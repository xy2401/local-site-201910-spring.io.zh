<html dir="ltr" data-clipboard-buttons="" data-code-prettify="" data-code-sidebar="" data-hide-show-guide="" data-sts-import="" data-mobile-support="" data-search=""><head>
<title>入门·使用JMS进行消息传递</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>System.config({baseURL: "/b92013b"});</script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>System.import('app/main.js')</script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link rel="stylesheet" type="text/css" href="/css/gsguide-cce08ab7a9f46db88819a14148e45bad.css">

<meta property="og:title" content="Messaging with JMS">
<meta property="og:image" content="/img/spring-by-pivotal-9066b55828deb3c10e27e609af322c40.png">
<meta property="og:description" content="this guide is designed to get you productive as quickly as possible and using the latest Spring project releases and techniques as recommended by the Spring team">
</head>
<body dir="ltr">

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">// Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }</script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link active">
<a href="/guides">导游</a>
</li>
<li class="navbar-link">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<main class="main-body--wrapper">
<div class="row-fluid">
<div class="span8 mobile-left-pane">
<div class="content--title desktop-only">入门</div>
<article class="content--container">
<h1 class="title">使用JMS进行消息传递</h1>
<div class="article-body"><div class="paragraph">
<p>本指南将引导您完成使用JMS代理发布和订阅消息的过程。</p>
</div>
<div class="sect1">
<h2 id="_what_youll_build">你会建立什么</h2>
<div class="sectionbody">
<div class="paragraph">
<p>您将构建一个使用Spring的<code>JmsTemplate</code>来发布单个消息并使用托管Bean的<code>@JmsListener</code>annotation方法对其进行订阅的应用程序。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_youll_need">你需要什么</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li> <p>约15分钟</p> </li>
<li> <p>最喜欢的文本编辑器或IDE</p> </li>
<li> <p><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">JDK 1.8</a>或更高版本</p> </li>
<li> <p><a href="http://www.gradle.org/downloads">Gradle 4+</a>或<a href="https://maven.apache.org/download.cgi">Maven 3.2+</a></p> </li>
<li> <p>您还可以将代码直接导入到IDE中：</p>
<div class="ulist">
<ul>
<li> <p><a href="/guides/gs/sts">Spring Tool Suite（STS）</a></p> </li>
<li> <p><a href="/guides/gs/intellij-idea/">IntelliJ IDEA</a></p> </li>
</ul>
</div> </li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_complete_this_guide">如何完成本指南</h2>
<div class="sectionbody">
<div class="paragraph">
<p>像大多数Spring <a href="/guides">入门指南</a>一样，您可以从头开始并完成每个步骤，也可以绕过您已经熟悉的基本设置步骤。无论哪种方式，您最终都可以使用工作代码。</p>
</div>
<div class="paragraph">
<p>要<strong>从头开始</strong> ，请继续<a href="#scratch">使用Gradle构建</a> 。</p>
</div>
<div class="paragraph">
<p>要<strong>跳过基础知识</strong> ，请执行以下操作：</p>
</div>
<div class="ulist">
<ul>
<li> <p><a href="https://github.com/spring-guides/gs-messaging-jms/archive/master.zip">下载</a>并解压缩本指南的源存储库，或使用<a href="/understanding/Git">Git</a>对其进行<code>git clone <a href="https://github.com/spring-guides/gs-messaging-jms.git" class="bare">https://github.com/spring-guides/gs-messaging-jms.git</a></code> ： <code>git clone <a href="https://github.com/spring-guides/gs-messaging-jms.git" class="bare">https://github.com/spring-guides/gs-messaging-jms.git</a></code></p> </li>
<li> <p>cd到<code>gs-messaging-jms/initial</code></p> </li>
<li> <p>继续<a href="#initial">创建消息接收器</a> 。</p> </li>
</ul>
</div>
<div class="paragraph">
<p><strong>完成后</strong> ，可以根据<code>gs-messaging-jms/complete</code>中的代码检查结果。</p>
</div>
</div>
</div>
<div class="sect1 reveal-gradle">
<h2 id="reveal-gradle">用Gradle构建</h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1 use-gradle">
<h2 id="scratch">用Gradle构建</h2>
<div class="sectionbody">
<div class="paragraph">
<p>首先，您设置一个基本的构建脚本。在使用Spring构建应用程序时，可以使用任何喜欢的构建系统，但此处包含使用<a href="http://gradle.org">Gradle</a>和<a href="https://maven.apache.org">Maven</a>所需的代码。如果您都不熟悉，请参阅<a href="/guides/gs/gradle">使用Gradle</a> <a href="/guides/gs/maven">构建Java项目</a>或<a href="/guides/gs/maven">使用Maven构建Java项目</a> 。</p>
</div>
<div class="sect2">
<h3 id="_create_the_directory_structure">创建目录结构</h3>
<div class="paragraph">
<p>在您选择的项目目录中，创建以下子目录结构；例如，在* nix系统上使用<code>mkdir -p src/main/java/hello</code> ：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>└── src
    └── main
        └── java
            └── hello</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_gradle_build_file">创建一个Gradle构建文件</h3>
<div class="paragraph">
<p>以下是<a href="https://github.com/spring-guides/gs-messaging-jms/blob/master/initial/build.gradle">最初的Gradle构建文件</a> 。</p>
</div>
<div class="paragraph">
<p><code>build.gradle</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:2.1.6.RELEASE")
    }
}

apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'idea'
apply plugin: 'org.springframework.boot'
apply plugin: 'io.spring.dependency-management'

bootJar {
    baseName = 'gs-messaging-jms'
    version =  '0.1.0'
}

repositories {
    mavenCentral()
}

sourceCompatibility = 1.8
targetCompatibility = 1.8

dependencies {
    compile("org.springframework.boot:spring-boot-starter-activemq")
    compile("org.apache.activemq:activemq-broker")
    compile("com.fasterxml.jackson.core:jackson-databind")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/html">Spring Boot gradle插件</a>提供了许多方便的功能：</p>
</div>
<div class="ulist">
<ul>
<li> <p>它收集类路径上的所有jar，并构建一个可运行的单个“über-jar”，这使执行和传输服务更加方便。</p> </li>
<li> <p>它搜索<code>public static void main()</code>方法以将其标记为可运行类。</p> </li>
<li> <p>它提供了一个内建的依赖解析器，设置了版本号，以匹配<a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-dependencies/pom.xml">Spring Boot dependencies</a> 。您可以覆盖所需的任何版本，但是它将默认为Boot选择的一组版本。</p> </li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1 reveal-maven">
<h2 id="reveal-maven">用Maven构建</h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1 use-maven">
<h2 id="use-maven">用Maven构建</h2>
<div class="sectionbody">
<div class="paragraph">
<p>首先，您设置一个基本的构建脚本。使用Spring构建应用程序时，可以使用任何喜欢的构建系统，但是此处包含了使用<a href="https://maven.apache.org">Maven</a>所需的代码。如果您不熟悉Maven，请参阅使用Maven <a href="/guides/gs/maven">构建Java项目</a> 。</p>
</div>
<div class="sect2">
<h3 id="_create_the_directory_structure_2">创建目录结构</h3>
<div class="paragraph">
<p>在您选择的项目目录中，创建以下子目录结构；例如，在* nix系统上使用<code>mkdir -p src/main/java/hello</code> ：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>└── src
    └── main
        └── java
            └── hello</pre>
</div>
</div>
<div class="paragraph">
<p><code>pom.xml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml"><?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>org.springframework</groupId>
    <artifactId>gs-messaging-jms</artifactId>
    <version>0.1.0</version>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.1.6.RELEASE</version>
    </parent>

    <properties>
        <java.version>1.8</java.version>
    </properties>

    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-activemq</artifactId>
        </dependency>
        <dependency>
            <groupId>org.apache.activemq</groupId>
            <artifactId>activemq-broker</artifactId>
        </dependency>

        <dependency>
            <groupId>com.fasterxml.jackson.core</groupId>
            <artifactId>jackson-databind</artifactId>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>

</project></code></pre>
</div>
</div>
<div class="paragraph" gtc:encodedoriginal="PGRpdiBjbGFzcz0icGFyYWdyYXBoIj4=">
<p>The <a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin" gtc:encodedoriginal="PGEgaHJlZj0iaHR0cHM6Ly9kb2NzLnNwcmluZy5pby9zcHJpbmctYm9vdC9kb2NzL2N1cnJlbnQvbWF2ZW4tcGx1Z2luIj4=">Spring Boot Maven plugin</a> provides many convenient features:</p>
</div>
<div class="ulist" gtc:encodedoriginal="PGRpdiBjbGFzcz0idWxpc3QiPg==">
<ul>
<li> <p>It collects all the jars on the classpath and builds a single, runnable "über-jar", which makes it more convenient to execute and transport your service.</p> </li>
<li> <p>It searches for the <code gtc:encodedoriginal="PGNvZGUgZGF0YS1tYXJreD0iMjM2Ij4=">public static void main()</code> method to flag as a runnable class.</p> </li>
<li> <p>It provides a built-in dependency resolver that sets the version number to match <a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-dependencies/pom.xml" gtc:encodedoriginal="PGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3NwcmluZy1wcm9qZWN0cy9zcHJpbmctYm9vdC9ibG9iL21hc3Rlci9zcHJpbmctYm9vdC1wcm9qZWN0L3NwcmluZy1ib290LWRlcGVuZGVuY2llcy9wb20ueG1sIj4=">Spring Boot dependencies</a>. You can override any version you wish, but it will default to Boot’s chosen set of versions.</p> </li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1 reveal-sts" gtc:encodedoriginal="PGRpdiBjbGFzcz0ic2VjdDEgcmV2ZWFsLXN0cyI-">
<h2 id="reveal-sts" gtc:encodedoriginal="PGgyIGlkPSJyZXZlYWwtc3RzIj4=">Build with your IDE</h2>
<div class="sectionbody" gtc:encodedoriginal="PGRpdiBjbGFzcz0ic2VjdGlvbmJvZHkiPg==">
</div>
</div>
<div class="sect1 use-sts" gtc:encodedoriginal="PGRpdiBjbGFzcz0ic2VjdDEgdXNlLXN0cyI-">
<h2 id="use-sts" gtc:encodedoriginal="PGgyIGlkPSJ1c2Utc3RzIj4=">Build with your IDE</h2>
<div class="sectionbody" gtc:encodedoriginal="PGRpdiBjbGFzcz0ic2VjdGlvbmJvZHkiPg==">
<div class="ulist" gtc:encodedoriginal="PGRpdiBjbGFzcz0idWxpc3QiPg==">
<ul>
<li> <p>Read how to import this guide straight into <a href="/guides/gs/sts/" gtc:encodedoriginal="PGEgaHJlZj0iL2d1aWRlcy9ncy9zdHMvIj4=">Spring Tool Suite</a>.</p> </li>
<li> <p>Read how to work with this guide in <a href="/guides/gs/intellij-idea" gtc:encodedoriginal="PGEgaHJlZj0iL2d1aWRlcy9ncy9pbnRlbGxpai1pZGVhIj4=">IntelliJ IDEA</a>.</p> </li>
</ul>
</div>
</div>
</div>
<div class="sect1" gtc:encodedoriginal="PGRpdiBjbGFzcz0ic2VjdDEiPg==">
<h2 id="initial" gtc:encodedoriginal="PGgyIGlkPSJpbml0aWFsIj4=">Create a message receiver</h2>
<div class="sectionbody" gtc:encodedoriginal="PGRpdiBjbGFzcz0ic2VjdGlvbmJvZHkiPg==">
<div class="paragraph" gtc:encodedoriginal="PGRpdiBjbGFzcz0icGFyYWdyYXBoIj4=">
<p>Spring provides the means to publish messages to any <a href="/understanding/POJO" gtc:encodedoriginal="PGEgaHJlZj0iL3VuZGVyc3RhbmRpbmcvUE9KTyI-">POJO</a>.</p>
</div>
<div class="paragraph" gtc:encodedoriginal="PGRpdiBjbGFzcz0icGFyYWdyYXBoIj4=">
<p>In this guide, you will look at how to send a message out over a JMS message broker. To start things off, let’s create a very simply POJO that embodies the details of an email message. Pay note, we aren’t sending an email message. We’re simply sending the details from one place to another about WHAT to send in a message.</p>
</div>
<div class="paragraph" gtc:encodedoriginal="PGRpdiBjbGFzcz0icGFyYWdyYXBoIj4=">
<p><code gtc:encodedoriginal="PGNvZGUgZGF0YS1tYXJreD0iMjY0Ij4=">src/main/java/hello/Email.java</code></p>
</div>
<div class="listingblock" gtc:encodedoriginal="PGRpdiBjbGFzcz0ibGlzdGluZ2Jsb2NrIj4=">
<div class="content" gtc:encodedoriginal="PGRpdiBjbGFzcz0iY29udGVudCI-">
<pre class="prettyprint highlight" gtc:encodedoriginal="PHByZSBjbGFzcz0icHJldHR5cHJpbnQgaGlnaGxpZ2h0IiBkYXRhLW1hcmt4PSIyNjciPg=="><code class="language-java" data-lang="java">package hello;

public class Email {

    private String to;
    private String body;

    public Email() {
    }

    public Email(String to, String body) {
        this.to = to;
        this.body = body;
    }

    public String getTo() {
        return to;
    }

    public void setTo(String to) {
        this.to = to;
    }

    public String getBody() {
        return body;
    }

    public void setBody(String body) {
        this.body = body;
    }

    @Override
    public String toString() {
        return String.format("Email{to=%s, body=%s}", getTo(), getBody());
    }

}</code></pre>
</div>
</div>
<div class="paragraph" gtc:encodedoriginal="PGRpdiBjbGFzcz0icGFyYWdyYXBoIj4=">
<p>This POJO is quite simple, containing two fields, <strong>to</strong> and <strong>body</strong>, along with the presumed set of getters and setters.</p>
</div>
<div class="paragraph" gtc:encodedoriginal="PGRpdiBjbGFzcz0icGFyYWdyYXBoIj4=">
<p>From here, you can define a message receiver:</p>
</div>
<div class="paragraph" gtc:encodedoriginal="PGRpdiBjbGFzcz0icGFyYWdyYXBoIj4=">
<p><code gtc:encodedoriginal="PGNvZGUgZGF0YS1tYXJreD0iMjc3Ij4=">src/main/java/hello/Receiver.java</code></p>
</div>
<div class="listingblock" gtc:encodedoriginal="PGRpdiBjbGFzcz0ibGlzdGluZ2Jsb2NrIj4=">
<div class="content" gtc:encodedoriginal="PGRpdiBjbGFzcz0iY29udGVudCI-">
<pre class="prettyprint highlight" gtc:encodedoriginal="PHByZSBjbGFzcz0icHJldHR5cHJpbnQgaGlnaGxpZ2h0IiBkYXRhLW1hcmt4PSIyODAiPg=="><code class="language-java" data-lang="java">package hello;

import org.springframework.jms.annotation.JmsListener;
import org.springframework.stereotype.Component;

@Component
public class Receiver {

    @JmsListener(destination = "mailbox", containerFactory = "myFactory")
    public void receiveMessage(Email email) {
        System.out.println("Received <" + email + ">");
    }

}</code></pre>
</div>
</div>
<div class="paragraph" gtc:encodedoriginal="PGRpdiBjbGFzcz0icGFyYWdyYXBoIj4=">
<p><code gtc:encodedoriginal="PGNvZGUgZGF0YS1tYXJreD0iMjg0Ij4=">Receiver</code> is also known as a <strong>message driven POJO</strong>. As you can see in the code above, there is no need to implement any particular interface or for the method to have any particular name. Besides, the method may have a <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#jms-annotated-method-signature" gtc:encodedoriginal="PGEgaHJlZj0iaHR0cHM6Ly9kb2NzLnNwcmluZy5pby9zcHJpbmcvZG9jcy9jdXJyZW50L3NwcmluZy1mcmFtZXdvcmstcmVmZXJlbmNlL2h0bWxzaW5nbGUvI2ptcy1hbm5vdGF0ZWQtbWV0aG9kLXNpZ25hdHVyZSI-">very flexible signature</a>. Note in particular that this class has no import on the JMS API.</p>
</div>
<div class="paragraph" gtc:encodedoriginal="PGRpdiBjbGFzcz0icGFyYWdyYXBoIj4=">
<p>The <code gtc:encodedoriginal="PGNvZGUgZGF0YS1tYXJreD0iMjg5Ij4=">JmsListener</code> annotation defines the name of the <code gtc:encodedoriginal="PGNvZGUgZGF0YS1tYXJreD0iMjkwIj4=">Destination</code> that this method should listen to and the reference to the <code gtc:encodedoriginal="PGNvZGUgZGF0YS1tYXJreD0iMjkxIj4=">JmsListenerContainerFactory</code> to use to create the underlying message listener container. Strictly speaking that last attribute is not necessary unless you need to customize the way the container is built as Spring Boot registers a default factory if necessary.</p>
</div>
<div class="paragraph" gtc:encodedoriginal="PGRpdiBjbGFzcz0icGFyYWdyYXBoIj4=">
<p>The <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#jms-annotated-method-signature" gtc:encodedoriginal="PGEgaHJlZj0iaHR0cHM6Ly9kb2NzLnNwcmluZy5pby9zcHJpbmcvZG9jcy9jdXJyZW50L3NwcmluZy1mcmFtZXdvcmstcmVmZXJlbmNlL2ludGVncmF0aW9uLmh0bWwjam1zLWFubm90YXRlZC1tZXRob2Qtc2lnbmF0dXJlIj4=">reference documentation</a> covers this in more detail.</p>
</div>
</div>
</div>
<div class="sect1" gtc:encodedoriginal="PGRpdiBjbGFzcz0ic2VjdDEiPg==">
<h2 id="_send_and_receive_jms_messages_with_spring" gtc:encodedoriginal="PGgyIGlkPSJfc2VuZF9hbmRfcmVjZWl2ZV9qbXNfbWVzc2FnZXNfd2l0aF9zcHJpbmciPg==">Send and receive JMS messages with Spring</h2>
<div class="sectionbody" gtc:encodedoriginal="PGRpdiBjbGFzcz0ic2VjdGlvbmJvZHkiPg==">
<div class="paragraph" gtc:encodedoriginal="PGRpdiBjbGFzcz0icGFyYWdyYXBoIj4=">
<p>Next, wire up a sender and a receiver.</p>
</div>
<div class="paragraph" gtc:encodedoriginal="PGRpdiBjbGFzcz0icGFyYWdyYXBoIj4=">
<p><code gtc:encodedoriginal="PGNvZGUgZGF0YS1tYXJreD0iMzAyIj4=">src/main/java/hello/Application.java</code></p>
</div>
<div class="listingblock" gtc:encodedoriginal="PGRpdiBjbGFzcz0ibGlzdGluZ2Jsb2NrIj4=">
<div class="content" gtc:encodedoriginal="PGRpdiBjbGFzcz0iY29udGVudCI-">
<pre class="prettyprint highlight" gtc:encodedoriginal="PHByZSBjbGFzcz0icHJldHR5cHJpbnQgaGlnaGxpZ2h0IiBkYXRhLW1hcmt4PSIzMDUiPg=="><code class="language-java" data-lang="java">package hello;

import javax.jms.ConnectionFactory;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.autoconfigure.jms.DefaultJmsListenerContainerFactoryConfigurer;
import org.springframework.context.ConfigurableApplicationContext;
import org.springframework.context.annotation.Bean;
import org.springframework.jms.annotation.EnableJms;
import org.springframework.jms.config.DefaultJmsListenerContainerFactory;
import org.springframework.jms.config.JmsListenerContainerFactory;
import org.springframework.jms.core.JmsTemplate;
import org.springframework.jms.support.converter.MappingJackson2MessageConverter;
import org.springframework.jms.support.converter.MessageConverter;
import org.springframework.jms.support.converter.MessageType;

@SpringBootApplication
@EnableJms
public class Application {

    @Bean
    public JmsListenerContainerFactory<?> myFactory(ConnectionFactory connectionFactory,
                                                    DefaultJmsListenerContainerFactoryConfigurer configurer) {
        DefaultJmsListenerContainerFactory factory = new DefaultJmsListenerContainerFactory();
        // This provides all boot's default to this factory, including the message converter
        configurer.configure(factory, connectionFactory);
        // You could still override some of Boot's default if necessary.
        return factory;
    }

    @Bean // Serialize message content to json using TextMessage
    public MessageConverter jacksonJmsMessageConverter() {
        MappingJackson2MessageConverter converter = new MappingJackson2MessageConverter();
        converter.setTargetType(MessageType.TEXT);
        converter.setTypeIdPropertyName("_type");
        return converter;
    }

    public static void main(String[] args) {
        // Launch the application
        ConfigurableApplicationContext context = SpringApplication.run(Application.class, args);

        JmsTemplate jmsTemplate = context.getBean(JmsTemplate.class);

        // Send a message with a POJO - the template reuse the message converter
        System.out.println("Sending an email message.");
        jmsTemplate.convertAndSend("mailbox", new Email("<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9bf2f5fdf4dbfee3faf6ebf7feb5f8f4f6">[email protected]</a>", "Hello"));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@SpringBootApplication</code>是一个方便注释，它添加了以下所有内容：</p>
</div>
<div class="ulist">
<ul>
<li> <p><code>@Configuration</code> ：将类标记为应用程序上下文的Bean定义的源。</p> </li>
<li> <p><code>@EnableAutoConfiguration</code> ：告诉Spring Boot根据类路径设置，其他bean和各种属性设置开始添加bean。例如，如果<code>spring-webmvc</code>在类路径上，则此注释将应用程序标记为Web应用程序并激活诸如设置<code>DispatcherServlet</code>关键行为。</p> </li>
<li> <p><code>@ComponentScan</code> ：告诉Spring在<code>hello</code>包中寻找其他组件，配置和服务，让它找到控制器。</p> </li>
</ul>
</div>
<div class="paragraph">
<p><code>main()</code>方法使用Spring Boot的<code>SpringApplication.run()</code>方法启动应用程序。您是否注意到没有一行XML？也没有<code>web.xml</code>文件。该Web应用程序是100％纯Java，因此您无需处理任何管道或基础结构。</p>
</div>
<div class="paragraph">
<p><code>@EnableJms</code>触发使用<code>@JmsListener</code>annotation的方法的发现，在<code>@JmsListener</code>创建消息侦听器容器。</p>
</div>
<div class="paragraph">
<p>为了清楚起见，我们还定义了一个<code>myFactory</code> bean，该bean在接收方的<code>JmsListener</code>annotation中引用。由于我们使用的<code>DefaultJmsListenerContainerFactoryConfigurer</code>由Spring提供的启动基础设施建设，这<code>JmsMessageListenerContainer</code>将是相同的一个启动默认创建。</p>
</div>
<div class="paragraph">
<p>默认的<code>MessageConverter</code>只能转换基本类型（例如<code>String</code> ， <code>Map</code> ， <code>Serializable</code> ），而我们的<code>Email</code>不是有意进行<code>Serializable</code> 。我们要使用Jackson并将内容序列化为文本格式的json（即，作为<code>TextMessage</code> ）。Spring Boot将检测到<code>MessageConverter</code>的存在，并将其与默认<code>JmsTemplate</code>和<code>JmsListenerContainerFactory</code>创建的任何<code>JmsListenerContainerFactory</code> <code>DefaultJmsListenerContainerFactoryConfigurer</code> 。</p>
</div>
<div class="paragraph">
<p><code>JmsTemplate</code>使发送消息到JMS目标变得非常简单。在<code>main</code>方法中，启动后，您可以仅使用<code>jmsTemplate</code>发送<code>Email</code> POJO。因为我们的自定义<code>MessageConverter</code>已自动与其关联，所以将仅在<code>TextMessage</code>生成一个json文档。</p>
</div>
<div class="paragraph">
<p>您没有看到定义的两个bean是<code>JmsTemplate</code>和<code>ConnectionFactory</code> 。这些是由Spring Boot自动创建的。在这种情况下，ActiveMQ代理将运行嵌入式。</p>
</div>
<div class="paragraph">
<p>默认情况下，Spring Boot通过将<strong>pubSubDomain</strong>设置为false <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#jms-destinations">来</a>创建一个<code>JmsTemplate</code> ，该<code>JmsTemplate</code>配置为<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#jms-destinations">传输到队列</a> 。<code>JmsMessageListenerContainer</code>的配置也相同。要覆盖，请通过Boot的属性设置（在<code>application.properties</code>内部或通过环境变量）设置<code>spring.jms.isPubSubDomain=true</code> 。然后确保接收容器的设置相同。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="注意"></i> </td>
<td class="content">Spring的<code>JmsTemplate</code>可以直接通过其<code>receive</code>方法接收消息，但是只能同步工作，这意味着它将阻塞。这就是为什么我们建议您使用监听器容器，如<code>DefaultMessageListenerContainer</code>与基于缓存的连接工厂，所以你可以异步和最大连接效率使用消息。</td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_build_an_executable_jar">构建可执行的JAR</h3>
<div class="paragraph">
<p>您可以使用Gradle或Maven从命令行运行该应用程序。您还可以构建一个包含所有必需的依赖项，类和资源的可执行JAR文件，然后运行该文件。构建可执行的jar使得在整个开发生命周期中，跨不同环境等等的情况下，轻松地将服务作为应用程序进行发布，版本化和部署。</p>
</div>
<div class="paragraph">
<p>如果使用Gradle，则可以使用<code>./gradlew bootRun</code>运行应用程序。或者，您可以使用<code>./gradlew build</code>来<code>./gradlew build</code> JAR文件，然后运行JAR文件，如下所示：</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock has-copy-button">
<div class="content">
<pre>java -jar build/libs/gs-messaging-jms-0.1.0.jar</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>如果你使用Maven，您可以运行通过使用应用程序<code>./mvnw spring-boot:run</code> 。或者，您可以使用<code>./mvnw clean package</code>构建JAR文件，然后运行JAR文件，如下所示：</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock has-copy-button">
<div class="content">
<pre>java -jar target/gs-messaging-jms-0.1.0.jar</pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="注意"></i> </td>
<td class="content">此处描述的步骤将创建可运行的JAR。您还可以<a href="/guides/gs/convert-jar-to-war/">构建经典的WAR文件</a> 。</td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph">
<p>当它运行时，埋在所有日志中，您应该看到以下消息：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Sending an email message.
Received <Email{<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d8acb7e5b1b6beb798bda0b9b5a8b4bdf6bbb7b5">[email protected]</a>, body=Hello}></pre><a>
</a></div><a>
</a></div><a>
</a></div><a>
</a></div><a>
</a></div><a>
</a><div class="sect1"><a>
<h2 id="_summary">摘要</h2>
<div class="sectionbody">
<div class="paragraph">
<p>恭喜你！您刚刚开发了基于JMS的消息的发布者和使用者。</p>
</div>
<div class="paragraph">
<p>是否要编写新指南或为现有指南做出贡献？看看我们的<a href="https://github.com/spring-guides/getting-started-guides/wiki">贡献准则</a> 。</p>
</div>
<div class="admonitionblock important">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-important" title="重要"></i> </td>
<td class="content">所有的导游都发布了一个ASLv2许可证的代码，一个<a href="https://creativecommons.org/licenses/by-nd/3.0/">署名，NoDerivatives Creative Commons许可</a>的写作。</td>
</tr>
</tbody>
</table>
</div>
</div></a>
</div>
</div>
</article></div>
</div>
<aside class="span4 content-right-pane--container mobile-left-pane" id="sidebar">
<a class="ci-status desktop-only" href="https://travis-ci.org/spring-guides/gs-messaging-jms">
<img src="https://travis-ci.org/spring-guides/gs-messaging-jms.svg?branch=master">
</a>
<div class="right-pane-widget--container desktop-only">
<div class="github-actions https">
<h2>获取代码</h2>
<div class="btn-group">
<button class="btn" data-protocol="https">HTTPS</button>
<button class="btn" data-protocol="ssh">SSH协议</button>
</div>
<div class="clone-url https">
<input id="clone-url-https" type="text" value="https://github.com/spring-guides/gs-messaging-jms.git" readonly>
<button class="copy-button github" data-toggle="tooltip" data-clipboard-text="https://github.com/spring-guides/gs-messaging-jms.git"></button>
</div>
<div class="clone-url ssh">
<input id="clone-url-ssh" type="text" value="git@github.com:spring-guides/gs-messaging-jms.git" readonly>
<button class="copy-button github" data-toggle="tooltip" data-clipboard-text="git@github.com:spring-guides/gs-messaging-jms.git"></button>
</div>
<a class="github_download btn btn-black uppercase" href="https://github.com/spring-guides/gs-messaging-jms/archive/master.zip">下载ZIP</a> <a class="gs-guide-import" href="https://github.com/spring-guides/gs-messaging-jms.git">导入到STS</a>
<div class="go-to-repo--container">
<a href="https://github.com/spring-guides/gs-messaging-jms"><i class="icon-github"></i>Go To Repo</a>
</div>
<div class="go-to-repo--container">
</div>
</div>
</div>
<div class="right-pane-widget--container">
<div>
<h3><a class="anchor" href="#table-of-contents" name="table-of-contents"></a>目录</h3>
<div><ul class="sectlevel1">
<li><a href="#_what_youll_build">你会建立什么</a></li>
<li><a href="#_what_youll_need">你需要什么</a></li>
<li><a href="#_how_to_complete_this_guide">如何完成本指南</a></li>
<li><a href="#scratch">用Gradle构建</a> </li>
<li><a href="#use-maven">用Maven构建</a> </li>
<li><a href="#use-sts">使用您的IDE进行构建</a></li>
<li><a href="#initial">创建一个消息接收者</a></li>
<li><a href="#_send_and_receive_jms_messages_with_spring">使用Spring发送和接收JMS消息</a> </li>
<li><a href="#_summary">摘要</a></li>
</ul></div>
</div>
</div>
</aside>
</main></div>

</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>

<script src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js" data-cfasync="false"></script></body></html>