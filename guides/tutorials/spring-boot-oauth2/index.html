<!DOCTYPE html>
<html data-clipboard-buttons="" data-code-prettify="" data-code-sidebar="" data-hide-show-guide="" data-sts-import="" data-mobile-support="" data-search="">
<head>
<title>Tutorial · Spring Boot and OAuth2</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link rel="stylesheet" type="text/css" href="/css/gsguide-cce08ab7a9f46db88819a14148e45bad.css" />

<meta property="og:title" content="Spring Boot and OAuth2" />
<meta property="og:image" content="/img/spring-by-pivotal-9066b55828deb3c10e27e609af322c40.png" />
<meta property="og:description" content="this tutorial is designed to be completed in 2-3 hours, it provides deeper, in-context explorations of enterprise application development topics, leaving you ready to implement real-world solutions." />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link active">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<main class="main-body--wrapper">
<div class="row-fluid">
<div class="span8 mobile-left-pane">
<div class="content--title desktop-only">Tutorial</div>
<article class="content--container">
<h1 class="title">Spring Boot and OAuth2</h1>
<div class="article-body"><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide shows you how to build a sample app doing various things with "social login" using <a href="https://tools.ietf.org/html/rfc6749">OAuth2</a> and <a href="https://projects.spring.io/spring-boot/">Spring Boot</a>. It starts with a simple, single-provider single-sign on, and works up to a self-hosted OAuth2 Authorization Server with a choice of authentication providers (<a href="https://developers.facebook.com">Facebook</a> or <a href="https://developer.github.com/">Github</a>). The samples are all single-page apps using Spring Boot and Spring OAuth on the back end. They also all use plain <a href="https://jquery.org/">jQuery</a> on the front end, but the changes needed to convert to a different JavaScript framework or to use server side rendering would be minimal.</p>
</div>
<div class="paragraph">
<p>Because one of the samples is a full OAuth2 Authorization Server we have used the <a href="https://docs.spring.io/spring-security-oauth2-boot/docs/current/reference/htmlsingle/">shim JAR</a> which supports bridging from Spring Boot 2.0 to the old Spring Security OAuth2 library. The simpler samples could also be implemented using the native OAuth2 support in <a href="https://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#boot-features-security-oauth2">Spring Boot</a> security features. The configuration is very similar.</p>
</div>
<div class="paragraph">
<p>There are several samples building on each other adding new features:</p>
</div>
<div class="ulist">
<ul>
<li> <p><a href="#_social_login_simple"><strong>simple</strong></a>: a very basic static app with just a home page and unconditional login through via Spring Boot’s <code>@EnableOAuth2Sso</code> (if you visit the home page you will be automatically redirected to Facebook).</p> </li>
<li> <p><a href="#_social_login_click"><strong>click</strong></a>: adds an explicit link that the user has to click to login.</p> </li>
<li> <p><a href="#_social_login_logout"><strong>logout</strong></a>: adds a logout link as well for authenticated users.</p> </li>
<li> <p><a href="#_social_login_manual"><strong>manual</strong></a>: shows how the <code>@EnableOAuth2Sso</code> works by unpicking it and configuring all its pieces manually.</p> </li>
<li> <p><a href="#_social_login_github"><strong>github</strong></a>: adds a second login provider in Github, so the user can choose on the home page which one to use.</p> </li>
<li> <p><a href="#_social_login_authserver"><strong>auth-server</strong></a>: turns the app into a fully-fledged OAuth2 Authorization Server, able to issue its own tokens, but still using the external OAuth2 providers for authentication.</p> </li>
<li> <p><a href="#_social_login_custom_error"><strong>custom-error</strong></a>: adds an error message for unauthenticated users, and a custom authentication based on Github API.</p> </li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content"> The changes needed to migrate from one app to the next one in the feature ladder can be tracked in the source (the source code is <a href="https://github.com/spring-guides/tut-spring-boot-oauth2">in Github</a>). The first 6 changes in the repository are transforming a single app so you can easily see the differences. Any further differences you might see between the app in those early commits and the final state you see in the guide are cosmetic. </td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph">
<p>Each of them can be imported into an IDE and there is a main class <code>SocialApplication</code> that you can run there to start the apps. They all come up with a home page on <a href="http://localhost:8080" class="bare">http://localhost:8080</a> (and all require that you have at least a Facebook account if you want to log in and see the content). You can also run all the apps on the command line using <code>mvn spring-boot:run</code> or by building the jar file and running it with <code>mvn package</code> and <code>java -jar target/*.jar</code> (per the <a href="https://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#getting-started-first-application-run">Spring Boot docs</a> and other <a href="https://spring.io/guides/gs/spring-boot/">available documentation</a>). There is no need to install Maven if you use the <a href="https://github.com/takari/maven-wrapper">wrapper</a> at the top level, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ cd simple
$ ../mvnw package
$ java -jar target/*.jar</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content"> The apps all work on <code>localhost:8080</code> because they use OAuth2 clients registered with Facebook and Github for that address. To run them on a different host or port, you need to register your own apps and put the credentials in the config files. There is no danger of leaking your Facebook or Github credentials beyond localhost if you use the default values, but be careful what you expose on the internet, and don’t put your own app registrations in public source control. </td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_social_login_simple">Single Sign On With Facebook</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we create a minimal application that uses Facebook for authentication. This will be quite easy if we take advantage of the autoconfiguration features in Spring Boot.</p>
</div>
<div class="sect2">
<h3 id="_creating_a_new_project">Creating a New Project</h3>
<div class="paragraph">
<p>First we need to create a Spring Boot application, which can be done in a number of ways. The easiest is to go to <a href="https://start.spring.io" class="bare">https://start.spring.io</a> and generate an empty project (choosing the "Web" dependency as starting points). Equivalently do this on the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ mkdir ui &amp;&amp; cd ui
$ curl https://start.spring.io/starter.tgz -d style=web -d name=simple | tar -xzvf -</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then import that project into your favourite IDE (it’s a normal Maven Java project by default), or just work with the files and "mvn" on the command line.</p>
</div>
</div>
<div class="sect2">
<h3 id="_add_a_home_page">Add a Home Page</h3>
<div class="paragraph">
<p>In your new project create an <code>index.html</code> in the "src/main/resources/static" folder. You should add some style sheets and java script links so the result looks like this:</p>
</div>
<div class="listingblock">
<div class="title">
index.html
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;!doctype html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="utf-8"/&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"/&gt;
    &lt;title&gt;Demo&lt;/title&gt;
    &lt;meta name="description" content=""/&gt;
    &lt;meta name="viewport" content="width=device-width"/&gt;
    &lt;base href="/"/&gt;
    &lt;link rel="stylesheet" type="text/css" href="/webjars/bootstrap/css/bootstrap.min.css"/&gt;
    &lt;script type="text/javascript" src="/webjars/jquery/jquery.min.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="/webjars/bootstrap/js/bootstrap.min.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;h1&gt;Demo&lt;/h1&gt;
	&lt;div class="container"&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>None of this is necessary to demonstrate the OAuth2 login features, but we want to have a nice looking UI in the end, so we might as well start with some basic stuff in the home page.</p>
</div>
<div class="paragraph">
<p>If you start the app and load the home page you will notice that the stylesheets have not been loaded. So we need to add those as well, and we can do that by adding some dependencies:</p>
</div>
<div class="listingblock">
<div class="title">
pom.xml
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
	&lt;groupId&gt;org.webjars&lt;/groupId&gt;
	&lt;artifactId&gt;jquery&lt;/artifactId&gt;
	&lt;version&gt;2.1.1&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.webjars&lt;/groupId&gt;
	&lt;artifactId&gt;bootstrap&lt;/artifactId&gt;
	&lt;version&gt;3.2.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.webjars&lt;/groupId&gt;
	&lt;artifactId&gt;webjars-locator-core&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We added Twitter bootstrap and jQuery (which is all we need right now). The other dependency is the webjars "locator" which is provided as a library by the webjars site, and which can be used by Spring to locate static assets in webjars without needing to know the exact versions (hence the versionless <code>/webjars/**</code> links in the <code>index.html</code>). The webjar locator is activated by default in a Spring Boot app as long as you don’t switch off the MVC autoconfiguration.</p>
</div>
<div class="paragraph">
<p>With those changes in place we should have a nice looking home page for our app.</p>
</div>
</div>
<div class="sect2">
<h3 id="_securing_the_application">Securing the Application</h3>
<div class="paragraph">
<p>To make the application secure we just need to add Spring Security as a dependency. If we do that the default will be to secure it with HTTP Basic, so since we want to do a "social" login (delegate to Facebook), we add the Spring Security OAuth2 dependency as well:</p>
</div>
<div class="listingblock">
<div class="title">
pom.xml
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
	&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.security.oauth.boot&lt;/groupId&gt;
	&lt;artifactId&gt;spring-security-oauth2-autoconfigure&lt;/artifactId&gt;
	&lt;version&gt;2.0.0.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make the link to Facebook we need an <code>@EnableOAuth2Sso</code> annotation on our main class:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@SpringBootApplication
@EnableOAuth2Sso
public class SocialApplication {

  ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and some configuration (converting <code>application.properties</code> to YAML for better readability):</p>
</div>
<div class="listingblock">
<div class="title">
application.yml
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-yaml" data-lang="yaml">security:
  oauth2:
    client:
      clientId: 233668646673605
      clientSecret: 33b17e044ee6a4fa383f46ec6e28ea1d
      accessTokenUri: https://graph.facebook.com/oauth/access_token
      userAuthorizationUri: https://www.facebook.com/dialog/oauth
      tokenName: oauth_token
      authenticationScheme: query
      clientAuthenticationScheme: form
    resource:
      userInfoUri: https://graph.facebook.com/me
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration refers to a client app registered with Facebook in their <a href="https://developers.facebook.com">developers</a> site, in which you have to supply a registered redirect (home page) for the app. This one is registered to "localhost:8080" so it only works in an app running on that address.</p>
</div>
<div class="paragraph">
<p>With that change you can run the app again and visit the home page at <a href="http://localhost:8080" class="bare">http://localhost:8080</a>. Instead of the home page you should be redirected to login with Facebook. If you do that, and accept any authorizations you are asked to make, you will be redirected back to the local app and the home page will be visible. If you stay logged into Facebook, you won’t have to re-authenticate with this local app, even if you open it in a fresh browser with no cookies and no cached data. (That’s what Single Sign On means.)</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td>
<td class="content"> if you are working through this section with the sample application, be sure to clear your browser cache of cookies and HTTP Basic credentials. In Chrome the best way to do that for a single server is to open a new incognito window. </td>
</tr>
</tbody>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>It is safe to grant access to this sample because only the app running locally can use the tokens and the scope it asks for is limited. Be aware of what you are approving when you log into apps like this though: they might ask for permission to do more than you are comfortable with (e.g. they might ask for permission to change your personal data, which would be unlikely to be in your interest).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_what_just_happened">What Just Happened?</h3>
<div class="paragraph">
<p>The app you just wrote, in OAuth2 terms, is a Client Application and it uses the <a href="https://tools.ietf.org/html/rfc6749#section-4">authorization code grant</a> to obtain an access token from Facebook (the Authorization Server). It then uses the access token to ask Facebook for some personal details (only what you permitted it to do), including your login ID and your name. In this phase facebook is acting as a Resource Server, decoding the token that you send and checking it gives the app permission to access the user’s details. If that process is successful the app inserts the user details into the Spring Security context so that you are authenticated.</p>
</div>
<div class="paragraph">
<p>If you look in the browser tools (F12 on Chrome) and follow the network traffic for all the hops, you will see the redirects back and forth with Facebook, and finally you land back on the home page with a new <code>Set-Cookie</code> header. This cookie (<code>JSESSIONID</code> by default) is a token for your authentication details for Spring (or any servlet-based) applications.</p>
</div>
<div class="paragraph">
<p>So we have a secure application, in the sense that to see any content a user has to authenticate with an external provider (Facebook). We wouldn’t want to use that for an internet banking website, but for basic identification purposes, and to segregate content between different users of your site, it’s an excellent starting point, which explains why this kind of authentication is very popular these days. In the next section we are going to add some basic features to the application, and also make it a bit more obvious to users what is going on when they get that initial redirect to Facebook.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_social_login_click">Add a Welcome Page</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we modify the <a href="#_social_login_simple">simple</a> app we just built, by adding an explicit link to login with Facebook. Instead of being redirected immediately, the new link will be visible on the home page, and the user can choose to login or to stay unauthenticated. Only when the user has clicked on the link will he be shown the secure content.</p>
</div>
<div class="sect2">
<h3 id="_conditional_content_in_home_page">Conditional Content in Home Page</h3>
<div class="paragraph">
<p>To render some content conditional on whether the user is authenticated or not we could use server side rendering (e.g. with Freemarker or Tymeleaf), or we can just ask the browser to to it, using some JavaScript. To do that we are going to use <a href="https://angularjs.org/">AngularJS</a>, but if you prefer to use a different framework, it shouldn’t be very hard to translate the client code.</p>
</div>
<div class="paragraph">
<p>To get started with the dynamic content we need to mark up the HTML in parts of it are going to display it:</p>
</div>
<div class="listingblock">
<div class="title">
index.html
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;div class="container unauthenticated"&gt;
    With Facebook: &lt;a href="/login"&gt;click here&lt;/a&gt;
&lt;/div&gt;
&lt;div class="container authenticated" style="display:none"&gt;
    Logged in as: &lt;span id="user"&gt;&lt;/span&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This HTML sets us up with a need for some client side code that manipulates the <code>authenticated</code>, <code>unauthenticated</code> and <code>user</code> elements. Here’s a simple implementation of those features (drop them in at the end of the <code>&lt;body&gt;</code>):</p>
</div>
<div class="listingblock">
<div class="title">
index.html
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;script type="text/javascript"&gt;
    $.get("/user", function(data) {
        $("#user").html(data.userAuthentication.details.name);
        $(".unauthenticated").hide()
        $(".authenticated").show()
    });
&lt;/script&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_server_side_changes">Server Side Changes</h3>
<div class="paragraph">
<p>For this to work we need some changes on the server side. The "home" controller needs an endpoint at "/user" that describes the currently authenticated user. That’s quite easy to do, e.g. in our main class:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@SpringBootApplication
@EnableOAuth2Sso
@RestController
public class SocialApplication {

  @RequestMapping("/user")
  public Principal user(Principal principal) {
    return principal;
  }

  public static void main(String[] args) {
    SpringApplication.run(SocialApplication.class, args);
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of <code>@RestController</code> and <code>@RequestMapping</code> and the <code>java.security.Principal</code> we inject into the handler method.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-warning" title="Warning"></i> </td>
<td class="content"> It’s not a great idea to return a whole <code>Principal</code> in a <code>/user</code> endpoint like that (it might contain information you would rather not reveal to a browser client). We only did it to get something working quickly. Later in the guide we will convert the endpoint to hide the information we don’t need the browser to have. </td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph">
<p>This app will now work fine and authenticate as before, but without giving the user a chance to click on the link we just provided. To make the link visible we also need to switch off the security on the home page by adding a <code>WebSecurityConfigurer</code>:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@SpringBootApplication
@EnableOAuth2Sso
@RestController
public class SocialApplication extends WebSecurityConfigurerAdapter {

  ...

  @Override
  protected void configure(HttpSecurity http) throws Exception {
    http
      .antMatcher("/**")
      .authorizeRequests()
        .antMatchers("/", "/login**", "/webjars/**", "/error**")
        .permitAll()
      .anyRequest()
        .authenticated();
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Boot attaches a special meaning to a <code>WebSecurityConfigurer</code> on the class that carries the <code>@EnableOAuth2Sso</code> annotation: it uses it to configure the security filter chain that carries the OAuth2 authentication processor. So all we need to do to make our home page visible is to explicitly <code>authorizeRequests()</code> to the home page and the static resources it contains (we also include access to the login endpoints which handle the authentication). All other requests (e.g. to the <code>/user</code> endpoint) require authentication.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content"> <code>/error**</code> is an unprotected path because we want Spring Boot to be able to render errors if there is a problem in the app, even if the user is unauthenticated. </td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph">
<p>With that change in place the application is complete, and if you run it and visit the home page you should see a nicely styled HTML link to "login with Facebook". The link takes you not directly to Facebook, but to the local path that processes the authentication (and sends a redirect to Facebook). Once you have authenticated you get redirected back to the local app, where it now displays your name (assuming you have set up your permissions in Facebook to allow access to that data).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_social_login_logout">Add a Logout Button</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we modify the <a href="#_social_login_click">click</a> app we built by adding a button that allows the user to log out of the app. This seems like a simple feature, but it requires a bit of care to implement, so it’s worth spending some time discussing exactly how to do it. Most of the changes are to do with the fact that we are transforming the app from a read-only resource to a read-write one (logging out requires a state change), so the same changes would be needed in any realistic application that wasn’t just static content.</p>
</div>
<div class="sect2">
<h3 id="_client_side_changes">Client Side Changes</h3>
<div class="paragraph">
<p>On the client we just need to provide a logout button and some JavaScript to call back to the server to ask for the authentication to be cancelled. First, in the "authenticated" section of the UI, we add the button:</p>
</div>
<div class="listingblock">
<div class="title">
index.html
</div>
<div class="content">
<pre>&lt;div class="container authenticated"&gt;
  Logged in as: &lt;span id="user"&gt;&lt;/span&gt;
  &lt;div&gt;
    &lt;button onClick="logout()" class="btn btn-primary"&gt;Logout&lt;/button&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>and then we provide the <code>logout()</code> function that it refers to in the JavaScript:</p>
</div>
<div class="listingblock">
<div class="title">
index.html
</div>
<div class="content">
<pre>var logout = function() {
    $.post("/logout", function() {
        $("#user").html('');
        $(".unauthenticated").show();
        $(".authenticated").hide();
    })
    return true;
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>logout()</code> function does a POST to <code>/logout</code> and then clears the dynamic content. Now we can switch over to the server side to implement that endpoint.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_a_logout_endpoint">Adding a Logout Endpoint</h3>
<div class="paragraph">
<p>Spring Security has built in support for a <code>/logout</code> endpoint which will do the right thing for us (clear the session and invalidate the cookie). To configure the endpoint we simply extend the existing <code>configure()</code> method in our <code>WebSecurityConfigurer</code>:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Override
protected void configure(HttpSecurity http) throws Exception {
  http.antMatcher("/**")
    ... // existing code here
    .and().logout().logoutSuccessUrl("/").permitAll();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>/logout</code> endpoint requires us to POST to it, and to protect the user from Cross Site Request Forgery (CSRF, pronounced "sea surf"), it requires a token to be included in the request. The value of the token is linked to the current session, which is what provides the protection, so we need a way to get that data into our JavaScript app.</p>
</div>
<div class="paragraph">
<p>Many JavaScript frameworks have built in support for CSRF (e.g. in Angular they call it XSRF), but it is often implemented in a slightly different way than the out-of-the box behaviour of Spring Security. For instance in Angular the front end would like the server to send it a cookie called "XSRF-TOKEN" and if it sees that, it will send the value back as a header named "X-XSRF-TOKEN". We can implement the same behaviour with our simple jQuery client, and then the server side changes will work with other front end implementations with no or very few changes. To teach Spring Security about this we need to add a filter that creates the cookie and also we need to tell the existing CRSF filter about the header name. In the <code>WebSecurityConfigurer</code>:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Override
protected void configure(HttpSecurity http) throws Exception {
  http.antMatcher("/**")
    ... // existing code here
    .and().csrf().csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse());
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_the_csrf_token_in_the_client">Adding the CSRF Token in the Client</h3>
<div class="paragraph">
<p>Since we are not using a higher level framework in this sample, we need to explicitly add the CSRF token, which we made available as a cookie from the backend. To make the code a bit simpler, we include an additional library:</p>
</div>
<div class="listingblock">
<div class="title">
pom.xml
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.webjars&lt;/groupId&gt;
    &lt;artifactId&gt;js-cookie&lt;/artifactId&gt;
    &lt;version&gt;2.1.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Import it in HTML:</p>
</div>
<div class="listingblock">
<div class="title">
index.html
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;script type="text/javascript" src="/webjars/js-cookie/js.cookie.js"&gt;&lt;/script&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>then we can use <code>Cookies</code> convenience methods in xhr:</p>
</div>
<div class="listingblock">
<div class="title">
index.html
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">$.ajaxSetup({
beforeSend : function(xhr, settings) {
  if (settings.type == 'POST' || settings.type == 'PUT'
      || settings.type == 'DELETE') {
    if (!(/^http:.*/.test(settings.url) || /^https:.*/
        .test(settings.url))) {
      // Only send the token to relative URLs i.e. locally.
      xhr.setRequestHeader("X-XSRF-TOKEN",
          Cookies.get('XSRF-TOKEN'));
    }
  }
}
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ready_to_roll">Ready To Roll!</h3>
<div class="paragraph">
<p>With those changes in place we are ready to run the app and try out the new logout button. Start the app and load the home page in a new browser window. Click on the "login" link to take you to Facebook (if you are already logged in there you might not notice the redirect). Click on the "Logout" button to cancel the current session and return the app to the unauthenticated state. If you are curious you should be able to see the new cookies and headers in the requests that the browser exchanges with the local server.</p>
</div>
<div class="paragraph">
<p>Remember that now the logout endpoint is working with the browser client, then all other HTTP requests (POST, PUT, DELETE, etc.) will also work just as well. So this should be a good platform for an application with some more realistic features.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_social_login_manual">Manual Configuration of OAuth2 Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we modify the <a href="#_social_login_logout">logout</a> app we already built by picking apart the "magic" in the <code>@EnableOAuth2Sso</code> annotation, manually configuring everything in there to make it explicit.</p>
</div>
<div class="sect2">
<h3 id="_clients_and_authentication">Clients and Authentication</h3>
<div class="paragraph">
<p>There are 2 features behind <code>@EnableOAuth2Sso</code>: the OAuth2 client, and the authentication. The client is re-usable, so you can also use it to interact with the OAuth2 resources that your Authorization Server (in this case Facebook) provides (in this case the <a href="https://developers.facebook.com/docs/graph-api">Graph API</a>). The authentication piece aligns your app with the rest of Spring Security, so once the dance with Facebook is over your app behaves exactly like any other secure Spring app.</p>
</div>
<div class="paragraph">
<p>The client piece is provided by Spring Security OAuth2 and switched on by a different annotation <code>@EnableOAuth2Client</code>. So the first step in this transformation is to remove the <code>@EnableOAuth2Sso</code> and replace it with the lower level annotation:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@SpringBootApplication
@EnableOAuth2Client
@RestController
public class SocialApplication extends WebSecurityConfigurerAdapter {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once that is done we have some stuff created for us that will be useful. First off we can inject an <code>OAuth2ClientContext</code> and use it to build an authentication filter that we add to our security configuration:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@SpringBootApplication
@EnableOAuth2Client
@RestController
public class SocialApplication extends WebSecurityConfigurerAdapter {

  @Autowired
  OAuth2ClientContext oauth2ClientContext;

  @Override
  protected void configure(HttpSecurity http) throws Exception {
    http.antMatcher("/**")
      ...
      .and().addFilterBefore(ssoFilter(), BasicAuthenticationFilter.class);
  }

  ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>this filter is created in new method where we use the <code>OAuth2ClientContext</code>:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private Filter ssoFilter() {
  OAuth2ClientAuthenticationProcessingFilter facebookFilter = new OAuth2ClientAuthenticationProcessingFilter("/login/facebook");
  OAuth2RestTemplate facebookTemplate = new OAuth2RestTemplate(facebook(), oauth2ClientContext);
  facebookFilter.setRestTemplate(facebookTemplate);
  UserInfoTokenServices tokenServices = new UserInfoTokenServices(facebookResource().getUserInfoUri(), facebook().getClientId());
  tokenServices.setRestTemplate(facebookTemplate);
  facebookFilter.setTokenServices(tokenServices);
  return facebookFilter;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the filter also needs to know about the client registration with Facebook:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">  @Bean
  @ConfigurationProperties("facebook.client")
  public AuthorizationCodeResourceDetails facebook() {
    return new AuthorizationCodeResourceDetails();
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>and to complete the authentication it needs to know where the user info endpoint is in Facebook:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">  @Bean
  @ConfigurationProperties("facebook.resource")
  public ResourceServerProperties facebookResource() {
    return new ResourceServerProperties();
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that with both these "static" data objects (<code>facebook()</code> and <code>facebookResource()</code>) we used a <code>@Bean</code> decorated as <code>@ConfigurationProperties</code>. That means that we can convert the <code>application.yml</code> to a slightly new format, where the prefix for configuration is <code>facebook</code> instead of <code>security.oauth2</code>:</p>
</div>
<div class="listingblock">
<div class="title">
application.yml
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-yaml" data-lang="yaml">facebook:
  client:
    clientId: 233668646673605
    clientSecret: 33b17e044ee6a4fa383f46ec6e28ea1d
    accessTokenUri: https://graph.facebook.com/oauth/access_token
    userAuthorizationUri: https://www.facebook.com/dialog/oauth
    tokenName: oauth_token
    authenticationScheme: query
    clientAuthenticationScheme: form
  resource:
    userInfoUri: https://graph.facebook.com/me</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we changed the path to the login to be facebook-specific in the <code>Filter</code> declaration above, so we need to make the same change in the HTML:</p>
</div>
<div class="listingblock">
<div class="title">
index.html
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;h1&gt;Login&lt;/h1&gt;
&lt;div class="container unauthenticated"&gt;
	&lt;div&gt;
	With Facebook: &lt;a href="/login/facebook"&gt;click here&lt;/a&gt;
	&lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handling_the_redirects">Handling the Redirects</h3>
<div class="paragraph">
<p>The last change we need to make is to explicitly support the redirects from our app to Facebook. This is handled in Spring OAuth2 with a servlet <code>Filter</code>, and the filter is already available in the application context because we used <code>@EnableOAuth2Client</code>. All that is needed is to wire the filter up so that it gets called in the right order in our Spring Boot application. To do that we need a <code>FilterRegistrationBean</code>:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Bean
	public FilterRegistrationBean&lt;OAuth2ClientContextFilter&gt; oauth2ClientFilterRegistration(OAuth2ClientContextFilter filter) {
		FilterRegistrationBean&lt;OAuth2ClientContextFilter&gt; registration = new FilterRegistrationBean&lt;OAuth2ClientContextFilter&gt;();
		registration.setFilter(filter);
		registration.setOrder(-100);
		return registration;
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We autowire the already available filter, and register it with a sufficiently low order that it comes <strong>before</strong> the main Spring Security filter. In this way we can use it to handle redirects signaled by exceptions in authentication requests.</p>
</div>
<div class="paragraph">
<p>With these changes in place the app is good to go, and at runtime is equivalent to the <a href="#_social_login_logout">logout</a> sample we built in the last section. Breaking the configuration down and making it explicit teaches us that there is nothing magical about what Spring Boot is doing (it’s just configuration boiler plate), and it also prepares our application for extending the features provided automatically out of the box, adding our own opinions and business requirements.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_social_login_github">Login with Github</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we modify the <a href="#_social_login_manual">app</a> we built already, adding a link so the user can choose to authenticate with Github, in addition to the original link to Facebook.</p>
</div>
<div class="sect2">
<h3 id="_adding_the_github_link">Adding the Github Link</h3>
<div class="paragraph">
<p>In the client the change is trivial, we just add another link:</p>
</div>
<div class="listingblock">
<div class="title">
index.html
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;div class="container unauthenticated"&gt;
  &lt;div&gt;
    With Facebook: &lt;a href="/login/facebook"&gt;click here&lt;/a&gt;
  &lt;/div&gt;
  &lt;div&gt;
    With Github: &lt;a href="/login/github"&gt;click here&lt;/a&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In principle, once we start adding authentication providers, we may need to be more careful about the data returned from the "/user" endpoint. It turns out that Github and Facebook both have a "name" field in the same place in their user info, so there isn’t any change in practice to our simple endpoint.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_the_github_authentication_filter">Adding the Github Authentication Filter</h3>
<div class="paragraph">
<p>The main change on the server is to add an additional security filter to handle the "/login/github" requests coming from our new link. We already have a custom authentication filter for Facebook created in our <code>ssoFilter()</code> method, so all we need to do is replace that with a composite that can handle more than one authentication path:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private Filter ssoFilter() {

  CompositeFilter filter = new CompositeFilter();
  List&lt;Filter&gt; filters = new ArrayList&lt;&gt;();

  OAuth2ClientAuthenticationProcessingFilter facebookFilter = new OAuth2ClientAuthenticationProcessingFilter("/login/facebook");
  OAuth2RestTemplate facebookTemplate = new OAuth2RestTemplate(facebook(), oauth2ClientContext);
  facebookFilter.setRestTemplate(facebookTemplate);
  UserInfoTokenServices tokenServices = new UserInfoTokenServices(facebookResource().getUserInfoUri(), facebook().getClientId());
  tokenServices.setRestTemplate(facebookTemplate);
  facebookFilter.setTokenServices(tokenServices);
  filters.add(facebookFilter);

  OAuth2ClientAuthenticationProcessingFilter githubFilter = new OAuth2ClientAuthenticationProcessingFilter("/login/github");
  OAuth2RestTemplate githubTemplate = new OAuth2RestTemplate(github(), oauth2ClientContext);
  githubFilter.setRestTemplate(githubTemplate);
  tokenServices = new UserInfoTokenServices(githubResource().getUserInfoUri(), github().getClientId());
  tokenServices.setRestTemplate(githubTemplate);
  githubFilter.setTokenServices(tokenServices);
  filters.add(githubFilter);

  filter.setFilters(filters);
  return filter;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the code from our old <code>ssoFilter()</code> has been duplicated, once for Facebook and once for Github, and the two filters merged into a composite.</p>
</div>
<div class="paragraph">
<p>Note that the <code>facebook()</code> and <code>facebookResource()</code> methods have been supplemented with similar methods <code>github()</code> and <code>githubResource()</code>:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Bean
@ConfigurationProperties("github.client")
public AuthorizationCodeResourceDetails github() {
	return new AuthorizationCodeResourceDetails();
}

@Bean
@ConfigurationProperties("github.resource")
public ResourceServerProperties githubResource() {
	return new ResourceServerProperties();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the corresponding configuration:</p>
</div>
<div class="listingblock">
<div class="title">
application.yml
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-yaml" data-lang="yaml">github:
  client:
    clientId: bd1c0a783ccdd1c9b9e4
    clientSecret: 1a9030fbca47a5b2c28e92f19050bb77824b5ad1
    accessTokenUri: https://github.com/login/oauth/access_token
    userAuthorizationUri: https://github.com/login/oauth/authorize
    clientAuthenticationScheme: form
  resource:
    userInfoUri: https://api.github.com/user</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client details here are registered with <a href="https://github.com/settings/developers">Github</a>, also with the address <code>localhost:8080</code> (same as for Facebook).</p>
</div>
<div class="paragraph">
<p>The app is now ready to run and gives the user the choice between authenticating with Facebook or Github.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_add_a_local_user_database">How to Add a Local User Database</h3>
<div class="paragraph">
<p>Many applications need to hold data about their users locally, even if authentication is delegated to an external provider. We don’t show the code here, but it is easy to do in two steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li> <p>Choose a backend for your database, and set up some repositories (e.g. using Spring Data) for a custom <code>User</code> object that suits your needs and can be populated, fully or partially, from the external authentication.</p> </li>
<li> <p>Provision a <code>User</code> object for each unique user that logs in by inspecting the repository in your <code>/user</code> endpoint. If there is already a user with the identity of the current <code>Principal</code>, it can be updated, otherwise created.</p> </li>
</ol>
</div>
<div class="paragraph">
<p>Hint: add a field in the <code>User</code> object to link to a unique identifier in the external provider (not the user’s name, but something that is unique to the account in the external provider).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_social_login_authserver">Hosting an Authorization Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we modify the <a href="#_social_login_github">github</a> app we built by making the app into a fully-fledged OAuth2 Authorization Server, still using Facebook and Github for authentication, but able to create its own access tokens. These tokens could then be used to secure back end resources, or to do SSO with other applications that we happen to need to secure the same way.</p>
</div>
<div class="sect2">
<h3 id="_tidying_up_the_authentication_configuration">Tidying up the Authentication Configuration</h3>
<div class="paragraph">
<p>Before we start with the Authorization Server features, we are going to just tidy up the configuration code for the two external providers. There is some code that is duplicated in the <code>ssoFilter()</code> method, so we pull that out into a shared method:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private Filter ssoFilter() {
  CompositeFilter filter = new CompositeFilter();
  List&lt;Filter&gt; filters = new ArrayList&lt;&gt;();
  filters.add(ssoFilter(facebook(), "/login/facebook"));
  filters.add(ssoFilter(github(), "/login/github"));
  filter.setFilters(filters);
  return filter;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The new convenience method has all the duplicated code from the old method:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">private Filter ssoFilter(ClientResources client, String path) {
  OAuth2ClientAuthenticationProcessingFilter filter = new OAuth2ClientAuthenticationProcessingFilter(path);
  OAuth2RestTemplate template = new OAuth2RestTemplate(client.getClient(), oauth2ClientContext);
  filter.setRestTemplate(template);
  UserInfoTokenServices tokenServices = new UserInfoTokenServices(
      client.getResource().getUserInfoUri(), client.getClient().getClientId());
  tokenServices.setRestTemplate(template);
  filter.setTokenServices(tokenServices);
  return filter;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and it uses a new wrapper object <code>ClientResources</code> that consolidates the <code>OAuth2ProtectedResourceDetails</code> and the <code>ResourceServerProperties</code> that were declared as separate <code>@Beans</code> in the last version of the app:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">class ClientResources {

  @NestedConfigurationProperty
  private AuthorizationCodeResourceDetails client = new AuthorizationCodeResourceDetails();

  @NestedConfigurationProperty
  private ResourceServerProperties resource = new ResourceServerProperties();

  public AuthorizationCodeResourceDetails getClient() {
    return client;
  }

  public ResourceServerProperties getResource() {
    return resource;
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content"> the wrapper uses <code>@NestedConfigurationProperty</code> to instructs the annotation processor to crawl that type for meta-data as well since it does not represents a single value but a complete nested type. </td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph">
<p>With this wrapper in place we can use the same YAML configuration as before, but a single method for each provider:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Bean
@ConfigurationProperties("github")
public ClientResources github() {
  return new ClientResources();
}

@Bean
@ConfigurationProperties("facebook")
public ClientResources facebook() {
  return new ClientResources();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_the_authorization_server">Enabling the Authorization Server</h3>
<div class="paragraph">
<p>If we want to turn our application into an OAuth2 Authorization Server, there isn’t a lot of fuss and ceremony, at least to get started with some basic features (one client and the ability to create access tokens). An Authorization Server is nothing more than a bunch of endpoints, and they are implemented in Spring OAuth2 as Spring MVC handlers. We already have a secure application, so it’s really just a matter of adding the <code>@EnableAuthorizationServer</code> annotation:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@SpringBootApplication
@RestController
@EnableOAuth2Client
@EnableAuthorizationServer
public class SocialApplication extends WebSecurityConfigurerAdapter {

   ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>with that new annotation in place Spring Boot will install all the necessary endpoints and set up the security for them, provided we supply a few details of an OAuth2 client we want to support:</p>
</div>
<div class="listingblock">
<div class="title">
application.yml
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-yaml" data-lang="yaml">security:
  oauth2:
    client:
      client-id: acme
      client-secret: acmesecret
      scope: read,write
      auto-approve-scopes: '.*'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This client is the equivalent of the <code>facebook.client*</code> and <code>github.client*</code> that we need for the external authentication. With the external providers we had to register and get a client ID and a secret to use in our app. In this case we are providing our own equivalent of the same feature, so we need (at least one) client for it to work.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content"> We have set the <code>auto-approve-scopes</code> to a regex matching all scopes. This is not necessarily where we would leave this app in a real system, but it gets us something working quickly without having to replace the whitelabel approval page that Spring OAuth2 would otherwise pop up for our users when they wanted an access token. To add an explicit approval step to the token grant we would need to provide a UI replacing the whitelabel version (at <code>/oauth/confirm_access</code>). </td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph">
<p>To finish the Authorization Server we just need to provide security configuration for its UI. In fact there isn’t much of a user interface in this simple app, but we still need to protect the <code>/oauth/authorize</code> endpoint, and make sure that the home page with the "Login" buttons is visible. That’s why we have this method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Override
protected void configure(HttpSecurity http) throws Exception {
  http.antMatcher("/**")                                       <i class="conum" data-value="1"></i><b>(1)</b>
    .authorizeRequests()
      .antMatchers("/", "/login**", "/webjars/**").permitAll() <i class="conum" data-value="2"></i><b>(2)</b>
      .anyRequest().authenticated()                            <i class="conum" data-value="3"></i><b>(3)</b>
    .and().exceptionHandling()
      .authenticationEntryPoint(new LoginUrlAuthenticationEntryPoint("/")) <i class="conum" data-value="4"></i><b>(4)</b>
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All requests are protected by default</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The home page and login endpoints are explicitly excluded</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>All other endpoints require an authenticated user</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Unauthenticated users are re-directed to the home page</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_get_an_access_token">How to Get an Access Token</h3>
<div class="paragraph">
<p>Access tokens are now available from our new Authorization Server. The simplest way to get a token up to now is to grab one as the "acme" client. You can see this if you run the app and curl it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ curl acme:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a3c2c0cec6d0c6c0d1c6d7e3cfccc0c2cfcbccd0d7">[email&#160;protected]</a>:8080/oauth/token -d grant_type=client_credentials
{"access_token":"370592fd-b9f8-452d-816a-4fd5c6b4b8a6","token_type":"bearer","expires_in":43199,"scope":"read write"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Client credentials tokens are useful in some circumstances (like testing that the token endpoint works), but to take advantage of all the features of our server we want to be able to create tokens for users. To get a token on behalf of a user of our app we need to be able to authenticate the user. If you were watching the logs carefully when the app started up you would have seen a random password being logged for the default Spring Boot user (per the <a href="https://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#boot-features-security">Spring Boot User Guide</a>). You can use this password to get a token on behalf of the user with id "user":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ curl acme:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3657555b53455355445342765a5955575a5e594542">[email&#160;protected]</a>:8080/oauth/token -d grant_type=password -d username=user -d password=...
{"access_token":"aa49e025-c4fe-4892-86af-15af2e6b72a2","token_type":"bearer","refresh_token":"97a9f978-7aad-4af7-9329-78ff2ce9962d","expires_in":43199,"scope":"read write"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where "…​" should be replaced with the actual password. This is called a "password" grant, where you exchange a username and password for an access token.</p>
</div>
<div class="paragraph">
<p>Password grant is also mainly useful for testing, but can be appropriate for a native or mobile application, when you have a local user database to store and validate the credentials. For most apps, or any app with "social" login, like ours, you need the "authorization code" grant, and that means you need a browser (or a client that behaves like a browser) to handle redirects and cookies, and render the user interfaces from the external providers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_client_application">Creating a Client Application</h3>
<div class="paragraph">
<p>A client application for our Authorization Server that is itself a web application is easy to create with Spring Boot. Here’s an example:</p>
</div>
<div class="listingblock">
<div class="title">
ClientApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@EnableAutoConfiguration
@Configuration
@EnableOAuth2Sso
@RestController
public class ClientApplication {

  @RequestMapping("/")
  public String home(Principal user) {
    return "Hello " + user.getName();
  }

  public static void main(String[] args) {
    new SpringApplicationBuilder(ClientApplication.class)
        .properties("spring.config.name=client").run(args);
  }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content"> The <code>ClientApplication</code> class MUST NOT be created in the same package (or a sub-package) of the <code>SocialApplication</code> class. Otherwise, Spring will load some <code>ClientApplication</code> auto-configurations while starting the <code>SocialApplication</code> server, resulting in startup errors. </td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph">
<p>The ingredients of the client are a home page (just prints the user’s name), and an explicit name for a configuration file (via <code>spring.config.name=client</code>). When we run this app it will look for a configuration file which we provide as follows:</p>
</div>
<div class="listingblock">
<div class="title">
client.yml
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-yaml" data-lang="yaml">server:
  port: 9999
  context-path: /client
security:
  oauth2:
    client:
      client-id: acme
      client-secret: acmesecret
      access-token-uri: http://localhost:8080/oauth/token
      user-authorization-uri: http://localhost:8080/oauth/authorize
    resource:
      user-info-uri: http://localhost:8080/me</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration looks a lot like the values we used in the main app, but with the "acme" client instead of the Facebook or Github ones. The app will run on port 9999 to avoid conflicts with the main app. And it refers to a user info endpoint "/me" which we haven’t implemented yet.</p>
</div>
<div class="paragraph">
<p>Note that the <code>server.context-path</code> is set explicitly, so if you run the app to test it remember the home page is <a href="http://localhost:9999/client" class="bare">http://localhost:9999/client</a>. Clicking on that link should take you to the auth server and once you you have authenticated with the social provider of your choice you will be redirected back to the client app.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content"> The context path has to be explicit if you are running both the client and the auth server on localhost, otherwise the cookie paths clash and the two apps cannot agree on a session identifier. </td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_protecting_the_user_info_endpoint">Protecting the User Info Endpoint</h3>
<div class="paragraph">
<p>To use our new Authorization Server for single sign on, just like we have been using Facebook and Github, it needs to have a <code>/user</code> endpoint that is protected by the access tokens it creates. So far we have a <code>/user</code> endpoint, and it is secured with cookies created when the user authenticates. To secure it in addition with the access tokens granted locally we can just re-use the existing endpoint and make an alias to it on a new path:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@RequestMapping({ "/user", "/me" })
public Map&lt;String, String&gt; user(Principal principal) {
  Map&lt;String, String&gt; map = new LinkedHashMap&lt;&gt;();
  map.put("name", principal.getName());
  return map;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content"> We have converted the <code>Principal</code> into a <code>Map</code> so as to hide the parts that we don’t want to expose to the browser, and also to unify the behaviour of the endpoint between the two external authentication providers. In principle we could add more detail here, like a provider-specific unique identifier for instance, or an e-mail address if it’s available. </td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph">
<p>The "/me" path can now be protected with the access token by declaring that our app is a Resource Server (as well as an Authorization Server). We create a new configuration class (as an inner class in the main app, but it could also be split out into a separate standalone class):</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Configuration
@EnableResourceServer
protected static class ResourceServerConfiguration
    extends ResourceServerConfigurerAdapter {
  @Override
  public void configure(HttpSecurity http) throws Exception {
    http
      .antMatcher("/me")
      .authorizeRequests().anyRequest().authenticated();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition we need to specify an <code>@Order</code> for the main application security:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@SpringBootApplication
...
@Order(SecurityProperties.ACCESS_OVERRIDE_ORDER)
public class SocialApplication extends WebSecurityConfigurerAdapter {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@EnableResourceServer</code> annotation creates a security filter with <code>@Order(SecurityProperties.ACCESS_OVERRIDE_ORDER-1)</code> by default, so by moving the main application security to <code>@Order(SecurityProperties.ACCESS_OVERRIDE_ORDER)</code> we ensure that the rule for "/me" takes precedence.</p>
</div>
</div>
<div class="sect2">
<h3 id="_testing_the_oauth2_client">Testing the OAuth2 Client</h3>
<div class="paragraph">
<p>To test the new features you can just run both apps and visit <a href="http://localhost:9999/client" class="bare">http://localhost:9999/client</a> in your browser. The client app will redirect to the local Authorization Server, which then gives the user the usual choice of authentication with Facebook or Github. Once that is complete control returns to the test client, the local access token is granted and authentication is complete (you should see a "Hello" message in your browser). If you are already authenticated with Github or Facebook you may not even notice the remote authentication.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_error">Adding an Error Page for Unauthenticated Users</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we modify the <a href="#_social_login_logout">logout</a> app we built earlier, switching to Github authentication, and also giving some feedback to users that cannot authenticate. At the same time we take the opportunity to extend the authentication logic to include a rule that only allows users if they belong to a specific Github organization. The "organization" is a Github domain-specific concept, but similar rules could be devised for other providers, e.g. with Google you might want to only authenticate users from a specific domain.</p>
</div>
<div class="sect2">
<h3 id="_switching_to_github">Switching to Github</h3>
<div class="paragraph">
<p>The <a href="#_social_login_logout">logout</a> sample use Facebook as an OAuth2 provider. We can easily switch to Github by changing the local configuration:</p>
</div>
<div class="listingblock">
<div class="title">
application.yml
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-yaml" data-lang="yaml">security:
  oauth2:
    client:
      clientId: bd1c0a783ccdd1c9b9e4
      clientSecret: 1a9030fbca47a5b2c28e92f19050bb77824b5ad1
      accessTokenUri: https://github.com/login/oauth/access_token
      userAuthorizationUri: https://github.com/login/oauth/authorize
      clientAuthenticationScheme: form
    resource:
      userInfoUri: https://api.github.com/user</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_detecting_an_authentication_failure_in_the_client">Detecting an Authentication Failure in the Client</h3>
<div class="paragraph">
<p>On the client we need to be able to provide some feedback for a user that could not authenticate. To facilitate this we add a div with an informative message:</p>
</div>
<div class="listingblock">
<div class="title">
index.html
</div>
<div class="content">
<pre>&lt;div class="container text-danger error" style="display:none"&gt;
There was an error (bad credentials).
&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This text will only be shown when the "error" element is shown, so we need some code to do that:</p>
</div>
<div class="listingblock">
<div class="title">
index.html
</div>
<div class="content">
<pre>$.ajax({
  url : "/user",
  success : function(data) {
    $(".unauthenticated").hide();
    $("#user").html(data.userAuthentication.details.name);
    $(".authenticated").show();
  },
  error : function(data) {
    $("#user").html('');
    $(".unauthenticated").show();
    $(".authenticated").hide();
    if (location.href.indexOf("error=true")&gt;=0) {
      $(".error").show();
    }
  }
});</pre>
</div>
</div>
<div class="paragraph">
<p>The authentication function checks the browser location when it loads and if it finds a URL with "error=true" in it, the flag is set.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_an_error_page">Adding an Error Page</h3>
<div class="paragraph">
<p>To support the flag setting in the client we need to be able to capture an authentication error and redirect to the home page with that flag set in query parameters. Hence we need an endpoint, in a regular <code>@Controller</code> like this:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@RequestMapping("/unauthenticated")
public String unauthenticated() {
  return "redirect:/?error=true";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the sample app we put this in the main application class, which is now a <code>@Controller</code> (not a <code>@RestController</code>) so it can handle the redirect. The last thing we need is a mapping from an unauthenticated response (HTTP 401, a.k.a. UNAUTHORIZED) to the "/unauthenticated" endpoint we just added:</p>
</div>
<div class="listingblock">
<div class="title">
ServletCustomizer.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Configuration
public class ServletCustomizer {
  @Bean
  public EmbeddedServletContainerCustomizer customizer() {
    return container -&gt; {
      container.addErrorPages(new ErrorPage(HttpStatus.UNAUTHORIZED, "/unauthenticated"));
    };
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>(In the sample, this is added as a nested class inside the main application, just for conciseness.)</p>
</div>
</div>
<div class="sect2">
<h3 id="_generating_a_401_in_the_server">Generating a 401 in the Server</h3>
<div class="paragraph">
<p>A 401 response will already be coming from Spring Security if the user cannot or does not want to login with Github, so the app is already working if you fail to authenticate (e.g. by rejecting the token grant).</p>
</div>
<div class="paragraph">
<p>To spice things up a bit we will extend the authentication rule to reject users that are not in the right organization. It is easy to use the Github API to find out more about the user, so we just need to plug that into the right part of the authentication process. Fortunately, for such a simple use case, Spring Boot has provided an easy extension point: if we declare a <code>@Bean</code> of type <code>AuthoritiesExtractor</code> it will be used to construct the authorities (typically "roles") of an authenticated user. We can use that hook to assert the the user is in the correct organization, and throw an exception if not:</p>
</div>
<div class="listingblock">
<div class="title">
SocialApplication.java
</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Bean
public AuthoritiesExtractor authoritiesExtractor(OAuth2RestOperations template) {
  return map -&gt; {
    String url = (String) map.get("organizations_url");
    @SuppressWarnings("unchecked")
    List&lt;Map&lt;String, Object&gt;&gt; orgs = template.getForObject(url, List.class);
    if (orgs.stream()
        .anyMatch(org -&gt; "spring-projects".equals(org.get("login")))) {
      return AuthorityUtils.commaSeparatedStringToAuthorityList("ROLE_USER");
    }
    throw new BadCredentialsException("Not in Spring Projects origanization");
  };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we have autowired a <code>OAuth2RestOperations</code> into this method, so we can use that to access the Github API on behalf of the authenticated user. We do that, and loop over the organizations, looking for one that matches "spring-projects" (this is the organization that is used to store Spring open source projects). You can substitute your own value there if you want to be able to authenticate successfully and you are not in the Spring Engineering team. If there is no match, we throw <code>BadCredentialsException</code> and this is picked up by Spring Security and turned in to a 401 response.</p>
</div>
<div class="paragraph">
<p>The <code>OAuth2RestOperations</code> has to be created as a bean as well (as of Spring Boot 1.4), but that’s trivial because its ingredients are all autowirable by virtue of having used <code>@EnableOAuth2Sso</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Bean
public OAuth2RestTemplate oauth2RestTemplate(OAuth2ProtectedResourceDetails resource, OAuth2ClientContext context) {
	return new OAuth2RestTemplate(resource, context);
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td>
<td class="content"> Obviously the code above can be generalized to other authentication rules, some applicable to Github and some to other OAuth2 providers. All you need is the <code>OAuth2RestOperations</code> and some knowledge of the provider’s API. </td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have seen how to use Spring Boot and Spring Security to build apps in a number of styles with very little effort. The main theme running through all of the samples is "social" login using an external OAuth2 provider. The final sample could even be used to provide such a service "internally" because it has the same basic features that the external providers have. All of the sample apps can be easily extended and re-configured for more specific use cases, usually with nothing more than a configuration file change. Remember if you use versions of the samples in your own servers to register with Facebook or Github (or similar) and get client credentials for your own host addresses. And remember not to put those credentials in source control!</p>
</div>
<div class="paragraph">
<p>Want to write a new guide or contribute to an existing one? Check out our <a href="https://github.com/spring-guides/getting-started-guides/wiki">contribution guidelines</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-important" title="Important"></i> </td>
<td class="content"> All guides are released with an ASLv2 license for the code, and an <a href="https://creativecommons.org/licenses/by-nd/3.0/">Attribution, NoDerivatives creative commons license</a> for the writing. </td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</article>
</div>
<aside class="span4 content-right-pane--container mobile-left-pane" id="sidebar">
<a class="ci-status desktop-only" href="https://travis-ci.org/spring-guides/tut-spring-boot-oauth2">
<img src="https://travis-ci.org/spring-guides/tut-spring-boot-oauth2.svg?branch=master" />
</a>
<div class="right-pane-widget--container desktop-only">
<div class="github-actions https">
<h2>Get the Code</h2>
<div class="btn-group">
<button class="btn" data-protocol="https">HTTPS</button>
<button class="btn" data-protocol="ssh">SSH</button>
</div>
<div class="clone-url https">
<input id="clone-url-https" readonly="readonly" type="text" value="https://github.com/spring-guides/tut-spring-boot-oauth2.git" />
<button class="copy-button github" data-toggle="tooltip" data-clipboard-text="https://github.com/spring-guides/tut-spring-boot-oauth2.git"></button>
</div>
<div class="clone-url ssh">
<input id="clone-url-ssh" readonly="readonly" type="text" value="git@github.com:spring-guides/tut-spring-boot-oauth2.git" />
<button class="copy-button github" data-toggle="tooltip" data-clipboard-text="git@github.com:spring-guides/tut-spring-boot-oauth2.git"></button>
</div>
<a class="github_download btn btn-black uppercase" href="https://github.com/spring-guides/tut-spring-boot-oauth2/archive/master.zip">Download ZIP</a>
<a class="gs-guide-import" href="https://github.com/spring-guides/tut-spring-boot-oauth2.git">Import into STS</a>
<div class="go-to-repo--container">
<a href="https://github.com/spring-guides/tut-spring-boot-oauth2"><i class="icon-github"></i>Go To Repo</a>
</div>
<div class="go-to-repo--container">
</div>
</div>
</div>
<div class="right-pane-widget--container">
<div>
<h3><a class="anchor" href="#table-of-contents" name="table-of-contents"></a>Table of contents</h3>
<div><ul class="sectlevel1">
<li><a href="#_social_login_simple">Single Sign On With Facebook</a> </li>
<li><a href="#_social_login_click">Add a Welcome Page</a> </li>
<li><a href="#_social_login_logout">Add a Logout Button</a> </li>
<li><a href="#_social_login_manual">Manual Configuration of OAuth2 Client</a> </li>
<li><a href="#_social_login_github">Login with Github</a> </li>
<li><a href="#_social_login_authserver">Hosting an Authorization Server</a> </li>
<li><a href="#_custom_error">Adding an Error Page for Unauthenticated Users</a> </li>
<li><a href="#_conclusion">Conclusion</a></li>
</ul></div>
</div>
</div>
</aside>
</div>
</main>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body></html>