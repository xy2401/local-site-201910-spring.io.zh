<!DOCTYPE html>
<html data-clipboard-buttons="" data-code-prettify="" data-code-sidebar="" data-hide-show-guide="" data-sts-import="" data-mobile-support="" data-search="">
<head>
<title>Tutorial Â· Building web applications with Spring Boot and Kotlin</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link rel="stylesheet" type="text/css" href="/css/gsguide-cce08ab7a9f46db88819a14148e45bad.css" />

<meta property="og:title" content="Building web applications with Spring Boot and Kotlin" />
<meta property="og:image" content="/img/spring-by-pivotal-9066b55828deb3c10e27e609af322c40.png" />
<meta property="og:description" content="this tutorial is designed to be completed in 2-3 hours, it provides deeper, in-context explorations of enterprise application development topics, leaving you ready to implement real-world solutions." />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link active">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<main class="main-body--wrapper">
<div class="row-fluid">
<div class="span8 mobile-left-pane">
<div class="content--title desktop-only">Tutorial</div>
<article class="content--container">
<h1 class="title">Building web applications with Spring Boot and Kotlin</h1>
<div class="article-body"><div class="paragraph">
<p>This tutorial shows you how to build efficiently a sample blog application by combining the power of <a href="https://projects.spring.io/spring-boot/">Spring Boot</a> and <a href="https://kotlinlang.org/">Kotlin</a>.</p>
</div>
<div class="paragraph">
<p>If you are starting with Kotlin, you can learn the language by reading the <a href="https://kotlinlang.org/docs/reference/">reference documentation</a>, following the online <a href="https://try.kotlinlang.org">Kotlin Koans tutorial</a> or just using <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/">Spring Framework reference documentation</a> which now provides code samples in Kotlin.</p>
</div>
<div class="paragraph">
<p>Spring Kotlin support is documented in the <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/languages.html#kotlin">Spring Framework</a> and <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-kotlin.html">Spring Boot</a> reference documentation. If you need help, search or ask questions with the <a href="https://stackoverflow.com/questions/tagged/kotlin+spring"><code>spring</code> and <code>kotlin</code> tags on StackOverflow</a> or come discuss in the <code>#spring</code> channel of <a href="https://slack.kotlinlang.org/">Kotlin Slack</a>.</p>
</div>
<div class="sect1">
<h2 id="_creating_a_new_project">Creating a New Project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First we need to create a Spring Boot application, which can be done in a number of ways.</p>
</div>
<div class="sect2">
<h3 id="using-the-initializr-website">Using the Initializr Website</h3>
<div class="paragraph">
<p>Visit <a href="https://start.spring.io" class="bare">https://start.spring.io</a> and choose the Kotlin language. Gradle is the most commonly used build tool in Kotlin, and it provides a Kotlin DSL which is used by default when generating a Kotlin project, so this is the recommended choice. But you can also use Maven if you are more comfortable with it. Notice that you can use <a href="https://start.spring.io/#!language=kotlin&amp;type=gradle-project" class="bare">https://start.spring.io/#!language=kotlin&amp;type=gradle-project</a> to have Kotlin and Gradle selected by default.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li> <p>Select "Gradle Project" or let the default "Maven Project" depending on which build tool you want to use</p> </li>
<li> <p>Enter the following artifact coordinates: <code>blog</code></p> </li>
<li> <p>Add the following dependencies:</p>
<div class="ulist">
<ul>
<li> <p>Spring Web</p> </li>
<li> <p>Mustache</p> </li>
<li> <p>Spring Data JPA</p> </li>
<li> <p>H2 Database</p> </li>
<li> <p>Spring Boot DevTools</p> </li>
</ul>
</div> </li>
<li> <p>Click "Generate Project".</p> </li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/initializr.png" alt="initializr">
</div>
</div>
<div class="paragraph">
<p>The .zip file contains a standard project in the root directory, so you might want to create an empty directory before you unpack it.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-command-line">Using command line</h3>
<div class="paragraph">
<p>You can use the Initializr HTTP API <a href="https://docs.spring.io/initializr/docs/current/reference/htmlsingle/#command-line">from the command line</a> with, for example, curl on a UN*X like system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ mkdir blog &amp;&amp; cd blog
$ curl https://start.spring.io/starter.zip -d language=kotlin -d style=web,mustache,jpa,h2,devtools -d packageName=com.example.blog -d name=Blog -o blog.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add <code>-d type=gradle-project</code> if you want to use Gradle.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-intellij-idea">Using IntelliJ IDEA</h3>
<div class="paragraph">
<p>Spring Initializr is also integrated in IntelliJ IDEA Ultimate edition and allows you to create and import a new project without having to leave the IDE for the command-line or the web UI.</p>
</div>
<div class="paragraph">
<p>To access the wizard, go to File | New | Project, and select Spring Initializr.</p>
</div>
<div class="paragraph">
<p>Follow the steps of the wizard to use the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li> <p>Artifact: "blog"</p> </li>
<li> <p>Type: Maven project or Gradle Project</p> </li>
<li> <p>Language: Kotlin</p> </li>
<li> <p>Name: "Blog"</p> </li>
<li> <p>Dependencies: "Spring Web Starter", "Mustache", "Spring Data JPA", "H2 Database" and "Spring Boot DevTools"</p> </li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1 reveal-gradle">
<h2 id="reveal-gradle">Gradle Build</h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1 use-gradle">
<h2 id="use-gradle">Gradle Build</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_plugins">Plugins</h3>
<div class="paragraph">
<p>In addition to the obvious <a href="https://kotlinlang.org/docs/reference/using-gradle.html">Kotlin Gradle plugin</a>, the default configuration declares the <a href="https://kotlinlang.org/docs/reference/compiler-plugins.html#spring-support">kotlin-spring plugin</a> which automatically opens classes and methods (unlike in Java, the default qualifier is <code>final</code> in Kotlin) annotated or meta-annotated with Spring annotations. This is useful to be able to create <code>@Configuration</code> or <code>@Transactional</code> beans without having to add the <code>open</code> qualifier required by CGLIB proxies for example.</p>
</div>
<div class="paragraph">
<p>In order to be able to use Kotlin non-nullable properties with JPA, <a href="https://kotlinlang.org/docs/reference/compiler-plugins.html#jpa-support">Kotlin JPA plugin</a> is also enabled. It generates no-arg constructors for any class annotated with <code>@Entity</code>, <code>@MappedSuperclass</code> or <code>@Embeddable</code>.</p>
</div>
<div class="paragraph">
<p><code>build.gradle.kts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">import org.jetbrains.kotlin.gradle.tasks.KotlinCompile

plugins {
  kotlin("plugin.jpa") version "1.3.50"
  id("org.springframework.boot") version "2.2.0.RELEASE"
  id("io.spring.dependency-management") version "1.0.8.RELEASE"
  kotlin("jvm") version "1.3.50"
  kotlin("plugin.spring") version "1.3.50"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compiler_options">Compiler options</h3>
<div class="paragraph">
<p>One of Kotlinâs key features is <a href="https://kotlinlang.org/docs/reference/null-safety.html">null-safety</a> - which cleanly deals with <code>null</code> values at compile time rather than bumping into the famous <code>NullPointerException</code> at runtime. This makes applications safer through nullability declarations and expressing "value or no value" semantics without paying the cost of wrappers like <code>Optional</code>. Note that Kotlin allows using functional constructs with nullable values; check out this <a href="https://www.baeldung.com/kotlin-null-safety">comprehensive guide to Kotlin null-safety</a>.</p>
</div>
<div class="paragraph">
<p>Although Java does not allow one to express null-safety in its type-system, Spring Framework provides null-safety of the whole Spring Framework API via tooling-friendly annotations declared in the <code>org.springframework.lang</code> package. By default, types from Java APIs used in Kotlin are recognized as <a href="https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types">platform types</a> for which null-checks are relaxed. <a href="https://kotlinlang.org/docs/reference/java-interop.html#jsr-305-support">Kotlin support for JSR 305 annotations</a> + Spring nullability annotations provide null-safety for the whole Spring Framework API to Kotlin developers, with the advantage of dealing with <code>null</code> related issues at compile time.</p>
</div>
<div class="paragraph">
<p>This feature can be enabled by adding the <code>-Xjsr305</code> compiler flag with the <code>strict</code> options.</p>
</div>
<div class="paragraph">
<p>Notice also that Kotlin compiler is configured to generate Java 8 bytecode (Java 6 by default).</p>
</div>
<div class="paragraph">
<p><code>build.gradle.kts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">tasks.withType&lt;KotlinCompile&gt; {
  kotlinOptions {
    freeCompilerArgs = listOf("-Xjsr305=strict")
    jvmTarget = "1.8"
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dependencies">Dependencies</h3>
<div class="paragraph">
<p>3 Kotlin specific libraries are required for such Spring Boot web application and configured by default:</p>
</div>
<div class="ulist">
<ul>
<li> <p><code>kotlin-stdlib-jdk8</code> is the Java 8 variant of Kotlin standard library</p> </li>
<li> <p><code>kotlin-reflect</code> is Kotlin reflection library</p> </li>
<li> <p><code>jackson-module-kotlin</code> adds support for serialization/deserialization of Kotlin classes and data classes (single constructor classes can be used automatically, and those with secondary constructors or static factories are also supported)</p> </li>
</ul>
</div>
<div class="paragraph">
<p><code>build.gradle.kts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">dependencies {
  implementation("org.springframework.boot:spring-boot-starter-data-jpa")
  implementation("org.springframework.boot:spring-boot-starter-mustache")
  implementation("org.springframework.boot:spring-boot-starter-web")
  implementation("com.fasterxml.jackson.module:jackson-module-kotlin")
  implementation("org.jetbrains.kotlin:kotlin-reflect")
  implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
  runtimeOnly("com.h2database:h2:1.4.200") // See https://github.com/spring-projects/spring-boot/issues/18593 and https://github.com/h2database/h2database/issues/1841
  runtimeOnly("org.springframework.boot:spring-boot-devtools")
  testImplementation("org.springframework.boot:spring-boot-starter-test")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Boot Gradle plugin automatically uses the Kotlin version declared via the Kotlin Gradle plugin.</p>
</div>
</div>
</div>
</div>
<div class="sect1 reveal-maven">
<h2 id="reveal-maven">Maven Build</h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1 use-maven">
<h2 id="use-maven">Maven Build</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_plugins_2">Plugins</h3>
<div class="paragraph">
<p>In addition to the obvious <a href="https://kotlinlang.org/docs/reference/using-maven.html">Kotlin Maven plugin</a>, the default configuration declares the <a href="https://kotlinlang.org/docs/reference/compiler-plugins.html#spring-support">kotlin-spring plugin</a> which automatically opens classes and methods (unlike in Java, the default qualifier is <code>final</code> in Kotlin) annotated or meta-annotated with Spring annotations. This is useful to be able to create <code>@Configuration</code> or <code>@Transactional</code> beans without having to add the <code>open</code> qualifier required by CGLIB proxies for example.</p>
</div>
<div class="paragraph">
<p>In order to be able to use Kotlin non-nullable properties with JPA, <a href="https://kotlinlang.org/docs/reference/compiler-plugins.html#jpa-support">Kotlin JPA plugin</a> is also enabled. It generates no-arg constructors for any class annotated with <code>@Entity</code>, <code>@MappedSuperclass</code> or <code>@Embeddable</code>.</p>
</div>
<div class="paragraph">
<p><code>pom.xml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;build&gt;
    &lt;sourceDirectory&gt;${project.basedir}/src/main/kotlin&lt;/sourceDirectory&gt;
    &lt;testSourceDirectory&gt;${project.basedir}/src/test/kotlin&lt;/testSourceDirectory&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
        &lt;artifactId&gt;kotlin-maven-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
          &lt;compilerPlugins&gt;
            &lt;plugin&gt;jpa&lt;/plugin&gt;
            &lt;plugin&gt;spring&lt;/plugin&gt;
          &lt;/compilerPlugins&gt;
          &lt;args&gt;
            &lt;arg&gt;-Xjsr305=strict&lt;/arg&gt;
          &lt;/args&gt;
        &lt;/configuration&gt;
        &lt;dependencies&gt;
          &lt;dependency&gt;
            &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
            &lt;artifactId&gt;kotlin-maven-noarg&lt;/artifactId&gt;
            &lt;version&gt;${kotlin.version}&lt;/version&gt;
          &lt;/dependency&gt;
          &lt;dependency&gt;
            &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
            &lt;artifactId&gt;kotlin-maven-allopen&lt;/artifactId&gt;
            &lt;version&gt;${kotlin.version}&lt;/version&gt;
          &lt;/dependency&gt;
        &lt;/dependencies&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>One of Kotlinâs key features is <a href="https://kotlinlang.org/docs/reference/null-safety.html">null-safety</a> - which cleanly deals with <code>null</code> values at compile time rather than bumping into the famous <code>NullPointerException</code> at runtime. This makes applications safer through nullability declarations and expressing "value or no value" semantics without paying the cost of wrappers like <code>Optional</code>. Note that Kotlin allows using functional constructs with nullable values; check out this <a href="https://www.baeldung.com/kotlin-null-safety">comprehensive guide to Kotlin null-safety</a>.</p>
</div>
<div class="paragraph">
<p>Although Java does not allow one to express null-safety in its type-system, Spring Framework provides null-safety of the whole Spring Framework API via tooling-friendly annotations declared in the <code>org.springframework.lang</code> package. By default, types from Java APIs used in Kotlin are recognized as <a href="https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types">platform types</a> for which null-checks are relaxed. <a href="https://kotlinlang.org/docs/reference/java-interop.html#jsr-305-support">Kotlin support for JSR 305 annotations</a> + Spring nullability annotations provide null-safety for the whole Spring Framework API to Kotlin developers, with the advantage of dealing with <code>null</code> related issues at compile time.</p>
</div>
<div class="paragraph">
<p>This feature can be enabled by adding the <code>-Xjsr305</code> compiler flag with the <code>strict</code> options.</p>
</div>
<div class="paragraph">
<p>Notice also that Kotlin compiler is configured to generate Java 8 bytecode (Java 6 by default).</p>
</div>
</div>
<div class="sect2">
<h3 id="_dependencies_2">Dependencies</h3>
<div class="paragraph">
<p>3 Kotlin specific libraries are required for such Spring Boot web application and configured by default:</p>
</div>
<div class="ulist">
<ul>
<li> <p><code>kotlin-stdlib-jdk8</code> is the Java 8 variant of Kotlin standard library</p> </li>
<li> <p><code>kotlin-reflect</code> is Kotlin reflection library (mandatory as of Spring Framework 5)</p> </li>
<li> <p><code>jackson-module-kotlin</code> adds support for serialization/deserialization of Kotlin classes and data classes (single constructor classes can be used automatically, and those with secondary constructors or static factories are also supported)</p> </li>
</ul>
</div>
<div class="paragraph">
<p><code>pom.xml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-mustache&lt;/artifactId&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;com.fasterxml.jackson.module&lt;/groupId&gt;
    &lt;artifactId&gt;jackson-module-kotlin&lt;/artifactId&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
    &lt;artifactId&gt;kotlin-reflect&lt;/artifactId&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
    &lt;artifactId&gt;kotlin-stdlib-jdk8&lt;/artifactId&gt;
  &lt;/dependency&gt;

  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
  &lt;/dependency&gt;
  &lt;!-- See https://github.com/spring-projects/spring-boot/issues/18593 and https://github.com/h2database/h2database/issues/1841 --&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;com.h2database&lt;/groupId&gt;
    &lt;artifactId&gt;h2&lt;/artifactId&gt;
    &lt;version&gt;1.4.200&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_understanding_the_generated_application">Understanding the generated Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>src/main/kotlin/com/example/blog/BlogApplication.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">package com.example.blog

import org.springframework.boot.autoconfigure.SpringBootApplication
import org.springframework.boot.runApplication

@SpringBootApplication
class BlogApplication

fun main(args: Array&lt;String&gt;) {
  runApplication&lt;BlogApplication&gt;(*args)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compared to Java, you can notice the lack of semicolons, the lack of brackets on empty class (you can add some if you need to declare beans via <code>@Bean</code> annotation) and the use of <code>runApplication</code> top level function. <code>runApplication&lt;BlogApplication&gt;(*args)</code> is Kotlin idiomatic alternative to <code>SpringApplication.run(BlogApplication::class.java, *args)</code> and can be used to customize the application with following syntax.</p>
</div>
<div class="paragraph">
<p><code>src/main/kotlin/com/example/blog/BlogApplication.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">fun main(args: Array&lt;String&gt;) {
  runApplication&lt;BlogApplication&gt;(*args) {
    setBannerMode(Banner.Mode.OFF)
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_writing_your_first_kotlin_controller">Writing your first Kotlin controller</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Letâs create a simple controller to display a simple web page.</p>
</div>
<div class="paragraph">
<p><code>src/main/kotlin/com/example/blog/HtmlController.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">package com.example.blog

import org.springframework.stereotype.Controller
import org.springframework.ui.Model
import org.springframework.ui.set
import org.springframework.web.bind.annotation.GetMapping

@Controller
class HtmlController {

  @GetMapping("/")
  fun blog(model: Model): String {
    model["title"] = "Blog"
    return "blog"
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that we are using here a <a href="https://kotlinlang.org/docs/reference/extensions.html">Kotlin extension</a> that allows to add Kotlin functions or operators to existing Spring types. Here we import the <code>org.springframework.ui.set</code> extension function in order to be able to write <code>model["title"] = "Blog"</code> instead of <code>model.addAttribute("title", "Blog")</code>. The <a href="https://docs.spring.io/spring-framework/docs/current/kdoc-api/spring-framework/">Spring Framework KDoc API</a> lists all the Kotlin extensions provided to enrich the Java API.</p>
</div>
<div class="paragraph">
<p>We also need to create the associated Mustache templates.</p>
</div>
<div class="paragraph">
<p><code>src/main/resources/templates/header.mustache</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;{{title}}&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>src/main/resources/templates/footer.mustache</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>src/main/resources/templates/blog.mustache</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>{{&gt; header}}

&lt;h1&gt;{{title}}&lt;/h1&gt;

{{&gt; footer}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start the web application by running the <code>main</code> function of <code>BlogApplication.kt</code>, and go to <code><a href="http://localhost:8080/" class="bare">http://localhost:8080/</a></code>, you should see a sober web page with a "Blog" headline.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_with_junit_5">Testing with JUnit 5</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JUnit 5 now used by default in Spring Boot provides various features very handy with Kotlin, including <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/testing.html#testcontext-junit-jupiter-di">autowiring of constructor/method parameters</a> which allows to use non-nullable <code>val</code> properties and the possibility to use <code>@BeforeAll</code>/<code>@AfterAll</code> on regular non-static methods.</p>
</div>
<div class="sect2">
<h3 id="_writing_junit_5_tests_in_kotlin">Writing JUnit 5 tests in Kotlin</h3>
<div class="paragraph">
<p>For the sake of this example, letâs create an integration test in order to demonstrate various features:</p>
</div>
<div class="ulist">
<ul>
<li> <p>We use real sentences between backticks instead of camel-case to provide expressive test function names</p> </li>
<li> <p>JUnit 5 allows to inject constructor and method parameters, which is a good fit with Kotlin read-only and non-nullable properties</p> </li>
<li> <p>This code leverages <code>getForObject</code> and <code>getForEntity</code> Kotlin extensions (you need to import them)</p> </li>
</ul>
</div>
<div class="paragraph">
<p><code>src/test/kotlin/com/example/blog/IntegrationTests.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
class IntegrationTests(@Autowired val restTemplate: TestRestTemplate) {

  @Test
  fun `Assert blog page title, content and status code`() {
    val entity = restTemplate.getForEntity&lt;String&gt;("/")
    assertThat(entity.statusCode).isEqualTo(HttpStatus.OK)
    assertThat(entity.body).contains("&lt;h1&gt;Blog&lt;/h1&gt;")
  }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_instance_lifecycle">Test instance lifecycle</h3>
<div class="paragraph">
<p>Sometimes you need to execute a method before or after all tests of a given class. Like Junit 4, JUnit 5 requires by default these methods to be static (which translates to <a href="https://kotlinlang.org/docs/reference/object-declarations.html#companion-objects"><code>companion object</code></a> in Kotlin, which is quite verbose and not straightforward) because test classes are instantiated one time per test.</p>
</div>
<div class="paragraph">
<p>But Junit 5 allows you to change this default behavior and instantiate test classes one time per class. This can be done in <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle">various ways</a>, here we will use a property file to change the default behavior for the whole project:</p>
</div>
<div class="paragraph">
<p><code>src/test/resources/junit-platform.properties</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-properties" data-lang="properties">junit.jupiter.testinstance.lifecycle.default = per_class</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration, we can now use <code>@BeforeAll</code> and <code>@AfterAll</code> annotations on regular methods like shown in updated version of <code>IntegrationTests</code> above.</p>
</div>
<div class="paragraph">
<p><code>src/test/kotlin/com/example/blog/IntegrationTests.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
class IntegrationTests(@Autowired val restTemplate: TestRestTemplate) {

  @BeforeAll
  fun setup() {
    println("&gt;&gt; Setup")
  }

  @Test
  fun `Assert blog page title, content and status code`() {
    println("&gt;&gt; Assert blog page title, content and status code")
    val entity = restTemplate.getForEntity&lt;String&gt;("/")
    assertThat(entity.statusCode).isEqualTo(HttpStatus.OK)
    assertThat(entity.body).contains("&lt;h1&gt;Blog&lt;/h1&gt;")
  }

  @Test
  fun `Assert article page title, content and status code`() {
    println("&gt;&gt; TODO")
  }

  @AfterAll
  fun teardown() {
    println("&gt;&gt; Tear down")
  }

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_your_own_extensions">Creating your own extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of using util classes with abstract methods like in Java, it is usual in Kotlin to provide such functionalities via Kotlin extensions. Here we are going to add a <code>format()</code> function to the existing <code>LocalDateTime</code> type in order to generate text with the english date format.</p>
</div>
<div class="paragraph">
<p><code>src/main/kotlin/com/example/blog/Extensions.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">fun LocalDateTime.format() = this.format(englishDateFormatter)

private val daysLookup = (1..31).associate { it.toLong() to getOrdinal(it) }

private val englishDateFormatter = DateTimeFormatterBuilder()
    .appendPattern("yyyy-MM-dd")
    .appendLiteral(" ")
    .appendText(ChronoField.DAY_OF_MONTH, daysLookup)
    .appendLiteral(" ")
    .appendPattern("yyyy")
    .toFormatter(Locale.ENGLISH)

private fun getOrdinal(n: Int) = when {
  n in 11..13 -&gt; "${n}th"
  n % 10 == 1 -&gt; "${n}st"
  n % 10 == 2 -&gt; "${n}nd"
  n % 10 == 3 -&gt; "${n}rd"
  else -&gt; "${n}th"
}

fun String.toSlug() = toLowerCase()
    .replace("\n", " ")
    .replace("[^a-z\\d\\s]".toRegex(), " ")
    .split(" ")
    .joinToString("-")
    .replace("-+".toRegex(), "-")</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will leverage these extensions in the next section.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_persistence_with_jpa">Persistence with JPA</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to make lazy fetching working as expected, entities should be <code>open</code> as described in <a href="https://youtrack.jetbrains.com/issue/KT-28525">KT-28525</a>. We are going to use the Kotlin <code>allopen</code> plugin for that purpose.</p>
</div>
<div class="paragraph">
<p>With Gradle:</p>
</div>
<div class="paragraph">
<p><code>build.gradle.kts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">plugins {
  ...
  kotlin("plugin.allopen") version "1.3.50"
}

allOpen {
  annotation("javax.persistence.Entity")
  annotation("javax.persistence.Embeddable")
  annotation("javax.persistence.MappedSuperclass")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or with Maven:</p>
</div>
<div class="paragraph">
<p><code>pom.xml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;artifactId&gt;kotlin-maven-plugin&lt;/artifactId&gt;
  &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
  &lt;configuration&gt;
    ...
    &lt;compilerPlugins&gt;
      ...
      &lt;plugin&gt;all-open&lt;/plugin&gt;
    &lt;/compilerPlugins&gt;
    &lt;pluginOptions&gt;
      &lt;option&gt;all-open:annotation=javax.persistence.Entity&lt;/option&gt;
      &lt;option&gt;all-open:annotation=javax.persistence.Embeddable&lt;/option&gt;
      &lt;option&gt;all-open:annotation=javax.persistence.MappedSuperclass&lt;/option&gt;
    &lt;/pluginOptions&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we create our model by using Kotlin <a href="https://kotlinlang.org/docs/reference/classes.html#constructors">primary constructor concise syntax</a> which allows to declare at the same time the properties and the constructor parameters.</p>
</div>
<div class="paragraph">
<p><code>src/main/kotlin/com/example/blog/Entities.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">@Entity
class Article(
    var title: String,
    var headline: String,
    var content: String,
    @ManyToOne var author: User,
    var slug: String = title.toSlug(),
    var addedAt: LocalDateTime = LocalDateTime.now(),
    @Id @GeneratedValue var id: Long? = null)

@Entity
class User(
    var login: String,
    var firstname: String,
    var lastname: String,
    var description: String? = null,
    @Id @GeneratedValue var id: Long? = null)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that we are using here our <code>String.toSlug()</code> extension to provide a default argument to the <code>slug</code> parameter of <code>Article</code> constructor. Optional parameters with default values are defined at the last position in order to make it possible to omit them when using positional arguments (Kotlin also supports <a href="https://kotlinlang.org/docs/reference/functions.html#named-arguments">named arguments</a>). Notice that in Kotlin it is not unusual to group concise class declarations in the same file.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content"> Here we donât use <a href="https://kotlinlang.org/docs/reference/data-classes.html"><code>data</code> classes</a> with <code>val</code> properties because JPA is not designed to work with immutable classes or the methods generated automatically by <code>data</code> classes. If you are using other Spring Data flavor, most of them are designed to support such constructs so you should use classes like <code>data class User(val login: String, â¦â)</code> when using Spring Data MongoDB, Spring Data JDBC, etc. </td>
</tr>
</tbody>
</table>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content"> While Spring Data JPA makes it possible to use natural IDs (it could have been the <code>login</code> property in <code>User</code> class) via <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.entity-persistence.saving-entites"><code>Persistable</code></a>, it is not a good fit with Kotlin due to <a href="https://youtrack.jetbrains.com/issue/KT-6653">KT-6653</a>, thatâs why it is recommended to always use entities with generated IDs in Kotlin. </td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph">
<p>We also declare our Spring Data JPA repositories as following.</p>
</div>
<div class="paragraph">
<p><code>src/main/kotlin/com/example/blog/Repositories.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">interface ArticleRepository : CrudRepository&lt;Article, Long&gt; {
  fun findBySlug(slug: String): Article?
  fun findAllByOrderByAddedAtDesc(): Iterable&lt;Article&gt;
}

interface UserRepository : CrudRepository&lt;User, Long&gt; {
  fun findByLogin(login: String): User?
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we write JPA tests to check basic use cases works as expected.</p>
</div>
<div class="paragraph">
<p><code>src/test/kotlin/com/example/blog/RepositoriesTests.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">@DataJpaTest
class RepositoriesTests @Autowired constructor(
    val entityManager: TestEntityManager,
    val userRepository: UserRepository,
    val articleRepository: ArticleRepository) {

  @Test
  fun `When findByIdOrNull then return Article`() {
    val juergen = User("springjuergen", "Juergen", "Hoeller")
    entityManager.persist(juergen)
    val article = Article("Spring Framework 5.0 goes GA", "Dear Spring community ...", "Lorem ipsum", juergen)
    entityManager.persist(article)
    entityManager.flush()
    val found = articleRepository.findByIdOrNull(article.id!!)
    assertThat(found).isEqualTo(article)
  }

  @Test
  fun `When findByLogin then return User`() {
    val juergen = User("springjuergen", "Juergen", "Hoeller")
    entityManager.persist(juergen)
    entityManager.flush()
    val user = userRepository.findByLogin(juergen.login)
    assertThat(user).isEqualTo(juergen)
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content"> We use here the <code>CrudRepository.findByIdOrNull</code> Kotlin extension provided by default with Spring Data, which is a nullable variant of the <code>Optional</code> based <code>CrudRepository.findById</code>. Read the great <a href="https://medium.com/@elizarov/null-is-your-friend-not-a-mistake-b63ff1751dd5">Null is your friend, not a mistake</a> blog post for more details. </td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementing_the_blog_engine">Implementing the blog engine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We update the "blog" Mustache templates.</p>
</div>
<div class="paragraph">
<p><code>src/main/resources/templates/blog.mustache</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>{{&gt; header}}

&lt;h1&gt;{{title}}&lt;/h1&gt;

&lt;div class="articles"&gt;

  {{#articles}}
    &lt;section&gt;
      &lt;header class="article-header"&gt;
        &lt;h2 class="article-title"&gt;&lt;a href="/article/{{slug}}"&gt;{{title}}&lt;/a&gt;&lt;/h2&gt;
        &lt;div class="article-meta"&gt;By  &lt;strong&gt;{{author.firstname}}&lt;/strong&gt;, on &lt;strong&gt;{{addedAt}}&lt;/strong&gt;&lt;/div&gt;
      &lt;/header&gt;
      &lt;div class="article-description"&gt;
        {{headline}}
      &lt;/div&gt;
    &lt;/section&gt;
  {{/articles}}
&lt;/div&gt;

{{&gt; footer}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we create an "article" new one.</p>
</div>
<div class="paragraph">
<p><code>src/main/resources/templates/article.mustache</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>{{&gt; header}}

&lt;section class="article"&gt;
  &lt;header class="article-header"&gt;
    &lt;h1 class="article-title"&gt;{{article.title}}&lt;/h1&gt;
    &lt;p class="article-meta"&gt;By  &lt;strong&gt;{{article.author.firstname}}&lt;/strong&gt;, on &lt;strong&gt;{{article.addedAt}}&lt;/strong&gt;&lt;/p&gt;
  &lt;/header&gt;

  &lt;div class="article-description"&gt;
    {{article.headline}}

    {{article.content}}
  &lt;/div&gt;
&lt;/section&gt;

{{&gt; footer}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We update the <code>HtmlController</code> in order to render blog and article pages with the formatted date. <code>ArticleRepository</code> and <code>MarkdownConverter</code> constructor parameters will be automatically autowired since <code>HtmlController</code> has a single constructor (implicit <code>@Autowired</code>).</p>
</div>
<div class="paragraph">
<p><code>src/main/kotlin/com/example/blog/HtmlController.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">@Controller
class HtmlController(private val repository: ArticleRepository) {

  @GetMapping("/")
  fun blog(model: Model): String {
    model["title"] = "Blog"
    model["articles"] = repository.findAllByOrderByAddedAtDesc().map { it.render() }
    return "blog"
  }

  @GetMapping("/article/{slug}")
  fun article(@PathVariable slug: String, model: Model): String {
    val article = repository
        .findBySlug(slug)
        ?.render()
        ?: throw ResponseStatusException(HttpStatus.NOT_FOUND, "This article does not exist")
    model["title"] = article.title
    model["article"] = article
    return "article"
  }

  fun Article.render() = RenderedArticle(
      slug,
      title,
      headline,
      content,
      author,
      addedAt.format()
  )

  data class RenderedArticle(
      val slug: String,
      val title: String,
      val headline: String,
      val content: String,
      val author: User,
      val addedAt: String)

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, we add data initialization to a new <code>BlogConfiguration</code> class.</p>
</div>
<div class="paragraph">
<p><code>src/main/kotlin/com/example/blog/BlogConfiguration.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">@Configuration
class BlogConfiguration {

    @Bean
    fun databaseInitializer(userRepository: UserRepository,
                            articleRepository: ArticleRepository) = ApplicationRunner {

        val smaldini = userRepository.save(User("smaldini", "StÃ©phane", "Maldini"))
        articleRepository.save(Article(
                title = "Reactor Bismuth is out",
                headline = "Lorem ipsum",
                content = "dolor sit amet",
                author = smaldini
        ))
        articleRepository.save(Article(
                title = "Reactor Aluminium has landed",
                headline = "Lorem ipsum",
                content = "dolor sit amet",
                author = smaldini
        ))
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content"> Notice the usage of named parameters to make the code more readable. </td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph">
<p>And we also update the integration tests accordingly.</p>
</div>
<div class="paragraph">
<p><code>src/test/kotlin/com/example/blog/IntegrationTests.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
class IntegrationTests(@Autowired val restTemplate: TestRestTemplate) {

  @BeforeAll
  fun setup() {
    println("&gt;&gt; Setup")
  }

  @Test
  fun `Assert blog page title, content and status code`() {
    println("&gt;&gt; Assert blog page title, content and status code")
    val entity = restTemplate.getForEntity&lt;String&gt;("/")
    assertThat(entity.statusCode).isEqualTo(HttpStatus.OK)
    assertThat(entity.body).contains("&lt;h1&gt;Blog&lt;/h1&gt;", "Reactor")
  }

  @Test
  fun `Assert article page title, content and status code`() {
    println("&gt;&gt; Assert article page title, content and status code")
    val title = "Reactor Aluminium has landed"
    val entity = restTemplate.getForEntity&lt;String&gt;("/article/${title.toSlug()}")
    assertThat(entity.statusCode).isEqualTo(HttpStatus.OK)
    assertThat(entity.body).contains(title, "Lorem ipsum", "dolor sit amet")
  }

  @AfterAll
  fun teardown() {
    println("&gt;&gt; Tear down")
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start (or restart) the web application, and go to <code><a href="http://localhost:8080/" class="bare">http://localhost:8080/</a></code>, you should see the list of articles with clickable links to see a specific article.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exposing_http_api">Exposing HTTP API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We are now going to implement the HTTP API via <code>@RestController</code> annotated controllers.</p>
</div>
<div class="paragraph">
<p><code>src/main/kotlin/com/example/blog/HttpControllers.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">@RestController
@RequestMapping("/api/article")
class ArticleController(private val repository: ArticleRepository) {

  @GetMapping("/")
  fun findAll() = repository.findAllByOrderByAddedAtDesc()

  @GetMapping("/{slug}")
  fun findOne(@PathVariable slug: String) =
      repository.findBySlug(slug) ?: ResponseStatusException(HttpStatus.NOT_FOUND, "This article does not exist")

}

@RestController
@RequestMapping("/api/user")
class UserController(private val repository: UserRepository) {

  @GetMapping("/")
  fun findAll() = repository.findAll()

  @GetMapping("/{login}")
  fun findOne(@PathVariable login: String) =
      repository.findByLogin(login) ?: ResponseStatusException(HttpStatus.NOT_FOUND, "This user does not exist")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For tests, instead of integration tests, we are going to leverage <code>@WebMvcTest</code> and <a href="https://mockk.io/">Mockk</a> wich is similar to <a href="https://site.mockito.org/">Mockito</a> but better suited for Kotlin.</p>
</div>
<div class="paragraph">
<p>Since <code>@MockBean</code> and <code>@SpyBean</code> annotations are specific to Mockito, we are going to leverage <a href="https://github.com/Ninja-Squad/springmockk">SpringMockK</a> which provides similar <code>@MockkBean</code> and <code>@SpykBean</code> annotations for Mockk.</p>
</div>
<div class="paragraph">
<p>With Gradle:</p>
</div>
<div class="paragraph">
<p><code>build.gradle.kts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">testImplementation("org.springframework.boot:spring-boot-starter-test") {
  exclude(module = "junit")
  exclude(module = "mockito-core")
}
testImplementation("org.junit.jupiter:junit-jupiter-api")
testRuntimeOnly("org.junit.jupiter:junit-jupiter-engine")
testImplementation("com.ninja-squad:springmockk:1.1.3")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or with Maven:</p>
</div>
<div class="paragraph">
<p><code>pom.xml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
  &lt;scope&gt;test&lt;/scope&gt;
  &lt;exclusions&gt;
    &lt;exclusion&gt;
      &lt;groupId&gt;junit&lt;/groupId&gt;
      &lt;artifactId&gt;junit&lt;/artifactId&gt;
    &lt;/exclusion&gt;
    &lt;exclusion&gt;
      &lt;groupId&gt;org.mockito&lt;/groupId&gt;
      &lt;artifactId&gt;mockito-core&lt;/artifactId&gt;
    &lt;/exclusion&gt;
  &lt;/exclusions&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
  &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.ninja-squad&lt;/groupId&gt;
  &lt;artifactId&gt;springmockk&lt;/artifactId&gt;
  &lt;version&gt;1.1.3&lt;/version&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>src/test/kotlin/com/example/blog/HttpControllersTests.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">@WebMvcTest
class HttpControllersTests(@Autowired val mockMvc: MockMvc) {

  @MockkBean
  private lateinit var userRepository: UserRepository

  @MockkBean
  private lateinit var articleRepository: ArticleRepository

  @Test
  fun `List articles`() {
    val juergen = User("springjuergen", "Juergen", "Hoeller")
    val spring5Article = Article("Spring Framework 5.0 goes GA", "Dear Spring community ...", "Lorem ipsum", juergen)
    val spring43Article = Article("Spring Framework 4.3 goes GA", "Dear Spring community ...", "Lorem ipsum", juergen)
    every { articleRepository.findAllByOrderByAddedAtDesc() } returns listOf(spring5Article, spring43Article)
    mockMvc.perform(get("/api/article/").accept(MediaType.APPLICATION_JSON))
        .andExpect(status().isOk)
        .andExpect(content().contentType(MediaType.APPLICATION_JSON_UTF8))
        .andExpect(jsonPath("\$.[0].author.login").value(juergen.login))
        .andExpect(jsonPath("\$.[0].slug").value(spring5Article.slug))
        .andExpect(jsonPath("\$.[1].author.login").value(juergen.login))
        .andExpect(jsonPath("\$.[1].slug").value(spring43Article.slug))
  }

  @Test
  fun `List users`() {
    val juergen = User("springjuergen", "Juergen", "Hoeller")
    val smaldini = User("smaldini", "StÃ©phane", "Maldini")
    every { userRepository.findAll() } returns listOf(juergen, smaldini)
    mockMvc.perform(get("/api/user/").accept(MediaType.APPLICATION_JSON))
        .andExpect(status().isOk)
        .andExpect(content().contentType(MediaType.APPLICATION_JSON_UTF8))
        .andExpect(jsonPath("\$.[0].login").value(juergen.login))
        .andExpect(jsonPath("\$.[1].login").value(smaldini.login))
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content"> <code>$</code> needs to be escaped in strings as it is used for string interpolation. </td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_properties">Configuration properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Kotlin, the recommended way to manage your application properties is to leverage <code>@ConfigurationProperties</code> with <code>@ConstructorBinding</code> in order to be able to use read-only properties.</p>
</div>
<div class="paragraph">
<p><code>src/main/kotlin/com/example/blog/BlogProperties.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">@ConstructorBinding
@ConfigurationProperties("blog")
data class BlogProperties(var title: String, val banner: Banner) {
  data class Banner(val title: String? = null, val content: String)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To generate <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#configuration-metadata-annotation-processor">your own metadata</a> in order to get these custom properties recognized by your IDE, <a href="https://kotlinlang.org/docs/reference/kapt.html">kapt should be configured</a> with the <code>spring-boot-configuration-processor</code> dependency as following.</p>
</div>
<div class="paragraph">
<p><code>build.gradle.kts</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">plugins {
  ...
  kotlin("kapt") version "1.3.50"
}

dependencies {
  ...
  kapt("org.springframework.boot:spring-boot-configuration-processor")
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content"> Note that some features (such as detecting the default value or deprecated items) are not working due to limitations in the model kapt provides. Also annotation processing is not yet supported with Maven due to <a href="https://youtrack.jetbrains.com/issue/KT-18022">KT-18022</a>, see <a href="https://github.com/spring-io/initializr/issues/438">initializr#438</a> for more details. </td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph">
<p>In IntelliJ IDEA:</p>
</div>
<div class="ulist">
<ul>
<li> <p>Make sure Spring Boot plugin in enabled in menu File | Settings | Plugins | Spring Boot</p> </li>
<li> <p>Enable annotation processing via menu File | Settings | Build, Execution, Deployment | Compiler | Annotation Processors | Enable annotation processing</p> </li>
<li> <p>Since <a href="https://youtrack.jetbrains.com/issue/KT-15040">Kapt is not yet integrated in IDEA</a>, you need to run manually the command <code>./gradlew kaptKotlin</code> to generate the metadata</p> </li>
</ul>
</div>
<div class="paragraph">
<p>Your custom properties should now be recognized when editing <code>application.properties</code> (autocomplete, validation, etc.).</p>
</div>
<div class="paragraph">
<p><code>src/main/resources/application.properties</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-properties" data-lang="properties">blog.title=Blog
blog.banner.title=Warning
blog.banner.content=The blog will be down tomorrow.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit the template and the controller accordingly.</p>
</div>
<div class="paragraph">
<p><code>src/main/resources/templates/blog.mustache</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>{{&gt; header}}

&lt;div class="articles"&gt;

  {{#banner.title}}
  &lt;section&gt;
    &lt;header class="banner"&gt;
      &lt;h2 class="banner-title"&gt;{{banner.title}}&lt;/h2&gt;
    &lt;/header&gt;
    &lt;div class="banner-content"&gt;
      {{banner.content}}
    &lt;/div&gt;
  &lt;/section&gt;
  {{/banner.title}}

  ...

&lt;/div&gt;

{{&gt; footer}}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>src/main/kotlin/com/example/blog/HtmlController.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">@Controller
class HtmlController(private val repository: ArticleRepository,
           private val properties: BlogProperties) {

  @GetMapping("/")
  fun blog(model: Model): String {
    model["title"] = properties.title
    model["banner"] = properties.banner
    model["articles"] = repository.findAllByOrderByAddedAtDesc().map { it.render() }
    return "blog"
  }

  // ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since <code>@ConfigurationProperties</code> are not scanned automatically in test slices, we need to configure it explicitly in our test annotated with <code>@WebMvcTest</code>.</p>
</div>
<div class="paragraph">
<p><code>src/main/kotlin/com/example/blog/BlogApplication.kt</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">@WebMvcTest
@EnableConfigurationProperties(BlogProperties::class)
class HttpControllersTests(@Autowired val mockMvc: MockMvc) {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart the web application, refresh <code><a href="http://localhost:8080/" class="bare">http://localhost:8080/</a></code>, you should see the banner on the blog homepage.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have now finished to build this sample Kotlin blog application. The source code <a href="https://github.com/spring-guides/tut-spring-boot-kotlin">is available on Github</a>. You can also have a look to <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/languages.html#kotlin">Spring Framework</a> and <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-kotlin.html">Spring Boot</a> reference documentation if you need more details on specific features.</p>
</div>
</div>
</div>
</div>
</article>
</div>
<aside class="span4 content-right-pane--container mobile-left-pane" id="sidebar">
<a class="ci-status desktop-only" href="https://travis-ci.org/spring-guides/tut-spring-boot-kotlin">
<img src="https://travis-ci.org/spring-guides/tut-spring-boot-kotlin.svg?branch=master" />
</a>
<div class="right-pane-widget--container desktop-only">
<div class="github-actions https">
<h2>Get the Code</h2>
<div class="btn-group">
<button class="btn" data-protocol="https">HTTPS</button>
<button class="btn" data-protocol="ssh">SSH</button>
</div>
<div class="clone-url https">
<input id="clone-url-https" readonly="readonly" type="text" value="https://github.com/spring-guides/tut-spring-boot-kotlin.git" />
<button class="copy-button github" data-toggle="tooltip" data-clipboard-text="https://github.com/spring-guides/tut-spring-boot-kotlin.git"></button>
</div>
<div class="clone-url ssh">
<input id="clone-url-ssh" readonly="readonly" type="text" value="git@github.com:spring-guides/tut-spring-boot-kotlin.git" />
<button class="copy-button github" data-toggle="tooltip" data-clipboard-text="git@github.com:spring-guides/tut-spring-boot-kotlin.git"></button>
</div>
<a class="github_download btn btn-black uppercase" href="https://github.com/spring-guides/tut-spring-boot-kotlin/archive/master.zip">Download ZIP</a>
<a class="gs-guide-import" href="https://github.com/spring-guides/tut-spring-boot-kotlin.git">Import into STS</a>
<div class="go-to-repo--container">
<a href="https://github.com/spring-guides/tut-spring-boot-kotlin"><i class="icon-github"></i>Go To Repo</a>
</div>
<div class="go-to-repo--container">
</div>
</div>
</div>
<div class="right-pane-widget--container">
<div>
<h3><a class="anchor" href="#table-of-contents" name="table-of-contents"></a>Table of contents</h3>
<div><ul class="sectlevel1">
<li><a href="#_creating_a_new_project">Creating a New Project</a> </li>
<li><a href="#use-gradle">Gradle Build</a> </li>
<li><a href="#use-maven">Maven Build</a> </li>
<li><a href="#_understanding_the_generated_application">Understanding the generated Application</a></li>
<li><a href="#_writing_your_first_kotlin_controller">Writing your first Kotlin controller</a></li>
<li><a href="#_testing_with_junit_5">Testing with JUnit 5</a> </li>
<li><a href="#_creating_your_own_extensions">Creating your own extensions</a></li>
<li><a href="#_persistence_with_jpa">Persistence with JPA</a></li>
<li><a href="#_implementing_the_blog_engine">Implementing the blog engine</a></li>
<li><a href="#_exposing_http_api">Exposing HTTP API</a></li>
<li><a href="#_configuration_properties">Configuration properties</a></li>
<li><a href="#_conclusion">Conclusion</a></li>
</ul></div>
</div>
</div>
</aside>
</div>
</main>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>