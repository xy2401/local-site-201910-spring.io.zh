<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>Spring Data Evans有什么新功能？</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Whats new in Spring Data Evans?">
<meta name="twitter:description" content="<p>Spring Data Release <a href=" https:="" ="" spring.io="" blog="" 2014="" 09="" spring-data-release-train-evans-goes-g="="></head><body >Evans has been around for a while and it’s more than time to finally introduce you to the latest and greatest features we shipped with it.
<p>There’s a lot to cover since major enhancements have gone into the commons module. Those changes already have made it into some store modules and will go on and sneak their way into others over time, too. All of them are already available for at least <a href="http://projects.spring.io/spring-data-jpa/">Spring Data JPA</a>. That said, lets jump right in.</p>
<h2><a href="#advanced-support-for-java-8" class="anchor" name="advanced-support-for-java-8"></a>Advanced support for Java 8</h2>
<p>Java8 has now been around for a while and previous Spring Data release trains already added fundamental support for some of those. With the Evans release train we extended the support significantly.</p>
">
<meta name="twitter:creator" content="@stroblchristoph">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/eeacd6c45e867cb36eb05c9daa5cc2de?s=200">

<meta property="og:title" content="Whats new in Spring Data Evans?">
<meta property="og:image" content="https://gravatar.com/avatar/eeacd6c45e867cb36eb05c9daa5cc2de?s=200">
<meta property="og:description" content="<p>Spring Data Release <a href=" https:="" ="" spring.io="" blog="" 2014="" 09="" spring-data-release-train-evans-goes-g="=">Evans has been around for a while and it’s more than time to finally introduce you to the latest and greatest features we shipped with it.
<p>There’s a lot to cover since major enhancements have gone into the commons module. Those changes already have made it into some store modules and will go on and sneak their way into others over time, too. All of them are already available for at least <a href="http://projects.spring.io/spring-data-jpa/">Spring Data JPA</a>. That said, lets jump right in.</p>
<h2><a href="#advanced-support-for-java-8" class="anchor" name="advanced-support-for-java-8"></a>Advanced support for Java 8</h2>
<p>Java8 has now been around for a while and previous Spring Data release trains already added fundamental support for some of those. With the Evans release train we extended the support significantly.</p>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2014-10-15 13:20:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Data Evans有什么新功能？</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/eeacd6c45e867cb36eb05c9daa5cc2de?s=20&d=mm"> <a class="author" rel="author" href="/team/christophstrobl">克里斯多夫·斯特罗布尔</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2014-10-15 13:20:00.0">2014年10月15日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2014/10/15/whats-new-in-spring-data-evans#disqus_thread" data-disqus-identifier="1764">
</a></div>
</div>
</header>
<div class="blog--post"><p>Spring Data Release <a href="https://spring.io/blog/2014/09/09/spring-data-release-train-evans-goes-ga">Evans</a>已经存在了一段时间，现在终于可以为您介绍我们随附的最新和最强大的功能了。</p><p>自从commons模块中进行了重大改进以来，有很多内容需要介绍。这些更改已将其纳入某些商店模块，并且随着时间的推移，它们还将继续潜入其他商店。至少<a href="https://projects.spring.io/spring-data-jpa/">Spring Data JPA</a>已经提供了所有这些功能。也就是说，让我们跳进去。</p><h2><a href="#advanced-support-for-java-8" class="anchor" name="advanced-support-for-java-8"></a>对Java 8的高级支持</h2><p>Java8已经存在了一段时间，以前的Spring Data版本培训已经为其中一些添加了基本支持。通过Evans发布培训，我们大大扩展了支持范围。</p><p>Java 8的<a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html"><code>Optional</code></a>自从<a href="https://spring.io/blog/2014/05/21/what-s-new-in-spring-data-dijkstra">Dijkstra发布</a>以来，一直是受支持的退货<code>null</code>检查遍及您的代码。当用作存储库的返回类型时，我们只为您包装和解包值。</p><p>从Evans版本开始，可以在存储库接口中使用<a href="https://docs.oracle.com/javase/tutorial/java/IandI/defaultmethods.html">默认方法</a> ，例如将传递给该方法的部分参数转发给其他查询方法。</p>
<pre><code class="prettyprint java">interface PersonRepository extends Repository&lt;Person, Long&gt; {
  
  Optional&lt;Customer&gt; findByLastname(String lastname);
  
  default Optional&lt;Customer&gt; findByLastname(Customer customer) {
    return findByLastname(customer == null ? null : customer.getLastname());
  }
}
</code></pre><h2><a href="#enhanced-multi-store-support" class="anchor" name="enhanced-multi-store-support"></a>增强的多店支持</h2><p>到目前为止，配置应用程序以使用不同的Spring Data模块并非没有问题。例如，您可能希望将JPA和MongoDB结合使用， <code>Customer</code>恰好是JPA实体，而<code>Order</code>是一个通过相应的存储库接口持久保存的MongoDB文档。</p>
<pre><code class="prettyprint java">@Entity
class Customer {

  @Id @GeneratedValue Long id;
  String firstname, lastname;
  // ...
}

@Document
class Order {

  @Id String id;
  Long customerId;
  Date orderDate;
  // ...
}

interface CustomerRepository extends CrudRepository&lt;Customer, Long&gt; {}

interface OrderRepository extends CrudRepository&lt;Order, String&gt; {}
</code></pre><p>在Spring Data Evans发行版之前，您必须手动配置MongoDB和JPA的存储库设置，以相互排除与给定存储无关的接口。用户通常为此使用单独的软件包。</p><p>现在，存储库设置检测到类路径上存在多个Spring Data模块，并自动限制存储库扫描并检查给定存储库使用的域类型以存储特定的注释，例如<code>@Entity</code>和<code>@Document</code>确定它们所属的具体实现。例如，Spring Data MongoDB模块将删除（意外地）检测到的<code>CustomerRepository</code>因为我们找不到<code>@Document</code>注解。</p><h3><a href="#statically-limiting-results" class="anchor" name="statically-limiting-results"></a>静态限制结果</h3><p>自Spring Data以来，动态限制结果并不是什么新概念<code>Pagable</code>自成立以来就一直是抽象的，我敢打赌，几乎每个Spring Data用户都已经熟悉以下内容：</p>
<pre><code class="prettyprint java">List&lt;Person&gt; findByLastname(String lastname, Pageable page)
</code></pre><p>该方法声明提供了相当大的灵活性：客户端定义其要访问的元素的页码，大小和排序顺序。如果这些值动态变化（例如，当您逐页遍历结果集时），那就太好了。</p><p>但是，如果您始终只对前10个结果感兴趣，并且始终希望按姓氏对它们排序，该怎么办？这可以通过静态定义一个<code>PageRequest</code>并在每次方法调用中重复使用该方法。但是，这仍然需要客户提交特别<code>PageRequest</code> 。</p><p>从Spring Data Evans开始，我们现在为您提供一种便捷的方法，通过使用关键字将结果集明确限制为一定数量的元素<code>top</code>和<code>first</code>后面跟一个可选的正数值（默认为1）。</p>
<pre><code class="prettyprint java">List&lt;Person&gt; findTop10ByLastnameOrderByFirstnameDesc(String lastname);
</code></pre><h2><a href="#mongodb-full-text-search" class="anchor" name="mongodb-full-text-search"></a> MongoDB全文搜索</h2><p>Evans RC1版本引入了对MongoDB 2.6的基本<a href="https://spring.io/blog/2014/07/17/text-search-your-documents-with-spring-data-mongodb">文本索引支持</a> 。使用<code>@TextIndexed</code>允许您标记要启用文本搜索的属性，以便我们继续为您创建索引。请注意， <code>@TextIndexed</code>引用复杂类型的属性上的索引将索引该类型的所有属性。由于评分是全文搜索的基本组成部分，因此<code>@TextScore</code>注释将断言任何全文查询都将返回文档分数，从而使您可以按相关性对其进行排序。</p>
<pre><code class="prettyprint java">@Document
class BlogPost {

  @Id String id;
  @TextIndexed(weight = 3) String title;
  @TextIndexed(weight = 2) String content;
  @TextIndexed List&lt;String&gt; categories;
  @TextScore Float score;
}
</code></pre><p>这样，我们扩展了存储库支持以接受<code>TextCriteria</code>实例，它将定义有关将要执行的文本搜索的详细选项：要搜索的术语，语言选项等。</p>
<pre><code class="prettyprint java">interface BlogPostRepository extends CrudRepository&lt;BlogPost, String&gt; {

	Page&lt;BlogPost&gt; findBy(TextCriteria criteria, Pageable page);

	List&lt;BlogPost&gt; findAllByOrderByScoreDesc(TextCriteria criteria);
}
</code></pre><p>第一种查询方法非常简单。它执行给定<code>TextCriteria</code>并分页结果。第二个查询方法定义结合了给定<code>TextCriteria</code>从方法名称派生的标准标准定义。这表明您可以轻松地自由组合文本搜索和标准查询。</p><h2><a href="#mongodb-query-modifiers" class="anchor" name="mongodb-query-modifiers"></a> MongoDB查询修饰符</h2><p>我们加了<code>@Meta</code>允许您定义查询的输出和行为。通过设置例如<code>maxExecutionTime</code>可以定义查询可能花费的最长时间（以毫秒为单位）。任何超出限制的执行都会导致错误。您还可以建议MongoDB仅扫描最大数量的文档，然后返回发现的内容，直到达到限制为止，方法是设置<code>maxScanDocuments</code> ，而<code>comment</code>允许您定义可以在<code>system.profile</code>万一您为MongoDB实例启用了概要分析，请收集。</p>
<pre><code class="prettyprint java">@Meta(maxExcecutionTime = 100, comment = &quot;onlyLimitedTime&quot;)
List&lt;Customer&gt; findByFirstname(String firstname);
</code></pre><h2><a href="#configuration-options-for-redis-sentinel" class="anchor" name="configuration-options-for-redis-sentinel"></a> Redis Sentinel的配置选项</h2><p>Redis 2.8引入了称为<a href="http://redis.io/topics/sentinel">Sentinels的</a>高可用性支持。Spring Data Evans的Redis模块增加了对轻松配置到哨兵设置的支持，从而使您的客户端能够在Redis集群中的主节点被重新选举的情况下继续工作。</p><p><code>RedisSentinelConfiguration</code>定义前哨的位置，以便<code>ConnectionFactory</code>可以相应地设置池。如果是Jedis，它将创建一个<code>JedisSentinelPool</code>自动故障转移。这意味着，如果您的主节点发生故障，一旦哨兵同意新的主节点，您将获得与新主节点的连接，而无需任何进一步的交互。</p>
<pre><code class="prettyprint java">@Configuration
class RedisSentinelApplicationConfig {

  @Bean
  RedisConnectionFactory connectionFactory() {
    return new JedisConnectionFactory(sentinelConfig());
  }
  
  @Bean
  RedisSentinelConfiguration sentinelConfig() {
    return new RedisSentinelConfiguration().master(&quot;mymaster&quot;)
      .sentinel(&quot;localhost&quot;, 26379)
      .sentinel(&quot;localhost&quot;, 26380)
      .sentinel(&quot;localhost&quot;, 26381);
  }
}
</code></pre><p>即将推出的Spring Boot 1.2甚至可以通过自动选择<code>RedisSentinelConfiguration</code>如果存在并初始化<code>RedisConnectionFactory</code>相应地。</p><h2><a href="#schema-support-for-solr" class="anchor" name="schema-support-for-solr"></a>对Solr的架构支持</h2><p>尽管<a href="https://cwiki.apache.org/confluence/display/solr/Schema+API">Solr Schema API</a>尚未完成，但是我们已经尝试了尽可能多地支持它。使用Evans版本，您现在可以将缺少的字段动态添加到现有（托管）模式中。为此，我们阅读了现有的字段定义，并将其与从域类型的属性派生的定义进行比较。为此，我们扩展了<code>@Indexed</code>注释一下。现在，它允许对字段进行一些微调，以创建诸如以下值<code>indexed</code> ， <code>stored</code>和<code>solrType</code>可以明确定义。</p>
<pre><code class="prettyprint java">@Configuration
@EnableSolrRepositories(schemaCreationSupport = true)
class SolrConfiguration {
  
  @Bean
  SolrServer solrServer() {
    return new HttpSolrServer(&quot;http://localhost:8983/solr&quot;);
  }
}

@SolrDocument(solrCoreName = &quot;collection1&quot;)
class ManagedProduct {
  
  @Id String id;
  @Indexed(type = &quot;text_general&quot;) String name;
  @Indexed(name = &quot;cat&quot;) List&lt;String&gt; category;
}
</code></pre><p>一如既往，我们渴望收到您的来信！在<a href="https://twitter.com/SpringData">Twitter</a> ， <a href="https://stackoverflow.com/tags/spring-data">Stackoverflow</a>或<a href="https://jira.spring.io">JIRA</a>上与我们联系，以请求新功能，提出改进建议或报告错误。</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 1764;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>