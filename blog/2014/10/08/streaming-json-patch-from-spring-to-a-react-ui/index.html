<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Streaming JSON Patch from Spring to a React UI</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Streaming JSON Patch from Spring to a React UI" />
<meta name="twitter:description" content="&lt;p&gt;We’re exploring ways to help developers create rich, modern front-ends that integrate easily with Spring back-ends. If you attended SpringOne this year, you’ve already seen some of the things we’ve been working on:&lt;/p&gt;
&lt;ol&gt; 
 &lt;li&gt;&lt;a href=&quot;https://speakerdeck.com/gregturn/springone2gx-2014-spring-data-rest-data-meets-hypermedia&quot;&gt;Hypermedia support in Spring Data REST&lt;/a&gt; presented by Greg Turnquist, Oliver Gierke, and Roy Clarkson&lt;/li&gt; 
 &lt;li&gt;&lt;a href=&quot;http://www.slideshare.net/unscriptable/rave-js-springone-2gx-2014&quot;&gt;RaveJS: Spring Boot concepts for JavaScript applications&lt;/a&gt; by John Hann&lt;/li&gt; 
 &lt;li&gt;&lt;a href=&quot;http://www.slideshare.net/briancavalier/differential-sync-and-json-patch-s2-gx-2014&quot;&gt;Differential Synchronization and JSON Patch&lt;/a&gt; by Craig Walls and me&lt;/li&gt; 
&lt;/ol&gt;
&lt;p&gt;In short, We want to make it easy to communicate efficiently between a Spring back-end and a client and to easily integrate the best and most popular client-side technologies.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@briancavalier" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/8968338d5e83299cfdf9bba2abbf9332?s=200" />

<meta property="og:title" content="Streaming JSON Patch from Spring to a React UI" />
<meta property="og:image" content="https://gravatar.com/avatar/8968338d5e83299cfdf9bba2abbf9332?s=200" />
<meta property="og:description" content="&lt;p&gt;We’re exploring ways to help developers create rich, modern front-ends that integrate easily with Spring back-ends. If you attended SpringOne this year, you’ve already seen some of the things we’ve been working on:&lt;/p&gt;
&lt;ol&gt; 
 &lt;li&gt;&lt;a href=&quot;https://speakerdeck.com/gregturn/springone2gx-2014-spring-data-rest-data-meets-hypermedia&quot;&gt;Hypermedia support in Spring Data REST&lt;/a&gt; presented by Greg Turnquist, Oliver Gierke, and Roy Clarkson&lt;/li&gt; 
 &lt;li&gt;&lt;a href=&quot;http://www.slideshare.net/unscriptable/rave-js-springone-2gx-2014&quot;&gt;RaveJS: Spring Boot concepts for JavaScript applications&lt;/a&gt; by John Hann&lt;/li&gt; 
 &lt;li&gt;&lt;a href=&quot;http://www.slideshare.net/briancavalier/differential-sync-and-json-patch-s2-gx-2014&quot;&gt;Differential Synchronization and JSON Patch&lt;/a&gt; by Craig Walls and me&lt;/li&gt; 
&lt;/ol&gt;
&lt;p&gt;In short, We want to make it easy to communicate efficiently between a Spring back-end and a client and to easily integrate the best and most popular client-side technologies.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2014-10-08 01:47:03.347" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Streaming JSON Patch from Spring to a React UI</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/8968338d5e83299cfdf9bba2abbf9332?s=20&amp;d=mm" />
<span class="author">Brian Cavalier</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2014-10-08 01:47:03.347">October 08, 2014</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="1782" href="/blog/2014/10/08/streaming-json-patch-from-spring-to-a-react-ui#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>We&rsquo;re exploring ways to help developers create rich, modern front-ends that integrate easily with Spring back-ends. If you attended SpringOne this year, you&rsquo;ve already seen some of the things we&rsquo;ve been working on:</p>
<ol>
<li><a href="https://speakerdeck.com/gregturn/springone2gx-2014-spring-data-rest-data-meets-hypermedia">Hypermedia support in Spring Data REST</a> presented by Greg Turnquist, Oliver Gierke, and Roy Clarkson</li>
<li><a href="http://www.slideshare.net/unscriptable/rave-js-springone-2gx-2014">RaveJS: Spring Boot concepts for JavaScript applications</a> by John Hann</li>
<li><a href="http://www.slideshare.net/briancavalier/differential-sync-and-json-patch-s2-gx-2014">Differential Synchronization and JSON Patch</a> by Craig Walls and me</li>
</ol><p>In short, We want to make it easy to communicate efficiently between a Spring back-end and a client and to easily integrate the best and most popular client-side technologies.</p><h2><a href="#react-streaming-updates" class="anchor" name="react-streaming-updates"></a>React + streaming updates</h2><p>JSON Patch is a format for sending incremental changes to structured data. I thought it would be interesting to try streaming updates in JSON Patch format via STOMP all the way out to a web UI.</p><p>Craig Walls had already built a simple <a href="https://github.com/habuma/scores">football scores proof of concept</a>, using the new <a href="https://github.com/spring-projects/spring-sync/">Spring Sync</a> project to push score updates to a browser using JSON Patch over STOMP. I was able to take his POC, drop in RaveJS, add client-side reactive streams, and integrate the updates into a <a href="https://facebook.github.io/react/">React</a> UI component.</p><p>You can find the <a href="https://github.com/briancavalier/scores">complete code on github in my rave-most-react branch</a>. The server is unchanged from Craig&rsquo;s original version. The <a href="https://github.com/briancavalier/scores/tree/rave-most-react/src/main/resources/public">web client</a> is where the action is. Have a look at the <a href="https://github.com/briancavalier/scores/blob/rave-most-react/src/main/resources/public/main.js">main.js to get an overall sense of the app</a> before we dive into some specifics.</p><h2><a href="#starting-out" class="anchor" name="starting-out"></a>Starting out</h2><p>I used <a href="https://github.com/RaveJS/rave">RaveJS</a> and npm to manage my client side dependencies, so my startup was simple:</p>
<pre><code class="prettyprint sh">&gt; cd src/main/resources/public

&gt; npm init

&lt;answer a few questions&gt;

&gt; npm install --save rave most jiff react rave-load-jsx rave-node-process stompjs
</code></pre><p>Then I just needed a single script tag in the existing HTML, and I was off to coding!</p>
<pre><code class="prettyprint html">&lt;script src=&quot;node_modules/rave/rave.js&quot;&gt;&lt;/script&gt;
</code></pre><h2><a href="#introducing-most-js" class="anchor" name="introducing-most-js"></a>Introducing most.js</h2><p>Thanks to Craig, I already had a stream of updates (in JSON Patch format) flowing to the client over STOMP. I decided that the nicest way to work with the stream of patches would be to (surprise!) <em>actually use a stream</em>.</p><p><a href="https://github.com/cujojs/most">Most.js</a> is cujoJS&rsquo;s new JavaScript reactive streams package. It provides a small, but powerful set of APIs for creating, transforming, and consuming event streams. I used it to wrap up the stompjs API.</p><p>It turns out that there were two STOMP subscriptions: one that carried an initial, complete copy of all the score data, and another that carried all the subsequent changes. I was able to wrap both subscriptions up into a single reactive stream representing &ldquo;the latest set of scores&rdquo; by using <a href="https://github.com/cujojs/jiff">jiff.js</a> to apply the JSON Patches as they arrived.</p><p>This bit of code creates a stream from a STOMP subscription to the initial data, takes the first event (a complete snapshot of all scores), and combines it with a second stream containing only JSON Patch updates to produce a view of the scores that changes over time.</p>
<pre><code class="prettyprint js">function getScoresStream(initDestination, updateDestination, client) {
	// Create a stream containing one full copy of the data, and
	// flatMap that to a stream containing the time-varying
	// current set of scores, by accumulating each patch
	// and emitting the updated scores data.
	return getInitialDataStream(initDestination, client)
		.flatMap(function(data) {
			return getUpdatesStream(updateDestination, client, data);
		});
}

function getInitialDataStream (initDestination, client) {
	// Await a copy of the data from the STOMP subscription
	// that is sending the full scores data, then unsubscribe.
	return streamFromStompJson(initDestination, client)
		.take(1);
}

function getUpdatesStream (updateDestination, client, data) {
	// Incrementally accumulate patches from the STOMP subscription
	// that is carrying JSON Patches onto the scores data to produce
	// an updated view of the scores.
	return streamFromStompJson(updateDestination, client)
		.startWith([])
		.scan(updateWithJsonPatch, data);
}
</code></pre><p>Most.js also automatically cleans up underlying resources when streams end. It was easy to arrange to unsubscribe from the first subscription after an initial copy of the full scores data had arrived, leaving only one subscription: the changes.</p><h2><a href="#making-the-ui-with-react" class="anchor" name="making-the-ui-with-react"></a>Making the UI with React</h2><p>Now that I had a single most.js stream representing the latest scores, I created a <a href="https://github.com/briancavalier/scores/blob/rave-most-react/src/main/resources/public/Scoreboard.jsx">React component to display them</a>. I installed (see above) the <a href="https://github.com/KidkArolis/rave-load-jsx">rave-load-jsx extension</a>, a RaveJS extension created by a community member, which enables direct JSX component loading in RaveJS. All I had to do was create a Scoreboard.jsx file and start coding a simple React scoreboard component.</p><p>React components have an internal <code>state</code> object containing the data that will be used to render the component. All I needed to do was pass the latest scores stream when creating the component, and then have the component observe the stream and update its <code>state</code>. The relevant bit of code is only a couple lines:</p>
<pre><code class="prettyprint js">// this.props.scores is the scores stream provided when the
// Scoreboard component is created

this.props.scores.observe(function(scores) {
	self.setState({ scores: scores });
});
</code></pre><p>React took care of automatically keeping the DOM in sync with the <code>state</code>.</p><h2><a href="#from-bits-to-pixels" class="anchor" name="from-bits-to-pixels"></a>From bits to pixels</h2><p>This is admittedly a toy app. However, it shows quite a few powerful concepts working together in a very small space, with very little code: small, server-generated deltas flowing over STOMP + WebSocket, to a reactive stream on the client being observed by a React component. Changes are flowing from a Spring back-end through to the UI&ndash;bits to pixels, as it were.</p><p>I hope this tiny app also provides a glimpse at the direction we&rsquo;re headed. We want to provide tools and client-side packages that help developers build rich, modern client applications that integrate with leading client-side technologies and Spring back-ends.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 1782;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>