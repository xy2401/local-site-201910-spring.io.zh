<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Preview Spring Security Test: Web Security</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Preview Spring Security Test: Web Security" />
<meta name="twitter:description" content="&lt;p&gt;&lt;/p&gt;
&lt;div class=&quot;callout&quot;&gt; 
 &lt;div class=&quot;callout-title&quot;&gt;
  Updated March 31 2015
 &lt;/div&gt; This blog is outdated and no longer maintained. Please refer to the 
 &lt;a href=&quot;http://docs.spring.io/spring-security/site/docs/4.0.x/reference/htmlsingle/#test&quot;&gt;Test Section&lt;/a&gt; of the reference documentation for updated documentation.
 &lt;br&gt; 
&lt;/div&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;In my &lt;a href=&quot;http://spring.io/blog/2014/05/07/preview-spring-security-test-method-security&quot;&gt;previous blog&lt;/a&gt; we demonstrated how the new Spring Security testing support can ease testing method based security. In this blog we will explore how we can use the testing support with Spring MVC Test.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#setting-up-mockmvc-and-spring-security&quot; class=&quot;anchor&quot; name=&quot;setting-up-mockmvc-and-spring-security&quot;&gt;&lt;/a&gt;Setting Up MockMvc and Spring Security&lt;/h2&gt;
&lt;p&gt;In order to use Spring Security with Spring MVC Test it is necessary to add the Spring Security &lt;code&gt;FilterChainProxy&lt;/code&gt; as a &lt;code&gt;Filter&lt;/code&gt;. For example:&lt;/p&gt;
" />
<meta name="twitter:creator" content="@rob_winch" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/30ed046efb35c67d4c055dab109b8933?s=200" />

<meta property="og:title" content="Preview Spring Security Test: Web Security" />
<meta property="og:image" content="https://gravatar.com/avatar/30ed046efb35c67d4c055dab109b8933?s=200" />
<meta property="og:description" content="&lt;p&gt;&lt;/p&gt;
&lt;div class=&quot;callout&quot;&gt; 
 &lt;div class=&quot;callout-title&quot;&gt;
  Updated March 31 2015
 &lt;/div&gt; This blog is outdated and no longer maintained. Please refer to the 
 &lt;a href=&quot;http://docs.spring.io/spring-security/site/docs/4.0.x/reference/htmlsingle/#test&quot;&gt;Test Section&lt;/a&gt; of the reference documentation for updated documentation.
 &lt;br&gt; 
&lt;/div&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;In my &lt;a href=&quot;http://spring.io/blog/2014/05/07/preview-spring-security-test-method-security&quot;&gt;previous blog&lt;/a&gt; we demonstrated how the new Spring Security testing support can ease testing method based security. In this blog we will explore how we can use the testing support with Spring MVC Test.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#setting-up-mockmvc-and-spring-security&quot; class=&quot;anchor&quot; name=&quot;setting-up-mockmvc-and-spring-security&quot;&gt;&lt;/a&gt;Setting Up MockMvc and Spring Security&lt;/h2&gt;
&lt;p&gt;In order to use Spring Security with Spring MVC Test it is necessary to add the Spring Security &lt;code&gt;FilterChainProxy&lt;/code&gt; as a &lt;code&gt;Filter&lt;/code&gt;. For example:&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2014-05-23 15:56:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Preview Spring Security Test: Web Security</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/30ed046efb35c67d4c055dab109b8933?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/rwinch">Rob Winch</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2014-05-23 15:56:00.0">May 23, 2014</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="1589" href="/blog/2014/05/23/preview-spring-security-test-web-security#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p><div class="callout">
<div class="callout-title">Updated March 31 2015</div>
This blog is outdated and no longer maintained. Please refer to the <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/reference/htmlsingle/#test">Test Section</a> of the reference documentation for updated documentation.<br />
</div></p><p>In my <a href="https://spring.io/blog/2014/05/07/preview-spring-security-test-method-security">previous blog</a> we demonstrated how the new Spring Security testing support can ease testing method based security. In this blog we will explore how we can use the testing support with Spring MVC Test.</p><h2><a href="#setting-up-mockmvc-and-spring-security" class="anchor" name="setting-up-mockmvc-and-spring-security"></a>Setting Up MockMvc and Spring Security</h2><p>In order to use Spring Security with Spring MVC Test it is necessary to add the Spring Security <code>FilterChainProxy</code> as a <code>Filter</code>. For example:</p>
<pre><code class="prettyprint java">@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
@WebAppConfiguration
public class CsrfShowcaseTests {

  @Autowired
  private WebApplicationContext context;

  @Autowired
  private Filter springSecurityFilterChain;

  private MockMvc mvc;

  @Before
  public void setup() {
      mvc = MockMvcBuilders
              .webAppContextSetup(context)
              .addFilters(springSecurityFilterChain)
              .build();
  }

  ...
</code></pre><p><div class="callout">
<div class="callout-title">Source Code</div>
You can find the complete source code for this blog series <a href="https://github.com/rwinch/spring-security-test-blog">on github</a><br />
</div></p><h2><a href="#securitymockmvcrequestpostprocessors" class="anchor" name="securitymockmvcrequestpostprocessors"></a>SecurityMockMvcRequestPostProcessors</h2><p>Spring MVC Test provides a convenient interface called a <code>RequestPostProcessor</code> that can be used to modify a request. Spring Security provides a number of <code>RequestPostProcessor</code> implementations that make testing easier. In order to use Spring Security&rsquo;s <code>RequestPostProcessor</code> implementations ensure the following static import is used:</p>
<pre><code class="prettyprint java">import static org.springframework.security.test.web.servlet.request.SecurityMockMvcRequestPostProcessors.*;
</code></pre><h3><a href="#testing-with-csrf-protection" class="anchor" name="testing-with-csrf-protection"></a>Testing with CSRF Protection</h3><p>When testing any non safe HTTP methods and using Spring Security&rsquo;s CSRF protection, you must be sure to include a valid CSRF Token in the request. Prior to the Spring Security testing support this was quite challenging. Now you can specify a valid CSRF token as a request parameter using the following:</p>
<pre><code class="prettyprint java">mvc
    .perform(post(&quot;/&quot;).with(csrf()))
</code></pre><p>If you like you can include CSRF token in the header instead:</p>
<pre><code class="prettyprint java">mvc
    .perform(post(&quot;/&quot;).with(csrf().asHeader()))
</code></pre><p>You can also test providing an invalid CSRF token using the following:</p>
<pre><code class="prettyprint java">mvc
    .perform(post(&quot;/&quot;).with(csrf().useInvalidToken()))
</code></pre><h3><a href="#running-a-test-as-a-user" class="anchor" name="running-a-test-as-a-user"></a>Running a Test as a User</h3><p>It is often desirable to run tests as a specific user. Prior to the Spring Security testing support this was challenging in web based tests since the <code>SecurityContextHolder</code> is modified by the <code>SecurityContextRepositoryFilter</code>.</p><p>There are now two simple ways of populating the user:</p>
<ul>
<li><a href="#user-content-populating-a-test-user-with-a-requestpostprocessor">Populating a Test User with a RequestPostProcessor</a></li>
<li><a href="#user-content-populating-a-test-user-with-annotations">Populating a Test User with Annotations</a></li>
</ul><p><div class="callout">
<div class="callout-title">NOTE</div>
<br />The testing support to run as a current user does not currently work when using Spring Security&rsquo;s stateless mode. This is being tracked at <a href="https://jira.spring.io/browse/SEC-2593">SEC-2593</a>.<br />
</div></p><h4><a href="#populating-a-test-user-with-a-requestpostprocessor" class="anchor" name="populating-a-test-user-with-a-requestpostprocessor"></a>Populating a Test User with a RequestPostProcessor</h4><p>There are a number of options available to populate a test user. For example, the following will run as a user (which does not need to exist) with the username &ldquo;user&rdquo;, the password &ldquo;password&rdquo;, and the role &ldquo;ROLE_USER&rdquo;:</p>
<pre><code class="prettyprint java">mvc
    .perform(get(&quot;/&quot;).with(user(&quot;user&quot;)))
</code></pre><p>You can easily make customizations. For example, the following will run as a user (which does not need to exist) with the username &ldquo;admin&rdquo;, the password &ldquo;pass&rdquo;, and the roles &ldquo;ROLE_USER&rdquo; and &ldquo;ROLE_ADMIN&rdquo;.</p>
<pre><code class="prettyprint java">mvc
    .perform(get(&quot;/admin&quot;).with(user(&quot;admin&quot;).password(&quot;pass&quot;).roles(&quot;USER&quot;,&quot;ADMIN&quot;)))
</code></pre><p>If you have a custom <code>UserDetails</code> that you would like to use, you can easily specify that as well. For example, the following will use the specified <code>UserDetails</code> (which does not need to exist) to run with a <code>UsernamePasswordAuthenticationToken</code> that has a principal of the specified <code>UserDetails</code>:</p>
<pre><code class="prettyprint java">mvc
    .perform(get(&quot;/&quot;).with(user(userDetails)))
</code></pre><p>If you want a custom <code>Authentication</code> (which does not need to exist) you can do so using the following:</p>
<pre><code class="prettyprint java">mvc
    .perform(get(&quot;/&quot;).with(authentication(authentication)))
</code></pre><p>You can even customize the <code>SecurityContext</code> using the following:</p>
<pre><code class="prettyprint java">mvc
    .perform(get(&quot;/&quot;).with(securityContext(securityContext)))
</code></pre><p>We can also ensure to run as a specific user for every request by using <code>MockMvcBuilders</code>&rsquo;s default request. For example, the following will run as a user (which does not need to exist) with the username &ldquo;admin&rdquo;, the password &ldquo;password&rdquo;, and the role &ldquo;ROLE_ADMIN&rdquo;:</p>
<pre><code class="prettyprint java">mvc = MockMvcBuilders
        .webAppContextSetup(context)
        .defaultRequest(get(&quot;/&quot;).with(user(&quot;user&quot;).roles(&quot;ADMIN&quot;)))
        .addFilters(springSecurityFilterChain)
        .build();
</code></pre><p>If you find you are using the same user in many of your tests, it is recommended to move the user to a method. For example, you can specify the following in your own class named <code>CustomSecurityMockMvcRequestPostProcessors</code>:</p>
<pre><code class="prettyprint java">public static RequestPostProcessor rob() {
	return user(&quot;rob&quot;).roles(&quot;ADMIN&quot;);
}
</code></pre><p>Now you can perform a static import on <code>SecurityMockMvcRequestPostProcessors</code> and use that within your tests:</p>
<pre><code class="prettyprint java">import static sample.CustomSecurityMockMvcRequestPostProcessors.*;

...

mvc
    .perform(get(&quot;/&quot;).with(rob()))
</code></pre><h4><a href="#populating-a-test-user-with-annotations" class="anchor" name="populating-a-test-user-with-annotations"></a>Populating a Test User with Annotations</h4><p>As an alternative to using a <code>RequestPostProcessor</code> to create your user, you can use annotations described in my previous <a href="https://spring.io/blog/2014/05/07/preview-spring-security-test-method-security">blog post</a>. However, for this to work, you must specify a <code>RequestPostProcessor</code> runs the request with the user from the annotations as shown below:</p>
<pre><code class="prettyprint java">mvc = MockMvcBuilders
        .webAppContextSetup(context)
        .addFilters(springSecurityFilterChain)
        .defaultRequest(get(&quot;/&quot;).with(testSecurityContext()))
        .build();
</code></pre><p><div class="callout">
<div class="callout-title">NOTE</div>
<br />Do not forget to specify the <code>WithSecurityContextTestExcecutionListener</code> as described in the previous blog.<br />
</div></p><p>Now you can run a test with any of the approaches described in Method Based Security Testing. For example, the following will run the test with the user with username &ldquo;user&rdquo;, password &ldquo;password&rdquo;, and role &ldquo;ROLE_USER&rdquo;:</p>
<pre><code class="prettyprint java">@Test
@WithMockUser
public void requestProtectedUrlWithUser() throws Exception {
  mvc
      .perform(get(&quot;/&quot;))
      ...
}
</code></pre><p>Alternatively, the following will run the test with the user with username &ldquo;user&rdquo;, password &ldquo;password&rdquo;, and role &ldquo;ROLE_ADMIN&rdquo;:</p>
<pre><code class="prettyprint java">@Test
@WithMockUser(roles=&quot;ADMIN&quot;)
public void requestProtectedUrlWithUser() throws Exception {
  mvc
      .perform(get(&quot;/&quot;))
      ...
}
</code></pre><p>For additional information on how to use the annotations, refer to my <a href="https://spring.io/blog/2014/05/07/preview-spring-security-test-method-security">previous blog</a>.</p><h3><a href="#testing-http-basic-authentication" class="anchor" name="testing-http-basic-authentication"></a>Testing HTTP Basic Authentication</h3><p>While it has always been possible to authenticate with HTTP Basic, it was a bit tedious to remember the header name, format, and encode the values. Now this can be done using Spring Security&rsquo;s <code>httpBasic</code> <code>RequestPostProcessor</code>. For example, the snippet below:</p>
<pre><code class="prettyprint java">mvc
    .perform(get(&quot;/&quot;).with(httpBasic(&quot;user&quot;,&quot;password&quot;)))
</code></pre><p>will attempt to use HTTP Basic to authenticate a user with the username &ldquo;user&rdquo; and the password &ldquo;password&rdquo; by ensuring the following header is populated on the HTTP Request:</p>
<pre><code class="prettyprint text">Authorization: Basic dXNlcjpwYXNzd29yZA==
</code></pre><h2><a href="#securitymockmvcrequestbuilders" class="anchor" name="securitymockmvcrequestbuilders"></a>SecurityMockMvcRequestBuilders</h2><p>Spring MVC Test also provides a <code>RequestBuilder</code> interface that can be used to create the <code>MockHttpServletRequest</code> used in your test. Spring Security provides a few <code>RequestBuilder</code> implementations that can be used to make testing easier. In order to use Spring Security&rsquo;s <code>RequestBuilder</code> implementations ensure the following static import is used:</p>
<pre><code class="prettyprint java">import static org.springframework.security.test.web.servlet.request.SecurityMockMvcRequestBuilders.*;
</code></pre><h3><a href="#testing-form-based-authentication" class="anchor" name="testing-form-based-authentication"></a>Testing Form Based Authentication</h3><p>You can easily create a request to test a form based authentication using Spring Security&rsquo;s testing support. For example, the following will submit a POST to &ldquo;/login&rdquo; with the username &ldquo;user&rdquo;, the password &ldquo;password&rdquo;, and a valid CSRF token:</p>
<pre><code class="prettyprint java">mvc
    .perform(formLogin())
</code></pre><p>It is easy to customize the request. For example, the following will submit a POST to &ldquo;/auth&rdquo; with the username &ldquo;admin&rdquo;, the password &ldquo;pass&rdquo;, and a valid CSRF token:</p>
<pre><code class="prettyprint java">mvc
    .perform(formLogin(&quot;/auth&quot;).user(&quot;admin&quot;).password(&quot;pass&quot;))
</code></pre><p>We can also customize the parameters names that the username and password are included on. For example, this is the above request modified to include the username on the HTTP parameter &ldquo;u&rdquo; and the password on the HTTP parameter &ldquo;p&rdquo;.</p>
<pre><code class="prettyprint java">mvc
    .perform(formLogin(&quot;/auth&quot;).user(&quot;a&quot;,&quot;admin&quot;).password(&quot;p&quot;,&quot;pass&quot;))
</code></pre><h3><a href="#testing-logout" class="anchor" name="testing-logout"></a>Testing Logout</h3><p>While fairly trivial using standard Spring MVC Test, you can use Spring Security&rsquo;s testing support to make testing log out easier. For example, the following will submit a POST to &ldquo;/logout&rdquo; with a valid CSRF token:</p>
<pre><code class="prettyprint java">mvc
    .perform(logout())
</code></pre><p>You can also customize the URL to post to. For example, the snippet below will submit a POST to &ldquo;/signout&rdquo; with a valid CSRF token:</p>
<pre><code class="prettyprint java">mvc
    .perform(logout(&quot;/signout&quot;))
</code></pre><h2><a href="#securitymockmvcresultmatchers" class="anchor" name="securitymockmvcresultmatchers"></a>SecurityMockMvcResultMatchers</h2><p>At times it is desirable to make various security related assertions about a request. To accommodate this need, Spring Security Test support implements Spring MVC Test&rsquo;s <code>ResultMatcher</code> interface. In order to use Spring Security&rsquo;s <code>ResultMatcher</code> implementations ensure the following static import is used:</p>
<pre><code class="prettyprint java">import static org.springframework.security.test.web.servlet.response.SecurityMockMvcResultMatchers.*;
</code></pre><h3><a href="#unauthenticated-assertion" class="anchor" name="unauthenticated-assertion"></a>Unauthenticated Assertion</h3><p>At times it may be valuable to assert that there is no authenticated user associated with the result of a <code>MockMvc</code> invocation. For example, you might want to test submitting an invalid username and password and verify that no user is authenticated. You can easily do this with Spring Security&rsquo;s testing support using something like the following:</p>
<pre><code class="prettyprint java">mvc
    .perform(formLogin().password(&quot;invalid&quot;))
    .andExpect(unauthenticated());
</code></pre><h3><a href="#authenticated-assertion" class="anchor" name="authenticated-assertion"></a>Authenticated Assertion</h3><p>It is often times that we must assert that an authenticated user exists. For example, we may want to verify that we authenticated successfully. We could verify that a form based login was successful with the following snippet of code:</p>
<pre><code class="prettyprint java">mvc
    .perform(formLogin())
    .andExpect(authenticated());
</code></pre><p>If we wanted to assert the roles of the user, we could refine our previous code as shown below:</p>
<pre><code class="prettyprint java">mvc
    .perform(formLogin().user(&quot;admin&quot;))
    .andExpect(authenticated().withRoles(&quot;USER&quot;,&quot;ADMIN&quot;));
</code></pre><p>Alternatively, we could verify the username:</p>
<pre><code class="prettyprint java">mvc
    .perform(formLogin().user(&quot;admin&quot;))
    .andExpect(authenticated().withUsername(&quot;admin&quot;));
</code></pre><p>We can also combine the assertions:</p>
<pre><code class="prettyprint java">mvc
    .perform(formLogin().user(&quot;admin&quot;).roles(&quot;USER&quot;,&quot;ADMIN&quot;))
    .andExpect(authenticated().withUsername(&quot;admin&quot;));
</code></pre><h2><a href="#with-htmlunit" class="anchor" name="with-htmlunit"></a>With HtmlUnit</h2><p>We have now seen how Spring Security Test support can make testing with Spring MVC Test easier. In our <a href="https://spring.io/blog/2014/05/23/preview-spring-security-test-htmlunit">next blog</a>, we will explore how to use Spring Security Testing support with <a href="https://github.com/spring-projects/spring-test-mvc-htmlunit">Spring Test MVC HtmlUnit</a>.</p><p><div class="callout">
<div class="callout-title">Feedback please!</div>
<br />If you have feedback on this blog series or the Spring Security Test support, I encourage you to reach out via <a href="https://jira.spring.io/browse/SEC">JIRA</a>, via the comments section, or ping me on twitter <a href="https://twitter.com/rob_winch">@rob_winch</a>. Of course the best feedback comes in the form of <a href="https://github.com/spring-projects/spring-security/blob/master/CONTRIBUTING.md">contributions</a>.<br />
</div></p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 1589;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>