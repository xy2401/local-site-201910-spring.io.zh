<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Building a RESTful quotation service with Spring</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Building a RESTful quotation service with Spring" />
<meta name="twitter:description" content="&lt;p&gt;I was recently made aware that a public API we were using for one of our guides contained objectionable material. After confirming this, I immediately responded that we would pick another source. Wishing to avoid such an issue in the future, I decided the best solution was to build our own RESTful quote service. So I decided to use the best tools to do so, the Spring stack, and was able to migrate the very next day.&lt;/p&gt;
&lt;h3&gt;&lt;a href=&quot;#picking-your-tools&quot; class=&quot;anchor&quot; name=&quot;picking-your-tools&quot;&gt;&lt;/a&gt;Picking your tools&lt;/h3&gt;
&lt;p&gt;To kick things off, I made a check list of what I knew would be the right tools for the job of creating a RESTful web service.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@gregturn" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/43e9a9d63f7f4f9891c9fcd592b89cfa?s=200" />

<meta property="og:title" content="Building a RESTful quotation service with Spring" />
<meta property="og:image" content="https://gravatar.com/avatar/43e9a9d63f7f4f9891c9fcd592b89cfa?s=200" />
<meta property="og:description" content="&lt;p&gt;I was recently made aware that a public API we were using for one of our guides contained objectionable material. After confirming this, I immediately responded that we would pick another source. Wishing to avoid such an issue in the future, I decided the best solution was to build our own RESTful quote service. So I decided to use the best tools to do so, the Spring stack, and was able to migrate the very next day.&lt;/p&gt;
&lt;h3&gt;&lt;a href=&quot;#picking-your-tools&quot; class=&quot;anchor&quot; name=&quot;picking-your-tools&quot;&gt;&lt;/a&gt;Picking your tools&lt;/h3&gt;
&lt;p&gt;To kick things off, I made a check list of what I knew would be the right tools for the job of creating a RESTful web service.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2014-08-21 20:05:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Building a RESTful quotation service with Spring</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/43e9a9d63f7f4f9891c9fcd592b89cfa?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/gturnquist">Greg Turnquist</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2014-08-21 20:05:00.0">August 21, 2014</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="1741" href="/blog/2014/08/21/building-a-restful-quotation-service-with-spring#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>I was recently made aware that a public API we were using for one of our guides contained objectionable material. After confirming this, I immediately responded that we would pick another source. Wishing to avoid such an issue in the future, I decided the best solution was to build our own RESTful quote service. So I decided to use the best tools to do so, the Spring stack, and was able to migrate the very next day.</p><h3><a href="#picking-your-tools" class="anchor" name="picking-your-tools"></a>Picking your tools</h3><p>To kick things off, I made a check list of what I knew would be the right tools for the job of creating a RESTful web service.</p>
<ul>
<li><a href="https://projects.spring.io/spring-data-jpa/">Spring Data JPA</a> - quickly pre-load, fetch, and potentially update content</li>
<li><a href="https://projects.spring.io/spring-framework/">Spring MVC</a> - solid REST support since Spring 3</li>
<li><a href="https://projects.spring.io/spring-boot/">Spring Boot</a> - create all the needed components with little to no effort</li>
<li><a href="https://start.spring.io">http://start.spring.io</a> - assemble a project by simply checking the desired items on a form</li>
</ul><p>I quickly set aside the desire to add, delete, manage, or view the data through a web page. Instead, my focus was to serve up a fixed set of content with the exact same structure that the guide expected to consume.</p><h3><a href="#picking-your-content" class="anchor" name="picking-your-content"></a>Picking your content</h3><p>The original content for the guide was a series of &ldquo;Chunk Norris&rdquo; jokes. I like a good laugh. But when I revisited the public API, I saw that several of the jokes were a bit rancid. After a brief discussion with colleagues, the idea came up to cite historical quotes. I took that idea and bent it a little. I had recently collected quotes from various developers about Spring Boot for personal reasons, so I decided to use that as the curated content.</p><h3><a href="#time-to-code" class="anchor" name="time-to-code"></a>Time to code!</h3><p>To kick things off, I visited <a href="https://start.spring.io">http://start.spring.io</a>. This <a href="https://github.com/spring-io/initializr">Spring Boot app</a> lets you enter the details of your new project, pick the Java level, and select the Spring Boot starters you need. I used my checklist up above and created a new gradle-based project.</p><h4><a href="#defining-your-domain" class="anchor" name="defining-your-domain"></a>Defining your domain</h4><p>With the project unpacked and imported into my IDE, the first thing I did was copy the <a href="https://spring.io/guides/gs/messaging-reactor/#initial">domain objects shown in the Reactor guide</a>. This way, I could ensure that the data sent out by my REST service was correct. Since the POJOs in my <em>Quoters Incorporated</em> app are almost identical, I won&rsquo;t post them here.</p><p>Then I created a Spring Data repository.</p>
<pre><code class="prettyprint java">public interface QuoteRepository extends CrudRepository&lt;Quote, Long&gt; {}
</code></pre><p>This empty interface definition handles <code>Quote</code> objects with an internal primary key of type <code>Long</code>. By extending the Spring Data Commons <code>CrudRepository</code>, it inherits a fistful of database operations we&rsquo;ll use later on.</p><p>Next step? Initialize some data. I created a <code>DatabaseLoader</code> like this:</p>
<pre><code class="prettyprint java">@Service
public class DatabaseLoader {

	private final QuoteRepository repository;

	@Autowired
	public DatabaseLoader(QuoteRepository repository) {
		this.repository = repository;
	}

	@PostConstruct
	void init() {
		repository.save(new Quote(&quot;Working with Spring Boot is like pair-programming with the Spring developers.&quot;));
		// more quotes...
	}

}
</code></pre>
<ul>
<li>It&rsquo;s marked as a <code>@Service</code> so it will be automatically picked up by <code>@ComponentScan</code> when the app starts.</li>
<li>It uses constructor injection with auto-wiring to ensure a copy of the <code>QuoteRepository</code> is made available.</li>
<li><code>@PostConstruct</code> tells Spring MVC to run the data loading method after all beans have been created.</li>
<li>Finally, the <code>init()</code> method uses Spring Data JPA to create a whole slew of quotations.</li>
</ul><p>Because I have H2 as my database of choice (**com.h2database:h2**) in <code>build.gradle</code>, there is no database set up at all (thanks to Spring Boot).</p><h4><a href="#creating-a-controller" class="anchor" name="creating-a-controller"></a>Creating a controller</h4><p>After I built this database layer, I went on to create the APIs. With Spring MVC, it wasn&rsquo;t hard at all.</p>
<pre><code class="prettyprint java">@RestController
public class QuoteController {

	private final QuoteRepository repository;

	private final static Quote NONE = new Quote(&quot;None&quot;);

	private final static Random RANDOMIZER = new Random();

	@Autowired
	public QuoteController(QuoteRepository repository) {
		this.repository = repository;
	}

	@RequestMapping(value = &quot;/api&quot;, method = RequestMethod.GET)
	public List&lt;QuoteResource&gt; getAll() {
		return StreamSupport.stream(repository.findAll().spliterator(), false)
			.map(q -&gt; new QuoteResource(q, &quot;success&quot;))
			.collect(Collectors.toList());
	}

	@RequestMapping(value = &quot;/api/{id}&quot;, method = RequestMethod.GET)
	public QuoteResource getOne(@PathVariable Long id) {
		if (repository.exists(id)) {
			return new QuoteResource(repository.findOne(id), &quot;success&quot;);
		} else {
			return new QuoteResource(NONE, &quot;Quote &quot; + id + &quot; does not exist&quot;);
		}
	}

	@RequestMapping(value = &quot;/api/random&quot;, method = RequestMethod.GET)
	public QuoteResource getRandomOne() {
		return getOne(nextLong(1, repository.count() + 1));
	}

	private long nextLong(long lowerRange, long upperRange) {
		return (long)(RANDOMIZER.nextDouble() * (upperRange - lowerRange)) + lowerRange;
	}

}
</code></pre><p>Let&rsquo;s break it down:</p>
<ul>
<li>The whole class is flagged as a <code>@RestController</code>. This means all routes return objects not views.</li>
<li>I have some static objects, particular a <code>NONE</code> quote and a Java 8 <code>Random</code> for randomly picking quotes.</li>
<li>It uses constructor injection to get a hold of <code>QuoteRepository</code>.</li>
</ul>
<table>
<thead>
<tr>
<th>API </th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>/api </td>
<td>Fetch ALL quotes</td>
</tr>
<tr>
<td>/api/{id} </td>
<td>Fetch quote <strong>id</strong></td>
</tr>
<tr>
<td>/api/random </td>
<td>Fetch a random quote</td>
</tr>
</tbody>
</table><p>To fetch ALL quotes, I use a Java 8 stream to wrap the Spring data&rsquo;s <code>findAll()</code> and in turn, wrap each one into a <code>QuoteResource</code>. The results are turned into a <code>List</code>.</p><p>To fetch a single quote, it first tests if a given id exists. If not, return <code>NONE</code>. Otherwise, return a wrapped quote.</p><p>Finally, to fetch a random quote, I use Java 8&rsquo;s <code>Random</code> utility inside the <code>nextLong()</code> utility method to fetch a <code>Long</code> with the <code>lowerRange</code> and <code>upperRange</code>, inclusively.</p>
<blockquote><p><strong>QUESTION:</strong> Why am I using <code>QuoteResource</code>? <code>Quote</code> is the core domain object returned by the <code>QuoteRepository</code>. To match the previous public API, I wrap each instance in a <code>QuoteResource</code> which includes a <strong>status</strong> code.</p>
</blockquote><h4><a href="#testing-the-results" class="anchor" name="testing-the-results"></a>Testing the results</h4><p>With this in place, the default <code>Application</code> class created by <a href="https://start.spring.io">http://start.spring.io</a> was ready to run.</p><p>`<code>
$ curl localhost:8080/api/random
{
type: &quot;success&quot;,
value: {
id: 1,
quote: &quot;Working with Spring Boot is like pair-programming with the Spring developers.&quot;
}
}
</code></p><p>Ta dah! </p><p>To wrap things up, I built the JAR file and pushed it up to <a href="https://run.pivotal.io/">Pivotal Web Services</a>. You can view the site yourself at <a href="https://gturnquist-quoters.cfapps.io/api/random">http://gturnquist-quoters.cfapps.io/api/random</a>.</p><p>Suffice it to say, I was able to tweak the <a href="https://spring.io/guides/gs/messaging-reactor/">Reactor guide</a> by altering <a href="https://github.com/spring-guides/gs-messaging-reactor/blob/master/complete/src/main/java/hello/Receiver.java#L21">ONE LINE OF CODE</a>. With that in place, I did some other clean up of the content and was done!</p><p>To see the code, please visit <a href="https://github.com/gregturn/quoters">https://github.com/gregturn/quoters</a>.</p><h3><a href="#outstanding-issues" class="anchor" name="outstanding-issues"></a>Outstanding issues</h3>
<ul>
<li>This RESTful service satisfies <a href="http://martinfowler.com/articles/richardsonMaturityModel.html#level2">Level 2 - HTTP Verbs</a> of the Richardson Maturity Model. While good, it&rsquo;s best to shoot for <a href="http://martinfowler.com/articles/richardsonMaturityModel.html#level3">Level 3 - Hypermedia</a>. With <a href="https://projects.spring.io/spring-hateoas">Spring HATEOAS</a>, it&rsquo;s easier than ever to add hypermedia links. Stay tuned.</li>
<li>There is no friendly web page. This would be nice, but it isn&rsquo;t required.</li>
<li>Content is fixed and defined inside the app. To make content flexible, we would need to open the door to POSTs and PUTs. This would introduce the desire to also secure things properly.</li>
</ul><p>These are some outstanding things that didn&rsquo;t fit inside the time budget and weren&rsquo;t required to solve the original problem involving the Reactor guide. But they are good exercises you can explore! You can clone the project in github and take a shot at it yourself!</p><h3><a href="#springone-2gx-2014" class="anchor" name="springone-2gx-2014"></a>SpringOne 2GX 2014</h3><p>Book your place at <a href="https://2014.event.springone2gx.com/register">SpringOne</a> in Dallas, TX for Sept 8-11 soon. It&rsquo;s simply the best opportunity to find out first hand all that&rsquo;s going on and to provide direct feedback. You can see myself and Roy Clarkson talk about <a href="https://2014.event.springone2gx.com/schedule/sessions/spring_data_rest_data_meets_hypermedia.html">Spring Data REST - Data Meets Hypermedia</a> to see how to merge Spring Data and RESTful services.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 1741;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>