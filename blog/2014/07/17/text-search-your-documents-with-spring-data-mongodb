<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>$text $search your Documents with Spring Data MongoDB</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="$text $search your Documents with Spring Data MongoDB" />
<meta name="twitter:description" content="&lt;p&gt;MongoDB officially has offered full text search capabilities since its 2.6 release. The feature ranks among the &lt;a href=&quot;https://jira.mongodb.org/issues/?jql=project%20%3D%20SERVER%20AND%20issuetype%20%3D%20%22New%20Feature%22%20ORDER%20BY%20votes%20DESC&quot;&gt;Top 5&lt;/a&gt; most voted features for the server component and ships in its current version with numerous stemmers and parsers, phrase matching, negation and per field weights. So it’s about time to give it a little love and share what’s cooking in Spring Data’s kitchen to support that feature.&lt;/p&gt;
&lt;p&gt;For text indexing and searching MongoDB defaults the language to English, normalizing the text by tokenizing, removing common stop words and reducing words to their base. There’s support for several other languages as well.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@stroblchristoph" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/eeacd6c45e867cb36eb05c9daa5cc2de?s=200" />

<meta property="og:title" content="$text $search your Documents with Spring Data MongoDB" />
<meta property="og:image" content="https://gravatar.com/avatar/eeacd6c45e867cb36eb05c9daa5cc2de?s=200" />
<meta property="og:description" content="&lt;p&gt;MongoDB officially has offered full text search capabilities since its 2.6 release. The feature ranks among the &lt;a href=&quot;https://jira.mongodb.org/issues/?jql=project%20%3D%20SERVER%20AND%20issuetype%20%3D%20%22New%20Feature%22%20ORDER%20BY%20votes%20DESC&quot;&gt;Top 5&lt;/a&gt; most voted features for the server component and ships in its current version with numerous stemmers and parsers, phrase matching, negation and per field weights. So it’s about time to give it a little love and share what’s cooking in Spring Data’s kitchen to support that feature.&lt;/p&gt;
&lt;p&gt;For text indexing and searching MongoDB defaults the language to English, normalizing the text by tokenizing, removing common stop words and reducing words to their base. There’s support for several other languages as well.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2014-07-17 12:52:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">$text $search your Documents with Spring Data MongoDB</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/eeacd6c45e867cb36eb05c9daa5cc2de?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/christophstrobl">Christoph Strobl</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2014-07-17 12:52:00.0">July 17, 2014</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="1661" href="/blog/2014/07/17/text-search-your-documents-with-spring-data-mongodb#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>MongoDB officially has offered full text search capabilities since its 2.6 release. The feature ranks among the <a href="https://jira.mongodb.org/issues/?jql=project%20%3D%20SERVER%20AND%20issuetype%20%3D%20%22New%20Feature%22%20ORDER%20BY%20votes%20DESC">Top 5</a> most voted features for the server component and ships in its current version with numerous stemmers and parsers, phrase matching, negation and per field weights. So it&rsquo;s about time to give it a little love and share what&rsquo;s cooking in Spring Data&rsquo;s kitchen to support that feature.</p><p>For text indexing and searching MongoDB defaults the language to English, normalizing the text by tokenizing, removing common stop words and reducing words to their base. There&rsquo;s support for several other languages as well.</p><h2><a href="#manually-build-text-indexes" class="anchor" name="manually-build-text-indexes"></a>Manually build text indexes</h2>
<pre><code class="prettyprint java">@Document
class CookingRecipe {
  String title;
  String content;
}
</code></pre><p>Here we&rsquo;ve got a very simple entity <code>CookingRecipe</code> and want to have a text index based on its <code>title</code> and <code>content</code> fields, putting some weight of 2 to search hits in <code>title</code>. Attaching weights to fields allows you to influence relevancy of a document when being looked up. It defines the significance of a field relative to others, boosting the documents score. In this case it doubles the documents relevance when hitting a match in <code>title</code>. The raw MongoDB index definition would look something like this:</p>
<pre><code class="prettyprint javascript">{
  title : &quot;text&quot;,
  content : &quot;text&quot;
},
{
  weights: { title : 2 }
}
</code></pre><p>As of version 1.5 M1 of Spring Data MongoDB we can create a text index, capturing the fields we want to have full text search enabled on, manually.</p>
<pre><code class="prettyprint java">TextIndexDefinition textIndex = new TextIndexDefinitionBuilder()
  .onField(&quot;title&quot;, 2F)
  .onField(&quot;content&quot;)
  .build();

MongoTemplate template = … // obtain MongoTemplate
template.indexOps(CookingRecipe.class).ensureIndex(textIndex);
</code></pre><p>Alternatively, let the index be created automatically using mapping annotations. All we need to do is adding a few hints on the domain class and we are good to go.</p>
<pre><code class="prettyprint java">@Document
class CookingRecipe {
  @TextIndexed(weight=2) String title;
  @TextIndexed String content;
}
</code></pre><p>Please note that it is only possible to have one full text index per collection. Now that we&rsquo;ve created the index we&rsquo;ll query the top 5 recipes matching &ldquo;coffee&rdquo; or &ldquo;cake&rdquo;.</p>
<pre><code class="prettyprint java">TextCriteria criteria = TextCriteria.forDefaultLanguage()
  .matchingAny(&quot;coffee&quot;, &quot;cake&quot;);

Query query = TextQuery.queryText(criteria)
  .sortByScore()
  .with(new PageRequest(0, 5));

List&lt;CookingRecipe&gt; recipes = template.find(query, CookingRecipe);
</code></pre><p>Note that we provide dedicated types <code>TextCriteria</code> and <code>TextQuery</code> to express searches in full detail. </p><h2><a href="#scoring" class="anchor" name="scoring"></a>Scoring</h2><p>As mentioned earlier, documents get scored while searching. The <code>score</code> value is not returned by default, but since this information is often helpful we can include it in the output by adding <code>{ score : { $meta : &quot;textScore&quot; } }</code> to the projection, which is implicitly done by calling <code>query.sortByScore()</code>. To access the score in the resulting documents we add a <code>@TextScore</code> annotated property to <code>CookingRecipe</code>.</p>
<pre><code class="prettyprint java">@Document
class CookingRecipe {
  @TextIndexed(weight=2) String title;
  @TextIndexed String content;
  @TextScore Float score;
}
</code></pre><p>The <code>@TextScore</code> annotation implicitly turns the <code>score</code> property into a read-only property due to the <code>@ReadOnlyProperty</code> annotation the annotation carries in turn. The latter can be used in other contexts as well where you&rsquo;d like make sure fields from a document are only read but never written.</p><p>Additional resources on <a href="http://docs.mongodb.org/manual/reference/operator/query/text/#behavior">behavior and restrictions</a>, as well as <a href="http://docs.mongodb.org/manual/reference/text-search-languages">supported languages</a> can be found in the <a href="http://docs.mongodb.org/manual/reference/">MongoDB reference</a>.</p><p>Moving forward with release train <a href="https://github.com/spring-projects/spring-data-commons/wiki/Release-Train-Evans">Evans</a> we will be adding text search support to <code>MongoRepositories</code>.</p>
<hr /><p>If you want to learn more about Spring Data, be sure to <a href="https://2014.event.springone2gx.com/register">register</a> for this year&rsquo;s SpringOne conference. The <a href="https://2014.event.springone2gx.com/schedule/2014-09-09">schedule</a> contains a lot of data-related talks to introduce you to the latest features we&rsquo;re going to ship with Evans.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 1661;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
 <aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>