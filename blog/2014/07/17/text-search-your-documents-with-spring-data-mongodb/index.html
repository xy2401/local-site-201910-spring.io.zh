<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>$ text $使用Spring Data MongoDB搜索您的文档</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="$text $search your Documents with Spring Data MongoDB">
<meta name="twitter:description" content="<p>MongoDB officially has offered full text search capabilities since its 2.6 release. The feature ranks among the <a href=" https:="" ="" jira.mongodb.org="" issues="" ?jql="project %3D SERVER AND issuetype %3D "New Feature" ORDER BY votes DESC""></head><body >Top 5 most voted features for the server component and ships in its current version with numerous stemmers and parsers, phrase matching, negation and per field weights. So it’s about time to give it a little love and share what’s cooking in Spring Data’s kitchen to support that feature.
<p>For text indexing and searching MongoDB defaults the language to English, normalizing the text by tokenizing, removing common stop words and reducing words to their base. There’s support for several other languages as well.</p>
">
<meta name="twitter:creator" content="@stroblchristoph">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/eeacd6c45e867cb36eb05c9daa5cc2de?s=200">

<meta property="og:title" content="$text $search your Documents with Spring Data MongoDB">
<meta property="og:image" content="https://gravatar.com/avatar/eeacd6c45e867cb36eb05c9daa5cc2de?s=200">
<meta property="og:description" content="<p>MongoDB officially has offered full text search capabilities since its 2.6 release. The feature ranks among the <a href=" https:="" ="" jira.mongodb.org="" issues="" ?jql="project %3D SERVER AND issuetype %3D "New Feature" ORDER BY votes DESC"">Top 5 most voted features for the server component and ships in its current version with numerous stemmers and parsers, phrase matching, negation and per field weights. So it’s about time to give it a little love and share what’s cooking in Spring Data’s kitchen to support that feature.
<p>For text indexing and searching MongoDB defaults the language to English, normalizing the text by tokenizing, removing common stop words and reducing words to their base. There’s support for several other languages as well.</p>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2014-07-17 12:52:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">$ text $使用Spring Data MongoDB搜索您的文档</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/eeacd6c45e867cb36eb05c9daa5cc2de?s=20&d=mm"> <a class="author" rel="author" href="/team/christophstrobl">克里斯多夫·斯特罗布尔</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2014-07-17 12:52:00.0">2014年7月17日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2014/07/17/text-search-your-documents-with-spring-data-mongodb#disqus_thread" data-disqus-identifier="1661">
</a></div>
</div>
</header>
<div class="blog--post"><p>自2.6版本以来，MongoDB正式提供了全文本搜索功能。该功能是该服务器组件中投票<a href="https://jira.mongodb.org/issues/?jql=project %3D SERVER AND issuetype %3D "New Feature" ORDER BY votes DESC">最多的5个</a>功能之一，并且在其当前版本中具有大量词干分析器，短语匹配，否定和每个字段权重。因此，现在是时候给它一点点爱，并在Spring Data的厨房中分享烹饪内容以支持该功能了。</p><p>对于文本索引和搜索，MongoDB默认将语言设置为英语，通过标记化，删除常见的停用词并将其缩减为基本词来对文本进行标准化。也支持其他几种语言。</p><h2><a href="#manually-build-text-indexes" class="anchor" name="manually-build-text-indexes"></a>手动建立文字索引</h2>
<pre><code class="prettyprint java">@Document
class CookingRecipe {
  String title;
  String content;
}
</code></pre><p>在这里，我们有一个非常简单的实体<code>CookingRecipe</code>并希望基于其文本索引<code>title</code>和<code>content</code>字段，将2的权重用于搜索匹配<code>title</code> 。在字段上附加权重可以使您在查找文档时影响文档的相关性。它定义了字段相对于其他字段的重要性，从而提高了文档得分。在这种情况下，在<code>title</code> 。原始的MongoDB索引定义如下所示：</p>
<pre><code class="prettyprint javascript">{
  title : &quot;text&quot;,
  content : &quot;text&quot;
},
{
  weights: { title : 2 }
}
</code></pre><p>从Spring Data MongoDB的1.5 M1版本开始，我们可以创建文本索引，捕获要手动启用全文搜索的字段。</p>
<pre><code class="prettyprint java">TextIndexDefinition textIndex = new TextIndexDefinitionBuilder()
  .onField(&quot;title&quot;, 2F)
  .onField(&quot;content&quot;)
  .build();

MongoTemplate template = … // obtain MongoTemplate
template.indexOps(CookingRecipe.class).ensureIndex(textIndex);
</code></pre><p>另外，也可以使用映射注释自动创建索引。我们要做的就是在域类上添加一些提示，我们很高兴。</p>
<pre><code class="prettyprint java">@Document
class CookingRecipe {
  @TextIndexed(weight=2) String title;
  @TextIndexed String content;
}
</code></pre><p>请注意，每个集合只能有一个全文索引。现在，我们已经创建了索引，我们将查询与“咖啡”或“蛋糕”匹配的前5个食谱。</p>
<pre><code class="prettyprint java">TextCriteria criteria = TextCriteria.forDefaultLanguage()
  .matchingAny(&quot;coffee&quot;, &quot;cake&quot;);

Query query = TextQuery.queryText(criteria)
  .sortByScore()
  .with(new PageRequest(0, 5));

List&lt;CookingRecipe&gt; recipes = template.find(query, CookingRecipe);
</code></pre><p>请注意，我们提供专用类型<code>TextCriteria</code>和<code>TextQuery</code>表示详细搜索。</p><h2><a href="#scoring" class="anchor" name="scoring"></a>计分</h2><p>如前所述，文档在搜索时会得到评分。的<code>score</code>默认情况下不返回值，但是由于此信息通常很有用，我们可以通过添加以下内容将其包含在输出中<code>{ score : { $meta : "textScore" } }</code>到投影，这是通过调用隐式完成的<code>query.sortByScore()</code> 。要访问结果文档中的分数，我们添加一个<code>@TextScore</code>带注释的属性<code>CookingRecipe</code> 。</p>
<pre><code class="prettyprint java">@Document
class CookingRecipe {
  @TextIndexed(weight=2) String title;
  @TextIndexed String content;
  @TextScore Float score;
}
</code></pre><p>的<code>@TextScore</code>注释隐式地将<code>score</code>属性由于变成了只读属性<code>@ReadOnlyProperty</code>注释注释依次携带。后者也可以在其他上下文中使用，您需要确保仅读取文档中的字段，而不能写入文档中的字段。</p><p>有关<a href="http://docs.mongodb.org/manual/reference/operator/query/text/#behavior">行为和限制的</a>其他资源以及<a href="http://docs.mongodb.org/manual/reference/text-search-languages">受支持的语言，请</a>参见<a href="http://docs.mongodb.org/manual/reference/">MongoDB参考</a> 。</p><p>随着发行火车<a href="https://github.com/spring-projects/spring-data-commons/wiki/Release-Train-Evans">Evans的发展，</a>我们将为<code>MongoRepositories</code> 。</p>
<hr><p>如果您想了解有关Spring Data的更多信息，请确保<a href="https://2014.event.springone2gx.com/register">注册</a>今年的SpringOne会议。<a href="https://2014.event.springone2gx.com/schedule/2014-09-09">日程安排</a>包含许多与数据相关的讲座，向您介绍我们将随Evans一起提供的最新功能。</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 1661;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>