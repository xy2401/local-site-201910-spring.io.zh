<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>用Geb进行Spring MVC测试</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Spring MVC Test with Geb">
<meta name="twitter:description" content="<p>In my <a href=" https:="" ="" spring.io="" blog="" 2014="" 03="" 26="" spring-mvc-test-with-webdrive="="></head><body >third post I discussed how to use <a href="http://docs.seleniumhq.org/projects/webdriver/">WebDriver</a> to make designing our tests easier with the Page Object Pattern. In this post, I’m going to discuss how to use <a href="http://www.gebish.org/">Geb</a> to make our testing with <code>MockMvc</code> more Groovy.
<h2><a href="#why-geb-and-mockmvc" class="anchor" name="why-geb-and-mockmvc"></a>Why Geb and MockMvc</h2>
<p>Geb is backed by WebDriver, so it offers many of the same benefits we got from WebDriver. However, Geb makes things even easier by taking care of some of the boiler plate code for us. Of course we want to use MockMvc so that we do no need to deploy our code to a server. The easiest way to understand the benefits of using Geb is to jump into an example.</p>
">
<meta name="twitter:creator" content="@rob_winch">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/30ed046efb35c67d4c055dab109b8933?s=200">

<meta property="og:title" content="Spring MVC Test with Geb">
<meta property="og:image" content="https://gravatar.com/avatar/30ed046efb35c67d4c055dab109b8933?s=200">
<meta property="og:description" content="<p>In my <a href=" https:="" ="" spring.io="" blog="" 2014="" 03="" 26="" spring-mvc-test-with-webdrive="=">third post I discussed how to use <a href="http://docs.seleniumhq.org/projects/webdriver/">WebDriver</a> to make designing our tests easier with the Page Object Pattern. In this post, I’m going to discuss how to use <a href="http://www.gebish.org/">Geb</a> to make our testing with <code>MockMvc</code> more Groovy.
<h2><a href="#why-geb-and-mockmvc" class="anchor" name="why-geb-and-mockmvc"></a>Why Geb and MockMvc</h2>
<p>Geb is backed by WebDriver, so it offers many of the same benefits we got from WebDriver. However, Geb makes things even easier by taking care of some of the boiler plate code for us. Of course we want to use MockMvc so that we do no need to deploy our code to a server. The easiest way to understand the benefits of using Geb is to jump into an example.</p>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2014-04-15 22:23:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">用Geb进行Spring MVC测试</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/30ed046efb35c67d4c055dab109b8933?s=20&d=mm"> <a class="author" rel="author" href="/team/rwinch">罗伯·温奇</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2014-04-15 22:23:00.0">2014年4月15日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2014/04/15/spring-mvc-test-with-geb#disqus_thread" data-disqus-identifier="1504">
</a></div>
</div>
</header>
<div class="blog--post"><p>在我的<a href="https://spring.io/blog/2014/03/26/spring-mvc-test-with-webdriver">第三篇文章中，</a>我讨论了如何使用<a href="http://docs.seleniumhq.org/projects/webdriver/">WebDriver</a>通过Page Object Pattern <a href="http://docs.seleniumhq.org/projects/webdriver/">简化</a>设计测试的过程。在这篇文章中，我将讨论如何使用<a href="http://www.gebish.org/">Geb</a>进行测试<code>MockMvc</code>更多Groovy。</p><h2><a href="#why-geb-and-mockmvc" class="anchor" name="why-geb-and-mockmvc"></a>为什么选择Geb和MockMvc</h2><p>Geb得到了WebDriver的支持，因此它提供了许多与WebDriver相同的好处。但是，Geb通过为我们处理一些样板代码使事情变得更加轻松。当然，我们要使用MockMvc，以便我们无需将代码部署到服务器。理解使用Geb的好处的最简单方法是跳到一个例子。</p><p>---<br><strong>注意</strong> ：Geb的另一个重要功能是其<a href="http://www.gebish.org/manual/current/">出色的文档</a> 。</p>
<hr><h2><a href="#updating-dependencies" class="anchor" name="updating-dependencies"></a>更新依赖项</h2><p>在使用项目之前，必须确保更新依赖项。有关<a href="https://github.com/spring-projects/spring-test-mvc-htmlunit#building-with-maven">Maven</a>和<a href="https://github.com/spring-projects/spring-test-mvc-htmlunit#building-with-gradle">Gradle的</a>说明，请参见站点文档。</p><h2><a href="#using-geb" class="anchor" name="using-geb"></a>使用Geb</h2><p>现在我们有了正确的依赖关系，我们可以在单元测试中使用Geb了。在<a href="https://github.com/spring-projects/spring-test-mvc-htmlunit/blob/master/mail-webapp/src/test/groovy/sample/geb/GebCreateMessagesSpec.groovy">GebCreateMessagesSpec中</a>可以找到使用Geb和Spring MVC Test的完整代码示例。</p><h3><a href="#creating-a-mockmvc-instance" class="anchor" name="creating-a-mockmvc-instance"></a>创建一个MockMvc实例</h3><p>为了使用HtmlUnit和Spring MVC Test，我们必须首先创建一个<code>MockMvc</code>实例。关于如何创建<code>MockMvc</code>实例，但我们将回顾如何创建一个<code>MockMvc</code>在本节中非常快地实例化。</p><p>第一步是创建一个新的<code>GebReportingSpec</code>带有注释的类，如下所示：</p>
<pre><code class="prettyprint groovy">@ContextConfiguration(classes=[WebMvcConfig,MockDataConfig])
@WebAppConfiguration
class GebCreateMessagesSpec extends GebReportingSpec {
  @Autowired
  WebApplicationContext context;

  WebDriver driver;

  ...
}
</code></pre>
<ul>
<li>为此，请确保按照<a href="https://github.com/spring-projects/spring-test-mvc-htmlunit#updating-dependencies">更新依赖性</a>部分中的说明添加spock-spring依赖性。这就是为什么<code>@Autowired</code>注释将受到尊重。</li>
<li><code>@ContextConfiguration</code>告诉Spring加载什么配置。您会注意到，我们正在加载数据层的模拟实例，以提高测试性能。如果需要，我们可以选择对真实数据库运行测试。但是，这具有我们<a href="https://spring.io/blog/2014/03/19/introducing-spring-test-mvc-htmlunit#integration-testing-to-the-rescue">前面提到</a>的缺点。</li>
<li><code>@WebAppConfiguration</code>表示一个<code>WebApplicationContext</code>应该创建而不是<code>ApplicationContext</code> 。</li>
</ul><p>接下来，我们需要创建我们的<code>MockMvc</code>来自的实例<code>context</code> 。下面提供了如何执行此操作的示例：</p>
<pre><code class="prettyprint java">def setup() {
  MockMvc mockMvc = MockMvcBuilders.webAppContextSetup(context).build()
  ...
}
</code></pre><p>当然，这只是创建广告素材的一种方法<code>MockMvc</code>实例。我们可能已经决定<a href="https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/testing.html#spring-mvc-test-server-filters">添加Servlet过滤器</a> ，使用<a href="https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/testing.html#spring-mvc-test-server-setup-options">独立设置</a>等。重要的是，我们需要一个Instance <code>MockMvc</code> 。有关创建广告的其他信息<code>MockMvc</code>实例请参阅<a href="https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/testing.html#spring-mvc-test-framework">Spring MVC测试文档</a> 。</p><h3><a href="#initializing-webdriver" class="anchor" name="initializing-webdriver"></a>初始化WebDriver</h3><p>现在，我们已经创建了<code>MockMvc</code>实例，我们需要创建一个<code>MockMvcHtmlUnitDriver</code>确保我们使用<code>MockMvc</code>我们在上一步中创建的实例。然后，我们使用Geb的<a href="http://www.gebish.org/manual/current/driver.html#explicit_lifecycle">显式生命周期，</a>并在Geb的<a href="http://www.gebish.org/manual/current/browser.html#the_browser">Browser</a>实例上设置驱动程序。</p>
<pre><code class="prettyprint java">WebDriver driver;

def setup() {
  MockMvc mockMvc = MockMvcBuilders.webAppContextSetup(context).build()
  driver = new MockMvcHtmlUnitDriver(mockMvc, true)
  browser.driver = driver
}

def destroy() {
  if(driver != null) {
    driver.close();
  }
}
</code></pre><h3><a href="#using-geb" class="anchor" name="using-geb"></a>使用Geb</h3><p>现在，我们可以像往常一样使用Geb，而无需部署我们的应用程序。例如，我们可以请求视图创建以下消息：</p>
<pre><code class="prettyprint groovy">to CreateMessagePage
</code></pre><p>然后，我们可以填写表格并将其提交以创建一条消息。</p>
<pre><code class="prettyprint groovy">form.summary = expectedSummary
form.text = expectedMessage
submit.click(ViewMessagePage)
</code></pre><p>找不到的所有无法识别的方法调用或属性访问/引用都将转发到当前页面对象。这消除了我们直接使用WebDriver时需要的许多样板代码。</p><p>此外，这改进了我们的<a href="https://spring.io/blog/2014/03/21/spring-mvc-test-with-htmlunit">HtmlUnit测试</a>的设计。最明显的变化是我们现在正在使用页面对象模式。正如我们在“ <a href="#why-webdriver">为什么要使用WebDriver？</a> ，我们可以将Page Object Pattern与HtmlUnit一起使用，但是现在它要容易得多。</p><p>让我们来看看我们的<code>CreateMessagePage</code> 。</p>
<pre><code class="prettyprint groovy">class CreateMessagePage extends Page {
  static url = &#39;messages/form&#39;
  static at = { assert title == &#39;Messages : Create&#39;; true }
  static content =  {
    submit { $(&#39;input[type=submit]&#39;) }
    form { $(&#39;form&#39;) }
    errors(required:false) { $(&#39;label.error, .alert-error&#39;)?.text() }
  }
}
</code></pre><p>您会注意到的第一件事是<code>CreateMessagePage</code>扩展<code>Page</code> 。我们不会详细介绍<code>Page</code> ，但总而言之，它包含我们所有页面的基本功能。</p><p>接下来您会注意到，我们定义了一个URL，可以在其中找到此页面。这使我们可以使用以下内容导航到页面：</p>
<pre><code class="prettyprint groovy">to CreateMessagePage
</code></pre><p>我们还有一个闭包，用来确定我们是否在指定页面上。如果我们在正确的页面上，它应该返回true。这就是为什么我们可以断言我们在正确的页面上的原因：</p><p>-<br><strong>注意</strong> ：我们在闭包中使用断言，因此，如果我们在错误的页面上，我们可以确定问题出在哪里。</p>
<hr>
<pre><code class="prettyprint groovy">at CreateMessagePage
</code></pre><p>我们最后创建一个内容闭合，以指定页面内所有感兴趣的区域。我们可以使用<a href="http://www.gebish.org/manual/current/intro.html#the_jquery_ish_navigator_api">jQuery-ish Navigator API</a>来选择我们感兴趣的内容。</p><p>最后，我们可以验证是否成功创建了新消息</p>
<pre><code class="prettyprint groovy">at ViewMessagePage
success == &#39;Successfully created a new message&#39;
id
date
summary == expectedSummary
message == expectedMessage
</code></pre><p>-<br><strong>请反馈！</strong></p><p>如果您对此博客系列或Spring Test MVC HtmlUnit有反馈，我鼓励您通过以下评论， <a href="https://github.com/spring-projects/spring-test-mvc-htmlunit/issues">github问题</a>或在twitter <a href="https://twitter.com/rob_winch">@rob_winch</a>上ping我。当然，最好的反馈是<a href="https://github.com/spring-projects/spring-test-mvc-htmlunit#contributing">贡献</a>形式。</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 1504;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>