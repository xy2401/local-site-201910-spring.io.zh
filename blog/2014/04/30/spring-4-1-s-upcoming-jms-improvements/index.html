<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Spring 4.1&#39;s Upcoming JMS Improvements</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Spring 4.1&#39;s Upcoming JMS Improvements" />
<meta name="twitter:description" content="&lt;p&gt;Spring Framework 4.0 introduced a new &lt;code&gt;spring-messaging&lt;/code&gt; module, adding a selection of Spring Integration types such as the core &lt;code&gt;Message&lt;/code&gt; abstraction. Spring 4.1 aligns its JMS support to allow you to benefit from that abstraction. But before diving into that, I’d like to show you in details how we further improved the infrastructure for listener endpoints.&lt;/p&gt;
&lt;h1&gt;&lt;a href=&quot;#annotation-driven-listener-endpoints&quot; class=&quot;anchor&quot; name=&quot;annotation-driven-listener-endpoints&quot;&gt;&lt;/a&gt;Annotation-driven listener endpoints&lt;/h1&gt;
&lt;p&gt;You are probably used to the &lt;code&gt;&amp;lt;xyz:annotation-driven&amp;gt;&lt;/code&gt; element or the &lt;code&gt;@Enable*&lt;/code&gt; counterpart and perhaps you were looking for something similar for JMS. Look no further: the next major release of the Spring framework will allow you to define JMS listeners with a simple annotation.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@snicoll" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/33d0963a20138828608f3f61927545b8?s=200" />

<meta property="og:title" content="Spring 4.1&#39;s Upcoming JMS Improvements" />
<meta property="og:image" content="https://gravatar.com/avatar/33d0963a20138828608f3f61927545b8?s=200" />
<meta property="og:description" content="&lt;p&gt;Spring Framework 4.0 introduced a new &lt;code&gt;spring-messaging&lt;/code&gt; module, adding a selection of Spring Integration types such as the core &lt;code&gt;Message&lt;/code&gt; abstraction. Spring 4.1 aligns its JMS support to allow you to benefit from that abstraction. But before diving into that, I’d like to show you in details how we further improved the infrastructure for listener endpoints.&lt;/p&gt;
&lt;h1&gt;&lt;a href=&quot;#annotation-driven-listener-endpoints&quot; class=&quot;anchor&quot; name=&quot;annotation-driven-listener-endpoints&quot;&gt;&lt;/a&gt;Annotation-driven listener endpoints&lt;/h1&gt;
&lt;p&gt;You are probably used to the &lt;code&gt;&amp;lt;xyz:annotation-driven&amp;gt;&lt;/code&gt; element or the &lt;code&gt;@Enable*&lt;/code&gt; counterpart and perhaps you were looking for something similar for JMS. Look no further: the next major release of the Spring framework will allow you to define JMS listeners with a simple annotation.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2014-04-30 12:52:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring 4.1&#39;s Upcoming JMS Improvements</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/33d0963a20138828608f3f61927545b8?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/snicoll">Stéphane Nicoll</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2014-04-30 12:52:00.0">April 30, 2014</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="1529" href="/blog/2014/04/30/spring-4-1-s-upcoming-jms-improvements#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>Spring Framework 4.0 introduced a new <code>spring-messaging</code> module, adding a selection of Spring Integration types such as the core <code>Message</code> abstraction. Spring 4.1 aligns its JMS support to allow you to benefit from that abstraction. But before diving into that, I&rsquo;d like to show you in details how we further improved the infrastructure for listener endpoints.</p><h1><a href="#annotation-driven-listener-endpoints" class="anchor" name="annotation-driven-listener-endpoints"></a>Annotation-driven listener endpoints</h1>
<p>You are probably used to the <code>&lt;xyz:annotation-driven&gt;</code> element or the <code>@Enable*</code> counterpart and perhaps you were looking for something similar for JMS. Look no further: the next major release of the Spring framework will allow you to define JMS listeners with a simple annotation.</p>
<pre><code class="prettyprint java">@Component
public class MyService {

    @JmsListener(containerFactory = &quot;myContainerFactory&quot;, destination = &quot;myQueue&quot;)
    public void processOrder(String data) { ... }

}
</code></pre>
<p>The following configuration (ignoring the JMS infrastructure setup) creates a JMS message listener container under the covers on the <code>myQueue</code> destination and will call <code>processOrder</code> whenever a message is available:</p>
<pre><code class="prettyprint java">@Configuration
@EnableJms
public class AppConfig {
	
    @Bean
    public DefaultJmsListenerContainerFactory myContainerFactory() {
        DefaultJmsListenerContainerFactory factory =
                new DefaultJmsListenerContainerFactory();
        factory.setConnectionFactory(connectionFactory());
        factory.setDestinationResolver(destinationResolver());
        factory.setConcurrency(&quot;3-10&quot;);
        return factory;
    }
}
</code></pre>
<p>This is the equivalent using the XML namespace:</p>
<pre><code class="prettyprint xml">&lt;jms:annotation-driven/&gt;

&lt;bean id=&quot;myContainerFactory&quot;
        class=&quot;org.springframework.jms.config.DefaultJmsListenerContainerFactory&quot;&gt;
    &lt;property name=&quot;connectionFactory&quot; ref=&quot;connectionFactory&quot;/&gt;
    &lt;property name=&quot;destinationResolver&quot; ref=&quot;destinationResolver&quot;/&gt;
    &lt;property name=&quot;concurrency&quot; value=&quot;3-10&quot;/&gt;
&lt;/bean&gt;
</code></pre>
<p>As usual, <code>@JmsListener</code> can be placed directly on the method or indirectly using a meta-annotation. The annotation has the usual options that are provided for quite some time by the <code>jms:listener</code> XML element. The <code>containerFactory</code> is new however and refers to the name of the <code>JmsListenerContainerFactory</code>, an equivalent of what you&rsquo;ve been used to configure in the <code>&lt;jms:listener-container&gt;</code> element. </p>
<p>If you want to smoothly transition from your existing configuration, we have added a <code>factory-id</code> attribute to that element. When it is present, the configuration is automatically exposed as a <code>JmsListenerContainerFactory</code> bean with that name. This XML configuration is the equivalent of the <code>myJmsContainerFactory</code> bean above:</p>
<pre><code class="prettyprint xml">&lt;jms:listener-container factory-id=&quot;myContainerFactory&quot; 
               connection-factory=&quot;connectionFactory&quot;
               destination-resolver=&quot;destinationResolver&quot;
               concurrency=&quot;3-10&quot;/&gt;
</code></pre>
<p>As a single container factory setup can be fairly common, the <code>containerFactory</code> attribute can be omitted if a default one has either been set or discovered. By default, we look up for a bean named <code>jmsListenerContainerFactory</code>. </p>
<p>The configuration of this infrastructure can be customized in several ways by implementing the <code>JmsListenerConfigurer</code> interface. Like we just mentioned, the default container factory to use can be specified explicitly but this callback interface also allows you to register JMS endpoints programmatically!</p>
<pre><code class="prettyprint java">@Configuration
@EnableJms
public class AppConfig implements JmsListenerConfigurer {

    @Override
    public void configureJmsListeners(JmsListenerEndpointRegistrar registrar) {
        registrar.setDefaultContainerFactory(defaultContainerFactory());

        SimpleJmsListenerEndpoint endpoint = new SimpleJmsListenerEndpoint();
        endpoint.setDestination(&quot;anotherQueue&quot;);
        endpoint.setMessageListener(message -&gt; {
            // processing
        });
        registrar.registerEndpoint(endpoint);
    }

    @Bean
    public DefaultJmsListenerContainerFactory defaultContainerFactory() {
        ...
    }

</code></pre>
<p>The sample above sets the default <code>JmsListenerContainerFactory</code> and also configures an additional endpoint on <code>anotherQueue</code>. <code>JmsListenerEndpoint</code> models your endpoint and is responsible for configuring the container for that model. In the example above, we used <code>SimpleJmsListenerEndpoint</code> which provides the actual <code>MessageListener</code> to invoke but you could just as well build your own endpoint variant describing a custom invocation mechanism. <code>MethodJmsListenerEndpoint</code> is another example that is used by all endpoints annotated with <code>@JmsListener</code>.</p><h1><a href="#messaging-abstraction" class="anchor" name="messaging-abstraction"></a>Messaging abstraction</h1>
<p>So far, we have been injecting a simple <code>String</code> in our endpoint but it can actually have a very flexible method signature. Let&rsquo;s rewrite it to inject the <code>Order</code> with a custom header:</p>
<pre><code class="prettyprint java">@Component
public class MyService {

    @JmsListener(destination = &quot;myQueue&quot;)
    public void processOrder(Order order,  @Header(&quot;order_type&quot;) String orderType) {
        ...
    }
}
</code></pre>
<p>These are the main elements you can inject in JMS listener endpoints:<br />* The raw <code>javax.jms.Message</code> or any of its subclasses (provided of course that it matches the incoming message type).<br />* The <code>javax.jms.Session</code> for optional access to the native JMS API e.g. for sending a custom reply.<br />* The <code>org.springframework.messaging.Message</code> representing the incoming JMS message. Note that this message holds both the custom and the standard headers (as defined by <code>JmsHeaders</code>).<br />* <code>@Header</code>-annotated method arguments to extract a specific header value, including standard JMS headers.<br />* <code>@Headers</code>-annotated argument that must also be assignable to <code>java.util.Map</code> for getting access to all headers.<br />* A non-annotated element that is not one of the supported types (i.e. <code>Message</code> and <code>Session</code>) is considered to be the payload. You can make that explicit by annotating the parameter with <code>@Payload</code>. You can also turn on validation by adding an extra <code>@Validated</code>.</p>
<p>The ability to inject Spring&rsquo;s <code>Message</code> abstraction is particularly useful to benefit from all the information stored in the transport-specific message without relying on transport-specific API.</p>
<pre><code class="prettyprint java">@JmsListener(destination = &quot;myQueue&quot;)
public void processOrder(Message&lt;Order&gt; order) { ... }
</code></pre>
<p>These features are provided under the covers for all annotated elements. It is possible to customize the validation and conversion service or even add additional method argument resolvers for your custom use case. The following example sets a custom <code>Validator</code> so that a <code>@Validated</code> annotated payload is first validated with it before invoking the listener method:</p>
<pre><code class="prettyprint java">@Configuration
@EnableJms
public class AppConfig implements JmsListenerConfigurer {

    @Override
    public void configureJmsListeners(JmsListenerEndpointRegistrar registrar) {
        registrar.setJmsHandlerMethodFactory(myJmsHandlerMethodFactory());
    }

    @Bean
    public DefaultJmsHandlerMethodFactory myJmsHandlerMethodFactory() {
        DefaultJmsHandlerMethodFactory factory = new DefaultJmsHandlerMethodFactory();
        factory.setValidator(myValidator());
        return factory;
    }
}
</code></pre><h1><a href="#reply-management" class="anchor" name="reply-management"></a>Reply management</h1>
<p>The existing support in <code>MessageListenerAdapter</code> already allows your method to have a non-<code>void</code> return type. When that&rsquo;s the case, the result of the invocation is encapsulated in a <code>javax.jms.Message</code> sent either in the destination specified in the <code>JMSReplyTo</code> header of the original message or in the default destination configured on the listener. That default destination can now be set using the <code>@SendTo</code> annotation of the messaging abstraction.</p>
<p>Assuming our <code>processOrder</code> method should now return an <code>OrderStatus</code>, it is possible to write it as follow to automatically send a reply:</p>
<pre><code class="prettyprint java">@JmsListener(destination = &quot;myQueue&quot;)
@SendTo(&quot;queueOut&quot;)
public OrderStatus processOrder(Order order) {
    // order processing
    return status;
}
</code></pre>
<p>If you need to set additional headers in a transport-independent manner, you could return a <code>Message</code> instead, something like:</p>
<pre><code class="prettyprint java">@JmsListener(destination = &quot;myQueue&quot;)
@SendTo(&quot;queueOut&quot;)
public Message&lt;OrderStatus&gt; processOrder(Order order) {
    // order processing
    return MessageBuilder
            .withPayload(status)
            .setHeader(&quot;code&quot;, 1234)
            .build();
}
</code></pre><h1><a href="#wrapping-up" class="anchor" name="wrapping-up"></a>Wrapping up</h1>
<p>Spring Framework 4.1 is due this July and includes several improvements in the JMS area: JMS listener methods can be simply annotated and can use a very flexible method signature. The messaging abstraction introduced in Spring 4.0 is now also supported for JMS listeners.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 1529;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>