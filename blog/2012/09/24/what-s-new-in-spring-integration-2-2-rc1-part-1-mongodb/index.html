<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>Spring Integration 2.2中的新增功能。RC1（第1部分-MongoDb）</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="What's New in Spring Integration 2.2.RC1 (Part 1 - MongoDb)">
<meta name="twitter:description" >
<meta name="twitter:image:src" content="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=200">

<meta property="og:title" content="What's New in Spring Integration 2.2.RC1 (Part 1 - MongoDb)">
<meta property="og:image" content="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=200">
<meta property="og:description" >
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2012-09-24 09:30:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Integration 2.2中的新增功能。RC1（第1部分-MongoDb）</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=20&d=mm"> <span class="author">奥列格·朱拉库斯基（Oleg Zhurakousky）</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2012-09-24 09:30:00.0">2012年9月24日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2012/09/24/what-s-new-in-spring-integration-2-2-rc1-part-1-mongodb#disqus_thread" data-disqus-identifier="485">
</a></div>
</div>
</header>
<div class="blog--post"><h3>介绍</h3><p>Spring Integration 2.2。RC1已经发布，我们将在未来几天发布一系列博客，讨论其一些新功能。<br>在第一个博客中，我们将讨论MongoDb入站和出站通道适配器。<a href="https://github.com/SpringSource/spring-integration-samples/tree/master/basic/mongodb">这里</a>提供<a href="https://github.com/SpringSource/spring-integration-samples/tree/master/basic/mongodb">了</a>完整的讨论样本集</p>
<h3>MongoDb出站通道适配器</h3><p>MongoDb出站通道适配器允许您将消息有效负载写入MongoDb文档存储。</p><p>您可以在下面看到MongoDb通道适配器的最简单配置：</p>
<pre><code class="prettyprint xml"><int-mongodb:outbound-channel-adapter id="deafultAdapter"/>
</code></pre><p>它将使用<strong>MongoDbFactory</strong>的默认实例（默认bean名称为“ mongoDbFactory”）进行初始化，否则您可以提供它<br>通过<strong>mongodb-factory</strong>属性进行引用。</p><p>现在，您可以运行<strong>MongoDbOutboundAdapterDemo</strong> 。运行它后，打开终端窗口并启动MongoDb CLI</p>
<pre><code class="prettyprint text">$> mongo
</code></pre><p>在MongoDb CLI中输入查询：</p>
<pre><code class="prettyprint text">> db.data.find({})
</code></pre><p>您应该看到我们刚刚创建的3个文档条目：</p>
<pre><code class="prettyprint text">{ "_id" : ObjectId("505ff83d03649ed6881d066b"), "_class" : "org.springframework.integration.samples.mongodb.domain.Person", "fname" : "John", "lname" : "Doe", "address" : { "street" : "3401 Hillview Ave", "city" : "Palo Alto", "zip" : "94304", "state" : "CA" } }
{ "_id" : ObjectId("505ff83d03649ed6881d066c"), "_class" : "org.springframework.integration.samples.mongodb.domain.Person", "fname" : "Josh", "lname" : "Doe", "address" : { "street" : "123 Main st", "city" : "San Francisco", "zip" : "94115", "state" : "CA" } }
{ "_id" : ObjectId("505ff83d03649ed6881d066d"), "_class" : "org.springframework.integration.samples.mongodb.domain.Person", "fname" : "Jane", "lname" : "Doe", "address" : { "street" : "2323 Market st", "city" : "Philadelphia", "zip" : "19152", "state" : "PA" } }
</code></pre><p>请注意，我们的条目由非常简单的Java Beans样式对象表示，这些对象已使用默认转换器转换为JSON字符串。</p><p>让我们尝试使问题稍微复杂化。我们将尝试在<strong>MongoDbOutboundAdapterDemo（）。runSimpleComplexAdapter（）</strong>演示中存储一个简单的<strong>逗号</strong>分隔的字符串：</p>
<pre><code class="prettyprint java">messageChannel.send(new GenericMessage<String>("John Dow, Palo Alto, 3401 Hillview Ave, 94304, CA"));
</code></pre><p>如您所见，我们正在发送一条消息，其中包含代表一个人的String有效负载。执行此代码将导致：</p>
<pre><code class="prettyprint text">Caused by: java.lang.IllegalArgumentException: can't serialize class java.lang.Character
</code></pre><p>这是因为MongoDb尝试使用基于Java Beans约定的默认转换器集来转换基础字符串。<br>无论如何，在任何情况下都不是我们想要的，因为我们希望将此对象存储为文档，并且每个字段都单独表示，因此我们需要首先将此字符串解析为一组字段。为此，我们将应用自定义<strong>MongoConverter</strong> 。修改<strong>simpleAdapterWithConverter</strong>的样本配置，以添加对已配置转换器的引用。</p>
<pre><code class="prettyprint xml"><int-mongodb:outbound-channel-adapter id="adapterWithConverter"
				mongo-converter="stringConverter"/>
</code></pre><p>再次运行该演示，您会发现这次将成功，并且您应该将存储的对象视为：</p>
<pre><code class="prettyprint text">{ "_id" : ObjectId("505ffeac0364f8a92337657e"), "fname" : "John", "lname" : "Dow", "address" : { "city" : "Palo Alto", "street" : "3401 Hillview Ave", "zip" : "94304", "state" : "CA" } }
</code></pre><p>这次，使用提供的转换器完成了转换，您可以在StringConverter.write（..）方法中看到，我们所做的只是解析输入的String并将其数据作为单个字段添加到DBObject的实例中。</p><p>对于更复杂的场景，您还可以使用<strong>MongoTemplate</strong>的自定义实例来引导适配器，但这超出了本博客的范围。</p>
<h3>MongoDb入站通道适配器</h3><p>MongoDb入站通道适配器使您可以从MongoDb中读取文档，并将其作为消息有效负载发送到下游。</p><p>这个简单的示例向您展示了如何读取MongoDb中存储的文档。对于此示例，我们将使用上一节中讨论的MongoDb出站通道适配器存储的数据。<br>从下面的示例中可以看到，MongoDb入站通道适配器的配置与其他任何轮询的入站通道适配器非常相似。</p>
<pre><code class="prettyprint xml"><int-mongodb:inbound-channel-adapter id="simpleInboundAdapter" channel="splittingChannel" 
									     query="{address.state : 'CA'}">
		<int:poller fixed-rate="60000" max-messages-per-poll="1"/>
</int-mongodb:inbound-channel-adapter>
</code></pre><p>请注意<strong>查询</strong>属性，该属性允许您提供表示为简单String的JSON查询。有关MongoDb查询的更多信息，请参阅<a href="https://www.mongodb.org/display/DOCS/Querying">MongoDb文档</a> 。您还可以使用<strong>query-expression</strong>属性来代替SpEL的功能，以实现与查询相关的更大动态。<br>在上述情况下，我们选择<i>地址</i>元素的<i>状态</i>元素为<b>'CA'的</b>所有文档。您可能已经猜到了，MongoDb入站通道适配器默认情况下会返回列表，因此您可以轻松地在下游配置一个非常基本的拆分器（如本例中所示），以同时处理一条消息。运行<strong>MongoDbInboundAdapterDemo</strong> ，您应该在控制台中看到结果：</p>
<pre><code class="prettyprint text">04:37:30.720 WARN  . . . { "_id" : { "$oid" : "50601bca0364063859066bcd"} , "_class" : "org.springframework.integration.samples.mongodb.domain.Person" , "fname" : "John" , "lname" : "Doe" , "address" : { "street" : "3401 Hillview Ave" , "city" : "Palo Alto" , "zip" : "94304" , "state" : "CA"}}
04:37:30.722 WARN  . . . { "_id" : { "$oid" : "50601bca0364063859066bce"} , "_class" : "org.springframework.integration.samples.mongodb.domain.Person" , "fname" : "Josh" , "lname" : "Doe" , "address" : { "street" : "123 Main st" , "city" : "San Francisco" , "zip" : "94115" , "state" : "CA"}}
</code></pre><p>但是，如果您知道查询只能返回单个结果，则可以通过配置<strong>Expect-single-result</strong>属性并将其值设置为“ true”来避免返回List。</p><p>另外，您可能希望对从MongoDb读取的成功处理的数据进行一些后处理。<br>例如;您可能需要在处理完文档后移动或删除它。<br>您可以使用Spring Integration 2.2附带的“事务同步”功能来完成此任务，该功能将在本系列的下一篇博客中讨论（预计几天后）（来自Gary Russell）。但是，不耐烦的人现在可以通过阅读参考手册的MongoDb入站通道适配器部分来获取更多详细信息。 <a href="http://static.springsource.org/spring-integration/docs/2.2.0.RC1/reference/htmlsingle/#mongodb-inbound-channel-adapter"></a> <a href="http://static.springsource.org/spring-integration/docs/2.2.0.RC1/reference/htmlsingle/#mongodb-inbound-channel-adapter">http://static.springsource.org/spring-integration/docs/2.2.0.RC1/reference/htmlsingle/#mongodb-inbound-channel-adapter</a></p>
<h3>结论</h3><p>Spring Integration 2.2。RC1已经发布，在接下来的几周中，我们将讨论此版本中提供的一些新功能。尝试一下，通过在此博客中评论或通过常规的<a href="http://forum.springsource.org/forumdisplay.php?42-Integration">Spring Integration论坛</a>让我们知道您的想法。 </p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 485;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
 <i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>