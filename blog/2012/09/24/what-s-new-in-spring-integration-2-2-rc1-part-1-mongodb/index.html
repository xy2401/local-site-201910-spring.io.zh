<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>What&#39;s New in Spring Integration 2.2.RC1 (Part 1 - MongoDb)</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="What&#39;s New in Spring Integration 2.2.RC1 (Part 1 - MongoDb)" />
<meta name="twitter:description" content="&lt;h3&gt;Introduction&lt;/h3&gt;
&lt;p&gt;Spring Integration 2.2.RC1 is out and we will be coming out with a set of blogs in the coming days discussing some of its new features.&lt;br&gt;In this first blog we’ll talk about MongoDb Inbound and Outbound Channel Adapters. Full set of discussed samples is available &lt;a href=&quot;https://github.com/SpringSource/spring-integration-samples/tree/master/basic/mongodb&quot;&gt;here&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;MongoDb Outbound Channel Adapter&lt;/h3&gt;
&lt;p&gt;MongoDb Outbound Channel Adapter allows you to write the Message payload to a MongoDb document store.&lt;/p&gt;
&lt;p&gt;You can see the simplest configuration of the MongoDb Channel Adapter below:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;prettyprint xml&quot;&gt;&amp;lt;int-mongodb:outbound-channel-adapter id=&quot;deafultAdapter&quot;/&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=200" />

<meta property="og:title" content="What&#39;s New in Spring Integration 2.2.RC1 (Part 1 - MongoDb)" />
<meta property="og:image" content="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=200" />
<meta property="og:description" content="&lt;h3&gt;Introduction&lt;/h3&gt;
&lt;p&gt;Spring Integration 2.2.RC1 is out and we will be coming out with a set of blogs in the coming days discussing some of its new features.&lt;br&gt;In this first blog we’ll talk about MongoDb Inbound and Outbound Channel Adapters. Full set of discussed samples is available &lt;a href=&quot;https://github.com/SpringSource/spring-integration-samples/tree/master/basic/mongodb&quot;&gt;here&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;MongoDb Outbound Channel Adapter&lt;/h3&gt;
&lt;p&gt;MongoDb Outbound Channel Adapter allows you to write the Message payload to a MongoDb document store.&lt;/p&gt;
&lt;p&gt;You can see the simplest configuration of the MongoDb Channel Adapter below:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;prettyprint xml&quot;&gt;&amp;lt;int-mongodb:outbound-channel-adapter id=&quot;deafultAdapter&quot;/&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2012-09-24 09:30:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">What&#39;s New in Spring Integration 2.2.RC1 (Part 1 - MongoDb)</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=20&amp;d=mm" />
<span class="author">Oleg Zhurakousky</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2012-09-24 09:30:00.0">September 24, 2012</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="485" href="/blog/2012/09/24/what-s-new-in-spring-integration-2-2-rc1-part-1-mongodb#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><h3>Introduction</h3><p>Spring Integration 2.2.RC1 is out and we will be coming out with a set of blogs in the coming days discussing some of its new features.<br />In this first blog we&rsquo;ll talk about MongoDb Inbound and Outbound Channel Adapters. Full set of discussed samples is available <a href="https://github.com/SpringSource/spring-integration-samples/tree/master/basic/mongodb">here</a></p>
<h3>MongoDb Outbound Channel Adapter</h3><p>MongoDb Outbound Channel Adapter allows you to write the Message payload to a MongoDb document store.</p><p>You can see the simplest configuration of the MongoDb Channel Adapter below:</p>
<pre><code class="prettyprint xml">&lt;int-mongodb:outbound-channel-adapter id=&quot;deafultAdapter&quot;/&gt;
</code></pre><p>It will be initialized with the default instance of the <strong>MongoDbFactory</strong> (the default bean name is &lsquo;mongoDbFactory&rsquo;) otherwise you can provide its<br />reference via <strong>mongodb-factory</strong> attribute.</p><p>Now you can run the <strong>MongoDbOutboundAdapterDemo</strong>. After running it open terminal window and start MongoDb CLI</p>
<pre><code class="prettyprint text">$&gt; mongo
</code></pre><p>Once in MongoDb CLI type a query:</p>
<pre><code class="prettyprint text">&gt; db.data.find({})
</code></pre><p>And you should see the 3 document entries we just created:</p>
<pre><code class="prettyprint text">{ &quot;_id&quot; : ObjectId(&quot;505ff83d03649ed6881d066b&quot;), &quot;_class&quot; : &quot;org.springframework.integration.samples.mongodb.domain.Person&quot;, &quot;fname&quot; : &quot;John&quot;, &quot;lname&quot; : &quot;Doe&quot;, &quot;address&quot; : { &quot;street&quot; : &quot;3401 Hillview Ave&quot;, &quot;city&quot; : &quot;Palo Alto&quot;, &quot;zip&quot; : &quot;94304&quot;, &quot;state&quot; : &quot;CA&quot; } }
{ &quot;_id&quot; : ObjectId(&quot;505ff83d03649ed6881d066c&quot;), &quot;_class&quot; : &quot;org.springframework.integration.samples.mongodb.domain.Person&quot;, &quot;fname&quot; : &quot;Josh&quot;, &quot;lname&quot; : &quot;Doe&quot;, &quot;address&quot; : { &quot;street&quot; : &quot;123 Main st&quot;, &quot;city&quot; : &quot;San Francisco&quot;, &quot;zip&quot; : &quot;94115&quot;, &quot;state&quot; : &quot;CA&quot; } }
{ &quot;_id&quot; : ObjectId(&quot;505ff83d03649ed6881d066d&quot;), &quot;_class&quot; : &quot;org.springframework.integration.samples.mongodb.domain.Person&quot;, &quot;fname&quot; : &quot;Jane&quot;, &quot;lname&quot; : &quot;Doe&quot;, &quot;address&quot; : { &quot;street&quot; : &quot;2323 Market st&quot;, &quot;city&quot; : &quot;Philadelphia&quot;, &quot;zip&quot; : &quot;19152&quot;, &quot;state&quot; : &quot;PA&quot; } }
</code></pre><p>Note that our entries were represented by a very simple Java Beans style objects which were converted into JSON string using default converters.</p><p>Let&rsquo;s try to complicate the issue slightly. We are going to try to store a simple coma delimited String in our <strong>MongoDbOutboundAdapterDemo().runSimpleComplexAdapter()</strong> demo:</p>
<pre><code class="prettyprint java">messageChannel.send(new GenericMessage&lt;String&gt;(&quot;John Dow, Palo Alto, 3401 Hillview Ave, 94304, CA&quot;));
</code></pre><p>As you can see we are sending a Message with the String payload which represents a person. Executing this code will result in:</p>
<pre><code class="prettyprint text">Caused by: java.lang.IllegalArgumentException: can&#39;t serialize class java.lang.Character
</code></pre><p>That is because MongoDb attempts to convert the underlying string using default set of converters that are based on Java Beans convention.<br />In any case that is not what we are looking for in this case anyway since we want to store this object as a document with each field represented individually so we need to parse this string into a set of fields first. To do so we will apply a custom <strong>MongoConverter</strong>. Modify the sample configuration of <strong>simpleAdapterWithConverter</strong> to add a reference to an already configured converter.</p>
<pre><code class="prettyprint xml">&lt;int-mongodb:outbound-channel-adapter id=&quot;adapterWithConverter&quot;
				mongo-converter=&quot;stringConverter&quot;/&gt;
</code></pre><p>Run the demo again and you&rsquo;ll see that it will succeed this time and you should see the stored object as:</p>
<pre><code class="prettyprint text">{ &quot;_id&quot; : ObjectId(&quot;505ffeac0364f8a92337657e&quot;), &quot;fname&quot; : &quot;John&quot;, &quot;lname&quot; : &quot;Dow&quot;, &quot;address&quot; : { &quot;city&quot; : &quot;Palo Alto&quot;, &quot;street&quot; : &quot;3401 Hillview Ave&quot;, &quot;zip&quot; : &quot;94304&quot;, &quot;state&quot; : &quot;CA&quot; } }
</code></pre><p>This time the conversion is done using a provided converter and you can see in the StringConverter.write(..) method that all that we are doing is parsing the input String and adding its data as an individual fields to an instance of the DBObject.</p><p>For even more complex scenarios you can also bootstrap the adapter with the custom instance of the <strong>MongoTemplate</strong>, but its out of scope of this blog.</p>
<h3>MongoDb Inbound Channel Adapter</h3><p>MongoDb Inbound Channel Adapter allows you to read documents from the MongoDb and send them as Message payloads downstream.</p><p>This simple example shows you how to read the documents stored in the MongoDb. For this example we&rsquo;ll use data stored by the MongoDb Outbound Channel Adapter discussed in the previous section.<br />As you can see from the example below, the configuration of MongoDb Inbound Channel Adapter is very similar to any other polling Inbound Channel Adapter.</p>
<pre><code class="prettyprint xml">&lt;int-mongodb:inbound-channel-adapter id=&quot;simpleInboundAdapter&quot; channel=&quot;splittingChannel&quot; 
									     query=&quot;{address.state : &#39;CA&#39;}&quot;&gt;
		&lt;int:poller fixed-rate=&quot;60000&quot; max-messages-per-poll=&quot;1&quot;/&gt;
&lt;/int-mongodb:inbound-channel-adapter&gt;
</code></pre><p>Notice the <strong>query</strong> attribute which allows you to provide JSON queries represented as simple String. For more information on MongoDb queries please refer to <a href="https://www.mongodb.org/display/DOCS/Querying">MongoDb documentation</a>. You can also use <strong>query-expression</strong> attribute instead to rely on the powers of SpEL to achieve greater dynamics related to queries.<br />In the above case we are selecting all documents where <i>state</i> element of the <i>address</i> element is <b>&lsquo;CA&rsquo;</b>. As you may have guessed the MongoDb Inbound Channel Adapter returns List by default, so you can easily configure a very basic splitter downstream (as in this example) to process one message at the time. Run the <strong>MongoDbInboundAdapterDemo</strong> and you should see the results in the console:</p>
<pre><code class="prettyprint text">04:37:30.720 WARN  . . . { &quot;_id&quot; : { &quot;$oid&quot; : &quot;50601bca0364063859066bcd&quot;} , &quot;_class&quot; : &quot;org.springframework.integration.samples.mongodb.domain.Person&quot; , &quot;fname&quot; : &quot;John&quot; , &quot;lname&quot; : &quot;Doe&quot; , &quot;address&quot; : { &quot;street&quot; : &quot;3401 Hillview Ave&quot; , &quot;city&quot; : &quot;Palo Alto&quot; , &quot;zip&quot; : &quot;94304&quot; , &quot;state&quot; : &quot;CA&quot;}}
04:37:30.722 WARN  . . . { &quot;_id&quot; : { &quot;$oid&quot; : &quot;50601bca0364063859066bce&quot;} , &quot;_class&quot; : &quot;org.springframework.integration.samples.mongodb.domain.Person&quot; , &quot;fname&quot; : &quot;Josh&quot; , &quot;lname&quot; : &quot;Doe&quot; , &quot;address&quot; : { &quot;street&quot; : &quot;123 Main st&quot; , &quot;city&quot; : &quot;San Francisco&quot; , &quot;zip&quot; : &quot;94115&quot; , &quot;state&quot; : &quot;CA&quot;}}
</code></pre><p>However, if you know that your query can only return a single result you can avoid returning List by configuring <strong>expect-single-result</strong> attribute setting its value to &lsquo;true&rsquo;.</p><p>Also, you may wish to do some post-processing to the successfully processed data that was read from the MongoDb.<br />For example; you may want to move or remove a document after its been processed.<br />You can do this using Transaction Synchronization feature that was added with Spring Integration 2.2 and which will be discussed in the next blog in this series expected in a few days (from Gary Russell). However the impatient once can get more details now by reading MongoDb Inbound Channel Adapter section of the reference manual <a href="http://static.springsource.org/spring-integration/docs/2.2.0.RC1/reference/htmlsingle/#mongodb-inbound-channel-adapter"><a href="http://static.springsource.org/spring-integration/docs/2.2.0.RC1/reference/htmlsingle/#mongodb-inbound-channel-adapter">http://static.springsource.org/spring-integration/docs/2.2.0.RC1/reference/htmlsingle/#mongodb-inbound-channel-adapter</a></a></p>
<h3>Conclusion</h3><p>Spring Integration 2.2.RC1 is out and in the next few weeks we&rsquo;ll be talking about some of the new features available in this release. Give it a spin and let us know what you think by commenting in this blog or via the usual <a href="http://forum.springsource.org/forumdisplay.php?42-Integration">Spring Integration Forums</a> </p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 485;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
 <i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>