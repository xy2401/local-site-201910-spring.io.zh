<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Spring Framework 3.2 RC1: Spring MVC Test Framework</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Spring Framework 3.2 RC1: Spring MVC Test Framework" />
<meta name="twitter:description" content="&lt;p&gt;&lt;/p&gt;
&lt;div class=&quot;callout&quot;&gt; 
 &lt;div class=&quot;callout-title&quot;&gt;
  Update Dec 19, 2012
 &lt;/div&gt; 
 &lt;br&gt;The final Spring Framework reference documentation contains 
 &lt;a href=&quot;http://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/htmlsingle/#migration-3.2-compatibility-spring-mvc-test&quot;&gt;guidance on migration&lt;/a&gt; as well as 
 &lt;a href=&quot;http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/integration-testing.html#spring-mvc-test-framework&quot;&gt;a complete section&lt;/a&gt; on Spring MVC Test.
 &lt;br&gt; 
&lt;/div&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;Last week &lt;a href=&quot;https://twitter.com/springjuergen&quot;&gt;Juergen Hoeller&lt;/a&gt; announced&lt;br&gt;the release of Spring Framework 3.2 RC1 and &lt;a href=&quot;https://twitter.com/sam_brannen&quot;&gt;Sam Brannen&lt;/a&gt; discussed exciting &lt;a href=&quot;http://blog.springsource.org/2012/11/07/spring-framework-3-2-rc1-new-testing-features/&quot;&gt;additions in its spring-test&lt;/a&gt; module such as support for &lt;code&gt;WebApplicationContext&lt;/code&gt;’s and upcoming plans for loading a hierarchy of contexts. Today I will continue this subject and describe another exciting &lt;code&gt;spring-test&lt;/code&gt; addition. In 3.2 RC1 we’ve added first class support for testing Spring MVC applications both client-side and server-side.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@rstoya05" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/4b12b9c0c665bc0345467c1a218ed0f7?s=200" />

<meta property="og:title" content="Spring Framework 3.2 RC1: Spring MVC Test Framework" />
<meta property="og:image" content="https://gravatar.com/avatar/4b12b9c0c665bc0345467c1a218ed0f7?s=200" />
<meta property="og:description" content="&lt;p&gt;&lt;/p&gt;
&lt;div class=&quot;callout&quot;&gt; 
 &lt;div class=&quot;callout-title&quot;&gt;
  Update Dec 19, 2012
 &lt;/div&gt; 
 &lt;br&gt;The final Spring Framework reference documentation contains 
 &lt;a href=&quot;http://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/htmlsingle/#migration-3.2-compatibility-spring-mvc-test&quot;&gt;guidance on migration&lt;/a&gt; as well as 
 &lt;a href=&quot;http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/integration-testing.html#spring-mvc-test-framework&quot;&gt;a complete section&lt;/a&gt; on Spring MVC Test.
 &lt;br&gt; 
&lt;/div&gt;
&lt;p&gt;&lt;/p&gt;
&lt;p&gt;Last week &lt;a href=&quot;https://twitter.com/springjuergen&quot;&gt;Juergen Hoeller&lt;/a&gt; announced&lt;br&gt;the release of Spring Framework 3.2 RC1 and &lt;a href=&quot;https://twitter.com/sam_brannen&quot;&gt;Sam Brannen&lt;/a&gt; discussed exciting &lt;a href=&quot;http://blog.springsource.org/2012/11/07/spring-framework-3-2-rc1-new-testing-features/&quot;&gt;additions in its spring-test&lt;/a&gt; module such as support for &lt;code&gt;WebApplicationContext&lt;/code&gt;’s and upcoming plans for loading a hierarchy of contexts. Today I will continue this subject and describe another exciting &lt;code&gt;spring-test&lt;/code&gt; addition. In 3.2 RC1 we’ve added first class support for testing Spring MVC applications both client-side and server-side.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2012-11-12 14:13:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Framework 3.2 RC1: Spring MVC Test Framework</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/4b12b9c0c665bc0345467c1a218ed0f7?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/rstoyanchev">Rossen Stoyanchev</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2012-11-12 14:13:00.0">November 12, 2012</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="495" href="/blog/2012/11/12/spring-framework-3-2-rc1-spring-mvc-test-framework#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p><div class="callout">
<div class="callout-title">Update Dec 19, 2012</div>
<br />The final Spring Framework reference documentation contains <a href="https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/htmlsingle/#migration-3.2-compatibility-spring-mvc-test">guidance on migration</a> as well as <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/integration-testing.html#spring-mvc-test-framework">a complete section</a> on Spring MVC Test.<br />
</div></p>
<p>Last week <a href="https://twitter.com/springjuergen">Juergen Hoeller</a> announced<br />the release of Spring Framework 3.2 RC1 and <a href="https://twitter.com/sam_brannen">Sam Brannen</a> discussed exciting <a href="http://blog.springsource.org/2012/11/07/spring-framework-3-2-rc1-new-testing-features/">additions in its spring-test</a> module such as support for <code>WebApplicationContext</code>&rsquo;s and upcoming plans for loading a hierarchy of contexts. Today I will continue this subject and describe another exciting <code>spring-test</code> addition. In 3.2 RC1 we&rsquo;ve added first class support for testing Spring MVC applications both client-side and server-side.</p><h3><a href="#background" class="anchor" name="background"></a>Background</h3>
<p>The Spring MVC Test framework discussed here originates from a <a href="https://github.com/spring-projects/spring-test-mvc">standalone project</a> on Github, where features evolved for over a year with continuous feedback from many users. Thanks to all the early adopters, everyone who <a href="https://github.com/spring-projects/spring-test-mvc/graphs/contributors">contributed</a>, <a href="https://github.com/spring-projects/spring-test-mvc/issues?page=1&state=closed">reported issues</a>, commented, and everyone who blogged or spoke about it.</p>
<p>As of Spring 3.2 RC1, the code from the standalone project has been <a href="https://github.com/spring-projects/spring-framework/commit/22bcb54ab66c952d1c122526729b64d77a77280b">added to the Spring Framework</a> and is available in the <code>spring-test</code> module, under slightly modified package names, and with support for 3.2 specific features such as async requests and others. The standalone project will continue to exist for applications testing against Spring MVC 3.1.</p>
<p>With that out of the day, let&rsquo;s have a closer, more detailed look.</p><h3><a href="#server-side-support" class="anchor" name="server-side-support"></a>Server-Side Support</h3>
<p>How do you test a Spring MVC controller today? Most likely through a simple unit test, possibly involving the <code>MockHttpServletRequest</code> and <code>-Response</code>. Pretty trivial to do but it doesn&rsquo;t test enough. Controllers have annotations that express how they are mapped, what request data needs to be extracted, converted, and validated, whether to write to the body of the response, how to handle exceptions, and on and on. All of what the framework does as a result of these annotations, remains untested if you only write simple unit tests.</p>
<p>What if you could re-write these controller unit tests but instead of invoking controllers directly, it would be done through the DispatcherServlet, just as it happens at runtime? And what if you could use a fluent API to specify the request to perform and the response you expect? All of that without the need for a servlet container. That&rsquo;s what Spring MVC Test does. Here is an example:</p>
<pre><code class="prettyprint java"><br />@RunWith(SpringJUnit4ClassRunner.class)
@WebAppConfiguration
@ContextConfiguration(&quot;servlet-context.xml&quot;)
public class SampleTests {

  @Autowired
  private WebApplicationContext wac;

  private MockMvc mockMvc;

  @Before
  public void setup() {
    this.mockMvc = webAppContextSetup(this.wac).build();
  }

  @Test
  public void getFoo() throws Exception {
    this.mockMvc.perform(get(&quot;/foo&quot;).accept(&quot;application/json&quot;))
        .andExpect(status().isOk())
        .andExpect(content().mimeType(&quot;application/json&quot;))
        .andExpect(jsonPath(&quot;$.name&quot;).value(&quot;Lee&quot;));
  }
}
</code></pre>
<p><div class="callout">
<div class="callout-title">Static Imports</div>
The fluent API relies on these static imports:<br /><code>MockMvcBuilders.*</code><br /><code>MockMvcRequestBuilders.*</code><br /><code>MockMvcResultMatchers.*</code><br />For code completion assistance, add them as &ldquo;favorite types&rdquo; in the Eclipse preferences, or simply remember classes starting with <code>MockMvc*</code>.
</div></p>
<p>As you can see we&rsquo;re using the new <code>@WebAppConfiguration</code> annotation to load our Spring MVC configuration. Then we inject the resulting <code>WebApplicationContext</code> into a test class field and use it to create a <code>MockMvc</code>, which in turn is used perform requests and define expectations.</p>
<p><div class="callout">
<div class="callout-title">Context Caching</div>
The TestContext framework caches the loaded Spring configuration across the test suite and even across the JVM. Therefore the speed of the tests should be very optimal.
</div></p>
<p>Just like with existing controller unit tests, Spring MVC Test builds on the mock request and response from <code>spring-test</code> and does not require a running servlet container. The main difference is that actual Spring MVC configuration is loaded through the TestContext framework and that the request is performed by actually invoking the <code>DispatcherServlet</code> and all the same Spring MVC infrastructure that is used at runtime.</p>
<p>Also similar to existing controller unit tests, you may consider injecting controllers with mock services in order to focus on testing the web layer and avoid hitting a database for example. So instead of loading actual business and persistence services, you can load configuration that creates mocks. For example:</p>
<pre><code class="prettyprint java"><br />@Configuration
public class MyConfig {

    @Bean
    public FooService fooService() {
        return Mockito.mock(FooService.class);
    }

}
</code></pre>
<p>or in XML configuration:</p>
<pre><code class="prettyprint xml"><br />&lt;bean class=&quot;org.mockito.Mockito&quot; factory-method=&quot;mock&quot;&gt;
    &lt;constructor-arg value=&quot;org.example.FooService&quot;/&gt;
&lt;/bean&gt;
</code></pre>
<p>Given that we&rsquo;re not running in an actual servlet container, just how much will and will not work? For the most part everything will work just like it does at runtime. You can even register Servlet filters, enabling things like Spring Security. Most rendering technologies like JSON/XML, Freemarker, Velocity, Thymeleaf, Excel, PDF, etc. All of that will work. The only rendering technology excluded is JSPs since since that requires a servlet container. For JSPs you can still verify the JSP the request was forwarded, what attributes are in the model, whether any exception was raised, and so on.</p><h3><a href="#client-side-rest-tests" class="anchor" name="client-side-rest-tests"></a>Client-side REST Tests</h3>
<p>What&rsquo;s the idea behind client-side REST tests? If you have code using the <code>RestTemplate</code>, you&rsquo;ll probably want to test it and to that you can target a running server or mock the RestTemplate. The client-side REST test support offers a third alternative, which is to use the actual <code>RestTemplate</code> but configure it with a custom <code>ClientHttpRequestFactory</code> that checks expectations against actual requests and returns stub responses.</p>
<pre><code class="prettyprint java"><br />RestTemplate restTemplate = new RestTemplate();
MockRestServiceServer mockServer = MockRestServiceServer.createServer(restTemplate);

mockServer.expect(requestTo(&quot;/greeting&quot;))
  .andRespond(withSuccess(&quot;Hello world&quot;, &quot;text/plain&quot;));

// use RestTemplate ...

mockServer.verify();
</code></pre>
<p><div class="callout">
<div class="callout-title">Static Imports</div>
The fluent API requires static imports:<br><br /><code>MockRestRequestMatchers.*</code><br /><code>MockRestResponseCreators.*</code><br />For code completion assistance, add them as &ldquo;favorite types&rdquo; in the Eclipse preferences, or simply remember classes starting with <code>&quot;MockRest*&quot;</code>.
</div></p>
<p>As you can see we create an instance of <code>RestTemplate</code> and pass it to <code>MockRestServiceServer</code> to be configured. Then we define the characteristics of an expected request and provide a stub response to be returned. We could define any number of expected requests and stub responses. At the end of testing we can use the <code>verify</code> method to check if all expected requests were executed.</p><h3><a href="#next-steps" class="anchor" name="next-steps"></a>Next Steps</h3>
<p>There is a lot more we could discuss but it&rsquo;s probably best if you give it a try with your own project either using Spring Framework 3.2 RC1 or the <a href="https://github.com/spring-projects/spring-test-mvc">standalone project</a> on Github, which works with Spring Framework 3.1. </p>
<p>Recently I went through the exercise myself by adding a <a href="https://github.com/spring-projects/spring-mvc-showcase/tree/master/src/test/java/org/springframework/samples/mvc">comprehensive set of tests</a> for all controller methods of the spring-mvc-showcase. It was a useful exercise since it helped me find one bug. Therefore I expect it to be useful for others as well.</p>
<p>There are also many <a href="https://github.com/spring-projects/spring-framework/tree/master/spring-test/src/test/java/org/springframework/test/web/servlet/samples">demo tests</a> in the Spring Framework if you want more examples including <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-test/src/test/java/org/springframework/test/web/servlet/samples/standalone/AsyncTests.java#L46">tests with async requests</a>, <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-test/src/test/java/org/springframework/test/web/servlet/samples/standalone/FilterTests.java">tests with filters</a>, <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-test/src/test/java/org/springframework/test/web/servlet/samples/standalone/resultmatchers/JsonPathAssertionTests.java">JSON responses</a>, <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-test/src/test/java/org/springframework/test/web/servlet/samples/standalone/resultmatchers/XpathAssertionTests.java">XML responses</a>, and many others.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 495;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>