<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Spring Framework 3.2 RC1: New Testing Features</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Spring Framework 3.2 RC1: New Testing Features" />
<meta name="twitter:description" content="&lt;p&gt; As &lt;a href=&quot;http://blog.springsource.org/author/juergenh/&quot; target=&quot;_blank&quot; title=&quot;Juergen Hoeller&quot;&gt;Juergen Hoeller&lt;/a&gt; mentioned in his post announcing the &lt;a href=&quot;http://blog.springsource.org/2012/11/05/spring-framework-3-2-rc1-released/&quot; title=&quot;Spring Framework 3.2 RC1 released&quot; target=&quot;_blank&quot;&gt;release of Spring Framework 3.2 RC1&lt;/a&gt;, the Spring Team has introduced some exciting new features in terms of testing support. Most importantly, we&#39;ve added first-class support for testing web applications. &lt;em&gt;[1]&lt;/em&gt; &lt;/p&gt;
&lt;p&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Please note: this is a &lt;a href=&quot;http://www.swiftmind.com/de/2012/11/07/spring-framework-3-2-rc1-new-testing-features/&quot; target=&quot;_blank&quot; title=&quot;Spring Framework 3.2 RC1: New Testing Features&quot;&gt;cross post&lt;/a&gt; from my &lt;a href=&quot;http://www.swiftmind.com&quot; target=&quot;_blank&quot; title=&quot;Swiftmind&quot;&gt;Swiftmind&lt;/a&gt; company blog. &lt;/p&gt;
&lt;p&gt; In this post we&#39;ll first take a look at some of the general new testing features in the Spring Framework, and then we&#39;ll go into detail regarding support for testing with a &lt;code&gt;WebApplicationContext&lt;/code&gt; as well as &lt;em&gt;request&lt;/em&gt; and &lt;em&gt;session&lt;/em&gt; scoped beans. We&#39;ll close with a look at support for &lt;code&gt;ApplicationContextInitializers&lt;/code&gt; and a brief discussion of the road map for testing with application context hierarchies. &lt;/p&gt;
" />
<meta name="twitter:creator" content="@sam_brannen" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/64310de9c07f30458f9baae33d91ccdc?s=200" />

<meta property="og:title" content="Spring Framework 3.2 RC1: New Testing Features" />
<meta property="og:image" content="https://gravatar.com/avatar/64310de9c07f30458f9baae33d91ccdc?s=200" />
<meta property="og:description" content="&lt;p&gt; As &lt;a href=&quot;http://blog.springsource.org/author/juergenh/&quot; target=&quot;_blank&quot; title=&quot;Juergen Hoeller&quot;&gt;Juergen Hoeller&lt;/a&gt; mentioned in his post announcing the &lt;a href=&quot;http://blog.springsource.org/2012/11/05/spring-framework-3-2-rc1-released/&quot; title=&quot;Spring Framework 3.2 RC1 released&quot; target=&quot;_blank&quot;&gt;release of Spring Framework 3.2 RC1&lt;/a&gt;, the Spring Team has introduced some exciting new features in terms of testing support. Most importantly, we&#39;ve added first-class support for testing web applications. &lt;em&gt;[1]&lt;/em&gt; &lt;/p&gt;
&lt;p&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Please note: this is a &lt;a href=&quot;http://www.swiftmind.com/de/2012/11/07/spring-framework-3-2-rc1-new-testing-features/&quot; target=&quot;_blank&quot; title=&quot;Spring Framework 3.2 RC1: New Testing Features&quot;&gt;cross post&lt;/a&gt; from my &lt;a href=&quot;http://www.swiftmind.com&quot; target=&quot;_blank&quot; title=&quot;Swiftmind&quot;&gt;Swiftmind&lt;/a&gt; company blog. &lt;/p&gt;
&lt;p&gt; In this post we&#39;ll first take a look at some of the general new testing features in the Spring Framework, and then we&#39;ll go into detail regarding support for testing with a &lt;code&gt;WebApplicationContext&lt;/code&gt; as well as &lt;em&gt;request&lt;/em&gt; and &lt;em&gt;session&lt;/em&gt; scoped beans. We&#39;ll close with a look at support for &lt;code&gt;ApplicationContextInitializers&lt;/code&gt; and a brief discussion of the road map for testing with application context hierarchies. &lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2012-11-07 17:23:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Framework 3.2 RC1: New Testing Features</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/64310de9c07f30458f9baae33d91ccdc?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/sbrannen">Sam Brannen</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2012-11-07 17:23:00.0">November 07, 2012</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="494" href="/blog/2012/11/07/spring-framework-3-2-rc1-new-testing-features#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>
As <a href="http://blog.springsource.org/author/juergenh/" target="_blank" title="Juergen Hoeller">Juergen Hoeller</a> mentioned in his post announcing the <a href="http://blog.springsource.org/2012/11/05/spring-framework-3-2-rc1-released/" title="Spring Framework 3.2 RC1 released" target="_blank">release of Spring Framework 3.2 RC1</a>, the Spring Team has introduced some exciting new features in terms of testing support. Most importantly, we've added first-class support for testing web applications. <em>[1]</em>
</p>
<p>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Please note: this is a <a href="http://www.swiftmind.com/de/2012/11/07/spring-framework-3-2-rc1-new-testing-features/" target="_blank" title="Spring Framework 3.2 RC1: New Testing Features">cross post</a> from my <a href="http://www.swiftmind.com" target="_blank" title="Swiftmind">Swiftmind</a> company blog.
</p>
<p>
In this post we'll first take a look at some of the general new testing features in the Spring Framework, and then we'll go into detail regarding support for testing with a <code>WebApplicationContext</code> as well as <em>request</em> and <em>session</em> scoped beans. We'll close with a look at support for <code>ApplicationContextInitializers</code> and a brief discussion of the road map for testing with application context hierarchies.
</p>
<p>
<a href="http://blog.springsource.org/author/rstoyanchev/" title="Rossen Stoyanchev" target="_blank">Rossen Stoyanchev</a> will later follow up with a detailed post on the new <em>Spring MVC Test</em> framework that provides first-class support for testing Spring MVC applications. So be sure to stay tuned for that as well, since it builds on the basic web testing support discussed later in this post.
</p>
<p><hr /><br /><br /><h1>General New Features and Updates</h1><br /></p>
<h2>Build and Dependencies</h2><p>The <code>spring-test</code> module now builds against and supports JUnit 4.10 and TestNG 6.5.2, and <code>spring-test</code> now depends on the <code>junit:junit-dep</code> Maven artifact instead of <code>junit:junit</code> which means that you have full control over your dependencies on Hamcrest libraries (e.g., <code>hamcrest-core</code>, <code>hamcrest-all</code>, etc.).</p>
<h2>Generic Factory Methods</h2>
<p>
<em>Generic factory methods</em> are methods that implement the <a href="https://en.wikipedia.org/wiki/Factory_method_pattern" target="_blank" title="Factory Method Design Pattern">Factory Method Design Pattern</a> using Java Generics. Here are some example signatures of generic factory methods:
</p>
<pre><code class="prettyprint java"><br />public static &lt;T&gt; T mock(Class&lt;T&gt; clazz) { ... }

public static &lt;T&gt; T proxy(T obj) { ... }
</code></pre>
<p>
The use of <em>generic factory methods</em> in Spring configuration is by no means specific to testing, but generic factory methods such as <code>EasyMock.createMock(MyService.class)</code> or <code>Mockito.mock(MyService.class)</code> are often used to create dynamic mocks for Spring beans in a test application context. For example, prior to Spring Framework 3.2 the following configuration could fail to autowire the <code>OrderRepository</code> into the <code>OrderService</code>. The reason is that, depending on the order in which beans are initialized in the application context, Spring would potentially infer the type of the <code>orderRepository</code> bean to be <code>java.lang.Object</code> instead of <code>com.example.repository.OrderRepository</code>.
</p>
<pre><code class="prettyprint xml"><br />&lt;beans&gt;

  &lt;!-- OrderService is autowired with OrderRepository --&gt;
  &lt;context:component-scan base-package=&quot;com.example.service&quot;/&gt;

  &lt;bean id=&quot;orderRepository&quot; class=&quot;org.easymock.EasyMock&quot;
      factory-method=&quot;createMock&quot;
      c:_=&quot;com.example.repository.OrderRepository&quot; /&gt;

&lt;/beans&gt;
</code></pre>
<p>
In Spring 3.2, generic return types for factory methods are now properly inferred, and <em>autowiring by type</em> for mocks should work as expected. As a result, custom work-arounds such as a <code>MockitoFactoryBean</code>, <code>EasyMockFactoryBean</code>, or <a href="https://bitbucket.org/kubek2k/springockito/wiki/Home" target="_blank" title="Springockito">Springockito</a> are likely no longer necessary.
</p>
<h2>Mock Objects</h2>
<p>
We've introduced <code>MockEnvironment</code> which complements the existing <code>MockPropertySource</code> to complete support for mocking out the environment and property source abstractions introduced in Spring 3.1.
</p>
<p>
Regarding unit testing support for web components, we've added new features to existing Servlet API mocks such as <code>MockServletContext</code>, <code>MockHttpSession</code>, <code>MockFilterChain</code>, and <code>MockRequestDispatcher</code>, and we've introduced new mocks related to REST Web Services: <code>MockClientHttpRequest</code> and <code>MockClientHttpResponse</code> for the client side as well as <code>MockHttpInputMessage</code> and <code>MockHttpOutputMessage</code> for the server side.
</p>
<h2>JDBC Testing Support</h2><p>In Spring 3.2 we&rsquo;ve deprecated <code>SimpleJdbcTestUtils</code> in favor of the improved <code>JdbcTestUtils</code> class which offers new <code>countRowsInTableWhere()</code> and <code>dropTables()</code> utility methods in addition to everything that <code>SimpleJdbcTestUtils</code> previously offered. These changes help to avoid the compiler warnings associated with the use of the deprecated <code>SimpleJdbcTemplate</code> and provide a convenient means for counting the number of rows in a table using a <code>WHERE</code> clause and for dropping a list of tables. On a similar note, <code>AbstractTransactionalJUnit4SpringContextTests</code> and <code>AbstractTransactionalTestNGSpringContextTests</code> have been retrofitted with a <code>jdbcTemplate</code> instance variable as well as <code>countRowsInTableWhere()</code> and <code>dropTables()</code> methods which delegate to their counterparts in <code>JdbcTestUtils</code>. </p>
<h2>Transaction Manager Configuration</h2>
<p>
If you're familiar with the support for transactional integration tests in the <em>Spring TestContext Framework</em>, then you're probably aware that the transaction manager used for tests must be called <em>"transactionManager"</em> by convention. Since Spring 2.5, this has been overridable via the <code>@TransactionConfiguration</code> annotation (e.g., <code>@TransactionConfiguration(transactionManager="txMgr")</code>); however, the use of this annotation is no longer necessary if there is a single <code>PlatformTransactionManger</code> present in the application context. In other words, as long as there is only one transaction manager defined in the context, there's no longer a need to <em>qualify</em> what the name of that transaction manager is: if there's only one, the TestContext framework will simply use it.
</p>
<p>
Spring 3.1 introduced the <code>TransactionManagementConfigurer</code> interface for programmatically specifying the transaction manager to use with <code>@Transactional</code> methods when using <code>@Configuration</code> classes in conjunction with <code>@EnableTransactionManagement</code> (i.e., as opposed to using XML configuration with <code>&lt;tx:annotation-driven /&gt;</code>). So as of Spring 3.2, if one of your components (i.e., typically an <code>@Configuration</code> class) implements <code>TransactionManagementConfigurer</code>, the TestContext framework will use the transaction manager specified by that component.
</p>
<p><hr /><br /><br /><h1>The Spring TestContext Framework</h1><br /></p>
<p>
<em>The rest of this post deals explicitly with new features in the Spring TestContext Framework. If you're already familiar with the TestContext framework, feel free to skip to the next section. Otherwise, you might want to first familiarize yourself with the information provided via the links in the following paragraphs.</em>
</p>
<p>
In Spring 2.5 we introduced the <a href="http://static.springsource.org/spring/docs/3.2.0.RC1/reference/html/testing.html#testcontext-framework" target="_blank" title="Spring TestContext Framework"><em>Spring TestContext Framework</em></a> which provides annotation-driven integration testing support that can be used with JUnit or TestNG. The examples in this post will focus on JUnit-based tests, but all features used here apply to TestNG as well.
</p>
<p>
In Spring 3.1 we revised the <em>Spring TestContext Framework</em> with added support for <a href="http://www.swiftmind.com/de/2011/06/22/spring-3-1-m2-testing-with-configuration-classes-and-profiles/" target="_blank" title="Spring 3.1 M2: Testing with @Configuration Classes and Profiles">testing with <code>@Configuration</code> classes and environment profiles</a>.
</p>
<p><hr /><br /><br /><h1>Loading a WebApplicationContext</h1><br /></p>
<ul>
<li><strong>Question</strong>: How do you tell the TestContext framework to load a <code>WebApplicationContext</code>?
<li><strong>Answer</strong>: Just annotate your test class with <code>@WebAppConfiguration</code>.
</ul>
<p>
That's really all there is to it. The presence of <code>@WebAppConfiguration</code> on your test class instructs the TestContext framework (TCF) that a <code>WebApplicationContext</code> (WAC) should be loaded for your integration tests. In the background the TCF makes sure that a <code>MockServletContext</code> is created and supplied to your test's WAC. By default the base resource path for your <code>MockServletContext</code> will be set to <em>"src/main/webapp"</em>. This is interpreted as a path relative to the root of your JVM (i.e., normally the path to your project). If you're familiar with the directory structure of a web application in a Maven project, you'll know that <em>"src/main/webapp"</em> is the default location for the root of your WAR. If you need to override this default, simply provide an alternate path to the <code>@WebAppConfiguration</code> annotation (e.g., <code>@WebAppConfiguration("src/test/webapp")</code>). If you wish to reference a base resource path from the classpath instead of the file system, just use Spring's <em>classpath:</em> prefix.
</p>
<p>
Please note that Spring's testing support for <code>WebApplicationContexts</code> is on par with its support for standard <code>ApplicationContexts</code>. When testing with a <code>WebApplicationContext</code> you are free to declare either XML configuration files or <code>@Configuration</code> classes via <code>@ContextConfiguration</code>. You are of course also free to use any other test annotations such as <code>@TestExecutionListeners</code>, <code>@TransactionConfiguration</code>, <code>@ActiveProfiles</code>, etc.
</p>
<p>
Let's take a look at some examples...
</p><p><code>Conventions</code></p>
<pre><code class="prettyprint java"><br />@RunWith(SpringJUnit4ClassRunner.class)

// defaults to &quot;file:src/main/webapp&quot;
@WebAppConfiguration

// detects &quot;WacTests-context.xml&quot; in same package
// or static nested @Configuration class
@ContextConfiguration

public class WacTests {
	//...
}
</code></pre>
<p>
The above example demonstrates the TestContext framework's support for <em>convention over configuration</em>. If you annotate a test class with <code>@WebAppConfiguration</code> without specifying a resource base path, the resource path will effectively default to <em>"file:src/main/webapp"</em>. Similarly, if you declare <code>@ContextConfiguration</code> without specifying resource <code>locations</code>, annotated <code>classes</code>, or context <code>initializers</code>, Spring will attempt to detect the presence of your configuration using conventions (i.e., <em>"WacTests-context.xml"</em> in the same package as the <code>WacTests</code> class or static nested <code>@Configuration</code> classes).
</p><p><code>Default Resource Semantics</code></p>
<pre><code class="prettyprint java"><br />@RunWith(SpringJUnit4ClassRunner.class)

// file system resource
@WebAppConfiguration(&quot;webapp&quot;)

// classpath resource
@ContextConfiguration(&quot;/spring/test-servlet-config.xml&quot;)

public class WacTests {
	//...
}
</code></pre>
<p>
This example demonstrates how to explicitly declare a resource base path with <code>@WebAppConfiguration</code> and an XML resource location with <code>@ContextConfiguration</code>. The important thing to note here is the different semantics for paths with these two annotations. By default, <code>@WebAppConfiguration</code> resource paths are file system based; whereas, <code>@ContextConfiguration</code> resource locations are classpath based.
</p><p><code>Explicit Resource Semantics</code></p>
<pre><code class="prettyprint java"><br />@RunWith(SpringJUnit4ClassRunner.class)

// classpath resource
@WebAppConfiguration(&quot;classpath:test-web-resources&quot;)

// file system resource
@ContextConfiguration(
    &quot;file:src/main/webapp/WEB-INF/servlet-config.xml&quot;)

public class WacTests {
	//...
}
</code></pre>
<p>
In this third example, we see that we can override the default resource semantics for both annotations by specifying a Spring resource prefix. Contrast the comments in this example with the previous example.
</p>
<p><hr /><br /><br /><h1>Working with Web Mocks</h1><br /></p>
<p>
To provide comprehensive web testing support, Spring 3.2 introduces a new <code>ServletTestExecutionListener</code> that is enabled by default. When testing against a <code>WebApplicationContext</code> this <a href="http://static.springsource.org/spring/docs/3.2.0.RC1/reference/html/testing.html#testcontext-key-abstractions" target="_blank" title="TestExecutionListener">TestExecutionListener</a> sets up default thread-local state via Spring Web's <code>RequestContextHolder</code> before each test method and creates a <code>MockHttpServletRequest</code>, <code>MockHttpServletResponse</code>, and <code>ServletWebRequest</code> based on the base resource path configured via <code>@WebAppConfiguration</code>. <code>ServletTestExecutionListener</code> also ensures that the <code>MockHttpServletResponse</code> and <code>ServletWebRequest</code> can be injected into the test instance, and once the test is complete it cleans up thread-local state.
</p>
<p>
Once you have a <code>WebApplicationContext</code> loaded for your test you might find that you need to interact with the web mocks &mdash; for example, to set up your test fixture or to perform assertions after invoking your web component. The following example demonstrates which mocks can be autowired into your test instance. Note that the <code>WebApplicationContext</code> and <code>MockServletContext</code> are both cached across the test suite; whereas, the other mocks are managed per test method by the <code>ServletTestExecutionListener</code>.
</p><p><code>Injecting Mocks</code></p>
<pre><code class="prettyprint java"><br />@WebAppConfiguration
@ContextConfiguration
public class WacTests {
	
	@Autowired WebApplicationContext wac; // cached
	
	@Autowired MockServletContext servletContext; // cached
	
	@Autowired MockHttpSession session;
	
	@Autowired MockHttpServletRequest request;
	
	@Autowired MockHttpServletResponse response;
	
	@Autowired ServletWebRequest webRequest;
	
	//...
}
</code></pre>
<p><hr /><br /><br /><h1>Request and Session Scoped Beans</h1><br /></p>
<p>
<a href="http://static.springsource.org/spring/docs/3.2.0.RC1/reference/html/beans.html#beans-factory-scopes-other" target="_blank" title="Request, session, and global session scopes">Request and session scoped beans</a> have been supported by Spring for several years now, but it's always been a bit non-trivial to test them. As of Spring 3.2 it's now a breeze to test your request-scoped and session-scoped beans by following these steps:
</p>
<ol>
<li>Ensure that a <code>WebApplicationContext</code> is loaded for your test by annotating your test class with <code>@WebAppConfiguration</code>.</li>
<li>Inject the mock request or session into your test instance and prepare your test fixture as appropriate.</li>
<li>Invoke your web component that you retrieved from the configured <code>WebApplicationContext</code> (i.e., via dependency injection).</li>
<li>Perform assertions against the mocks.</li>
</ol>
<p>
The following code snippet displays the XML configuration for a login use case. Note that the <code>userService</code> bean has a dependency on a request-scoped <code>loginAction</code> bean. Also, the <code>LoginAction</code> is instantiated using <a href="http://static.springsource.org/spring/docs/3.2.0.RC1/reference/html/expressions.html" target="_blank" title="Spring Expression Language">SpEL expressions</a> that retrieve the username and password from the current HTTP request. In our test, we will want to configure these request parameters via the mock managed by the TestContext framework.
</p><p><code>Request-scoped Bean Config</code></p>
<pre><code class="prettyprint xml"><br />&lt;beans&gt;

  &lt;bean id=&quot;userService&quot;
      class=&quot;com.example.SimpleUserService&quot;
      c:loginAction-ref=&quot;loginAction&quot; /&gt;

  &lt;bean id=&quot;loginAction&quot; class=&quot;com.example.LoginAction&quot;
      c:username=&quot;#{request.getParameter(&#39;user&#39;)}&quot;
      c:password=&quot;#{request.getParameter(&#39;pswd&#39;)}&quot;
      scope=&quot;request&quot;&gt;
    &lt;aop:scoped-proxy /&gt;
  &lt;/bean&gt;
	
&lt;/beans&gt;
</code></pre>
<p>
In <code>RequestScopedBeanTests</code> we inject both the <code>UserService</code> (i.e., the subject under test) and the <code>MockHttpServletRequest</code> into our test instance. Within our <code>requestScope()</code> test method we set up our test fixture by setting request parameters in the provided <code>MockHttpServletRequest</code>. When the <code>loginUser()</code> method is invoked on our <code>userService</code> we are assured that the user service has access to the request-scoped <code>loginAction</code> for the current <code>MockHttpServletRequest</code> (i.e., the one we just set parameters in). We can then perform assertions against the results based on the known inputs for the username and password.
</p><p><code>Request-scoped Bean Test</code></p>
<pre><code class="prettyprint java"><br />@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
@WebAppConfiguration
public class RequestScopedBeanTests {
	
	@Autowired UserService userService;
	@Autowired MockHttpServletRequest request;
	
	@Test
	public void requestScope() {
		
		request.setParameter(&quot;user&quot;, &quot;enigma&quot;);
		request.setParameter(&quot;pswd&quot;, &quot;$pr!ng&quot;);
		
		LoginResults results = userService.loginUser();
		
		// assert results
	}
}
</code></pre>
<p>
The following code snippet is similar to the one we saw above for a request-scoped bean; however, this time the <code>userService</code> bean has a dependency on a session-scoped <code>userPreferences</code> bean. Note that the <code>UserPreferences</code> bean is instantiated using a SpEL expression that retrieves the <em>theme</em> from the current HTTP session. In our test, we will need to configure a theme in the mock session managed by the TestContext framework.
</p><p><code>Session-scoped Bean Config</code></p>
<pre><code class="prettyprint xml"><br />&lt;beans&gt;

  &lt;bean id=&quot;userService&quot;
      class=&quot;com.example.SimpleUserService&quot;
      c:userPreferences-ref=&quot;userPreferences&quot; /&gt;

  &lt;bean id=&quot;userPreferences&quot;
      class=&quot;com.example.UserPreferences&quot;
      c:theme=&quot;#{session.getAttribute(&#39;theme&#39;)}&quot;
      scope=&quot;session&quot;&gt;
    &lt;aop:scoped-proxy /&gt;
  &lt;/bean&gt;

&lt;/beans&gt;
</code></pre>
<p>
In <code>SessionScopedBeanTests</code> we inject the <code>UserService</code> and the <code>MockHttpSession</code> into our test instance. Within our <code>sessionScope()</code> test method we set up our test fixture by setting the expected "theme" attribute in the provided <code>MockHttpSession</code>. When the <code>processUserPreferences()</code> method is invoked on our <code>userService</code> we are assured that the user service has access to the session-scoped <code>userPreferences</code> for the current <code>MockHttpSession</code>, and we can perform assertions against the results based on the configured theme.
</p><p><code>Session-scoped Bean Test</code></p>
<pre><code class="prettyprint java"><br />@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
@WebAppConfiguration
public class SessionScopedBeanTests {

  @Autowired UserService userService;
  @Autowired MockHttpSession session;

  @Test
  public void sessionScope() throws Exception {

    session.setAttribute(&quot;theme&quot;, &quot;blue&quot;);

    Results results = userService.processUserPreferences();

    // assert results
  }
}
</code></pre>
<p><hr /><br /><br /><h1>Application Context Initializers</h1><br /></p>
<p>
Spring 3.1 introduced the <code>ApplicationContextInitializer</code> interface that allows for programmatic initialization of a <code>ConfigurableApplicationContext</code> &mdash; for example, to register property sources or activate bean definition profiles against the Spring <code>Environment</code> abstraction. Initializers can be configured in <code>web.xml</code> by specifying <code>contextInitializerClasses</code> via a <code>context-param</code> for the <code>ContextLoaderListener</code> and via an <code>init-param</code> for the <code>DispatcherServlet</code>.
</p>
<p>
To use context initializers in integration tests, simply declare the initializer classes in <code>@ContextConfiguration</code> via the new <code>initializers</code> attribute introduced in Spring 3.2. Inheritance of initializers across a test class hierarchy can be controlled via the <code>inheritInitializers</code> attribute which is <code>true</code> by default. Since an <code>ApplicationContextInitializer</code> provides a fully programmatic approach to initializing an application context, an initializer may optionally configure the entire context. In other words, XML resource locations or annotated classes are no longer absolutely required in integration tests that are configured via <code>@ContextConfiguration</code> if initializers have been declared. Last but not least, context initializers are <em>ordered</em> based on Spring's <code>Ordered</code> interface or the <code>@Order</code> annotation.
</p>
<p>
The following code examples demonstrate the various ways that context initializers can be used in integration tests. The first shows how to configure a single initializer in conjunction with XML resource locations. The next example declares multiple context initializers. The third listing demonstrates the use of initializers in a class hierarchy where the list of context initializers declared in the <code>ExtendedTest</code> will be merged with those declared in the <code>BaseTest</code>. Recall that invocation order of initializers is influenced based on the implementation of Spring's <code>Ordered</code> interface or the presence of the <code>@Order</code> annotation. The fourth example is identical to the third example except that the <code>inheritInitializers</code> attribute in <code>@ContextConfiguration</code> has been set to <code>false</code>. The result is that any context initializers declared in parent classes will be ignored (i.e., overridden). The final listing demonstrates that an <code>ApplicationContext</code> can be loaded solely from context initializers without the need to declare XML resource locations or annotated classes.
</p><p><code>Single Initializer</code></p>
<pre><code class="prettyprint java"><br />@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(
    locations = &quot;/app-config.xml&quot;,
    initializers = CustomInitializer.class)
public class ApplicationContextInitializerTests {}
</code></pre><p><code>Multiple Initializers</code></p>
<pre><code class="prettyprint java"><br />@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(
  locations = &quot;/app-config.xml&quot;,
  initializers = {
    PropertySourceInitializer.class,
    ProfileInitializer.class
  })
public class ApplicationContextInitializerTests {}
</code></pre><p><code>Merged Initializers</code></p>
<pre><code class="prettyprint java"><br />@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(
    classes = BaseConfig.class,
    initializers = BaseInitializer.class)
public class BaseTest {}


@ContextConfiguration(
    classes = ExtendedConfig.class,
    initializers = ExtendedInitializer.class)
public class ExtendedTest extends BaseTest {}
</code></pre><p><code>Overridden Initializers</code></p>
<pre><code class="prettyprint java"><br />@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(
    classes = BaseConfig.class,
    initializers = BaseInitializer.class)
public class BaseTest {}


@ContextConfiguration(
    classes = ExtendedConfig.class,
    initializers = ExtendedInitializer.class,
    inheritInitializers = false)
public class ExtendedTest extends BaseTest {}
</code></pre><p><code>Initializer without Resources</code></p>
<pre><code class="prettyprint java"><br />// does not declare &#39;locations&#39; or &#39;classes&#39;
@ContextConfiguration(
    initializers = EntireAppInitializer.class)
public class InitializerWithoutConfigFilesOrClassesTest {}
</code></pre>
<p><hr /><br /><br /><h1>Context Caching</h1><br /></p>
<p>
Once the TestContext framework loads an <code>ApplicationContext</code> for a test, that context will be cached and reused for <strong>all</strong> subsequent tests that declare the same unique context configuration within the same test suite. The important thing to keep in mind here is that an <code>ApplicationContext</code> is uniquely identified by its <em>context cache key</em> (i.e., the combination of configuration parameters that are used to load it).
</p>
<p>
As of Spring 3.2 <code>ApplicationContextInitializer</code> classes are also included the <em>context cache key</em>. Furthermore, if the context is a <code>WebApplicationContext</code> its base resource path (defined via <code>@WebAppConfiguration</code>) will also be included in the <em>context cache key</em>. For further details on caching, consult the <a href="http://static.springsource.org/spring/docs/3.2.0.RC1/reference/html/testing.html#testcontext-ctx-management-caching" target="_blank" title="Context caching">Context caching</a> section of the reference manual.
</p>
<p><hr /><br /><br /><h1>Application Context Hierarchies</h1><br /></p>
<p>
<strong>NOTE</strong>: <em>As of Spring Framework 3.2 RC1, support for context hierarchies has not yet been implemented.</em>
</p>
<p>
In integration tests managed by the Spring TestContext Framework, currently only flat, non-hierarchical contexts are supported. In other words, there is no easy way to create contexts with parent-child relationships for tests. But context hierarchies are supported in production deployments. So it would be nice to be able to test them.
</p>
<p>
With that in mind, the Spring Team would like to introduce integration testing support for loading a test application context with a parent context, and ideally the following common hierarchies would be supported.
</p>
<ul>
<li>Root <code>WebApplicationContext</code> &#x2190; Dispatcher <code>WebApplicationContext</code></li>
<li>EAR &#x2190; Root <code>WebApplicationContext</code> &#x2190; Dispatcher <code>WebApplicationContext</code></li>
</ul>
<p>
The current proposal includes the introduction of a new <code>@ContextHierarchy</code> annotation that would contain nested <code>@ContextConfiguration</code> declarations plus a new <code>name</code> attribute in <code>@ContextConfiguration</code> that could be used for <em>merging</em> or <em>overriding</em> named configuration in the context hierarchy.
</p>
<p>
To shed some light on the proposal, let's take a look at a few examples...
</p>
<p>
<code>AppCtxHierarchyTests</code> demonstrates a parent-child context hierarchy declared within a single test class, where the contexts are standard contexts (i.e., non-web).
</p><p><code>Single Test with Context Hierarchy</code></p>
<pre><code class="prettyprint java"><br />@RunWith(SpringJUnit4ClassRunner.class)

@ContextHierarchy({
	@ContextConfiguration(&quot;parent.xml&quot;),
	@ContextConfiguration(&quot;child.xml&quot;)
})
public class AppCtxHierarchyTests {}
</code></pre>
<p>
<code>ControllerIntegrationTests</code> demonstrates a parent-child context hierarchy declared within a single test class, where the contexts are <code>WebApplicationContexts</code> and model a typical Spring MVC deployment.
</p><p><code>Root WAC &amp; Dispatcher WAC</code></p>
<pre><code class="prettyprint java"><br />@RunWith(SpringJUnit4ClassRunner.class)

@WebAppConfiguration

@ContextHierarchy({
    @ContextConfiguration(
		name = &quot;root&quot;,
		classes = WebAppConfig.class),
    @ContextConfiguration(
		name = &quot;dispatcher&quot;,
		locations = &quot;/spring/dispatcher-config.xml&quot;)
})
public class ControllerIntegrationTests {}
</code></pre>
<p>
The following code listing demonstrates how a context hierarchy could be built up across a test class hierarchy, where each level in the test class hierarchy is responsible for configuring its own level in the context hierarchy. Executing tests in both of these subclasses would result in three application contexts being loaded (and cached) and two distinct context hierarchies.
</p><p><code>Class &amp; Context Hierarchies</code></p>
<pre><code class="prettyprint java"><br />@RunWith(SpringJUnit4ClassRunner.class)
@WebAppConfiguration
@ContextConfiguration(
  &quot;file:src/main/webapp/WEB-INF/applicationContext.xml&quot;)
public abstract class AbstractWebTests{}

@ContextHierarchy(@ContextConfiguration(&quot;/spring/soap-ws-config.xml&quot;))
public class SoapWebServiceTests extends AbstractWebTests{}

@ContextHierarchy(@ContextConfiguration(&quot;/spring/rest-ws-config.xml&quot;))
public class RestWebServiceTests extends AbstractWebTests{}
</code></pre>
<h3>Feedback is Welcome</h3>
<p><p>If you are interested in further information on the proposal for context hierarchies or want to take part in the discussion, please feel free to <em>watch</em> the following JIRA issues and provide us your feedback.</p>
<ul>
<li><a href="https://jira.springsource.org/browse/SPR-5613" target="_blank" title="SPR-5613">SPR-5613</a>: context hierarchy support</li>
<li><a href="https://jira.springsource.org/browse/SPR-9863" target="_blank" title="SPR-9863">SPR-9863</a>: web context hierarchy support</li>
</ul>
<p><hr /><br /><br /><h1>Summary</h1><br /></p>
<p>
Spring Framework 3.2 introduces several new testing features with a strong focus on first-class support for testing web applications. We encourage you to try out these features as soon as you can and give us feedback. Also, stay tuned for <a href="http://blog.springsource.org/author/rstoyanchev/" title="Rossen Stoyanchev" target="_blank">Rossen Stoyanchev's</a> follow-up post on the new <em>Spring MVC Test</em> framework. And if you find any bugs or have any suggestions for improvements, now is the time to <a title="Spring JIRA issue tracker" href="https://jira.springsource.org/browse/SPR" target="_blank">take action</a>!
</p>
<p><hr /><br /></p>
<p>
<em>[1] The reference manual has not yet been updated to reflect testing support for web applications, but these features will certainly be well documented by Spring 3.2 GA.</em>
</p>
<p><hr /><br /></p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 494;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>