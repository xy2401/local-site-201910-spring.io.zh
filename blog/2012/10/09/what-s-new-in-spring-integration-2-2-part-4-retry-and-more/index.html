<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>What&#39;s New in Spring Integration 2.2 (Part 4 - Retry and More)</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="What&#39;s New in Spring Integration 2.2 (Part 4 - Retry and More)" />
<meta name="twitter:description" content="&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;This is the fourth part in a series of blog posts highlighting some of the new features available in Spring Integration 2.2 following the recent release of &lt;a href=&quot;http://www.springsource.org/node/3665&quot;&gt;Release Candidate 1&lt;/a&gt;. The &lt;a href=&quot;http://blog.springsource.org/2012/09/24/whats-new-in-spring-integration-2-2-rc1-part-1-mongodb/&quot;&gt;first part&lt;/a&gt; talks about the MongoDB adapters, the &lt;a href=&quot;http://blog.springsource.org/2012/09/26/whats-new-in-spring-integration-2-2-part-2-transaction-synchronization/&quot;&gt;second part&lt;/a&gt; talks about transaction synchronization; the &lt;a href=&quot;http://blog.springsource.org/2012/10/05/whats-new-in-spring-integration-2-2-part-3-jpa-support/&quot;&gt;third part&lt;/a&gt; talks about JPA support.&lt;/p&gt;
&lt;p&gt;Spring Integration 2.2 introduces the ability to apply one or more localized AOP Advice elements to a message handler. A number of standard Advice classes has also been provided as well as a sample application that explores the features they provide.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@gprussell" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/d84a5be5451df53118f5d2dedd1ef0fb?s=200" />

<meta property="og:title" content="What&#39;s New in Spring Integration 2.2 (Part 4 - Retry and More)" />
<meta property="og:image" content="https://gravatar.com/avatar/d84a5be5451df53118f5d2dedd1ef0fb?s=200" />
<meta property="og:description" content="&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;This is the fourth part in a series of blog posts highlighting some of the new features available in Spring Integration 2.2 following the recent release of &lt;a href=&quot;http://www.springsource.org/node/3665&quot;&gt;Release Candidate 1&lt;/a&gt;. The &lt;a href=&quot;http://blog.springsource.org/2012/09/24/whats-new-in-spring-integration-2-2-rc1-part-1-mongodb/&quot;&gt;first part&lt;/a&gt; talks about the MongoDB adapters, the &lt;a href=&quot;http://blog.springsource.org/2012/09/26/whats-new-in-spring-integration-2-2-part-2-transaction-synchronization/&quot;&gt;second part&lt;/a&gt; talks about transaction synchronization; the &lt;a href=&quot;http://blog.springsource.org/2012/10/05/whats-new-in-spring-integration-2-2-part-3-jpa-support/&quot;&gt;third part&lt;/a&gt; talks about JPA support.&lt;/p&gt;
&lt;p&gt;Spring Integration 2.2 introduces the ability to apply one or more localized AOP Advice elements to a message handler. A number of standard Advice classes has also been provided as well as a sample application that explores the features they provide.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2012-10-09 18:35:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">What&#39;s New in Spring Integration 2.2 (Part 4 - Retry and More)</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/d84a5be5451df53118f5d2dedd1ef0fb?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/grussell">Gary Russell</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2012-10-09 18:35:00.0">October 09, 2012</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="482" href="/blog/2012/10/09/what-s-new-in-spring-integration-2-2-part-4-retry-and-more#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><h2>Introduction</h2><p>This is the fourth part in a series of blog posts highlighting some of the new features available in Spring Integration 2.2 following the recent release of <a href="http://www.springsource.org/node/3665">Release Candidate 1</a>. The <a href="http://blog.springsource.org/2012/09/24/whats-new-in-spring-integration-2-2-rc1-part-1-mongodb/">first part</a> talks about the MongoDB adapters, the <a href="http://blog.springsource.org/2012/09/26/whats-new-in-spring-integration-2-2-part-2-transaction-synchronization/">second part</a> talks about transaction synchronization; the <a href="http://blog.springsource.org/2012/10/05/whats-new-in-spring-integration-2-2-part-3-jpa-support/">third part</a> talks about JPA support.</p><p>Spring Integration 2.2 introduces the ability to apply one or more localized AOP Advice elements to a message handler. A number of standard Advice classes has also been provided as well as a sample application that explores the features they provide.</p><p><p /><h2>Background</h2><br /><blockquote>For a general introduction to Aspect Oriented Programming (AOP), see the <a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/aop.html">Spring Documentation</a></blockquote></p><p>With Spring Integration, to-date, it has been possible to apply an <code>&lt;advice-chain/&gt;</code> to a poller. Assuming Direct channels are being used, an AOP Advice in such a chain applies to the entire flow, encompassing all downstream components. There are times, however, when it would be advantageous to advise just an individual endpoint to, say, retry an operation, rather than causing the entire flow to fail and be retried when a component well down-stream fails..<br /><p /><h2>Introduction</h2><br />Spring Integration 2.2 Introduces a new child element <code>&lt;request-handler-advice-chain/&gt;</code> on many endpoints. <p /><br />Consider a Spring Integration flow:</p><p><code>some-inbound-adapter&lt;-poller-&gt;http-gateway1-&gt;http-gateway2-&gt;jdbc-outbound-adapter</code><br /><p /><br />If the database connection has a glitch, and we have a retry advice on the poller; the entire flow will be reprocessed; causing both http gateways to be called a second (or more) times.<br /><p /><br />This feature provides a mechanism to apply a retry Advice (among others) to just the outbound adapter. Also, the Advice can be applied to many other endpoints, regardless of where they appear in the flow, for example, we could retry just the http-gateway2 if it fails.</p><p>In addition to the general capability to configure an Advice chain, three Advice classes are provided:<strong><br /><ul>RequestHandlerRetryAdvice<br />RequestHandlerCircuitBreakerAdvice<br />ExpressionEvaluatingRequestHandlerAdvice</ul></strong></p><p>These are described in some more detail below, and are explored further in a new <a href="https://github.com/SpringSource/spring-integration-samples/tree/master/intermediate/retry-and-more">retry-and-more</a> sample application.</p><p><p /><h2>RequestHandlerRetryAdvice</h2></p><p>This advice provides the ability to configure retry, utilizing the <a href="https://github.com/SpringSource/spring-retry">spring-retry project</a>, which had its origins in Spring Batch. spring-retry has a RetryTemplate which allows configuration of retry policies, such as back-off, recovery actions etc. Refer to the <a href="https://github.com/SpringSource/spring-retry/commits/master">spring-retry project</a> for more information.<br /><p /><br />Retry can be stateless or stateful. Stateless retry means the retries are simply performed internally; when a failure occurs the thread simply retries, based on the retry and backoff policies. Stateful recovery is used when the message source itself can retry - for example a transactional JMS or AMQP inbound channel adapter. In this case something needs to identify that this message has been tried before (such as JMSMessageID). For this purpose a SpEL-based RetryStateGenerator is provided which can extract the identifier from a header, for example.<br /><p /><br />In both cases, when retries are exhausted, a RecoveryCallback can be invoked; this is used to dispose of the failed message. An ErrorMessageSendingRecoverer is provided, which sends the failed message to a channel.<br /><p /><br />Examples of the RequesHandlerRetryAdvice are shown in the new <a href="https://github.com/SpringSource/spring-integration-samples/tree/master/intermediate/retry-and-more">retry-and-more</a> sample application.</p><p><p /><h2>RequestHandlerCircuitBreakerAdvice</h2></p><p>This advice provides an implementation of the Circuit Breaker pattern. If, say, a remote service is unavailable (requests fail for a configurable number of attempts), this Advice prevents attempts to call that service again for some (configurable) period of time. Once that time has expired, the advice allows the next attempt to call the service however, if the service is still unavailable, it is immediately marked as such. When a service is unavailable, an exception is immediately thrown without invoking the service; the circuit breaker is said to be &lsquo;open&rsquo;. Once a successful service call is made, the circuit breaker is &lsquo;closed&rsquo; and all subsequent calls will be routed to the service until it is, once again, detected to be unavailable because the configured number of consecutive failed attempts has been exceeded.<br /><p /><br />An example of the RequestHandlerCircuitBreakerAdvice is shown in the new <a href="https://github.com/SpringSource/spring-integration-samples/tree/master/intermediate/retry-and-more">retry-and-more</a> sample application.</p><p><p /><h2>ExpressionEvaluatingRequestHandlerAdvice</h2></p><p>This advice provides a mechanism whereby a SpEL expression is evaluated after the request is processed (either successfully or otherwise). For example, with an FTP outbound adapter, the onSuccessExpression might be<br /><p /><code>&ldquo;payload.reNameTo(&rsquo;/foo/succeeded/&rdquo; + payload.name)&ldquo;</code>,<br /><p />whereas the onFailureExpression might be<br /><p /><code>&rdquo;payload.reNameTo(&rsquo;/foo/failed/&ldquo; + payload.name)&rdquo;</code>.<br /><p />Each expression has a corresponding channel to which the result of the evaluation (if any) is sent.<br /><p /><br />An example of this advice is also shown in the new <a href="https://github.com/SpringSource/spring-integration-samples/tree/master/intermediate/retry-and-more">retry-and-more</a> sample application.</p><p><p /><h2>Custom Advice Classes</h2><br />While any AOP Advice can be applied, an abstract class has been provided to assist in creation of Advice classes to be used specifically for advising endpoints. For more information see the <a href="http://static.springsource.org/spring-integration/docs/2.2.0.RC1/reference/htmlsingle/#custom-advice">Custom Advice Classes</a> section in the reference documentation.</p><p><p /><h2>Conclusion</h2></p><p>Spring Integration provides a great deal of flexibility to assemble loosely coupled components into applications. It is now extremely easy to apply common mechanisms, such as retry, to individual components within that application. See the <a href="http://static.springsource.org/spring-integration/docs/2.2.0.RC1/reference/htmlsingle/#message-handler-advice-chain">reference documentation</a> and <a href="https://github.com/SpringSource/spring-integration-samples/tree/master/intermediate/retry-and-more">retry-and-more</a> sample application for more information.<br /><p /></p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 482;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>