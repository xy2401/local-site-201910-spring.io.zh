<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>为Apache Hadoop引入Spring</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Introducing Spring for Apache Hadoop">
<meta name="twitter:description" >
<meta property="og:title" content="Introducing Spring for Apache Hadoop">
<meta property="og:description" >
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2012-02-29 08:05:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">为Apache Hadoop引入Spring</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="null?s=20&d=mm"> <span class="author">Costin Leau</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2012-02-29 08:05:00.0">2012年2月29日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2012/02/29/introducing-spring-for-apache-hadoop#disqus_thread" data-disqus-identifier="462">
</a></div>
</div>
</header>
<div class="blog--post"><p>我很高兴地宣布，第一个里程碑版本（1.0.0。M1）为<a href="http://www.springsource.org/spring-data/hadoop">春为Apache的Hadoop</a>项目<a href="http://www.springsource.org/download/community?project=Spring Data Hadoop">提供</a>并谈一些我们一直在做，在过去几个月的工作。作为Apache Hadoop的<a href="http://www.springsource.org/spring-data/">Spring数据</a>保护伞的一部分，Spring通过利用Spring生态系统的功能为开发基于<a href="https://hadoop.apache.org/">Apache Hadoop</a>技术的应用程序提供支持。无论是编写独立的原始MapReduce应用程序，与企业中多个数据存储中的数据进行交互，还是协调HDFS，Pig或Hive作业的复杂工作流，或在两者之间进行任何协调，Spring for Apache Hadoop都始终如一。 Spring哲学提供了简化的编程模型，并解决了由基础架构引起的<i><a href="https://en.wikipedia.org/wiki/Accidental_complexity">“意外复杂性”</a></i> 。用于Apache Hadoop的Spring在开发人员库中提供了一个功能强大的工具来处理大数据量。</p>
<h4>MapReduce工作</h4><p>Apache Hadoop的<a href="https://en.wikipedia.org/wiki/Hello_world_program">Hello世界</a>是<a href="https://hadoop.apache.org/common/docs/current/mapred_tutorial.html#Example%3A+WordCount+v1.0">单词计数</a>示例-一个简单的用例，它公开了基本的Apache Hadoop功能。将Spring用于Apache Hadoop时，字数示例如下所示：</p>
<pre><code class="prettyprint xml">&lt;!-- configure Apache Hadoop FS/job tracker using defaults --&gt;
&lt;hdp:configuration /&gt;

&lt;!-- define the job --&gt;
&lt;hdp:job id=&quot;word-count&quot; 
  input-path=&quot;/input/&quot; output-path=&quot;/ouput/&quot;
  mapper=&quot;org.apache.hadoop.examples.WordCount.TokenizerMapper&quot;
  reducer=&quot;org.apache.hadoop.examples.WordCount.IntSumReducer&quot;/&gt;

&lt;!-- execute the job --&gt;
&lt;bean id=&quot;runner&quot; class=&quot;org.springframework.data.hadoop.mapreduce.JobRunner&quot; 
                  p:jobs-ref=&quot;word-count&quot;/&gt;
</code></pre><p>请注意IoC容器如何处理作业配置的创建和提交。无论需要调整Apache Hadoop配置还是reducer需要额外的参数，所有配置选项仍然可供您配置。这使您可以从小处着手，并使配置与应用程序一起增长。配置可以是简单的，也可以是开发人员希望/需要的，可以利用Spring <a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/beans.html">容器</a>功能（如<a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/beans.html#beans-factory-placeholderconfigurer">属性占位符</a>和<a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/new-in-3.1.html#d0e1313">环境支持）进行</a>高级配置：</p>
<pre><code class="prettyprint xml">&lt;hdp:configuration resources=&quot;classpath:/my-cluster-site.xml&quot;&gt;
    fs.default.name=${hd.fs}
    hadoop.tmp.dir=file://${java.io.tmpdir}
    electric=sea
&lt;/hdp:configuration&gt;

&lt;context:property-placeholder location=&quot;classpath:hadoop.properties&quot; /&gt;

&lt;!-- populate Apache Hadoop distributed cache --&gt;
&lt;hdp:cache create-symlink=&quot;true&quot;&gt;
  &lt;hdp:classpath value=&quot;/cp/some-library.jar#library.jar&quot; /&gt;
  &lt;hdp:cache value=&quot;/cache/some-archive.tgz#main-archive&quot; /&gt;
  &lt;hdp:cache value=&quot;/cache/some-resource.res&quot; /&gt;
&lt;/hdp:cache&gt;
</code></pre><p>（字数<a href="http://static.springsource.org/spring-hadoop/docs/current/reference/html/samples.html">示例</a>是Spring for Apache Hadoop发行版的一部分-随时下载并进行实验）。</p><p>Spring for Apache Hadoop不需要用Java重写您的MapReduce作业，您可以无缝地使用非Java <a href="https://hadoop.apache.org/common/docs/current/streaming.html">流</a>作业：它们只是对象（或者像Spring称为bean一样），就像任何对象一样被创建，配置，连接和管理其他由框架以一致，连贯的方式进行。开发人员可以根据自己的喜好和要求进行混合和匹配，而不必担心集成问题。</p>
<pre><code class="prettyprint xml">&lt;hdp:streaming id=&quot;streaming-env&quot; 
  input-path=&quot;/input/&quot; output-path=&quot;/ouput/&quot;
  mapper=&quot;${path.cat}&quot; reducer=&quot;${path.wc}&quot;&gt;
  &lt;hdp:cmd-env&gt;
    EXAMPLE_DIR=/home/example/dictionaries/
  &lt;/hdp:cmd-env&gt;
&lt;/hdp:streaming&gt;
</code></pre><p>还支持现有的Apache Hadoop <a href="https://hadoop.apache.org/common/docs/current/api/org/apache/hadoop/util/class-use/Tool.html">工具</a>实现；实际上，与其通过命令行指定自定义Apache Hadoop属性，还可以简单地注入它：</p>
<pre><code class="prettyprint xml">&lt;!-- the tool automatically is injected with &#39;hadoop-configuration&#39; --&gt;
&lt;hdp:tool-runner id=&quot;scalding&quot; tool-class=&quot;com.twitter.scalding.Tool&quot;&gt;
   &lt;hdp:arg value=&quot;tutorial/Tutorial1&quot;/&gt;
   &lt;hdp:arg value=&quot;--local&quot;/&gt;
&lt;/hdp:tool-runner&gt;
</code></pre><p>上面的配置执行Twitter的<a href="https://github.com/twitter/scalding">Scalding</a> （位于Cascading（请参见<a href="#cascading">下文</a> ）库之上的Scala DSL）的Tutorial1。请注意，Spring上没有针对Apache Hadoop或扩展的<i>专用</i>支持代码-仅使用标准的Apache Hadoop API。</p>
<h4>使用HBase / Hive / Pig</h4><p>说到DSL，在与Apache Hadoop进行交互时通常使用更高级别的抽象-流行的选择包括<a href="https://hbase.apache.org/">HBase</a> ， <a href="https://hive.apache.org/">Hive</a>或<a href="https://pig.apache.org/">Pig</a> 。Spring for Apache Hadoop提供了所有这些功能的集成，从而允许在Spring应用程序内轻松配置和使用这些<i>数据源</i> ：</p>
<pre><code class="prettyprint xml">&lt;!-- HBase configuration with nested properties --&gt;
&lt;hdp:hbase-configuration stop-proxy=&quot;false&quot; delete-connection=&quot;true&quot;&gt;
    foo=bar
&lt;/hdp:hbase-configuration&gt;

&lt;!-- create a Pig instance using custom properties
    and execute a script (using given arguments) at startup --&gt;
     
&lt;hdp:pig properties-location=&quot;pig-dev.properties&quot; /&gt;
   &lt;script location=&quot;org/company/pig/script.pig&quot;&gt;
     &lt;arguments&gt;electric=tears&lt;/arguments&gt;
   &lt;/script&gt;
&lt;/hdp:pig&gt;
</code></pre><p>通过Spring for Apache Hadoop，不仅可以获得强大的IoC容器，而且还可以访问Spring的可移植服务抽象。以流行的<a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/jdbc.html#jdbc-JdbcTemplate">JdbcTemplate</a>为例，可以在Hive的<a href="https://cwiki.apache.org/confluence/display/Hive/HiveClient">Jdbc客户端</a>上使用它：</p>
<pre><code class="prettyprint xml">&lt;!-- basic Hive driver bean --&gt;
&lt;bean id=&quot;hive-driver&quot; class=&quot;org.apache.hadoop.hive.jdbc.HiveDriver&quot;/&gt;

&lt;!-- wrapping a basic datasource around the driver --&gt;
&lt;bean id=&quot;hive-ds&quot;
    class=&quot;org.springframework.jdbc.datasource.SimpleDriverDataSource&quot;
    c:driver-ref=&quot;hive-driver&quot; c:url=&quot;${hive.url}&quot;/&gt;

&lt;!-- standard JdbcTemplate declaration --&gt;
&lt;bean id=&quot;template&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;
    c:data-source-ref=&quot;hive-ds&quot;/&gt;
</code></pre><p><a name="cascading"></a><br></p><h4>级联</h4><br>Spring还支持基于Java的类型安全<a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/new-in-3.0.html#new-java-configuration">配置</a>模型。可以将其用作声明性XML配置的替代或补充-例如使用<a href="http://www.cascading.org/">Cascading</a><p></p>
<pre><code class="prettyprint java">@Configuration
public class CascadingConfig {
    @Value(&quot;${cascade.sec}&quot;) private String sec;
    
    @Bean public Pipe tsPipe() {
        DateParser dateParser = new DateParser(new Fields(&quot;ts&quot;), 
                 &quot;dd/MMM/yyyy:HH:mm:ss Z&quot;);
        return new Each(&quot;arrival rate&quot;, new Fields(&quot;time&quot;), dateParser);
    }

    @Bean public Pipe tsCountPipe() {
        Pipe tsCountPipe = new Pipe(&quot;tsCount&quot;, tsPipe());
        tsCountPipe = new GroupBy(tsCountPipe, new Fields(&quot;ts&quot;));
    }
}
</code></pre>
<pre><code class="prettyprint xml">&lt;!-- code configuration class --&gt;
&lt;bean class=&quot;org.springframework.data.hadoop.cascading.CascadingConfig &quot;/&gt;

&lt;bean id=&quot;cascade&quot;
    class=&quot;org.springframework.data.hadoop.cascading.HadoopFlowFactoryBean&quot; 
    p:configuration-ref=&quot;hadoop-configuration&quot; p:tail-ref=&quot;tsCountPipe&quot; /&gt;
</code></pre><p>上面的示例混合了程序配置和声明性配置：前者创建单个级联管道，后者将它们连接在一起成为一个流。</p>
<h4>使用Spring的可移植服务抽象</h4><p>或者使用Spring出色的<a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/scheduling.html">任务/计划</a>支持在特定时间提交作业：</p>
<pre><code class="prettyprint xml">&lt;task:scheduler id=&quot;myScheduler&quot; pool-size=&quot;10&quot;/&gt;

&lt;task:scheduled-tasks scheduler=&quot;myScheduler&quot;&gt;
 &lt;!-- run once a day, at midnight --&gt;
 &lt;task:scheduled ref=&quot;word-count-job&quot; method=&quot;submit&quot; cron=&quot;0 0 * * * &quot;/&gt;
&lt;/task:scheduled-tasks&gt;
</code></pre><p>上面的配置使用一个简单的JDK <a href="https://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/Executor.html">Executor</a>实例-非常适合<a href="javascript:void(0);" https:="" ="" en.wikipedia.org="" wiki="" proof_of_concept="=">http://en.wikipedia.org/wiki/Proof_of_Concept的</a> POC开发。可以使用更全面的解决方案（例如专用<a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/scheduling.html#scheduling-quartz">调度程序</a>或<a href="https://docs.oracle.com/javaee/1.4/api/javax/resource/spi/work/WorkManager.html">WorkManager</a>实现）在生产中<a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/scheduling.html#scheduling-task-executor-types">轻松替换</a>它（单行），这是Spring强大的服务抽象的另一个示例。</p>
<h4>HDFS /脚本</h4><p>与<a href="https://hadoop.apache.org/hdfs/">HDFS</a>交互时的常见任务是准备文件系统，例如清理输出目录以避免覆盖数据或将所有输入文件移到相同的名称方案或文件夹下。Spring for Apache Hadoop通过完全拥抱Apache Hadoop的fs命令（例如<a href="https://hadoop.apache.org/common/docs/current/file_system_shell.html">FS Shell</a>和<a href="https://hadoop.apache.org/common/docs/current/distcp.html">DistCp）</a>并将它们作为适当的Java API <a href="http://static.springsource.org/spring-hadoop/docs/current/api/org/springframework/data/hadoop/fs/package-summary.html">公开</a>来解决了该问题。将其与JVM脚本（无论是Groovy，JRuby还是Rhino / JavaScript）混合使用，以形成强大的<a href="http://static.springsource.org/spring-hadoop/docs/current/reference/html/scripting.html#scripting:api">组合</a> ：</p>
<pre><code class="prettyprint xml">&lt;hdp:script language=&quot;groovy&quot;&gt;
  inputPath = &quot;/user/gutenberg/input/word/&quot;
  outputPath = &quot;/user/gutenberg/output/word/&quot;

  if (fsh.test(inputPath)) {
    fsh.rmr(inputPath)
  }

  if (fsh.test(outputPath)) {
    fsh.rmr(outputPath)
  }

  fs.copyFromLocalFile(&quot;data/input.txt&quot;, inputPath)
&lt;/hdp:script&gt;
</code></pre>
<h4>摘要</h4><p>这篇文章只是触及了Spring中可用于Apache Hadoop的一些功能；我没有提到Spring Batch集成为<a href="http://static.springsource.org/spring-hadoop/docs/current/reference/html/hadoop.html#hadoop:tasklet">各种</a> Apache Hadoop <a href="http://static.springsource.org/spring-hadoop/docs/current/reference/html/scripting.html#scripting-tasklet">交互</a>提供任务集，也没有提到使用Spring Integration进行事件触发-在以后的文章中将详细介绍。<br>让我们知道你在想什么，你需要什么，给我们反馈： <a href="http://www.springsource.org/download/community?project=Spring Data Hadoop">下载</a>的代码， <a href="https://github.com/SpringSource/spring-hadoop">叉</a>来源， <a href="https://jira.springsource.org/browse/SHDP">报告</a>问题， <a href="http://forum.springsource.org/forumdisplay.php?f=80">后</a>在论坛上或向我们发送<a href="https://twitter.com/costinl">的tweet</a> 。</p><p><br></p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 462;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>