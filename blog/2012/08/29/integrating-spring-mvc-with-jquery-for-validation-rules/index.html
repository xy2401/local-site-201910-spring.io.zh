<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>将Spring MVC与jQuery集成以验证规则</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Integrating Spring MVC with jQuery for validation rules">
<meta name="twitter:description" content="<p>I was thrilled to see in a recent <a href=" http: ="" zeroturnaround.com="" blog="" developer-productivity-report-2012-java-tools-tech-devs-and-data="" ="=">survey from zeroturnaround that Spring MVC was voted the most popular web framework for Java.
<p>This framework is very flexible and there are dozens of ways to use it. As with all flexible frameworks that have many options, it is important to discuss common practices.</p>
<p>The project I have created for this blog entry uses features common in many Spring MVC applications. You will find something like this:</p>
<p><a href=" blog.springsource.org wp-content uploads 2012 08 01-controller-view.png"></head><body ><img title="01-控制器视图" src="http://blog.springsource.org/wp-content/uploads/2012/08/01-controller-view.png" alt="" width="510" height="325"><p></p>
<p>In controllers you will find typical Spring MVC features for mapping requests, extracting request data through annotations, data binding, file upload…</p>
">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/e0dffdc6678a8035ce431e3bc46a82f8?s=200">

<meta property="og:title" content="Integrating Spring MVC with jQuery for validation rules">
<meta property="og:image" content="https://gravatar.com/avatar/e0dffdc6678a8035ce431e3bc46a82f8?s=200">
<meta property="og:description" content="<p>I was thrilled to see in a recent <a href=" http: ="" zeroturnaround.com="" blog="" developer-productivity-report-2012-java-tools-tech-devs-and-data="" ="=">survey from zeroturnaround that Spring MVC was voted the most popular web framework for Java.
<p>This framework is very flexible and there are dozens of ways to use it. As with all flexible frameworks that have many options, it is important to discuss common practices.</p>
<p>The project I have created for this blog entry uses features common in many Spring MVC applications. You will find something like this:</p>
<p><a href=" blog.springsource.org wp-content uploads 2012 08 01-controller-view.png"><img title="01-控制器视图" src="http://blog.springsource.org/wp-content/uploads/2012/08/01-controller-view.png" alt="" width="510" height="325"><p></p>
<p>In controllers you will find typical Spring MVC features for mapping requests, extracting request data through annotations, data binding, file upload…</p>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2012-08-29 10:18:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">将Spring MVC与jQuery集成以验证规则</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/e0dffdc6678a8035ce431e3bc46a82f8?s=20&d=mm"> <span class="author">迈克尔·艾维（Michael Isvy）</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2012-08-29 10:18:00.0">2012年8月29日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2012/08/29/integrating-spring-mvc-with-jquery-for-validation-rules#disqus_thread" data-disqus-identifier="484">
</a></div>
</div>
</header>
<div class="blog--post"><p>在最近<a href="http://zeroturnaround.com/blog/developer-productivity-report-2012-java-tools-tech-devs-and-data/">从零周转开始的调查中，</a>我很高兴看到Spring MVC被选为Java最受欢迎的Web框架。</p><p>这个框架非常灵活，有数十种使用方式。与所有具有多种选择的灵活框架一样，讨论通用做法也很重要。</p><p>我为此博客条目创建的项目使用许多Spring MVC应用程序中共有的功能。您会发现类似以下内容：</p><p><a href="http://blog.springsource.org/wp-content/uploads/2012/08/01-controller-view.png"><img title="01-控制器视图" src="http://blog.springsource.org/wp-content/uploads/2012/08/01-controller-view.png" alt="" width="510" height="325"></a></p><p>在控制器中，您将找到典型的Spring MVC功能，用于映射请求，通过注释提取请求数据，数据绑定，文件上传…</p><p>另一方面，在JSP内部，大多数HTML都是本地编写的（与Spring MVC标签生成的相反）。而且，Spring MVC标签库不会生成任何Javascript代码。</p><p>我们首先将讨论如何将Spring MVC与jQuery和Bean Validation集成。然后，我们将看到如何使这些JSP不再那么冗长。</p>

<h2>Bean验证？</h2><p>JSR 303 Bean验证提供了一种全面的方法来声明验证规则。这是一个例子：</p>
<pre><code class="prettyprint java"><br />public class DiningForm {
  @Pattern(regexp=&quot;\\d{16}&quot;)

  private String creditCardNumber;

  @Size(1)
  private String merchantNumber;

  @Min(0)
  private double monetaryAmount;

  @NotNull
  private Date date;

  ...

}
</code></pre><p>调用验证时，将根据上面的注释验证DiningForm的实例。</p><p>从Spring 3.0开始，Spring MVC与Bean验证集成了验证规则（这不是使用Spring @MVC进行验证的唯一方法，但显然，它已成为最常见的方法）。</p><p>在控制器方法中，我们可以使用@Valid，如下所示：</p>
<pre><code class="prettyprint java"><br />@RequestMapping(value=&quot;/update&quot;, method=RequestMethod.POST)
  public String update(@Valid DiningForm diningForm, BindingResult result) {

    if (result.hasErrors()) {
      return “rewards/edit”;
    }

    // continue on success...

  }
}
</code></pre><p>在JSP级别，可以使用以下命令显示错误消息<form:errors></form:errors> ：</p>
<pre><code class="prettyprint xml"><br />&lt;form:form modelAttribute=&quot;diningForm&quot;&gt;
  &lt;form:input path=&quot;firstName&quot;/&gt;
  &lt;form:errors path=&quot;firstName&quot;/&gt;
  …
&lt;/form:form&gt;
</code></pre><p>上面的代码非常简单并且运行良好。但是它不会生成任何Javascript。因此，它不允许部分渲染或客户端验证。让我们看看如何改善它！<br></p><h2>添加Javascript以进行部分渲染</h2><br>让我们考虑一下“名字”为空时会发生什么。<p></p><p><a href="http://blog.springsource.org/wp-content/uploads/2012/08/02-form.png"><img title="02表格" src="http://blog.springsource.org/wp-content/uploads/2012/08/02-form.png" alt="" width="312" height="185"></a></p><p>在前面的示例中，每次提交表单时都会刷新整个页面。以下是HTML响应的摘录：</p><p><a href="http://blog.springsource.org/wp-content/uploads/2012/08/02bis-fieldset.png"><img title="02bis-fieldset" src="http://blog.springsource.org/wp-content/uploads/2012/08/02bis-fieldset.png" alt="" width="518" height="176"></a></p><p>我们的目标是最小化响应大小。我们应该能够得到这样的响应（使用json语法）：</p>
<pre><code class="prettyprint xml"><br />{&quot;status&quot;:&quot;FAIL&quot;,&quot;result&quot;:[{&quot;fieldName&quot;:&quot;firstName&quot;,&quot;message&quot;:&quot;firstName  may not be empty&quot;}]}

</code></pre><p>首先，我们将使用jQuery表单提交来验证表单。当该表单被视为有效时，将使用常规HTML表单提交触发表单提交（通过这种方式，我们将能够重定向到另一个页面）。</p><p>让我们首先创建一个简单的<em>ValidationResponse</em>类，如下所示：</p>
<pre><code class="prettyprint java"><br />public class ValidationResponse {
 private String status;
 private List errorMessageList;

 public String getStatus() {
   return status;
 }
 public void setStatus(String status) {
   this.status = status;
 }
 public List getErrorMessageList() {
   return this.errorMessageList;
 }
 public void setErrorMessageList(List errorMessageList) {
   this.errorMessageList = errorMessageList;
 }
}
</code></pre><p>在controller类内，我们可以添加一个action方法：</p>
<pre><code class="prettyprint java"><br />@RequestMapping(value=&quot;/user.json&quot;)
public @ResponseBody ValidationResponse processForm (Model model, @Valid User user, BindingResult result ) {
 ValidationResponse res = new ValidationResponse();
 if(!result.hasErrors()){
   res.setStatus(&quot;SUCCESS&quot;);
 }
 // …
 return res;
}
</code></pre><p>感谢<em>@ResponseBody</em>批注，返回的对象将转换为JSON，如下图所示：</p><p><a href="http://blog.springsource.org/wp-content/uploads/2012/08/03-json-query1.png"><img title="03-json-query" src="http://blog.springsource.org/wp-content/uploads/2012/08/03-json-query1.png" alt="" width="517" height="161"></a></p><p>在JSP内部，将分析并显示错误消息（如果适用）。您可以浏览<a href="https://raw.github.com/michaelisvy/ajax-samples/16e1ba9b140c811f4cc74c0e2e740a97ec39f324/src/main/webapp/WEB-INF/jsp/02-ajax/userForm.jsp">Javascript代码</a>以获取更多详细信息。</p><p>根据<a href="https://en.wikipedia.org/wiki/Progressive_enhancement">渐进增强的</a>最佳做法，所有Javascript代码均已放置在HTML表单之外。如果在客户端的浏览器上禁用了Javascript，则表单会退回到整页刷新中。</p><p>现在，我们已经对验证规则进行了部分刷新，还有两点需要改进：<br></p><ul><br> <li>该页面看起来不酷！</li><br></ul><br><ul><br> <li>此hello-world-style页面已经有100行。应该有一些方法可以缩短它。</li><br></ul><br><h2>让我们用Bootstrap使其漂亮</h2><br>即使这与Spring MVC没有直接关系，但对于我来说，很难提供具有如此差的UI设计的示例应用程序。如果您还没有听说过， <a href="https://github.com/twitter/bootstrap">twitter Bootstrap</a>将成为事实上的CSS框架。许多开发人员喜欢它，因为它可以轻松完成网站的可接受设计。复制Bootstrap CSS和图像之后，我只需要使用Boostrap CSS类（有关更多详细信息，请参见<a href="https://github.com/michaelisvy/ajax-samples/blob/16e1ba9b140c811f4cc74c0e2e740a97ec39f324/src/main/webapp/WEB-INF/jsp/03-bootstrap/userForm.jsp">JSP源代码</a> ）。我的表格现在看起来像这样：<br><a name="custom"></a><p></p><p><a href="http://blog.springsource.org/wp-content/uploads/2012/08/04-form-bootstrap.png"><img class="aligncenter size-full wp-image-11466" title="04-形式引导" src="http://blog.springsource.org/wp-content/uploads/2012/08/04-form-bootstrap.png" alt="" width="470" height="186"></a></p>
<h2>使用自定义标签来避免“ JSP汤”综合征</h2><p>那就是事情变得非常有趣的地方：即使我们已经有一些已经在工作的代码，也很难阅读。我们将HTML，Javascript，CSS和JSP表达式语言混合在一起。如果我的JSP代码看起来像这样，则更具可读性：</p>
<pre><code class="prettyprint xml"><br /><br />&lt;html:form modelAttribute=&quot;user&quot;  id=&quot;add-user-form&quot; formUrl=&quot;/userAjaxCustomTag.htm&quot;&gt;
 &lt;html:inputField name=&quot;firstName&quot; label=&quot;Enter your first name:&quot; /&gt;
 &lt;html:inputField name=&quot;lastName&quot; label=&quot;Enter your last name:&quot; /&gt;
 &lt;div&gt;
   &lt;button type=&quot;submit&quot;&gt;Save changes&lt;/button&gt;
   &lt;button type=&quot;reset&quot;&gt;Cancel&lt;/button&gt;
 &lt;/div&gt;
&lt;/html:form&gt;

</code></pre><p>自定义标签是Java EE的一部分，在Apache Tomcat上也可以很好地工作。创建自定义标签非常容易。让我们以表单输入字段为例。我们目前使用以下语法（8行）：</p>
<pre><code class="prettyprint xml"><br />&lt;div id=&quot;firstName&quot;&gt;
 &lt;label&gt;Enter your first name:&lt;/label&gt;
 &lt;div&gt;
   &lt;form:input path=&quot;firstName&quot; /&gt;
   &lt;span&gt;
     &lt;form:errors path=&quot;firstName&quot; /&gt;
   &lt;/span&gt;
 &lt;/div&gt;
&lt;/div&gt;
</code></pre><p>我们的目标是改用它（1行）：</p>
<pre><code class="prettyprint xml"><br />&lt;html:inputField name=&quot;firstName&quot; label=&quot;Enter your first name:&quot; /&gt;
</code></pre><p>在WEB-INF文件夹中，我可以创建一个新的标记文件，如下所示：</p><p><a href="http://blog.springsource.org/wp-content/uploads/2012/08/05-folders1.png"><img title="05文件夹" src="http://blog.springsource.org/wp-content/uploads/2012/08/05-folders1.png" alt="" width="397" height="141"></a></p><p>其内容如下：</p>
<pre><code class="prettyprint xml"><br />&lt;%@ taglib prefix=&quot;form&quot; uri=&quot;http://www.springframework.org/tags/form&quot; %&gt;
&lt;%@ attribute name=&quot;name&quot; required=&quot;true&quot; rtexprvalue=&quot;true&quot; %&gt;
&lt;%@ attribute name=&quot;label&quot; required=&quot;true&quot; rtexprvalue=&quot;true&quot; %&gt;
&lt;div id=&quot;${name}&quot;&gt;
 &lt;label&gt;${label}&lt;/label&gt;
&lt;div&gt;
  &lt;form:input path=&quot;${name}&quot;/&gt;
  &lt;span&gt;&lt;form:errors path=&quot;${name}&quot;/&gt;&lt;/span&gt;
&lt;/div&gt;
</code></pre><p>回到<em>userForm.jsp</em> ，我只需要声明标签文件夹：</p>
<pre><code class="prettyprint xml"><br />&lt;%@ taglib prefix=&quot;html&quot; tagdir=&quot;/WEB-INF/tags/html&quot; %&gt;
</code></pre><p>我可以按如下方式使用这个新创建的标签：</p>
<pre><code class="prettyprint xml"><br />&lt;html:inputField name=&quot;firstName&quot; label=&quot;Enter your first name:&quot; /&gt;
</code></pre><p>自定义标签很好地集成在Eclipse / STS中，我什至可以访问代码完成功能：<a href="http://blog.springsource.org/wp-content/uploads/2012/08/06-auto-complete.png"><img title="06-自动完成" src="http://blog.springsource.org/wp-content/uploads/2012/08/06-auto-complete.png" alt="" width="435" height="117"></a></p><p>以类似的方式，我还可以将JavaScript代码外部化为标记，因此只需一行即可调用：</p>
<pre><code class="prettyprint xml"><br />&lt;ajax:formPartialRefresh validateUrl=&quot;/userAjaxBootstrap.json&quot; formName=&quot;add-user-form&quot;/&gt;
</code></pre>
<h2>结论</h2><p>我们已经讨论了使用Spring MVC进行表单验证中的部分渲染。在短短的几分钟内，我们就将JSP汤变成了更简单易懂的东西。</p><p>欢迎您<a href="https://github.com/michaelisvy/ajax-samples">在github上</a>查看相应的<a href="https://github.com/michaelisvy/ajax-samples">示例应用程序</a> 。</p><p>致谢：我要感谢我的朋友Nicholas Ding，他与我一起为该博客条目构建代码示例。</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 484;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>