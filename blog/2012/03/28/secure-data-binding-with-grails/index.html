<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Secure Data Binding With Grails</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Secure Data Binding With Grails" />
<meta name="twitter:description" content="&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;The Grails Framework provides a lot of tools and techniques to web application developers to simplify solving common application development challenges.&lt;/p&gt;
&lt;p&gt;Among those are a number of things which simplify the complicated and tedious problems often associated with data binding. In general, data binding is made very simple by Grails as it offers several techniques for binding maps of data to graphs of objects. &lt;/p&gt;
&lt;p&gt;It is important that application developers understand the implications of each of those techniques in order to decide which is most appropriate and most secure for any given use case.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@jeffscottbrown" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/e72a741751057c298657c338b4680b33?s=200" />

<meta property="og:title" content="Secure Data Binding With Grails" />
<meta property="og:image" content="https://gravatar.com/avatar/e72a741751057c298657c338b4680b33?s=200" />
<meta property="og:description" content="&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;The Grails Framework provides a lot of tools and techniques to web application developers to simplify solving common application development challenges.&lt;/p&gt;
&lt;p&gt;Among those are a number of things which simplify the complicated and tedious problems often associated with data binding. In general, data binding is made very simple by Grails as it offers several techniques for binding maps of data to graphs of objects. &lt;/p&gt;
&lt;p&gt;It is important that application developers understand the implications of each of those techniques in order to decide which is most appropriate and most secure for any given use case.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2012-03-28 16:43:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Secure Data Binding With Grails</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/e72a741751057c298657c338b4680b33?s=20&amp;d=mm" />
<span class="author">Jeff Scott Brown</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2012-03-28 16:43:00.0">March 28, 2012</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="466" href="/blog/2012/03/28/secure-data-binding-with-grails#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><h2>Introduction</h2><p>The Grails Framework provides a lot of tools and techniques to web application developers to simplify solving common application development challenges.</p><p>Among those are a number of things which simplify the complicated and tedious problems often associated with data binding. In general, data binding is made very simple by Grails as it offers several techniques for binding maps of data to graphs of objects. </p><p>It is important that application developers understand the implications of each of those techniques in order to decide which is most appropriate and most secure for any given use case.</p>
<h2>Web Application Data Binding Overview</h2><p>A really common task for many web applications is for the application to accept a set of http request parameters and bind those parameters to an object. The object then might be stored in the database, used to perform some kind of calculation or used carry out some kind of application logic. In a Grails application some of that is often carried out in a controller action and the data is often being bound to a domain object.</p><p>Consider a domain class which looks something like this:<br /><h4>Code Listing 1</h4></p>
<pre><code class="prettyprint groovy">class Employee {
    String firstName
    String lastName
    BigDecimal salary
}
</code></pre><p>There might be a form in the application which allows for updating the firstName and lastName properties. That form might not allow for updating the salary property, which might be updated only by some other part of the application.</p><p>A controller action for updating a particular employee might look something like this:<br /><h4>Code Listing 2</h4></p>
<pre><code class="prettyprint groovy">class EmployeeController {
    def updateEmployee() {
        // retrieve the employee from the database
        def employee = Employee.get(params.id)

        // update properties in the employee
        employee.firstName = params.firstName
        employee.lastName = params.lastName

        // update the database
        employee.save()
    }
}
</code></pre><p>Grails can simplify that by allowing something like this:</p>
<h4>Code Listing 3</h4>
<pre><code class="prettyprint groovy">class EmployeeController {
    def updateEmployee() {
        // retrieve the employee from the database
        def employee = Employee.get(params.id)

        // update properties in the employee
        employee.properties = params

        // update the database
        employee.save()
    }
}
</code></pre><p>Each of these examples assumes that there are request parameters named firstName and lastName. In the first example we have a line of code for every property which needs to be updated but in the second example we have just 1 line of code which accounts for all of the properties which need to be updated. </p><p>In this particular example we only eliminated 1 line of code but if there were a lot of properties to update in the Employee object the first example would get longer and more tedious while the second example would stay exactly the same.</p>
<h2>A Potential Problem</h2><p>Code Listing 3 is cleaner and requires less maintenance than Code Listing 2 but it may or may not be the best thing to do for any particular use case.</p><p>A problem with the more simple approach is it may allow a user to update properties that the application developer did not intend to allow.</p><p>For example, if there were a request parameter named salary, the code in Code Listing 2 would ignore that request parameter but the code in Code Listing 3 would use the value of that parameter to update the salary property in the Employee object, which might be problematic.</p><p>There are several techniques that the application code might use to defend against something like that. One is to use the approach shown in Code Listing 2. Another is to provide a white list or a black list of property names to Grails when asking for the data binding to be done.</p><p>One way to provide a white list is shown here:</p>
<h4>Code Listing 4</h4>
<pre><code class="prettyprint groovy">class EmployeeController {
    def updateEmployee() {
        // retrieve the employee from the database
        def employee = Employee.get(params.id)

        // update the firstName and lastName properties in the employee
        employee.properties[&#39;firstName&#39;, &#39;lastName&#39;] = params

        // update the database
        employee.save()
    }
}
</code></pre><p>The code in Code Listing 4 will bind only the firstName and lastName request parameters to the employee object, ignoring all other request parameters. If there is a request parameter named salary, it will not cause the salary property in the employee object to be updated.</p><p>Another technique is to use the bindData method which is added to all Grails controllers. The bindData method allows for a white list and/or a black list of property names to be supplied:</p>
<h4>Code Listing 5</h4>
<pre><code class="prettyprint groovy">class EmployeeController {
    def updateEmployee() {
        // retrieve the employee from the database
        def employee = Employee.get(params.id)

        // update the firstName and lastName properties in the employee
        bindData(employee, params, [include: [&#39;firstName&#39;, &#39;lastName&#39;]])

        // or... bindData(employee, params, [exclude: [&#39;salary&#39;]])

        // update the database
        employee.save()
    }
}
</code></pre>
<h2>Data Binding And Dependency Injection</h2><p>The potential problem described above could cause problems for an application in a number of ways. One is something like allowing an employee&rsquo;s salary property to be updated in a part of the application that wasn&rsquo;t intended to allow that. Another way that the problem might come up is if data binding is carried out on an object which has any properties which were injected into the object from the Spring application context.</p><p>Consider code like this:<br /><h4>Code Listing 6</h4></p>
<pre><code class="prettyprint groovy">class TaxCalculator {
    def taxRate

    def calculateTax(baseAmount) {
        baseAmount * taxRate
    }
}

class InvoiceHelper {
    def taxCalculator

    def calculateInvoice(...) {
        // do something with the parameters that involves invoking
        // taxCalculator.calculateTax(...) to generate some total
    }
}
</code></pre><p>Consider that an instance of TaxCalculator is configured in the Spring application context along with an instance of InvoiceHelper. The TaxCalculator instance is auto-wired into the InvoiceHelper instance.</p><p>Now consider a Grails domain class like this:<br /><h3>Code Listing 7</h3></p>
<pre><code class="prettyprint groovy">class Vendor {
    def invoiceHelper
    String vendorName

    // ...
}
</code></pre><p>A Grails controller might do something like this to update a Vendor currently persisted in the database:<br /><h4>Code Listing 8</h4></p>
<pre><code class="prettyprint groovy">class VendorController {
    def updateVendor = {
        // retrieve the vendor from the database
        def vendor = Vendor.get(params.id)

        // update properties in the vendor
        vendor.properties = params

        // update the database
        vendor.save()
    }
}
</code></pre><p>A potential problem with this is that it might inadvertently allow the taxRate property in the TaxCalculator instance which is in the Spring application context to be updated. </p><p>If there were a request parameter named invoiceHelper.taxCalculator.taxRate, that is exactly what would happen when &ldquo;vendor.properties = params&rdquo; is executed. Depending on some other details in the application, that might cause unexpected and problematic behavior of the application.</p><p>In Grails 2.0.2 that would not be a problem because the invoiceHelper property in the Vendor class is dynamically typed and as discussed below, dynamically typed properties are not bindable unless they are explicitly included in a white list. If the invoiceHelper property were statically typed, then it would be subject to data binding.</p><p>Prior to Grails 2.0.2 the code in Coding Listing 8 is problematic but can easily be dealt with using the white list or black list techniques described above.</p><p>Another version of the same problem comes up when using a data binding constructor:<br /><h4>Code Listing 9</h4></p>
<pre><code class="prettyprint groovy">class VendorController {
    def createVendor = {
        // create a new Vendor
        def vendor = new Vendor(params)

        // save to the database
        vendor.save()
    }
}
</code></pre><p>Prior to Grails 2.0.2 and Grails 1.3.8 what happens when &ldquo;new Vendor(params)&rdquo; is executed is the Vendor object is created, then dependency injection is carried out agains the Vendor instance, then data binding is carried out binding params to the instance. </p><p>Because of the order of events there, if params includes a request parameter named &ldquo;invoiceHelper.taxCalculator.taxRate&rdquo; then this code is subject to the same problem described above. </p><p>In Grails 2.0.2 and Grails 1.3.8 the order of events is changed so the Vendor object is created, then data binding is carried out agains the instance, then dependency injection is carried out. </p><p>With that sequence of events there is no danger of the data binding mutating properties in Spring beans because the Spring beans are not injected until after the data binding happens.</p><p>For versions of Grails prior to Grails 2.0.2 and Grails 1.3.8, a simple approach to manage this problem is something like this:<br /><h4>Code Listing 10</h4></p>
<pre><code class="prettyprint groovy">class VendorController {
    def createVendor = {
        // create a new Vendor
        def vendor = new Vendor()

        vendor.properties[&#39;vendorName&#39;] = params

        // or... bindData(vendor, params, [include: [&#39;vendorName&#39;]])
        // or... bindData(vendor, params, [exclude: [&#39;invoiceHelper&#39;]])

        // save to the database
        vendor.save()
    }
}
</code></pre><p>This is not problematic for every domain class but is potentially problematic for domain classes that have Spring beans auto-wired into them. Incidentally, the same set of issues applies to Grails command objects, which are also subject to data binding and automatic dependency injection.</p>
<h2>Grails 2.0.2 Data Binding Improvements</h2><p>Those techniques have all been supported by Grails for a long time. Grails 2.0.2 will include even more flexibility for managing data binding. In Grails 2.0.2 the code in Code Listings 4 and 5 will behave exactly the same as it did in previous versions. When a white list or a black list is supplied, it will be respected.</p><p>However, when a white list or a black list is not supplied, as in &ldquo;employee.properties = params&rdquo;, Grails 2.0.2 may behave differently, depending on some details in<br />the Employee class.</p><p>In Grails 2.0.2 the data binding mechanism will by default exclude all properties which are static, transient or dynamically typed. For more fine grained control over what is by default bindable and what is not, Grails 2.0.2 supports a new bindable constraint:<br /><h4>Code Listing 11</h4></p>
<pre><code class="prettyprint groovy">class Employee {
    String firstName
    String lastName
    BigDecimal salary

    static constraints = {
        salary bindable: false
    }
}
</code></pre><p>Code Listing 11 shows how to express that the salary property is not bindable by default. This means when an application does something like &ldquo;employee.properties = params&rdquo;, the salary property will not be subject to data binding. </p><p>If the property is ever explicitly included in a white list like &ldquo;employee.properties[&lsquo;firstName&rsquo;, &lsquo;lastName&rsquo;, &lsquo;salary&rsquo;] = params&rdquo;, then it will be subject to data binding.</p>
<h2>Conclusion</h2><p>The data binding mechanisms provided by Grails allow for clean expressive code to be written without being cluttered with a lot of tedious data binding related details. It is important for application developers to understand the implications of using those techniques so the best approach for any particular use case can be implemented.<br /><h3>References</h3><br /><ul><br /> <li><a href="http://grails.org/doc/2.0.2/">Grails 2.0.2 User Guide</a></li><br /> <li><a href="http://grails.org/doc/2.0.2/guide/theWebLayer.html#dataBinding">Data Binding Documentation</a></li><br /> <li><a href="http://grails.org/doc/2.0.2/ref/Constraints/bindable.html">bindable Constraint Documentation</a></li><br /></ul></p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 466;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>