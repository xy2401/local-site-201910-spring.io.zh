<html dir="ltr" data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>铋反应堆出炉了</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>System.config({baseURL: "/b92013b"});</script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>System.import('app/main.js')</script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Reactor Bismuth is out">
<meta name="twitter:description" content="<div class=" paragrap="="> 
 </head><body dir="ltr"><p>It is my great pleasure to announce the GA release of <strong>Reactor Bismuth</strong>, which notably encompasses <code>reactor-core</code> <strong>3.1.0.RELEASE</strong> and <code>reactor-netty</code> <strong>0.7.0.RELEASE</strong> 🎉</p> 

<div class="paragraph"> 
 <p>With the release of <a href="https://spring.io/blog/2017/09/28/spring-framework-5-0-goes-ga">Spring Framework 5.0</a> now just happening, you can imagine this is a giant step for Project Reactor :)</p> 
</div>
<div class="imageblock"> 
 <div class="content"> 
  <img src="https://farm2.staticflickr.com/1434/5109110719_6f10365d85_m_d.jpg" alt="铋晶体" width="300" height="200"> 
 </div> 
 <div class="title">
  <em>Like the bismuth crystal this release is intricate</em>
 </div> 
</div>
<div class="paragraph"> 
 <p> <br> The release contains a lot of changes and API polishing. For reactor-core you can find the exhaustive list in the <a href="https://github.com/reactor/reactor-core/releases/tag/v3.1.0.RELEASE">release notes</a>.</p> 
</div>
<div class="admonitionblock important"> 
 <table> 
  <tbody>
   <tr> 
    <td class="icon"> 
     <div class="title">
      Important
     </div> </td> 
    <td class="content"> There is a <strong>known (minor) issue</strong> with the <code>reactor-core</code> and <code>reactor-test</code> <strong>sources</strong> jars: They contain duplicate java source entries. See issue <a href="https://github.com/reactor/reactor-core/issues/887">#887</a> for more details. </td> 
   </tr> 
  </tbody>
 </table> 
</div>
">
<meta name="twitter:creator" content="@simonbasle">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/056097e00486bcdf172708607f194b1e?s=200">

<meta property="og:title" content="Reactor Bismuth is out">
<meta property="og:image" content="https://gravatar.com/avatar/056097e00486bcdf172708607f194b1e?s=200">
<meta property="og:description" content="<div class=" paragrap="="> 
 <p>It is my great pleasure to announce the GA release of <strong>Reactor Bismuth</strong>, which notably encompasses <code>reactor-core</code> <strong>3.1.0.RELEASE</strong> and <code>reactor-netty</code> <strong>0.7.0.RELEASE</strong> 🎉</p> 

<div class="paragraph"> 
 <p>With the release of <a href="https://spring.io/blog/2017/09/28/spring-framework-5-0-goes-ga">Spring Framework 5.0</a> now just happening, you can imagine this is a giant step for Project Reactor :)</p> 
</div>
<div class="imageblock"> 
 <div class="content"> 
  <img src="https://farm2.staticflickr.com/1434/5109110719_6f10365d85_m_d.jpg" alt="铋晶体" width="300" height="200"> 
 </div> 
 <div class="title">
  <em>Like the bismuth crystal this release is intricate</em>
 </div> 
</div>
<div class="paragraph"> 
 <p> <br> The release contains a lot of changes and API polishing. For reactor-core you can find the exhaustive list in the <a href="https://github.com/reactor/reactor-core/releases/tag/v3.1.0.RELEASE">release notes</a>.</p> 
</div>
<div class="admonitionblock important"> 
 <table> 
  <tbody>
   <tr> 
    <td class="icon"> 
     <div class="title">
      Important
     </div> </td> 
    <td class="content"> There is a <strong>known (minor) issue</strong> with the <code>reactor-core</code> and <code>reactor-test</code> <strong>sources</strong> jars: They contain duplicate java source entries. See issue <a href="https://github.com/reactor/reactor-core/issues/887">#887</a> for more details. </td> 
   </tr> 
  </tbody>
 </table> 
</div>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2017-09-28 15:08:20.37">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">// Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }</script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category content--title">
<div>工程</div>
</div>
<div class="blog-category active content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">铋反应堆出炉了</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon releases"></div>
<a class="category">发布</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/056097e00486bcdf172708607f194b1e?s=20&d=mm"> <a class="author" rel="author" href="/team/simonbasle">西蒙·巴斯莱（SimonBaslé）</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2017-09-28 15:08:20.37">九月28，2017</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2017/09/28/reactor-bismuth-is-out#disqus_thread" data-disqus-identifier="3046">
</a></div>
</div>
</header>
<div class="blog--post"><div class="paragraph">
<p>我非常高兴地宣布，GA释放了<strong>Reactor Bismuth</strong> ，该<strong>反应堆</strong>特别包含了<strong>Reactor</strong> <code>reactor-core</code> <strong>3.1.0。发布</strong>和<code>reactor-netty</code> <strong>0.7.0。RELEASE🎉</strong></p>
</div>
<div class="paragraph">
<p>随着<a href="https://spring.io/blog/2017/09/28/spring-framework-5-0-goes-ga">Spring Framework 5.0</a>的发布刚刚开始，您可以想象这对Project Reactor来说是巨大的一步：)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://farm2.staticflickr.com/1434/5109110719_6f10365d85_m_d.jpg" alt="铋晶体" width="300" height="200">
</div>
<div class="title"><em>像铋晶体一样，这种释放是复杂的</em></div>
</div>
<div class="paragraph">
<p> <br>该版本包含许多更改和API改进。对于反应堆堆芯，您可以在<a href="https://github.com/reactor/reactor-core/releases/tag/v3.1.0.RELEASE">发行说明中</a>找到详尽的清单。</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title">重要</div>
</td>
<td class="content"><code>reactor-core</code>和<code>reactor-test</code> <strong>源</strong> jar存在一个<strong>（较小的）问题</strong> ：它们包含重复的Java源条目。有关更多详细信息，请参见问题<a href="https://github.com/reactor/reactor-core/issues/887">＃887</a> 。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>让我们概述一下此版本中的新功能和值得注意的功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#api">API最终抛光</a></p>
</li>
<li>
<p><a href="#moved">反应堆测试和Kotlin扩展已移动</a></p>
</li>
<li>
<p><a href="#kotlin-null-safety">Kotlin和零安全支持</a></p>
</li>
<li>
<p><a href="#docs">文档抛光</a></p>
</li>
<li>
<p>此版本中的主要新功能： <a href="#context"><code>Context</code></a></p>
</li>
<li>
<p><a href="#other-new">其他有趣的新功能</a></p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="api"><a class="anchor" href="#api"></a> API最终抛光</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在3.0.x周期的最新版本和3.1.0之间进行了许多API更改。我们希望长期使用Spring Framework 5获得最佳的API，因此这些重大更改是必要的。发行说明包含此类更改的更详尽列表，但让我们看一下其中的一些更改。</p>
</div>
<div class="sect2">
<h3 id="error-handling-operators"><a class="anchor" href="#error-handling-operators"></a>错误处理运算符</h3>
<div class="paragraph">
<p>在<code>Flux</code>和<code>Mono</code>使错误处理运算符更加一致。全部使用<code>onError</code>前缀，并且两个类中的API均对齐：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>onErrorReturn</strong>切换到回退值（以前为<code>otherwiseReturn</code>返回Mono）</p>
</li>
<li>
<p><strong>onErrorResume</strong>切换到后备<code>Publisher</code> （原<code>onErrorResumeWith</code>在通量和<code>otherwise</code>在单声道）</p>
</li>
<li>
<p><strong>onErrorMap</strong>将<code>Exception</code>转换为另一个<code>Exception</code> （以前在Flux和Mono中都是<code>mapError</code> ）</p>
</li>
<li>
<p><strong>switchIfEmpty</strong>切换到回退序列如果源是空的（原<code>otherwiseIfEmpty</code>在<code>Mono</code> ）</p>
</li>
<li>
<p><code>Flux#switchOnError</code>已被删除，使用<code>onErrorResume</code>使用忽略其参数的lambda可以实现相同的效果。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="alignment-between-code-flux-code-and-code-mono-code-concepts-and-operators"><a class="anchor" href="#alignment-between-code-flux-code-and-code-mono-code-concepts-and-operators"></a> <code>Flux</code>和<code>Mono</code>概念与运算符之间的对齐</h3>
<div class="paragraph">
<p>尽管有类似的概念， <code>Mono</code> API有时还是会偏离<code>Flux</code> API。在合理的地方，这些分隔已得到修复。</p>
</div>
<div class="sect3">
<h4 id="alignment-of-code-when-code-code-and-code-code-zip-code-and-code-zipwith-code"><a class="anchor" href="#alignment-of-code-when-code-code-and-code-code-zip-code-and-code-zipwith-code"></a> <code>when</code> ， <code>and</code> ， <code>zip</code>和<code>zipWith</code></h4>
<div class="paragraph">
<p>例如， <code>Mono</code>有一个<code>and</code>运算符，而<code>when</code>静态方法<strong>用于组合元素并生成<code>Mono<Tuple2></code></strong> 。本质上，它们本质上是<code>zipWith</code>和<code>Flux</code> <code>zip</code>的专业化，但是名称不同使附加概念变得困难。这就是为什么这些方法已在<code>Mono</code>重命名的原因。</p>
</div>
<div class="paragraph">
<p>另一方面，您会注意到<code>Mono</code> API中仍然存在不同的<code>when</code>和<code>and</code>风格。与我们之前看到的相反，这些返回一个<code>Mono<Void></code> 。处理任务的完成是<code>Mono</code>的基本用例，并且这些方法现在专门针对此类应用程序量身定制：它们将合并并执行多个任务（表示为源Monos），忽略其潜在的<code>onNext</code>信号，仅传播该组合<code>onComplete</code>信号，产生<code>Mono<Void></code> N个任务完成时，该操作即完成。</p>
</div>
</div>
<div class="sect3">
<h4 id="consistent-semantic-of-the-code-then-code-prefix"><a class="anchor" href="#consistent-semantic-of-the-code-then-code-prefix"></a>一致语义的<code>then</code>前缀</h4>
<div class="paragraph">
<p>类似地， <code>then</code>前缀现在始终表示将丢弃源的<code>onNext</code> ，而是建立在终端信号上。这已在<code>Flux</code>和<code>Mono</code>保持一致：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>then()</code>返回一个<code>Mono<Void></code>仅从源传播<code>onComplete</code>或<code>onError</code>信号。</p>
</li>
<li>
<p><code>then(Mono<V>)</code>返回一个<code>Mono<V></code> ：等待原始<code>onComplete</code>切换到另一提供前信号<code>Mono</code> ，发光只从其它元素<code>Mono</code> 。</p>
</li>
<li>
<p><code>thenMany(Publisher<V>)</code>相似，除了它继续进入<code>Flux<V></code> 。</p>
</li>
<li>
<p><code>thenEmpty(Publisher<Void>)</code>返回一个<code>Mono<Void></code>一旦完成原<code>Mono</code> <em>，则</em> <code>Publisher</code>已经完成。也就是说，它代表顺序完成，这与<code>and</code>立即订阅两个序列不同。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意，已经完全删除了采用<code>Supplier</code>参数的变体（它们的惰性语义可以由<code>Mono.defer</code> ）。另外，上述的<code>Mono#thenEmpty</code>从<code>then(Publisher<Void>)</code>重命名。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-one-code-then-code-was-really-a-code-flatmap-code"><a class="anchor" href="#how-one-code-then-code-was-really-a-code-flatmap-code"></a>如何一<code>then</code>的确是一个<code>flatMap</code></h4>
<div class="paragraph">
<p><code>Mono</code>曾经有另一个有趣<code>then</code>变种：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Mono<V> then(Function<T, Mono<V>> thenFunction);</code></pre>
</div>
</div>
<div class="paragraph">
<p>当仔细观察时，这与<code>then*</code>关注终端信号的新语义不符。相反，它将<em>根据源的</em> <code>onNext</code>将源转换为另一个<code>Mono</code> 。听起来很熟悉？这确实与<code>Flux#flatMap</code>功能一致！</p>
</div>
<div class="paragraph">
<p>但是，有一个问题： <code>Mono</code>已经有一个<code>flatMap</code>运算符：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Flux<V> flatMap(Function<T, Publisher<V>> mapper);</code></pre>
</div>
</div>
<div class="paragraph">
<p>经过仔细考虑之后，我们认识到<code>flatMap</code>的经典语义是返回与应用<code>flatMap</code>相同类型的值。因此让<code>Mono#flatMap</code>返回<code>Mono</code>更为正确。</p>
</div>
<div class="paragraph">
<p>结果，我们将此变量重命名为<code>flatMap</code>并在变量后缀中使用<code>Many</code>后缀，该后缀将返回<code>Flux</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Mono<V> flatMap(Function<T, Mono<V>> mapper);
Flux<V> flatMapMany(Function<T, Publisher<V>> mapper);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">小费</div>
</td>
<td class="content">为了简化迁移，我们建议您搜索旧版<code>Mono.flatMap</code>所有用法，并<code>Mono.flatMap</code>其替换为<code>flatMapMany</code> 。然后搜索<code>then(Function)</code>用法并将其替换为<code>flatMap</code> 。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="various-api-simplifications"><a class="anchor" href="#various-api-simplifications"></a>各种API简化</h3>
<div class="paragraph">
<p><strong>时间</strong> ：在此版本中，所有的处理时间的运营商这样做只通过<code>Duration</code>型。多数情况下，带有<code>*Millis</code>后缀的变体使用一个<code>long</code>和一个<code>TimeUnit</code>来表示持续时间。这些变体已在3.1.0中删除。</p>
</div>
<div class="paragraph">
<p><strong>错误延迟</strong> ：另一个处理后缀的跨领域变更：一些运算符具有可选的配置，在这些配置中，他们可以组合多个错误并在最后发出<code>onError</code>信号，允许某些值仍使其在结果序列中出现。例如，如果内部序列发出<code>onError</code> ， <code>flatMap</code>可以立即停止，也可以在传播该错误之前继续合并其他内部序列中的元素。</p>
</div>
<div class="paragraph">
<p>在某些情况下，该可选行为在API中表示为<code>boolean</code>标志参数。在其他情况下，它是一个后缀为<code>DelayError</code>的单独变体。在3.1.0中，所有这些变体都进行了对齐，以一致地使用<code>*DelayError</code>后缀而不是boolean标志。</p>
</div>
<div class="paragraph">
<p><strong>简化的接口</strong> ：一些专门的接口也已被删除，以便使用更简单或更通用的替代方法：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Cancellation</code>接口已被删除，转而使用更通用的“ <code>Disposable</code>接口。</p>
</li>
<li>
<p><code>TimedScheduler</code>界面已被删除。少数几个没有时间能力的<code>Scheduler</code>会抛出<code>RejectedExecutionException</code>表明每当有人尝试在其上使用<code>schedulePeriodically</code> 。另外，已从<code>Scheduler#shutdown</code>中删除了Disposable，以支持<code>dispose()</code> 。</p>
</li>
<li>
<p>用于自省的多个接口已简化为单个<code>Scannable</code>接口，该接口通过操作员的<code>scan(Scannable.Attr)</code></p><code>scan(Scannable.Attr)</code></li><code>scan(Scannable.Attr)</code></ul><code>scan(Scannable.Attr)</code></div><code>scan(Scannable.Attr)</code></div><code>scan(Scannable.Attr)</code></div><code>scan(Scannable.Attr)</code></div><code>scan(Scannable.Attr)</code></div><code>scan(Scannable.Attr)</code></div><code>scan(Scannable.Attr)</code></article><code>scan(Scannable.Attr)</code></div><code>scan(Scannable.Attr)</code></div><code>scan(Scannable.Attr)</code></div><code>scan(Scannable.Attr)</code></div><code>scan(Scannable.Attr)</code></body></html>