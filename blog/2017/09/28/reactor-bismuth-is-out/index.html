<html  data-code-prettify="" data-mobile-support="" data-search=""><head></head><body >﻿
<title>铋反应堆出炉了</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Reactor Bismuth is out">
<meta name="twitter:description" >
<meta name="twitter:creator" content="@simonbasle">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/056097e00486bcdf172708607f194b1e?s=200">

<meta property="og:title" content="Reactor Bismuth is out">
<meta property="og:image" content="https://gravatar.com/avatar/056097e00486bcdf172708607f194b1e?s=200">
<meta property="og:description" >
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2017-09-28 15:08:20.37">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category content--title">
<div>工程</div>
</div>
<div class="blog-category active content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">铋反应堆出炉了</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon releases"></div>
<a class="category">发布</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/056097e00486bcdf172708607f194b1e?s=20&d=mm"> <a class="author" rel="author" href="/team/simonbasle">西蒙·巴斯莱（SimonBaslé）</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2017-09-28 15:08:20.37">九月28，2017</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2017/09/28/reactor-bismuth-is-out#disqus_thread" data-disqus-identifier="3046">
</a></div>
</div>
</header>
<div class="blog--post"><div class="paragraph">
<p>我很高兴宣布GA释放<strong>反应堆铋</strong> ，其中包括<code>reactor-core</code> <strong>3.1.0。发布</strong>和<code>reactor-netty</code> <strong>0.7.0。RELEASE🎉</strong></p>
</div>
<div class="paragraph">
<p>随着<a href="https://spring.io/blog/2017/09/28/spring-framework-5-0-goes-ga">Spring Framework 5.0</a>的发布刚刚开始，您可以想象这对Project Reactor来说是巨大的一步：)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://farm2.staticflickr.com/1434/5109110719_6f10365d85_m_d.jpg" alt="铋晶体" width="300" height="200">
</div>
<div class="title"><em>像铋晶体一样，这种释放是复杂的</em></div>
</div>
<div class="paragraph">
<p> <br>该版本包含许多更改和API改进。对于反应堆堆芯，您可以在<a href="https://github.com/reactor/reactor-core/releases/tag/v3.1.0.RELEASE">发行说明中</a>找到详尽的清单。</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<div class="title">重要</div>
</td>
<td class="content">存在一个<strong>已知（次要）问题</strong> <code>reactor-core</code>和<code>reactor-test</code> <strong>源</strong> jar：它们包含重复的Java源条目。有关更多详细信息，请参见问题<a href="https://github.com/reactor/reactor-core/issues/887">＃887</a> 。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>让我们概述一下此版本中的新功能和值得注意的功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#api">API最终抛光</a></p>
</li>
<li>
<p><a href="#moved">反应堆测试和Kotlin扩展已移动</a></p>
</li>
<li>
<p><a href="#kotlin-null-safety">Kotlin和Null-safety支持</a></p>
</li>
<li>
<p><a href="#docs">文档抛光</a></p>
</li>
<li>
<p>在这个版本的主要新功能： <a href="#context">在<code>Context</code></a></p>
</li>
<li>
<p><a href="#other-new">其他有趣的新功能</a></p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="api"><a class="anchor" href="#api"></a> API最终抛光</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在3.0.x周期的最新版本和3.1.0之间进行了许多API更改。我们希望长期使用Spring Framework 5获得最佳的API，因此这些重大更改是必要的。发行说明包含此类更改的更详尽列表，但让我们看一下其中的一些更改。</p>
</div>
<div class="sect2">
<h3 id="error-handling-operators"><a class="anchor" href="#error-handling-operators"></a>错误处理运算符</h3>
<div class="paragraph">
<p>错误处理运算符在两个方面都变得更加一致<code>Flux</code>和<code>Mono</code> 。全部使用<code>onError</code>前缀和API在两个类中都对齐：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>onErrorReturn</strong>切换为回退值（以前<code>otherwiseReturn</code>在单声道中）</p>
</li>
<li>
<p><strong>onErrorResume</strong>切换到后备<code>Publisher</code> （以前<code>onErrorResumeWith</code>在助焊剂中<code>otherwise</code>在单声道中）</p>
</li>
<li>
<p><strong>onErrorMap</strong>来翻译<code>Exception</code>变成另一个（以前<code>mapError</code>在通量和单声道中）</p>
</li>
<li>
<p>如果源为空（以前为<strong>switchIfEmpty</strong> ，则切换到回退序列） <code>otherwiseIfEmpty</code>在<code>Mono</code> ）</p>
</li>
<li>
<p><code>Flux#switchOnError</code>已被删除，同样可以实现<code>onErrorResume</code>使用忽略其参数的lambda。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="alignment-between-code-flux-code-and-code-mono-code-concepts-and-operators"><a class="anchor" href="#alignment-between-code-flux-code-and-code-mono-code-concepts-and-operators"></a>之间的对齐<code>Flux</code>和<code>Mono</code>概念和运算符</h3>
<div class="paragraph">
<p><code>Mono</code> API有时会偏离<code>Flux</code>尽管有相似的概念，API。在合理的地方，这些分隔已得到修复。</p>
</div>
<div class="sect3">
<h4 id="alignment-of-code-when-code-code-and-code-code-zip-code-and-code-zipwith-code"><a class="anchor" href="#alignment-of-code-when-code-code-and-code-code-zip-code-and-code-zipwith-code"></a>对齐<code>when</code> ， <code>and</code> ， <code>zip</code>和<code>zipWith</code></h4>
<div class="paragraph">
<p>例如， <code>Mono</code>有一个<code>and</code>运算符和<code>when</code> <strong>用于组合元素并产生的</strong>静态方法<strong><code>Mono<Tuple2></code></strong> 。从本质上讲，它们本质上是<code>zipWith</code>和<code>zip</code>在<code>Flux</code> ，但名称不同，因此很难附加这些概念。这就是为什么这些方法在<code>Mono</code> 。</p>
</div>
<div class="paragraph">
<p>另一方面，您会注意到， <code>when</code>和<code>and</code>仍然存在于<code>Mono</code> API。与我们先前看到的相反，这些返回一个<code>Mono<Void></code> 。处理任务的完成是<code>Mono</code> ，并且这些方法现在专门针对此类应用程序量身定制：它们将合并并执行多个任务（表示为源Monos），而忽略了它们的潜力<code>onNext</code>信号，仅传播<code>onComplete</code>信号，导致<code>Mono<Void></code> N个任务完成时，该操作即完成。</p>
</div>
</div>
<div class="sect3">
<h4 id="consistent-semantic-of-the-code-then-code-prefix"><a class="anchor" href="#consistent-semantic-of-the-code-then-code-prefix"></a>一致的语义<code>then</code>字首</h4>
<div class="paragraph">
<p>同样， <code>then</code>现在，前缀始终表示<code>onNext</code>源的信号将被丢弃，而是建立在终端信号上。这已经使两者一致<code>Flux</code>和<code>Mono</code> ：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>then()</code>返回一个<code>Mono<Void></code>只会传播<code>onComplete</code>要么<code>onError</code>来自信号源的信号。</p>
</li>
<li>
<p><code>then(Mono<V>)</code>返回一个<code>Mono<V></code> ：等待原始<code>onComplete</code>切换到另一个提供的信号之前<code>Mono</code> ，仅散发出其他元素<code>Mono</code> 。</p>
</li>
<li>
<p><code>thenMany(Publisher<V>)</code>相似，除了它继续进入<code>Flux<V></code> 。</p>
</li>
<li>
<p><code>thenEmpty(Publisher<Void>)</code>返回一个<code>Mono<Void></code>一旦原始完成<code>Mono</code> <em>然后</em> <code>Publisher</code>已经完成。也就是说，它代表顺序完成，与<code>and</code>立即订阅两个序列。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意，采用<code>Supplier</code>参数已完全删除（它们的惰性语义可以替换为<code>Mono.defer</code> ）。另外， <code>Mono#thenEmpty</code>上述内容改名为<code>then(Publisher<Void>)</code> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="how-one-code-then-code-was-really-a-code-flatmap-code"><a class="anchor" href="#how-one-code-then-code-was-really-a-code-flatmap-code"></a>怎么一个<code>then</code>真的是一个<code>flatMap</code></h4>
<div class="paragraph">
<p><code>Mono</code>曾经有另一个有趣的地方<code>then</code>变体：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Mono&lt;V&gt; then(Function&lt;T, Mono&lt;V&gt;&gt; thenFunction);</code></pre>
</div>
</div>
<div class="paragraph">
<p>当仔细观察时，这不符合的新语义<code>then*</code>关注终端信号。而是，它将源转换为另一个<code>Mono</code> <em>取决于来源</em> <code>onNext</code> 。听起来很熟悉？这确实与<code>Flux#flatMap</code>做！</p>
</div>
<div class="paragraph">
<p>但是，有一个问题： <code>Mono</code>已经有一个<code>flatMap</code>操作员：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Flux&lt;V&gt; flatMap(Function&lt;T, Publisher&lt;V&gt;&gt; mapper);</code></pre>
</div>
</div>
<div class="paragraph">
<p>经过更多思考之后，我们认识到<code>flatMap</code>是要返回与该类型相同类型的值<code>flatMap</code>适用于。所以拥有它更正确<code>Mono#flatMap</code>返回一个<code>Mono</code> ......</p>
</div>
<div class="paragraph">
<p>结果，我们将此名称重命名为<code>flatMap</code>我们使用了<code>Many</code>后缀的后缀会返回一个<code>Flux</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Mono&lt;V&gt; flatMap(Function&lt;T, Mono&lt;V&gt;&gt; mapper);
Flux&lt;V&gt; flatMapMany(Function&lt;T, Publisher&lt;V&gt;&gt; mapper);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">小费</div>
</td>
<td class="content">为了简化迁移，建议您搜索旧版本的所有用法<code>Mono.flatMap</code>并替换为<code>flatMapMany</code>第一。然后搜寻<code>then(Function)</code>使用并替换为<code>flatMap</code> 。
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="various-api-simplifications"><a class="anchor" href="#various-api-simplifications"></a>各种API简化</h3>
<div class="paragraph">
<p><strong>时间</strong> ：在此版本中，所有处理时间的操作员都专门通过<code>Duration</code>类型。最常用的是<code>*Millis</code>后缀使用<code>long</code>和一个<code>TimeUnit</code>代表持续时间。这些变体已在3.1.0中删除。</p>
</div>
<div class="paragraph">
<p><strong>延迟错误</strong> ：处理后缀的另一个跨领域变更：某些操作员具有可选配置，在其中可以合并多个错误并发出错误。 <code>onError</code>在最后发出信号，允许一些值仍使其在结果序列中。例如， <code>flatMap</code>如果发出内部序列，可以立即停止<code>onError</code>或在传播该错误之前继续合并其他内部序列中的元素。</p>
</div>
<div class="paragraph">
<p>在某些情况下，该可选行为在API中表示为<code>boolean</code>标志参数。在其他情况下，它是一个单独的变体，后缀为<code>DelayError</code> 。在3.1.0中，所有这些变体都经过调整以一致地使用<code>*DelayError</code>后缀而不是布尔标志。</p>
</div>
<div class="paragraph">
<p><strong>简化的接口</strong> ：一些专门的接口也已被删除，以便使用更简单或更通用的替代方法：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>的<code>Cancellation</code>接口已被删除，以支持更通用<code>Disposable</code>一。</p>
</li>
<li>
<p>的<code>TimedScheduler</code>界面已被删除。少数<code>Scheduler</code>没有时间的人会抛出一个<code>RejectedExecutionException</code>表示每次尝试使用<code>schedulePeriodically</code>在他们。也， <code>Scheduler#shutdown</code>已被删除以支持<code>dispose()</code>来自一次性。</p>
</li>
<li>
<p>用于自省的多个接口已简化为单个<code>Scannable</code>接口，通过操作员接口以尽力而为的方式公开有关操作员当前状态的信息<code>scan(Scannable.Attr)</code>方法。</p>
</li>
<li>
<p><code>QueueSupplier</code>已重命名为<code>Queues</code>并且现在纯粹是一个实用程序类（而不是<code>Supplier</code>不再）。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="moved"><a class="anchor" href="#moved"></a>反应堆测试和Kotlin扩展已移动</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kotlin扩展和Reactor Test工件都已直接集成到<code>reactor-core</code> ：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kotlin扩展程序是<code>reactor-core</code>神器。无需依赖<code>io.projectreactor:reactor-kotlin-extensions</code>不再。</p>
</li>
<li>
<p><code>reactor-test</code>现在与<code>reactor-core</code> 。</p>
<div class="ulist">
<ul>
<li>
<p>更换<code>io.projectreactor.addons:reactor-test</code>与<code>io.projectreactor:reactor-test</code> 。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kotlin-null-safety"><a class="anchor" href="#kotlin-null-safety"></a> Kotlin和Null-safety支持</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在此发行周期中，一直在努力与Kotlin之类的语言更好地集成。</p>
</div>
<div class="paragraph">
<p>为了避免使用lambda造成模棱两可的签名，这显然会转换为某些API返工。只要一个方法有两个替代，它们的功能接口类型只是有所不同，我们就会提取其中一个变量作为操作员的新后缀。</p>
</div>
<div class="paragraph">
<p>例如，考虑<code>buffer(Publisher, Supplier)</code>和<code>buffer(Publisher, Function)</code> 。第二个变体已重命名为<code>bufferWhen</code> ，因为<em>当</em>同伴<code>Publisher</code>从那个<code>Function</code>发出。</p>
</div>
<div class="paragraph">
<p>正如我们在上面看到的， <strong>Kotlin扩展</strong>也已直接集成到反应堆堆芯存储库中。</p>
</div>
<div class="paragraph">
<p>此外，通过引入三个注释，对Null-safety分析的支持得到了改进。这些注释建立在JSR 305之上，尽管它处于休眠状态，但仍由包括IntelliJ IDE在内的多个静态分析工具所使用。以下注释在<code>reactor.util.annotation</code>包：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@NonNull</code>表示特定参数，返回值或字段不能为null。（不需要参数和返回值，其中<code>@NonNullApi</code>适用）。</p>
</li>
<li>
<p><code>@Nullable</code>表示参数，返回值或字段可以为null。</p>
</li>
<li>
<p><code>@NonNullApi</code>是程序包级别的注释，它指示非null是参数和返回值的默认行为。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>我们利用这些注释在所有公共Reactor Core API上表达明确且可操作的null安全合同。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="docs"><a class="anchor" href="#docs"></a>文档抛光</h2>
<div class="sectionbody">
<div class="paragraph">
<p>该文档也受到了一些热爱： <a href="http://projectreactor.io/docs/core/release/reference">参考指南</a>最终完成，并且对Javadoc进行了审查和改写，以便更清楚地描述一些方法。</p>
</div>
<div class="paragraph">
<p>由于将Kotlin的支持直接集成到反应堆堆芯中，因此在参考指南中添加了<a href="http://projectreactor.io/docs/core/release/reference/docs/index.html#kotlin">新的部分，</a>并<a href="http://projectreactor.io/docs/core/release/kdoc-api/">发布</a>了KotlinDocs。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="context"><a class="anchor" href="#context"></a>的<code>Context</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>上下文数据现在可以附加到<code>Flux</code>要么<code>Mono</code> ，每个订阅都类似于地图<code>Context</code>宾语！</p>
</div>
<div class="paragraph">
<p>这是一个高级功能，大多数库开发人员都会对此感兴趣，但是我们知道，在迁移以前依赖的功能时，它将被证明具有无价的价值。 <code>ThreadLocal</code>例如命令式代码。</p>
</div>
<div class="paragraph">
<p>在春季投资组合中，我们期望<code>spring-security</code>和<code>spring-cloud-sleuth</code>受益匪浅。</p>
</div>
<div class="paragraph">
<p>为了将信息添加到<code>Context</code> ， 使用<code>subscriberContext(Context)</code>运算符，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Mono&lt;String&gt; put = doPut("www.example.com", Mono.just("Walter"))
    .subscriberContext(Context.of(HTTP_CORRELATION_ID, "2-j3r9afaf92j-afkaf"))
    .filter(t -&gt; t.getT1() &lt; 300)
    .map(Tuple2::getT2);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<div class="title">小费</div>
</td>
<td class="content">的<code>Context</code>是不可变的，并在<em>订阅</em>阶段传播，该阶段从链的末尾开始（ <code>subscribe()</code>通话）。<br>结果，您放入<code>Context</code>通过<code>subscriberContext</code>产生丰富的副本<code>Context</code> <strong>只有上方的操作员才能看到</strong> 。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>为了检索和使用放置在<code>Context</code> ，上游运营商可以利用<code>Mono.subscriberContext()</code> ，实现了可见<code>Context</code> （例如，在<code>flatMap</code> ）。</p>
</div>
<div class="paragraph">
<p>它可能看起来像以下片段：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Mono&lt;Tuple2&lt;String, Optional&lt;Object&gt;&gt;&gt; dataAndContext =
  data.zipWith(Mono.subscriberContext()
                   .map(c -&gt; c.getOrEmpty(HTTP_CORRELATION_ID))
  );</code></pre>
</div>
</div>
<div class="paragraph">
<p>前往<a href="http://projectreactor.io/docs/core/release/reference/docs/index.html#context">参考指南</a>以了解更多信息<code>Context</code> 。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="other-new"><a class="anchor" href="#other-new"></a>其他有趣的新功能</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="added-the-code-expand-code-operator"><a class="anchor" href="#added-the-code-expand-code-operator"></a>添加了<code>expand</code>操作员</h3>
<div class="paragraph">
<p>该运算符可用于<em>将</em>源元素递归<em>扩展</em>为嵌套<code>Publishers</code> ，产生图<code>Publisher</code>深度优先或宽度优先。</p>
</div>
</div>
<div class="sect2">
<h3 id="mapping-code-null-code-provider-to-the-empty-code-mono-code"><a class="anchor" href="#mapping-code-null-code-provider-to-the-empty-code-mono-code"></a>映射<code>null</code>提供者为空<code>Mono</code></h3>
<div class="paragraph">
<p>转换来源时<code>Callable</code>要么<code>Supplier</code>返回<code>null</code>变成一个<code>Mono</code> ， <code>fromCallable</code>和<code>fromSupplier</code>用于发出错误。他们现在容纳<code>null</code>结果并产生一个空的<code>Mono</code>代替。</p>
</div>
</div>
<div class="sect2">
<h3 id="added-ability-to-code-name-code-and-code-tag-code-a-reactive-sequence"><a class="anchor" href="#added-ability-to-code-name-code-and-code-tag-code-a-reactive-sequence"></a>增加的能力<code>name</code>和<code>tag</code>反应序列</h3>
<div class="paragraph">
<p>一个<code>name(String)</code>可以给一个<code>Flux</code> 。可以使用<code>Scannable.name()</code> ，它将操作员链带到上游，直到找到第一个声明的名称。</p>
</div>
<div class="paragraph">
<p>同样，几个<code>tag(String, String)</code>密钥对可以与<code>Flux</code>要么<code>Mono</code> 。这些可以作为<code>Stream<Tuple2<String, String>></code>由<code>Scannable#tags()</code>方法，将整个运营商链带到上游。</p>
</div>
</div>
<div class="sect2">
<h3 id="added-a-code-distinctuntilchanged-code-variant-with-a-code-bipredicate-code"><a class="anchor" href="#added-a-code-distinctuntilchanged-code-variant-with-a-code-bipredicate-code"></a>新增了A <code>distinctUntilChanged</code>带有A的变体<code>BiPredicate</code></h3>
<div class="paragraph">
<p>而不是使用<code>Set</code>评估是否有变化的语义<code>BiPredicate</code>应用于当前源元素和最后发出的元素。如果元素<em>离</em>最后发射的元素<em>太近，</em>则可以跳过这些元素（例如<code>Doubles</code>差异小于1）。</p>
</div>
</div>
<div class="sect2">
<h3 id="added-code-mono-cache-duration-code"><a class="anchor" href="#added-code-mono-cache-duration-code"></a>添加<code>Mono.cache(Duration)</code></h3>
<div class="paragraph">
<p>这样可以轻松地在有限的时间内缓存难以计算的单个值（或错误）。在TTL期限之后进入的第一个订阅者将重新触发对源的订阅。</p>
</div>
</div>
<div class="sect2">
<h3 id="cost-improvement-for-code-checkpoint-string-code"><a class="anchor" href="#cost-improvement-for-code-checkpoint-string-code"></a>成本改善<code>checkpoint(String)</code></h3>
<div class="paragraph">
<p>的<code>checkpoint(String)</code>现在，默认情况下，variant的状态为light，这意味着实例化时不会填充堆栈跟踪信息（使操作员的使用成本降低）。现在我们假设<code>String</code>标识符是唯一的，足以找到错误终止的序列的实例化点。</p>
</div>
</div>
<div class="sect2">
<h3 id="adding-a-grace-period-to-code-refcount-code"><a class="anchor" href="#adding-a-grace-period-to-code-refcount-code"></a>为宽限期添加<code>refCount</code></h3>
<div class="paragraph">
<p>使用时<code>refCount</code> ，现在可以提供一个<code>Duration</code> 。当参考计数序列的订户数量低于阈值时，操作员将等待该持续时间，而不是立即从源退订。如果有足够的订户在此宽限期内返回，则不会发生取消。</p>
</div>
</div>
<div class="sect2">
<h3 id="mono-code-delayuntil-code-replaces-code-untilother-code"><a class="anchor" href="#mono-code-delayuntil-code-replaces-code-untilother-code"></a>单声道<code>delayUntil</code>替代<code>untilOther</code></h3>
<div class="paragraph">
<p>的<code>delayUntil</code>操作员延迟排放<code>Mono</code>直到同伴之后<code>Publisher</code>从源值生成的，完成。</p>
</div>
<div class="paragraph">
<p>请注意，有一个<code>untilOther</code>已删除的运算符。它曾经也延迟，但在第一个触发<code>onNext</code>的伴侣。 <code>delayUntil</code>更加灵活，因为通过添加一个<code>take(1)</code>给同伴。</p>
</div>
</div>
<div class="sect2">
<h3 id="test-features"><a class="anchor" href="#test-features"></a>测试功能</h3>
<div class="paragraph">
<p>的<code>reactor-test</code>工件还具有一些新功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>关于与使用断言兼容的错误验证的新期望： <code>expectErrorSatisfies</code>和<code>verifyErrorSatisfies</code> 。</p>
</li>
<li>
<p>为添加了可选的可配置默认超时<code>StepVerifier#verify()</code> 。通过使用静态设置<code>StepVerifier#setDefaultTimeout</code>方法。</p>
</li>
<li>
<p>添加了<code>PublisherProbe</code>轻松检查带有条件开关的复杂操作员链（例如<code>switchIfEmpty</code> ）确实经过了逻辑分支，同时仍然通过包装任何内容来为测试发出有意义的数据<code>Flux</code>要么<code>Mono</code> 。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="conclusion" class="sect0"><a class="anchor" href="#conclusion"></a>结论</h1>
<div class="paragraph">
<p>如果您不熟悉Reactor，现在是开始使用Spring Framework 5.0进行响应式旅程的激动人心的时刻。如果您不是，我们希望所有这些更改都已就位之后，您将享受与Reactor一起工作的更多乐趣。</p>
</div>
<div class="paragraph">
<p>如果您遇到任何迁移困难，请查看<a href="https://github.com/reactor/reactor-core/releases/tag/v3.1.0.RELEASE">发行说明</a>或在我们的<a href="https://gitter.im/reactor/reactor">Gitter</a>上寻求帮助。</p>
</div>
<div class="paragraph">
<p>快乐的反应式编码！</p>
</div>
<div class="paragraph">
<p><em>铋晶体照片CC-By-SA David Abercrombie通过<a href="https://www.flickr.com/photos/albategnius/">Flickr</a></em></p>
</div></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 3046;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>