<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Spring Security 5.0.0.RC1 Released</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Spring Security 5.0.0.RC1 Released" />
<meta name="twitter:description" content="&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;On behalf of the community, I’m pleased to announce the release of Spring Security 5.0.0.RC1. This release resolves &lt;a href=&quot;https://github.com/spring-projects/spring-security/milestone/103?closed=1&quot;&gt;150+&lt;/a&gt; issues. Below are the highlights of this release:&lt;/p&gt; 
&lt;/div&gt;
&lt;div class=&quot;ulist&quot;&gt; 
 &lt;ul&gt; 
  &lt;li&gt; &lt;p&gt;WebFlux Security Highlights&lt;/p&gt; 
   &lt;div class=&quot;ulist&quot;&gt; 
    &lt;ul&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;#reactivesecuritycontextholder&quot;&gt;ReactiveSecurityContextHolder&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/4734&quot;&gt;Reactive CSRF Support added&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
    &lt;/ul&gt; 
   &lt;/div&gt; &lt;/li&gt; 
  &lt;li&gt; &lt;p&gt;OAuth 2.0 Highlights&lt;/p&gt; 
   &lt;div class=&quot;ulist&quot;&gt; 
    &lt;ul&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;#oauth-2-0-client-support&quot;&gt;OAuth 2.0 Client Support&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;#oauth2authorizedclient-service&quot;&gt;OAuth2AuthorizedClient / Service&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;#what-s-up-next-with-oauth-2-0-support&quot;&gt;What’s Up Next with OAuth 2.0 Support?&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
    &lt;/ul&gt; 
   &lt;/div&gt; &lt;/li&gt; 
  &lt;li&gt; &lt;p&gt;Core Highlights&lt;/p&gt; 
   &lt;div class=&quot;ulist&quot;&gt; 
    &lt;ul&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;#password-storage-updated&quot;&gt;Password Storage Updated&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-security/pull/4672&quot;&gt;Add UnboundId LDAP inmemory support&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-security/pull/4424&quot;&gt;Allow use of non-numeric (e.g. UUID) values for ObjectIdentity.getIdentifier()&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
    &lt;/ul&gt; 
   &lt;/div&gt; &lt;/li&gt; 
 &lt;/ul&gt; 
&lt;/div&gt;
" />
<meta name="twitter:creator" content="@rob_winch" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/30ed046efb35c67d4c055dab109b8933?s=200" />

<meta property="og:title" content="Spring Security 5.0.0.RC1 Released" />
<meta property="og:image" content="https://gravatar.com/avatar/30ed046efb35c67d4c055dab109b8933?s=200" />
<meta property="og:description" content="&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;On behalf of the community, I’m pleased to announce the release of Spring Security 5.0.0.RC1. This release resolves &lt;a href=&quot;https://github.com/spring-projects/spring-security/milestone/103?closed=1&quot;&gt;150+&lt;/a&gt; issues. Below are the highlights of this release:&lt;/p&gt; 
&lt;/div&gt;
&lt;div class=&quot;ulist&quot;&gt; 
 &lt;ul&gt; 
  &lt;li&gt; &lt;p&gt;WebFlux Security Highlights&lt;/p&gt; 
   &lt;div class=&quot;ulist&quot;&gt; 
    &lt;ul&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;#reactivesecuritycontextholder&quot;&gt;ReactiveSecurityContextHolder&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/4734&quot;&gt;Reactive CSRF Support added&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
    &lt;/ul&gt; 
   &lt;/div&gt; &lt;/li&gt; 
  &lt;li&gt; &lt;p&gt;OAuth 2.0 Highlights&lt;/p&gt; 
   &lt;div class=&quot;ulist&quot;&gt; 
    &lt;ul&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;#oauth-2-0-client-support&quot;&gt;OAuth 2.0 Client Support&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;#oauth2authorizedclient-service&quot;&gt;OAuth2AuthorizedClient / Service&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;#what-s-up-next-with-oauth-2-0-support&quot;&gt;What’s Up Next with OAuth 2.0 Support?&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
    &lt;/ul&gt; 
   &lt;/div&gt; &lt;/li&gt; 
  &lt;li&gt; &lt;p&gt;Core Highlights&lt;/p&gt; 
   &lt;div class=&quot;ulist&quot;&gt; 
    &lt;ul&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;#password-storage-updated&quot;&gt;Password Storage Updated&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-security/pull/4672&quot;&gt;Add UnboundId LDAP inmemory support&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
     &lt;li&gt; &lt;p&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-security/pull/4424&quot;&gt;Allow use of non-numeric (e.g. UUID) values for ObjectIdentity.getIdentifier()&lt;/a&gt;&lt;/p&gt; &lt;/li&gt; 
    &lt;/ul&gt; 
   &lt;/div&gt; &lt;/li&gt; 
 &lt;/ul&gt; 
&lt;/div&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2017-11-01 14:08:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category content--title">
<div>Engineering</div>
</div>
<div class="blog-category active content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Security 5.0.0.RC1 Released</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon releases"></div>
<a class="category">Releases</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/30ed046efb35c67d4c055dab109b8933?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/rwinch">Rob Winch</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2017-11-01 14:08:00.0">November 01, 2017</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="3080" href="/blog/2017/11/01/spring-security-5-0-0-rc1-released#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><div class="paragraph">
<p>On behalf of the community, I&#8217;m pleased to announce the release of Spring Security 5.0.0.RC1. This release resolves <a href="https://github.com/spring-projects/spring-security/milestone/103?closed=1">150+</a> issues. Below are the highlights of this release:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WebFlux Security Highlights</p>
<div class="ulist">
<ul>
<li>
<p><a href="#reactivesecuritycontextholder">ReactiveSecurityContextHolder</a></p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-security/issues/4734">Reactive CSRF Support added</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>OAuth 2.0 Highlights</p>
<div class="ulist">
<ul>
<li>
<p><a href="#oauth-2-0-client-support">OAuth 2.0 Client Support</a></p>
</li>
<li>
<p><a href="#oauth2authorizedclient-service">OAuth2AuthorizedClient / Service</a></p>
</li>
<li>
<p><a href="#what-s-up-next-with-oauth-2-0-support">What&#8217;s Up Next with OAuth 2.0 Support?</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Core Highlights</p>
<div class="ulist">
<ul>
<li>
<p><a href="#password-storage-updated">Password Storage Updated</a></p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-security/pull/4672">Add UnboundId LDAP inmemory support</a></p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-security/pull/4424">Allow use of non-numeric (e.g. UUID) values for ObjectIdentity.getIdentifier()</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<h1 id="reactivesecuritycontextholder" class="sect0"><a class="anchor" href="#reactivesecuritycontextholder"></a>ReactiveSecurityContextHolder</h1>
<div class="paragraph">
<p>Previously, Spring Security used the <code>ServerWebExchange.getPrincipal()</code> as the source of truth for who was authenticated.
The authenticated user was copied to Reactor&#8217;s Context to support method security which used the Reactor Context as it&#8217;s source of truth.
Having multiple sources of truth is obviously not ideal.</p>
</div>
<div class="paragraph">
<p>Spring Security now uses <a href="https://projectreactor.io/docs/core/snapshot/reference/#context">Reactor&#8217;s Context</a> as the source of truth for who is authenticated.
The user can still be accessed from <code>ServerWebExchange.getPrincipal()</code>, but this value comes from Reactor&#8217;s Context as well.</p>
</div>
<div class="paragraph">
<p>You can read and write the <code>SecurityContext</code> to Reactor&#8217;s Context using <code>ReactiveSecurityContextHolder</code>.
For example, this demonstrates how to retrieve the currently logged in user&#8217;s message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Authentication authentication =
    new TestingAuthenticationToken("user", "password", "ROLE_USER");

Mono&lt;String&gt; messageByUsername = ReactiveSecurityContextHolder.getContext()
  .map(SecurityContext::getAuthentication)
  .map(Authentication::getName)
  .flatMap(this::findMessageByUsername)
  // In a WebFlux application the `subscriberContext`
  // is automatically setup using `ReactorContextWebFilter`
  .subscriberContext(ReactiveSecurityContextHolder.withAuthentication(authentication));

StepVerifier.create(messageByUsername)
	.expectNext("Hi user")
	.verifyComplete();</code></pre>
</div>
</div>
<div class="paragraph">
<p>with <code>this::findMessageByUsername</code> defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Mono&lt;String&gt; findMessageByUsername(String username) {
	return Mono.just("Hi " + username);
}</code></pre>
</div>
</div>
<h1 id="oauth-2-0-client-support" class="sect0"><a class="anchor" href="#oauth-2-0-client-support"></a>OAuth 2.0 Client Support</h1>
<div class="paragraph">
<p>There have been many updates and polish applied to put the finishing touches on the new <strong>OAuth 2.0 Login</strong> feature. We are very excited to be releasing this to the Spring community in the next couple of weeks.</p>
</div>
<div class="paragraph">
<p>In addition to the updates, below are some new features that were added:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Spring Boot 2.0 auto-configuration for OAuth 2.0 Login</p>
</li>
<li>
<p><a href="https://openid.net/specs/openid-connect-core-1_0.html#IDTokenValidation">ID Token Validation</a></p>
</li>
<li>
<p>Protection against token substitution attacks on the <a href="https://openid.net/specs/openid-connect-core-1_0.html#UserInfoResponse">UserInfo Response</a> using <code>sub</code> claim verification</p>
</li>
<li>
<p><a href="https://tools.ietf.org/html/rfc6749#section-1.3.2">Implicit Grant</a> support via <code>ImplicitGrantConfigurer</code></p>
</li>
</ul>
</div>
<h1 id="oauth2authorizedclient-service" class="sect0"><a class="anchor" href="#oauth2authorizedclient-service"></a>OAuth2AuthorizedClient / Service</h1>
<div class="paragraph">
<p>The <code>OAuth2AuthorizedClient</code> represents an <strong><em>Authorized Client</em></strong>.
A client is considered <em>"authorized"</em> when the End-User <em>(Resource Owner)</em> has granted authorization to the client to access its protected resources.
This class serves the purpose of associating an <code>OAuth2AccessToken</code> to a <code>ClientRegistration</code> <em>(Client)</em> and <em>Resource Owner</em>,
who is the <code>Principal</code> End-User that granted the authorization.</p>
</div>
<div class="paragraph">
<p>The primary role of the <code>OAuth2AuthorizedClientService</code> is to manage <code>OAuth2AuthorizedClient</code> instances.
From a developer perspective, it provides the capability to lookup an <code>OAuth2AccessToken</code> associated to a Client
so that it may be used to initiate a request to a <em>Resource Server</em>.</p>
</div>
<div class="paragraph">
<p>The <code>OAuth2AuthorizedClientService</code> may be registered as a <code>@Bean</code> in the <code>ApplicationContext</code> (although not required)
so that the developer can lookup the <code>OAuth2AccessToken</code> associated to a Client.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Controller
public class GoogleCalendarController {

	@Autowired
	private OAuth2AuthorizedClientService authorizedClientService;

	@RequestMapping("/calendar")
	public String calendar(OAuth2AuthenticationToken authentication) {
		OAuth2AuthorizedClient authorizedClient =
			this.authorizedClientService.loadAuthorizedClient(
				"google", authentication.getName());

		OAuth2AccessToken accessToken = authorizedClient.getAccessToken();

		// ...

		return "calendar";
	}
}</code></pre>
</div>
</div>
<h1 id="what-s-up-next-with-oauth-2-0-support" class="sect0"><a class="anchor" href="#what-s-up-next-with-oauth-2-0-support"></a>What&#8217;s Up Next with OAuth 2.0 Support?</h1>
<div class="sect1">
<h2 id="handlermethodargumentresolver-s"><a class="anchor" href="#handlermethodargumentresolver-s"></a>HandlerMethodArgumentResolver(s)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will be providing an implementation of a <code>HandlerMethodArgumentResolver</code> for <code>OAuth2AuthorizedClient</code> and <code>OAuth2AccessToken</code>.</p>
</div>
<div class="paragraph">
<p>As an alternative to using <code>OAuth2AuthorizedClientService</code> directly, you&#8217;ll be able to resolve an
<code>OAuth2AuthorizedClient</code> or <code>OAuth2AccessToken</code> as an argument to a <code>@Controller</code> method parameter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resource-server-support"><a class="anchor" href="#resource-server-support"></a>Resource Server support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Soon we will start planning our feature log to provide support for the <strong><em>OAuth 2.0 Resource Server</em></strong> role, so please stay tuned.</p>
</div>
</div>
</div>
<h1 id="password-storage-updated" class="sect0"><a class="anchor" href="#password-storage-updated"></a>Password Storage Updated</h1>
<div class="paragraph">
<p>Password storage has undergone a major overhaul to provide more secure defaults and the ability to migrate how passwords are stored.
The default <code>PasswordEncoder</code> is now <a href="https://docs.spring.io/spring-security/site/docs/5.0.0.RC1/api/org/springframework/security/crypto/password/DelegatingPasswordEncoder.html">DelegatingPasswordEncoder</a> which is a non-passive change.
This change ensures that passwords are now encoded using BCrypt by default, allows for validating passwords in old formats, and allows for upgrading the password storage in the future.</p>
</div>
<div class="sect1">
<h2 id="constructing-delegatingpasswordencoder"><a class="anchor" href="#constructing-delegatingpasswordencoder"></a>Constructing DelegatingPasswordEncoder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can easily construct an instance using <code>PasswordEncoderFactories</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">PasswordEncoder passwordEncoder =
    PasswordEncoderFactories.createDelegatingPasswordEncoder();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you may create your own custom instance. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">String idForEncode = "bcrypt";
Map encoders = new HashMap&lt;&gt;();
encoders.put(idForEncode, new BCryptPasswordEncoder());
encoders.put("noop", NoOpPasswordEncoder.getInstance());
encoders.put("pbkdf2", new Pbkdf2PasswordEncoder());
encoders.put("scrypt", new SCryptPasswordEncoder());
encoders.put("sha256", new StandardPasswordEncoder());

PasswordEncoder passwordEncoder =
    new DelegatingPasswordEncoder(idForEncode, encoders);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="password-storage-format"><a class="anchor" href="#password-storage-format"></a>Password Storage Format</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The general format for a password is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-text" data-lang="text">{id}encodedPassword</code></pre>
</div>
</div>
<div class="paragraph">
<p>Such that <code>id</code> is an identifier used to look up which <code>PasswordEncoder</code> should be used and <code>encodedPassword</code> is the original encoded password for the selected <code>PasswordEncoder</code>.
The <code>id</code> must be at the beginning of the password, start with <code>{</code> and end with <code>}</code>.
If the <code>id</code> cannot be found, the <code>id</code> will be null.
For example, the following might be a list of passwords encoded using different <code>id</code>.
All of the original passwords are "password".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-text" data-lang="text">{bcrypt}$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG <b class="conum">(1)</b>
{noop}password <b class="conum">(2)</b>
{pbkdf2}5d923b44a6d129f3ddf3e3c8d29412723dcbde72445e8ef6bf3b508fbf17fa4ed4d6b99ca763d8dc <b class="conum">(3)</b>
{scrypt}$e0801$8bWJaSu2IKSn9Z9kM+TPXfOc/9bdYSrN1oD9qfVThWEwdRTnO7re7Ei+fUZRJ68k9lTyuTeUp4of4g24hHnazw==$OAOec05+bXxvuu/1qZ6NUR+xQYvYv7BeL1QxwRpY5Pc=  <b class="conum">(4)</b>
{sha256}97cde38028ad898ebc02e690819fa220e88c62e0699403e94fff291cfffaf8410849f27605abcbc0 <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The first password would have a <code>PasswordEncoder</code> id of <code>bcrypt</code> and encodedPassword of <code>$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG</code>.
When matching it would delegate to <code>BCryptPasswordEncoder</code></p>
</li>
<li>
<p>The second password would have a <code>PasswordEncoder</code> id of <code>noop</code> and encodedPassword of <code>password</code>.
When matching it would delegate to <code>NoOpPasswordEncoder</code></p>
</li>
<li>
<p>The third password would have a <code>PasswordEncoder</code> id of <code>pbkdf2</code> and encodedPassword of <code>5d923b44a6d129f3ddf3e3c8d29412723dcbde72445e8ef6bf3b508fbf17fa4ed4d6b99ca763d8dc</code>.
When matching it would delegate to <code>Pbkdf2PasswordEncoder</code></p>
</li>
<li>
<p>The fourth password would have a <code>PasswordEncoder</code> id of <code>scrypt</code> and encodedPassword of <code>$e0801$8bWJaSu2IKSn9Z9kM+TPXfOc/9bdYSrN1oD9qfVThWEwdRTnO7re7Ei+fUZRJ68k9lTyuTeUp4of4g24hHnazw==$OAOec05+bXxvuu/1qZ6NUR+xQYvYv7BeL1QxwRpY5Pc=</code>
When matching it would delegate to <code>SCryptPasswordEncoder</code></p>
</li>
<li>
<p>The final password would have a <code>PasswordEncoder</code> id of <code>sha256</code> and encodedPassword of <code>97cde38028ad898ebc02e690819fa220e88c62e0699403e94fff291cfffaf8410849f27605abcbc0</code>.
When matching it would delegate to <code>StandardPasswordEncoder</code></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="password-encoding"><a class="anchor" href="#password-encoding"></a>Password Encoding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>idForEncode</code> passed into the constructor determines which <code>PasswordEncoder</code> will be used for encoding passwords.
In the <code>DelegatingPasswordEncoder</code> we constructed above, that means that the result of encoding <code>password</code> would be delegated to <code>BCryptPasswordEncoder</code> and be prefixed with <code>{bcrypt}</code>.
The end result would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-text" data-lang="text">{bcrypt}$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="password-matching"><a class="anchor" href="#password-matching"></a>Password Matching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Matching is done based upon the <code>id</code> and the mapping of the <code>id</code> to the <code>PasswordEncoder</code> provided in the constructor.
Our example in <a href="#password-storage-format">Password Storage Format</a> provides a working example of how this is done.
By default, the result of invoking <code>matches(CharSequence, String)</code> with a password and an <code>id</code> that is not mapped (including a null id) will result in an <code>IllegalArgumentException</code>.
This behavior can be customized using <code>DelegatingPasswordEncoder.setDefaultPasswordEncoderForMatches(PasswordEncoder)</code>.</p>
</div>
<div class="paragraph">
<p>By using the <code>id</code> we can match on any password encoding, but encode passwords using the most modern password encoding.
This is important, because unlike encryption, password hashes are designed so that there is no simple way to recover the plaintext.
Since there is no way to recover the plaintext, it makes it difficult to migrate the passwords.
While it is simple for users to migrate <code>NoOpPasswordEncoder</code>, we chose to include it by default to make it simple for the getting started experience.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migrating-to-spring-security-5"><a class="anchor" href="#migrating-to-spring-security-5"></a>Migrating to Spring Security 5</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are not using an explicit <code>PasswordEncoder</code> or were relying on the old core <code>PasswordEncoder</code> you will need to migrate.</p>
</div>
<div class="sect2">
<h3 id="migrating-existing-passwords"><a class="anchor" href="#migrating-existing-passwords"></a>Migrating Existing Passwords</h3>
<div class="paragraph">
<p>If your passwords are stored in plaintext, upgrading the hash is as easy as taking the plaintext password and encoding it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">String encoded = passwordEncoder.encode(plainTextPassword);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your passwords are stored in another format, then you cannot update the hash.
To migrate these passwords you must determine the algorithm that your passwords are stored in and prefix all passwords with <code>{id}</code>.
For example, if passwords are hashed with <code>sha256</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-text" data-lang="text">97cde38028ad898ebc02e690819fa220e88c62e0699403e94fff291cfffaf8410849f27605abcbc0</code></pre>
</div>
</div>
<div class="paragraph">
<p>ensure all passwords are prefixed with <code>{sha256}</code> like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-text" data-lang="text">{sha256}97cde38028ad898ebc02e690819fa220e88c62e0699403e94fff291cfffaf8410849f27605abcbc0</code></pre>
</div>
</div>
<div class="paragraph">
<p>While this password is not stored in a secure format, it does allow for other passwords to be stored in a secure format.
We can also request the users to change their password which would update the hash it was stored in.</p>
</div>
<div class="paragraph">
<p>For astute readers, it might be obvious that you can also migrate plain text passwords by prefixing them with <code>{noop}</code>.
For example, with a password of</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-text" data-lang="text">password</code></pre>
</div>
</div>
<div class="paragraph">
<p>you can simply prefix the password with <code>{noop}</code> like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-text" data-lang="text">{noop}password</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will work, but it is <strong>NOT SECURE</strong> so it is not recommended for production environments.</p>
</div>
</div>
<div class="sect2">
<h3 id="passwordencoder-and-saltsource"><a class="anchor" href="#passwordencoder-and-saltsource"></a>PasswordEncoder and SaltSource</h3>
<div class="paragraph">
<p>If you were using the old and deprecated <code>PasswordEncoder</code> in core, this has been removed because it requied users to provide a salt and use a <code>SaltSource</code> (also removed).
Each of the <code>PasswordEncoder</code> implementations in core have been migrated to the new crypto API with migration instructions in the Javadoc.
An example is <a href="https://docs.spring.io/spring-security/site/docs/5.0.0.RC1/api/org/springframework/security/crypto/password/MessageDigestPasswordEncoder.html">MessageDigestPasswordEncoder</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="reverting-to-previous-behavior-insecure"><a class="anchor" href="#reverting-to-previous-behavior-insecure"></a>Reverting to Previous Behavior (insecure)</h3>
<div class="paragraph">
<p>While it is insecure, users can revert to the previous behavior, by providing a <code>NoOpPasswordEncoder</code> as a <code>@Bean</code>.
If the application leverages <code>AuthenticationManagerBuilder</code> the <code>NoOpPasswordEncoder</code> must be explicitly provided to <code>AuthenticationManagerBuilder</code>. For example, if you have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">auth
	.inMemoryAuthentication()
		.withUser("user").password("password").roles("USER");</code></pre>
</div>
</div>
<div class="paragraph">
<p>you can revert to the previous behavior using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">auth
	.inMemoryAuthentication()
		.passwordEncoder(NoOpPasswordEncoder.getInstance())
		.withUser("user").password("password").roles("USER");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-started-experience"><a class="anchor" href="#getting-started-experience"></a>Getting Started Experience</h3>
<div class="paragraph">
<p>If you are putting together a demo or a sample, it is a bit combersome to take time to hash the passwords of your users.
There are convenience mechanisms to make this easier, but this is still not intended for production.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">User user = User.withDefaultPasswordEncoder()
  .username("user")
  .password("password")
  .roles("user")
  .build();
System.out.println(user.getPassword());
// {bcrypt}$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are creating multiple users, you can also reuse the buider.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">UserBuilder users = User.withDefaultPasswordEncoder();
User user = users
  .username("user")
  .password("password")
  .roles("USER")
  .build();
User admin = users
  .username("admin")
  .password("password")
  .roles("USER","ADMIN")
  .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This does hash the password that is stored, but the passwords are still exposed in memory and in the compiled source code.
Therefore, it is still not considered secure for a production environment.
For production, you should hash your passwords externally.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="automatic-password-migration-future"><a class="anchor" href="#automatic-password-migration-future"></a>Automatic Password Migration (Future)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With <code>DelegatingPasswordEncoder</code> we will be able to update the password format after a user authenticates.
We can add a default method to <code>PasswordEncoder</code> that returns a type (i.e. <code>PasswordMatch</code>) that states if the password was a match.
When the password is a match and is using an old format, <code>PasswordMatch</code> would also have a member with an up-to-date encoding for the password.
When Spring Security sees the suggestion on the new format, it can use an API to update the format of the user&#8217;s password.</p>
</div>
<div class="paragraph">
<p><a href="https://projects.spring.io/spring-security/">Project Site</a> | <a href="https://docs.spring.io/spring-security/site/docs/5.0.0.RC1/reference/htmlsingle/">Reference</a> | <a href="https://stackoverflow.com/questions/tagged/spring-security">Help</a></p>
</div>
</div>
</div></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 3080;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>