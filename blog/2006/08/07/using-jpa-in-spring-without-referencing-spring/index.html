<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Using JPA in Spring without referencing Spring</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Using JPA in Spring without referencing Spring" />
<meta name="twitter:description" content="&lt;p&gt;Spring 2.0 has added support for the JPA data access standard with all of the &lt;a href=&quot;http://static.springframework.org/spring/docs/2.0.x/reference/orm.html#orm-jpa&quot;&gt;standard Spring support classes&lt;/a&gt; one would expect. Mark Fisher has a &lt;a href=&quot;http://blog.interface21.com/main/2006/05/30/getting-started-with-jpa-in-spring-20/&quot;&gt;great post&lt;/a&gt; on how to use this new support. However one of the questions that we keep getting is why one would want to use a Spring class (&lt;span style=&quot;font-family:courier&quot;&gt;JpaTemplate&lt;/span&gt;) to access an &lt;span style=&quot;font-family:courier&quot;&gt;EntityManager&lt;/span&gt;. The best answer for this question lies in the value add that &lt;span style=&quot;font-family:courier&quot;&gt;JpaTemplate&lt;/span&gt; provides. In addition to providing the &lt;a href=&quot;http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/orm/jpa/JpaTemplate.html#method_summary&quot;&gt;one-liner convenience methods&lt;/a&gt; that are a hallmark of Spring data access, it also provides automatic participation in transactions and translation from &lt;span style=&quot;font-family:courier&quot;&gt;PersistenceException&lt;/span&gt; to the Spring &lt;a href=&quot;http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/dao/DataAccessException.html&quot; style=&quot;font-family:courier&quot;&gt;DataAccessException&lt;/a&gt; hierarchy.&lt;/p&gt;
" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/329c22b36844c1d9c698d5e9b6709dc5?s=200" />

<meta property="og:title" content="Using JPA in Spring without referencing Spring" />
<meta property="og:image" content="https://gravatar.com/avatar/329c22b36844c1d9c698d5e9b6709dc5?s=200" />
<meta property="og:description" content="&lt;p&gt;Spring 2.0 has added support for the JPA data access standard with all of the &lt;a href=&quot;http://static.springframework.org/spring/docs/2.0.x/reference/orm.html#orm-jpa&quot;&gt;standard Spring support classes&lt;/a&gt; one would expect. Mark Fisher has a &lt;a href=&quot;http://blog.interface21.com/main/2006/05/30/getting-started-with-jpa-in-spring-20/&quot;&gt;great post&lt;/a&gt; on how to use this new support. However one of the questions that we keep getting is why one would want to use a Spring class (&lt;span style=&quot;font-family:courier&quot;&gt;JpaTemplate&lt;/span&gt;) to access an &lt;span style=&quot;font-family:courier&quot;&gt;EntityManager&lt;/span&gt;. The best answer for this question lies in the value add that &lt;span style=&quot;font-family:courier&quot;&gt;JpaTemplate&lt;/span&gt; provides. In addition to providing the &lt;a href=&quot;http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/orm/jpa/JpaTemplate.html#method_summary&quot;&gt;one-liner convenience methods&lt;/a&gt; that are a hallmark of Spring data access, it also provides automatic participation in transactions and translation from &lt;span style=&quot;font-family:courier&quot;&gt;PersistenceException&lt;/span&gt; to the Spring &lt;a href=&quot;http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/dao/DataAccessException.html&quot; style=&quot;font-family:courier&quot;&gt;DataAccessException&lt;/a&gt; hierarchy.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2006-08-07 19:08:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Using JPA in Spring without referencing Spring</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/329c22b36844c1d9c698d5e9b6709dc5?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/bhale">Ben Hale</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2006-08-07 19:08:00.0">August 07, 2006</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="16" href="/blog/2006/08/07/using-jpa-in-spring-without-referencing-spring#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>Spring 2.0 has added support for the JPA data access standard with all of the <a href="http://static.springframework.org/spring/docs/2.0.x/reference/orm.html#orm-jpa">standard Spring support classes</a> one would expect. Mark Fisher has a <a href="http://blog.interface21.com/main/2006/05/30/getting-started-with-jpa-in-spring-20/">great post</a> on how to use this new support. However one of the questions that we keep getting is why one would want to use a Spring class (<span style="font-family:courier">JpaTemplate</span>) to access an <span style="font-family:courier">EntityManager</span>. The best answer for this question lies in the value add that <span style="font-family:courier">JpaTemplate</span> provides. In addition to providing the <a href="http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/orm/jpa/JpaTemplate.html#method_summary">one-liner convenience methods</a> that are a hallmark of Spring data access, it also provides automatic participation in transactions and translation from <span style="font-family:courier">PersistenceException</span> to the Spring <a href="http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/dao/DataAccessException.html" style="font-family:courier">DataAccessException</a> hierarchy.</p>
<h2>But I still don't want to use <span style="font-family:courier">JpaTemplate</span></h2><p>That&rsquo;s fine because you don&rsquo;t have to sacrifice the power of Spring. Specifically the two biggest advantages (transaction participation and exception translation) are available without coding against Spring classes. In fact Spring actually has extensive support for plain API DAOs.</p>
<h3>Transaction Participation</h3><p>One of the benefits of Spring&rsquo;s declarative transaction management is that you never have to reference transaction structures in your code. So if you want automatic transaction participation all you need are a couple of bean definitions.</p>
<pre><code class="prettyprint xml"><br />&lt;bean id=&quot;entityManagerFactory&quot;
    class=&quot;org.springframework.orm.jpa.LocalEntityManagerFactoryBean&quot; /&gt;

&lt;bean class=&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;&gt;
    &lt;property name=&quot;entityManagerFactory&quot; ref=&quot;entityManagerFactory&quot; /&gt;
&lt;/bean&gt;

&lt;tx:annotation-driven /&gt;
</code></pre><p>The <a href="http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/orm/jpa/JpaTransactionManager.html" style="font-family:courier">JpaTransactionManager</a> is responsible for creating <span style="font-family:courier">EntityManager</span>s opening transactions and binding them to the current thread context. The <a href="http://static.springframework.org/spring/docs/2.0.x/reference/transaction.html#transaction-declarative-annotations" style="font-family:courier">&lt;tx:annotation-driven /&gt;</a> simply tells Spring to put transactional advice on any class or method that has an <span style="font-family:courier">@Transactional</span> annotation on it. You can now just write your main-line DAO logic without having to worry about transactional semantics.</p>
<pre><code class="prettyprint java"><br />public Collection loadProductsByCategory(String category) {
    return entityManager.createQuery(&quot;from Product p where p.category = :category&quot;)
        .setParameter(&quot;category&quot;, category).getResultList();
}
</code></pre>
<h3>Exception Translation</h3><p>If you want Spring&rsquo;s exception translation you can get that as well. All that needs to happen is the introduction of the <a href="http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/stereotype/Repository.html" style="font-family:courier">@Repository</a> annotation on your class. This (really minor) Spring annotation simply tells the Spring container that this class is a persistence repository and needs to have exception translation performed on it. To get the exception translation a simple bean definition is required.</p>
<pre><code class="prettyprint xml"><br />&lt;bean class=&quot;org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor&quot;/&gt;
</code></pre>
<h2>That's fine, but how do I get an EnityManager?</h2><p>This might actually be the coolest part. Basically you&rsquo;d just define a DAO exactly the way you would if you weren&rsquo;t using Spring by adding the <span style="font-family:courier">@PersistenceContext</span> JPA annotation.</p>
<pre><code class="prettyprint java"><br />public class ProductDaoImpl implements ProductDao {

    private EntityManager entityManager;

    @PersistenceContext
    public void setEntityManager(EntityManager entityManager) {
        this. entityManager = entityManager;
    }

    public Collection loadProductsByCategory(String category) {
        return entityManager.createQuery(&quot;from Product p where p.category = :category&quot;)
            .setParameter(&quot;category&quot;, category).getResultList();
    }
}
</code></pre><p>By adding a single bean definition the Spring container will act as a JPA container and inject an <span style="font-family:courier">EnitityManager</span> from your <span style="font-family:courier">EntityManagerFactory</span>.</p>
<pre><code class="prettyprint xml"><br />&lt;bean class=&quot;org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor&quot; /&gt;
</code></pre>
<h2>A post this long must mean a lot of code and configuration</h2><p>But it doesn&rsquo;t! Now that we&rsquo;ve show all the pieces and parts let&rsquo;s take a look at the complete system.</p>
<h3>Code</h3>
<ul>
<li><span style="font-family:courier">@Repository</span> for exception translation
<li><span style="font-family:courier">@PersistenceContext</span> for <span style="font-family:courier">EntityManager</span> injection
<li>Plain JPA API code!
</ul>
<pre><code class="prettyprint java"><br />@Repository
public class ProductDaoImpl implements ProductDao {

    private EntityManager entityManager;

    @PersistenceContext
    public void setEntityManager(EntityManager entityManager) {
        this. entityManager = entityManager;
    }

    public Collection loadProductsByCategory(String category) {
        return entityManager.createQuery(&quot;from Product p where p.category = :category&quot;)
            .setParameter(&quot;category&quot;, category).getResultList();
    }
}
</code></pre>
<h3>Configuration</h3>
<ul>
<li><span style="font-family:courier">LocalEnityManagerFactoryBean</span> to create the <span style="font-family:courier">EntityManagerFactory</span>
<li><span style="font-family:courier">JpaTransactionManager</span> to manager JPA transactions
<li><span style="font-family:courier">&lt;tx:annotation-driven /&gt;</span> to tell Spring to look for <span style="font-family:courier">@Transactional</span>
<li>Your bean definition!
</ul>
<pre><code class="prettyprint xml"><br />&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;
    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.springframework.org/schema/tx
      http://www.springframework.org/schema/tx/spring-tx.xsd&quot;&gt;

    &lt;bean id=&quot;entityManagerFactory&quot;
        class=&quot;org.springframework.orm.jpa.LocalEntityManagerFactoryBean&quot; /&gt;
	
    &lt;bean id=&quot;productDaoImpl&quot; class=&quot;product.ProductDaoImpl&quot;/&gt;

    &lt;bean
        class=&quot;org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor&quot; /&gt;

    &lt;bean class=&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;&gt;
        &lt;property name=&quot;entityManagerFactory&quot;
            ref=&quot;entityManagerFactory&quot; /&gt;
    &lt;/bean&gt;

    &lt;tx:annotation-driven /&gt;
	
&lt;/beans&gt;
</code></pre><p>That&rsquo;s it. Two annotations and four bean definitions.</p>
<h2>Additional Resources</h2>
<ul>
<li><a href="http://static.springframework.org/spring/docs/2.0.x/reference/orm.html#orm-jpa">Spring reference documentation of using JPA</a>
<li><a href="http://static.springframework.org/spring/docs/2.0.x/reference/orm.html#d0e15210">Spring reference documentation on using plain JPA with Spring</a>
</ul><p><br /><hr /><br /><i>Updated to remove ellipses from bean definitions. See comments for background.</i></p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 16;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>