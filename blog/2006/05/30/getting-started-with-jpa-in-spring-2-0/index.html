<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Getting Started With JPA in Spring 2.0</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Getting Started With JPA in Spring 2.0" />
<meta name="twitter:description" content="&lt;p&gt;The motivation behind this blog entry is to provide a simple step-by-step guide for getting started with JPA in a &lt;i&gt;standalone&lt;/i&gt; environment with the Spring Framework. While the JPA specification originated as the persistence mechanism &lt;i&gt;for EJB 3.0&lt;/i&gt;, it was fortunately recognized that any such mechanism should in fact be able to persist simple POJOs. Therefore, with a handful of JARs in your classpath and a few Spring-configured beans, you can begin experimenting with JPA code within your favorite IDE. I will be using Glassfish JPA - which is the reference implementation and is based upon Oracle&#39;s TopLink ORM framework.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@m_f_" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/443e6ec0242c3f54001dae34374780e2?s=200" />

<meta property="og:title" content="Getting Started With JPA in Spring 2.0" />
<meta property="og:image" content="https://gravatar.com/avatar/443e6ec0242c3f54001dae34374780e2?s=200" />
<meta property="og:description" content="&lt;p&gt;The motivation behind this blog entry is to provide a simple step-by-step guide for getting started with JPA in a &lt;i&gt;standalone&lt;/i&gt; environment with the Spring Framework. While the JPA specification originated as the persistence mechanism &lt;i&gt;for EJB 3.0&lt;/i&gt;, it was fortunately recognized that any such mechanism should in fact be able to persist simple POJOs. Therefore, with a handful of JARs in your classpath and a few Spring-configured beans, you can begin experimenting with JPA code within your favorite IDE. I will be using Glassfish JPA - which is the reference implementation and is based upon Oracle&#39;s TopLink ORM framework.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2006-05-30 13:03:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Getting Started With JPA in Spring 2.0</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/443e6ec0242c3f54001dae34374780e2?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/mfisher">Mark Fisher</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2006-05-30 13:03:00.0">May 30, 2006</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="8" href="/blog/2006/05/30/getting-started-with-jpa-in-spring-2-0#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>The motivation behind this blog entry is to provide a simple step-by-step guide for getting started with JPA in a <i>standalone</i> environment with the Spring Framework. While the JPA specification originated as the persistence mechanism <i>for EJB 3.0</i>, it was fortunately recognized that any such mechanism should in fact be able to persist simple POJOs. Therefore, with a handful of JARs in your classpath and a few Spring-configured beans, you can begin experimenting with JPA code within your favorite IDE. I will be using Glassfish JPA - which is the reference implementation and is based upon Oracle&apos;s TopLink ORM framework.</p>
<h2>Initial Setup</h2><p>Ensure that you are using Java 5 (a prerequisite for JPA as well as EJB 3.0).</p><p>Download the glassfish JPA jar from: <a href="https://glassfish.dev.java.net/downloads/persistence/JavaPersistence.html"><a href="https://glassfish.dev.java.net/downloads/persistence/JavaPersistence.html">https://glassfish.dev.java.net/downloads/persistence/JavaPersistence.html</a></a><br />(NOTE: I used the &ldquo;V2_build_02â³ jar, but any later version should also work.)</p><p>To unbundle the jar from the &ldquo;installer&rdquo; jar, run:<br /><tt>java -jar glassfish-persistence-installer-v2-b02.jar</tt><br />(this is required for acceptance of the license agreement)</p><p>Add the <tt>toplink-essentials.jar</tt> to your classpath</p><p>Add the JAR containing your database driver (I am using hsqldb.jar version 1.8.0.1 in the example, but only minor changes are necessary to adapt for another database).</p><p>Add the following Spring JARs using the 2.0 M5 versions (available here: <a href="https://sourceforge.net/project/showfiles.php?group_id=73357"><a href="https://sourceforge.net/project/showfiles.php?group_id=73357">http://sourceforge.net/project/showfiles.php?group_id=73357</a></a>).<br /><ul><br /> <li>spring.jar<br /> <li>spring-jpa.jar<br /> <li>spring-mock.jar<br /></ul></p><p>Finally, add these jars to your classpath as well:<br /><ul><br /> <li>commons-logging.jar<br /> <li>log4j.jar<br /> <li>junit.jar<br /></ul></p>
<h2>Code - Domain Model</h2><p>This example will be based on a purposefully simple domain model of just 3 classes. Notice the use of annotations. With JPA, one may choose to use either annotations or an XML file to specify the object-relational mapping metadata - or even a combination of both approaches. Here, I have chosen to use solely annotations - for which brief descriptions will be provided immediately following the domain model code listings.</p><p>First, the <tt>Restaurant</tt> class:</p>
<pre><code class="prettyprint java"><br />package blog.jpa.domain;

import java.util.Set;
import javax.persistence.CascadeType;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.JoinColumn;
import javax.persistence.JoinTable;
import javax.persistence.ManyToMany;
import javax.persistence.OneToOne;

@Entity
public class Restaurant {

  @Id
  @GeneratedValue(strategy = GenerationType.AUTO)
  private long id;

  private String name;

  @OneToOne(cascade = CascadeType.ALL)
  private Address address;

  @ManyToMany
  @JoinTable(inverseJoinColumns = @JoinColumn(name = &quot;ENTREE_ID&quot;))
  private Set&lt;Entree&gt; entrees;

  public long getId() {
    return id;
  }

  public void setId(long id) {
    this.id = id;
  }

  public String getName() {
    return name;
  }

  public void setName(String name) {
    this.name = name;
  }

  public Address getAddress() {
    return address;
  }

  public void setAddress(Address address) {
    this.address = address;
  }

  public Set&lt;Entree&gt; getEntrees() {
    return entrees;
  }

  public void setEntrees(Set&lt;Entree&gt; entrees) {
    this.entrees = entrees;
  }

}
</code></pre><p>Second, the <tt>Address</tt> class:</p>
<pre><code class="prettyprint java"><br />package blog.jpa.domain;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity
public class Address {

  @Id
  @GeneratedValue(strategy = GenerationType.AUTO)
  private long id;

  @Column(name = &quot;STREET_NUMBER&quot;)
  private int streetNumber;

  @Column(name = &quot;STREET_NAME&quot;)
  private String streetName;

  public long getId() {
    return id;
  }

  public void setId(long id) {
    this.id = id;
  }

  public int getStreetNumber() {
    return streetNumber;
  }

  public void setStreetNumber(int streetNumber) {
    this.streetNumber = streetNumber;
  }

  public String getStreetName() {
    return streetName;
  }

  public void setStreetName(String streetName) {
    this.streetName = streetName;
  }

}
</code></pre><p>Third, the <tt>Entree</tt> class:</p>
<pre><code class="prettyprint java"><br />package blog.jpa.domain;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity
public class Entree {

  @Id
  @GeneratedValue(strategy = GenerationType.AUTO)
  private long id;

  private String name;

  private boolean vegetarian;

  public long getId() {
    return id;
  }

  public void setId(long id) {
    this.id = id;
  }

  public String getName() {
    return name;
  }

  public void setName(String name) {
    this.name = name;
  }

  public boolean isVegetarian() {
    return vegetarian;
  }

  public void setVegetarian(boolean vegetarian) {
    this.vegetarian = vegetarian;
  }

}
</code></pre><p>As you can see, not every persistent field has been annotated. JPA uses defaults (such as using a column name that matches the property name exactly) so that in many cases you do not need to specify the metadata explicitly. However, you may still choose to do so in order to provide more thoroughly self-documenting code. Notice that in the <tt>Entree</tt> class I am not using annotations for the String property &ldquo;name&rdquo; or the boolean property &ldquo;vegetarian&rdquo;. However, in the <tt>Address</tt> class, I am using the annotations, because I want to have a non-default name for the columns in the database (for example, I have chosen &ldquo;STREET_NAME&rdquo; whereas the default would have been &ldquo;STREETNAME&rdquo;).</p><p>Of course, one of the most important features of any ORM mechanism is the way in which one specifies the mapping from relationships between Objects to their database counterparts. In the <tt>Restaurant</tt> class, there is a <tt>@OneToOne</tt> annotation to describe the relationship to an <tt>Address</tt> and a <tt>@ManyToMany</tt> annotation to describe the relationship with members of the <tt>Entree</tt> class. Since instances of these other classes are also being managed by the <tt>EntityManager</tt>, it is possible to specify &ldquo;cascade&rdquo; rules. For example, when a <tt>Restaurant</tt> is deleted, the associated <tt>Address</tt> will also be deleted. In a moment, you will see a testcase for this scenario.</p><p>Finally, take a look at the @Id annotations and the specified &ldquo;strategy&rdquo; for the ID&apos;s @GeneratedValue. This metadata is used for describing the <i>primary key</i> generation strategy which in turn controls the identity within the database.</p><p>To learn much more about these and additional JPA annotations, check out the JPA specification - which is actually a subset of <a href="https://www.jcp.org/en/jsr/detail?id=220">JSR-220</a>.</p>
<h2>Code - Data Access Layer</h2><p>For accessing instances of the domain model, it is best to create a generic interface that hides all details about the underlying persistence mechanism. That way, if switching later to something other than JPA, there will be no impact on the architecture. This also makes it easier to test the service layer, since it enables the creation of stub implementations of this data access interface - or even dynamic mock implementations.</p><p>Here is the interface. Notice that there are no dependencies on any JPA or Spring classes. In fact, the only dependencies here that are not core Java classes are the classes of my domain model (in this simple case, there is only one - <tt>Restaurant</tt>):</p>
<pre><code class="prettyprint java"><br />package blog.jpa.dao;

import java.util.List;
import blog.jpa.domain.Restaurant;

public interface RestaurantDao {

  public Restaurant findById(long id);

  public List&lt;Restaurant&gt; findByName(String name);

  public List&lt;Restaurant&gt; findByStreetName(String streetName);

  public List&lt;Restaurant&gt; findByEntreeNameLike(String entreeName);

  public List&lt;Restaurant&gt; findRestaurantsWithVegetarianEntrees();

  public void save(Restaurant restaurant);

  public Restaurant update(Restaurant restaurant);

  public void delete(Restaurant restaurant);

}
</code></pre><p>For the implementation of this interface, I am going to extend Spring&apos;s <tt>JpaDaoSupport</tt> class. This provides a convenience method for retrieving the <tt>JpaTemplate</tt>. If you have used Spring with JDBC or other ORM technologies, then you will probably be quite familiar with this approach.</p><p>It should be noted that use of the <tt>JpaDaoSupport</tt> is optional. It is possible to construct a <tt>JpaTemplate</tt> directly by simply providing the <tt>EntityManagerFactory</tt> to its constructor. In fact, the <tt>JpaTemplate</tt> itself is optional. If you do not wish to have the automatic translation of JPA exceptions into Spring&apos;s runtime exception hierarchy, then you can avoid <tt>JpaTemplate</tt> altogether. In that case, you may still be interested in Spring&apos;s <tt>EntityManagerFactoryUtils</tt> class which provides a convenient static method for obtaining the shared (and thus transactional) <tt>EntityManager</tt>.</p><p>Here is the implementation:</p>
<pre><code class="prettyprint java"><br />package blog.jpa.dao;

import java.util.List;
import org.springframework.orm.jpa.support.JpaDaoSupport;
import blog.jpa.domain.Restaurant;

public class JpaRestaurantDao extends JpaDaoSupport implements RestaurantDao {

  public Restaurant findById(long id) {
    return getJpaTemplate().find(Restaurant.class, id);
  }

  public List&lt;Restaurant&gt; findByName(String name) {
    return getJpaTemplate().find(&quot;select r from Restaurant r where r.name = ?1&quot;, name);
  }

  public List&lt;Restaurant&gt; findByStreetName(String streetName) {
    return getJpaTemplate().find(&quot;select r from Restaurant r where r.address.streetName = ?1&quot;, streetName);
  }

  public List&lt;Restaurant&gt; findByEntreeNameLike(String entreeName) {
    return getJpaTemplate().find(&quot;select r from Restaurant r where r.entrees.name like ?1&quot;, entreeName);
  }

  public List&lt;Restaurant&gt; findRestaurantsWithVegetarianEntrees() {
    return getJpaTemplate().find(&quot;select r from Restaurant r where r.entrees.vegetarian = &#39;true&#39;&quot;);
  }

  public void save(Restaurant restaurant) {
    getJpaTemplate().persist(restaurant);
  }

  public Restaurant update(Restaurant restaurant) {
    return getJpaTemplate().merge(restaurant);
  }

  public void delete(Restaurant restaurant) {
    getJpaTemplate().remove(restaurant);
  }

}
</code></pre>
<h2>The Service Layer</h2><p>As the purpose here is to focus on a JPA implementation for the data-access layer, the service layer is omitted. Obviously, in a realistic scenario, the service layer would play a critical role in the system architecture. It would be the point where transactions are demarcated - and typically, they would be demarcated declaratively in the Spring configuration. In the next step, when you have a look at the configuration, you will notice that I have provided a &ldquo;transactionManager&rdquo; bean. It is used by the base test class to automatically wrap each test method in a transaction, and it is the same &ldquo;transactionManager&rdquo; that would wrap service layer methods with transactions. The main point to take away is that there is NO transaction-related code in the data-access tier. Using the Spring <tt>JpaTemplate</tt> ensures that the same <tt>EntityManager</tt> is shared across all DAOs. Therefore transaction propagation occurs automatically - as dictated by the service layer. In other words, it will actually behave exactly the same as other persistence mechanisms configured within the Spring framework. There is nothing JPA-specific - hence the rationale for leaving it out of this entry which is focused on JPA.</p>
<h2>Configuration</h2><p>Since I opted for the annotation-based mappings, you have actually already seen most of the JPA-specific configuration when the domain classes were presented. As mentioned above, it also would have been possible to configure those mappings via XML (in an âorm.xml&apos; file). The only other required configuration is in âMETA-INF/persistence.xml&apos;. In this case, that is very simple since the database-related properties will be available to the <tt>EntityManagerFactory</tt> via a dependency-injected &ldquo;dataSource&rdquo; provided in the Spring configuration (due up next). The only other information in this âpersistence.xml&apos; is whether to use local or global (JTA) transactions. Here are the contents of the âpersistence.xml&apos; file:</p>
<pre><code class="prettyprint xml"><br />&lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot; version=&quot;1.0&quot;&gt;

  &lt;persistence-unit name=&quot;SpringJpaGettingStarted&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;/&gt;

&lt;/persistence&gt;
</code></pre><p>There are only 4 beans in the Spring configuration (well ok, a couple of inner-beans too). First, there is the &ldquo;restaurantDao&rdquo; (I purposefully left &ldquo;jpa&rdquo; out of the bean name since any service layer beans depending on the DAO should only be concerned with the generic interface). The only required property for the JPA implementation of this DAO is the &ldquo;entityManagerFactory&rdquo; which it uses to create the <tt>JpaTemplate</tt>. The &ldquo;entityManagerFactory&rdquo; depends on the &ldquo;dataSource&rdquo;, and there is nothing JPA-specific about that. In this configuration, you will see a <tt>DriverManagerDataSource</tt>, but in production code, this would be replaced by a connection pool - and typically one obtained via a <tt>JndiObjectFactoryBean</tt> (or Spring 2.0&apos;s new convenience &lt;jndi:lookup&gt; tag). The final bean is the &ldquo;transactionManager&rdquo; that is required by the test class. This is the same &ldquo;transactionManager&rdquo; that would be used for transactions demarcated in the service-layer. The implementation class is Spring&apos;s <tt>JpaTransactionManager</tt>. To anyone familiar with configuring Spring for JDBC, Hibernate, JDO, TopLink, or iBATIS, most of these beans will look very familiar. The only exception is the <tt>EntityManagerFactory</tt>. I will discuss it briefly, but first have a look at the complete âapplicationContext.xml&apos; file:</p>
<pre><code class="prettyprint xml"><br />&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;

  &lt;bean id=&quot;restaurantDao&quot; class=&quot;blog.jpa.dao.JpaRestaurantDao&quot;&gt;
    &lt;property name=&quot;entityManagerFactory&quot; ref=&quot;entityManagerFactory&quot;/&gt;
  &lt;/bean&gt;

  &lt;bean id=&quot;entityManagerFactory&quot; class=&quot;org.springframework.orm.jpa.ContainerEntityManagerFactoryBean&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
    &lt;property name=&quot;jpaVendorAdapter&quot;&gt;
      &lt;bean class=&quot;org.springframework.orm.jpa.vendor.TopLinkJpaVendorAdapter&quot;&gt;
        &lt;property name=&quot;showSql&quot; value=&quot;true&quot;/&gt;
        &lt;property name=&quot;generateDdl&quot; value=&quot;true&quot;/&gt;
        &lt;property name=&quot;databasePlatform&quot; value=&quot;oracle.toplink.essentials.platform.database.HSQLPlatform&quot;/&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name=&quot;loadTimeWeaver&quot;&gt;
      &lt;bean class=&quot;org.springframework.instrument.classloading.SimpleLoadTimeWeaver&quot;/&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;org.hsqldb.jdbcDriver&quot;/&gt;
    &lt;property name=&quot;url&quot; value=&quot;jdbc:hsqldb:hsql://localhost/&quot;/&gt;
    &lt;property name=&quot;username&quot; value=&quot;sa&quot;/&gt;
    &lt;property name=&quot;password&quot; value=&quot;&quot;/&gt;
  &lt;/bean&gt;

  &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;&gt;
    &lt;property name=&quot;entityManagerFactory&quot; ref=&quot;entityManagerFactory&quot;/&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;
</code></pre><p>First you see that the &ldquo;entityManagerFactory&rdquo; needs to be aware of a &ldquo;dataSource&rdquo;. Next there is the &ldquo;jpaVendorAdapter&rdquo; as there are a variety of JPA implementations. In this case, I&apos;ve configured the <tt>TopLinkJpaVendorAdapter</tt> as an inner bean, and it has a few properties of its own. There is a boolean property to specify whether SQL should be shown and another boolean property for the generation of DDL. Both of these have been set to &ldquo;true&rdquo; and thus the database schema will be automatically generated each time the tests are executed. This is rather convenient in the early development phase as it provides immediate feedback for experimentations in the mappings, column names, etc. The &ldquo;databasePlatformClass&rdquo; provides the necessary information of what particular database is being used. Finally, the &ldquo;entityManagerFactory&rdquo; has a property for a &ldquo;loadTimeWeaver&rdquo; that plays a role in the transformation of class files by JPA persistence providers in order to accomodate certain features such as lazy-loading.</p>
<h2>Integration Testing</h2><p>Perhaps the best way to learn a new API is to write a bunch of testcases. The <tt>JpaRestaurantDaoTests</tt> class provides some basic tests. In order to learn more about JPA, modify the code and/or configuration and observe the impact on these tests. For example, try modifying the <i>cascade</i> settings - or the cardinality of the associations. Notice that <tt>JpaRestaurantDaoTests</tt> extends Spring&apos;s <tt>AbstractJpaTests</tt>. You may already be familiar with Spring&apos;s <tt>AbstractTransactionalDataSourceSpringContextTests</tt>. This class will behave the same way in that any database changes caused by the test methods will rollback by default. <tt>AbstractJpaTests</tt> actually does much more than that, but it is beyond the scope of this entry to go into those details. If interested, have a look at the source code for <tt>AbstractJpaTests</tt>.</p><p>Here is the <tt>JpaRestaurantDaoTests</tt> code:</p>
<pre><code class="prettyprint java"><br />package blog.jpa.dao;

import java.util.List;
import org.springframework.test.jpa.AbstractJpaTests;
import blog.jpa.dao.RestaurantDao;
import blog.jpa.domain.Restaurant;

public class JpaRestaurantDaoTests extends AbstractJpaTests {

  private RestaurantDao restaurantDao;

  public void setRestaurantDao(RestaurantDao restaurantDao) {
    this.restaurantDao = restaurantDao;
  }

  protected String[] getConfigLocations() {
    return new String[] {&quot;classpath:/blog/jpa/dao/applicationContext.xml&quot;};
  }

  protected void onSetUpInTransaction() throws Exception {
    jdbcTemplate.execute(&quot;insert into address (id, street_number, street_name) values (1, 10, &#39;Main Street&#39;)&quot;);
    jdbcTemplate.execute(&quot;insert into address (id, street_number, street_name) values (2, 20, &#39;Main Street&#39;)&quot;);
    jdbcTemplate.execute(&quot;insert into address (id, street_number, street_name) values (3, 123, &#39;Dover Street&#39;)&quot;);

    jdbcTemplate.execute(&quot;insert into restaurant (id, name, address_id) values (1, &#39;Burger Barn&#39;, 1)&quot;);
    jdbcTemplate.execute(&quot;insert into restaurant (id, name, address_id) values (2, &#39;Veggie Village&#39;, 2)&quot;);
    jdbcTemplate.execute(&quot;insert into restaurant (id, name, address_id) values (3, &#39;Dover Diner&#39;, 3)&quot;);

    jdbcTemplate.execute(&quot;insert into entree (id, name, vegetarian) values (1, &#39;Hamburger&#39;, 0)&quot;);
    jdbcTemplate.execute(&quot;insert into entree (id, name, vegetarian) values (2, &#39;Cheeseburger&#39;, 0)&quot;);
    jdbcTemplate.execute(&quot;insert into entree (id, name, vegetarian) values (3, &#39;Tofu Stir Fry&#39;, 1)&quot;);
    jdbcTemplate.execute(&quot;insert into entree (id, name, vegetarian) values (4, &#39;Vegetable Soup&#39;, 1)&quot;);

    jdbcTemplate.execute(&quot;insert into restaurant_entree (restaurant_id, entree_id) values (1, 1)&quot;);
    jdbcTemplate.execute(&quot;insert into restaurant_entree (restaurant_id, entree_id) values (1, 2)&quot;);
    jdbcTemplate.execute(&quot;insert into restaurant_entree (restaurant_id, entree_id) values (2, 3)&quot;);
    jdbcTemplate.execute(&quot;insert into restaurant_entree (restaurant_id, entree_id) values (2, 4)&quot;);
    jdbcTemplate.execute(&quot;insert into restaurant_entree (restaurant_id, entree_id) values (3, 1)&quot;);
    jdbcTemplate.execute(&quot;insert into restaurant_entree (restaurant_id, entree_id) values (3, 2)&quot;);
    jdbcTemplate.execute(&quot;insert into restaurant_entree (restaurant_id, entree_id) values (3, 4)&quot;);
  }

  public void testFindByIdWhereRestaurantExists() {
    Restaurant restaurant = restaurantDao.findById(1);
    assertNotNull(restaurant);
    assertEquals(&quot;Burger Barn&quot;, restaurant.getName());
  }

  public void testFindByIdWhereRestaurantDoesNotExist() {
    Restaurant restaurant = restaurantDao.findById(99);
    assertNull(restaurant);
  }

  public void testFindByNameWhereRestaurantExists() {
    List&lt;Restaurant&gt; restaurants = restaurantDao.findByName(&quot;Veggie Village&quot;);
    assertEquals(1, restaurants.size());
    Restaurant restaurant = restaurants.get(0);
    assertEquals(&quot;Veggie Village&quot;, restaurant.getName());
    assertEquals(&quot;Main Street&quot;, restaurant.getAddress().getStreetName());
    assertEquals(2, restaurant.getEntrees().size());
  }

  public void testFindByNameWhereRestaurantDoesNotExist() {
    List&lt;Restaurant&gt; restaurants = restaurantDao.findByName(&quot;No Such Restaurant&quot;);
    assertEquals(0, restaurants.size());
  }

  public void testFindByStreetName() {
    List&lt;Restaurant&gt; restaurants = restaurantDao.findByStreetName(&quot;Main Street&quot;);
    assertEquals(2, restaurants.size());
    Restaurant r1 = restaurantDao.findByName(&quot;Burger Barn&quot;).get(0);
    Restaurant r2 = restaurantDao.findByName(&quot;Veggie Village&quot;).get(0);
    assertTrue(restaurants.contains(r1));
    assertTrue(restaurants.contains(r2));
  }

  public void testFindByEntreeNameLike() {
    List&lt;Restaurant&gt; restaurants = restaurantDao.findByEntreeNameLike(&quot;%burger&quot;);
    assertEquals(2, restaurants.size());
  }

  public void testFindRestaurantsWithVegetarianOptions() {
    List&lt;Restaurant&gt; restaurants = restaurantDao.findRestaurantsWithVegetarianEntrees();
    assertEquals(2, restaurants.size());
  }

  public void testModifyRestaurant() {
    String oldName = &quot;Burger Barn&quot;;
    String newName = &quot;Hamburger Hut&quot;;
    Restaurant restaurant = restaurantDao.findByName(oldName).get(0);
    restaurant.setName(newName);
    restaurantDao.update(restaurant);
    List&lt;Restaurant&gt; results = restaurantDao.findByName(oldName);
    assertEquals(0, results.size());
    results = restaurantDao.findByName(newName);
    assertEquals(1, results.size());
  }

  public void testDeleteRestaurantAlsoDeletesAddress() {
    String restaurantName = &quot;Dover Diner&quot;;
    int preRestaurantCount = jdbcTemplate.queryForInt(&quot;select count(*) from restaurant&quot;);
    int preAddressCount = jdbcTemplate.queryForInt(&quot;select count(*) from address where street_name = &#39;Dover Street&#39;&quot;);
    Restaurant restaurant = restaurantDao.findByName(restaurantName).get(0);
    restaurantDao.delete(restaurant);
    List&lt;Restaurant&gt; results = restaurantDao.findByName(restaurantName);
    assertEquals(0, results.size());
    int postRestaurantCount = jdbcTemplate.queryForInt(&quot;select count(*) from restaurant&quot;);
    assertEquals(preRestaurantCount - 1, postRestaurantCount);
    int postAddressCount = jdbcTemplate.queryForInt(&quot;select count(*) from address where street_name = &#39;Dover Street&#39;&quot;);
    assertEquals(preAddressCount - 1, postAddressCount);
  }

  public void testDeleteRestaurantDoesNotDeleteEntrees() {
    String restaurantName = &quot;Dover Diner&quot;;
    int preRestaurantCount = jdbcTemplate.queryForInt(&quot;select count(*) from restaurant&quot;);
    int preEntreeCount = jdbcTemplate.queryForInt(&quot;select count(*) from entree&quot;);
    Restaurant restaurant = restaurantDao.findByName(restaurantName).get(0);
    restaurantDao.delete(restaurant);
    List&lt;Restaurant&gt; results = restaurantDao.findByName(restaurantName);
    assertEquals(0, results.size());
    int postRestaurantCount = jdbcTemplate.queryForInt(&quot;select count(*) from restaurant&quot;);
    assertEquals(preRestaurantCount - 1, postRestaurantCount);
    int postEntreeCount = jdbcTemplate.queryForInt(&quot;select count(*) from entree&quot;);
    assertEquals(preEntreeCount, postEntreeCount);
  }
}
</code></pre>
<h2>Further Reading</h2><p>JPA is a vast topic, and this blog has only scratched the surface - the main objective being to demonstrate the basic configuration of a JPA-based persistence implementation with Spring. Obviously this domain model is trivial in terms of Object-Relational mapping. However, once you have this working configuration, you will be able to extend the example here while exploring the ORM capabilities offered by JPA. I would highly encourage a closer look at the Spring JPA support via the JavaDoc and the Spring reference documentation. The 2.0 RC1 release contains an added sub-section on JPA within the ORM section of the reference document.</p><p>Here are a few helpful links:</p><p><a href="https://www.jcp.org/en/jsr/detail?id=220">JSR-220</a> (contains the JPA specification)<br /><a href="https://glassfish.dev.java.net/javaee5/persistence/">Glassfish JPA</a> (the reference implementation)<br /><a href="http://commerce.bea.com/showproduct.jsp?family=KODO&major=4.0&minor=0">Kodo 4.0</a> (BEA&apos;s JPA implementation based on Kodo)<br /><a href="http://www.hibernate.org/371.html">Hibernate JPA Migration Guide</a></p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 8;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>