<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Spring: the foundation for Grails</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Spring: the foundation for Grails" />
<meta name="twitter:description" content="&lt;p&gt;In the SpringSource training course for Groovy &amp;amp; Grails, we highlight that Grails stands on the shoulders of giants. One of those giants is Spring. Without it, Grails simply wouldn’t have been developed as quickly as it was. It probably wouldn’t have the flexibility to integrate easily with enterprise Java systems either. Just look at the number of plugins available: many are based on Java libraries with Spring support.&lt;/p&gt;
&lt;p&gt;In this post, I want to start by looking at how Grails uses Spring and then cover the various ways in which you can access that raw power and flexibility.&lt;/p&gt;
" />

<meta property="og:title" content="Spring: the foundation for Grails" />
<meta property="og:description" content="&lt;p&gt;In the SpringSource training course for Groovy &amp;amp; Grails, we highlight that Grails stands on the shoulders of giants. One of those giants is Spring. Without it, Grails simply wouldn’t have been developed as quickly as it was. It probably wouldn’t have the flexibility to integrate easily with enterprise Java systems either. Just look at the number of plugins available: many are based on Java libraries with Spring support.&lt;/p&gt;
&lt;p&gt;In this post, I want to start by looking at how Grails uses Spring and then cover the various ways in which you can access that raw power and flexibility.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2010-06-08 10:39:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring: the foundation for Grails</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="null?s=20&amp;d=mm" />
<span class="author">Peter Ledbrook</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2010-06-08 10:39:00.0">June 08, 2010</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="329" href="/blog/2010/06/08/spring-the-foundation-for-grails#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>In the SpringSource training course for Groovy &amp; Grails, we highlight that Grails stands on the shoulders of giants. One of those giants is Spring. Without it, Grails simply wouldn&rsquo;t have been developed as quickly as it was. It probably wouldn&rsquo;t have the flexibility to integrate easily with enterprise Java systems either. Just look at the number of plugins available: many are based on Java libraries with Spring support.</p><p>In this post, I want to start by looking at how Grails uses Spring and then cover the various ways in which you can access that raw power and flexibility.</p>
<h2>A child of Spring</h2><p>You may not be aware of this, but when you create a Grails application you are also creating a Spring MVC one. Under the hood, Grails creates a variant of Spring MVC&rsquo;s <tt>DispatcherServlet</tt> and configures a bunch of beans to do the heavy lifting. Of course, this means that there is a Spring context underpinning your application - one that you have access to as you&rsquo;ll see later.</p><p>Here are some examples of the beans you&rsquo;ll find if you look in the Spring context of a typical Grails application:<br /><ul><br /><li><em>grailsApplication</em> - a bean representing the current application and its resources</li><br /><li><em>pluginManager</em> - the plugin manager, which you can query for information about loaded plugins</li><br /><li><em>jspViewResolver</em> - a custom MVC view resolver for GSPs that falls back to JSPs</li><br /><li><em>messageSource</em> - source for localized messages</li><br /><li><em>localeResolver</em> - how the user&rsquo;s locale is determined</li><br /><li><em>annotationHandlerMapping</em> - allows the use of the <tt>@Controller</tt> annotation</li><br /></ul><br />That&rsquo;s just a few of the many beans that Grails creates. In fact, you may be surprised to learn that all your application controllers, tag libraries, domain classes and services are also beans.</p><p>In what other areas does Grails depend on Spring? Well, there&rsquo;s data binding for a start: Spring does all the physical binding of string data to object properties. It&rsquo;s not just the web layer either: GORM uses Spring&rsquo;s Hibernate templates for saving and querying domain classes. Perhaps most importantly, Grails uses Spring&rsquo;s transaction management. And as I&rsquo;ve already alluded to, many plugins make use of the Spring integration provided with Java libraries.</p><p>So, a Grails application is really a Spring application. That raises the question of how you tap into the underlying Spring components when you need to.</p>
<h2>Talking to Spring</h2><p>You can easily write a Grails application, even a fairly complex one, without worrying about Spring. That&rsquo;s great, because it means new developers don&rsquo;t have to learn the technology right away. But just because you don&rsquo;t <em>have</em> to interact with Spring directly doesn&rsquo;t mean that it&rsquo;s hard.</p><p>There are several approaches you can take and I&rsquo;ll look at each of them in turn.</p>
<h3>Services and auto wiring</h3><p>The key to Spring is the creation and wiring of beans. You would normally have to provide some configuration to do this, but Grails services give you a lightweight, convention-based alternative. As I said earlier, several of the artifacts you create in a Grails application automatically become Spring beans, but it&rsquo;s the services that allow you the most control.</p><p>The principle is simple: create a class under <tt>grails-app/services</tt> with a suffix of <tt>Service</tt> and you will automatically get a new (singleton) Spring bean in your application. The name of that bean? Simple: the class name with a lowercase first letter. For example, the class <tt>SecurityService</tt> will result in a bean named &ldquo;securityService&rdquo;. <tt>AuditReportService</tt> will likewise become an &ldquo;auditReportService&rdquo; bean.</p><p>Wiring other beans into your services (and all other core Grails artifacts) is similarly straightforward: declare a property with the same name as the bean you want. For example, say I wanted to use the &ldquo;auditReportService&rdquo; bean from another service (or maybe a controller). I can wire it in like this:</p>
<pre><code class="prettyprint groovy">class MyService {
    def auditReportService
    ...
}
</code></pre><p>I&rsquo;m sure you&rsquo;ll agree that was pretty simple. It&rsquo;s an example of Spring&rsquo;s auto wiring. Grails will also wire beans by name even if you specify a type for the property.</p><p>Another useful feature of services is that they are transactional by default. This makes them a great way of abstracting away data access and building a robust architecture for your application. A typical approach is to create different &ldquo;gateways&rdquo; to your services: an HTML UI, an XML REST interface, remoting via RMI, etc. all calling into your services.</p><p>One final note: I said that Grails will instantiate your services as singleton beans, but you can change this behaviour on a per-service basis. Simply add a static <tt>scope</tt> property to your service class, like so:</p>
<pre><code class="prettyprint groovy">class MyService {
    static scope = &quot;request&quot;
    ...
}
</code></pre><p>As you can see, you get a lot of the main benefits of Spring with almost no effort when you use services. That&rsquo;s great, but what if you have existing classes that you want to turn into beans? Perhaps you have written them in Java, or they come packaged in a JAR file. With plain Spring, you would configure them manually. Fortunately, you can do the same in Grails.</p>
<h3>Manually defining beans</h3><p>In the good old days, before annotations, you would create one or more bean descriptor files in XML format for your Spring application. Grails allows you to do the same with the <tt>grails-app/conf/spring/resources.xml</tt> file. There&rsquo;s nothing special about it, so the standard Spring documentation applies!</p><p>I have to say I&rsquo;m not a big fan of writing XML any more, so I prefer an alternative bean definition format: Grails&rsquo; Spring Bean DSL. Here&rsquo;s a very simple example of defining a report generator bean in <tt>grails-app/conf/spring/resources.groovy</tt>:</p>
<pre><code class="prettyprint groovy">beans = {
    reportGenerator(org.example.XmlReportGenerator)
}
</code></pre><p>The definition starts with the name of the bean (&ldquo;reportGenerator&rdquo;) followed by the class in parentheses (&ldquo;XmlReportGenerator&rdquo;). You can also configure bean and bean definition properties:</p>
<pre><code class="prettyprint groovy">beans = {
    reportGenerator(org.example.XmlReportGenerator) { bean -&gt;
        bean.autowire = &quot;byName&quot;
        prettyFormat = true
    }
}
</code></pre><p>OK, so it&rsquo;s more concise than the XML format, but is that a good enough reason to switch? Probably not for most people. The real power of the DSL comes from the fact that it&rsquo;s real Groovy, which means:<br /><ul><br /><li>you can mix in normal Groovy code, such as conditions and loops; and</li><br /><li>you can use real types for property values.</li><br /></ul></p><p><b>Uodate</b> I have changed the example below to use the new approach for detecting the current environment.</p><p>Take this example:</p>
<pre><code class="prettyprint groovy">import grails.util.Environment

beans = {
    if (Environment.current == Environment.PRODUCTION) {
        // Use the real web service for production
        securityService(org.example.WsClientSecurityService) {
            endpoint = &quot;http://...&quot;
        }
    }
    else {
        // Use a dummy service for development and testing
        securityService(org.example.DummySecurityService)  {
            userRoles = [ peter: [ &quot;admin&quot;, &quot;user&quot;], tom: [ &quot;user&quot; ] ]
        }
    }
}
</code></pre><p>It demonstrates how you can use conditions to configure different bean implementations for different Grails environments. For production &ldquo;securityService&rdquo; is a web service client, whereas for all other environments we use a dummy in-memory service. You can also see that it&rsquo;s possible to assign a literal map to a <tt>Map</tt>property and the same goes for any other type too. Not only is it significantly more concise than with XML, but you are also working with real types and objects that you can manipulate at runtime.</p><p>There is more to the DSL than I have covered here, so I recommend you check out the <a href="http://www.grails.org/doc/latest/guide/14.%20Grails%20and%20Spring.html">user guide</a> for more information. You will find that the DSL supports Spring namespaces, factory methods, and more.</p><p>I have covered the two most common Spring integration points for Grails, but there is another one: annotations.</p>
<h3>Annotations</h3><p>Spring 2.5 introduced annotations for all sorts of things, such as components, Spring MVC controllers, transactions and more. You&rsquo;ll be glad to know that you can use those annotations in your Grails application. For example, imagine you have a Java class under <tt>src/java</tt> like so:</p>
<pre><code class="prettyprint java">package org.example;

@Component(&quot;securityService&quot;)
public class DummySecurityService implements SecurityService {
    ...
}
</code></pre><p>This should automatically become a Spring bean with the name &ldquo;securityService&rdquo;, but that won&rsquo;t happen yet. One more step is required: you have to specify the packages that Grails should scan for Spring annotations. So in this example, we want the <tt>org.example</tt> package scanned. To do this, simply add the following setting to <tt>grails-app/conf/Config.groovy</tt>:</p>
<pre><code class="prettyprint groovy">grails.spring.bean.packages = [ &quot;org.example&quot; ]
</code></pre><p>The class will now be automatically created as a Spring bean. Note that Grails scans all sub-packages as well, so the above would work even if the class were in a <tt>org.example.sub.pkg</tt> package.</p><p>As long as you specify the package via <tt>grails.spring.bean.packages</tt>, you can even add classes as controllers using the @Controller annotation. This can be helpful if you decide to migrate from Spring MVC to Grails or if a team has developed some Spring MVC controllers that you want to drop into your Grails application.</p><p>As you can see, there are enough options for defining beans in Grails to suit most people. That just leaves runtime interrogation of the Spring application context to cover.</p>
<h3>Runtime interaction</h3><p>Many applications find it useful to talk to the Spring application context directly, be it to find all beans of a particular type or simply to retrieve a particular bean without relying on auto wiring. How do you get access to the application context?</p><p>If your class is a Spring bean, then you can simply implement the <tt>ApplicationContextAware</tt> interface. Spring will then automatically inject the context into your <tt>applicationContext</tt> property. Alternatively, you can inject the <tt>grailsApplication</tt> bean and retrieve the context via <tt>grailsApplication.mainContext</tt>.</p><p>On the other hand, if your class is not managed by Spring you have to do some manual work. It&rsquo;s not pretty, but you can grab the context via this snippet of code:</p>
<pre><code class="prettyprint groovy">import org.springframework.web.context.support.WebApplicationContextUtils
import org.codehaus.groovy.grails.web.context.ServletContextHolder
import org.springframework.context.ApplicationContext
...
def ctx = WebApplicationContextUtils.getWebApplicationContext(ServletContextHolder.servletContext)
</code></pre><p>Beware: you&rsquo;re not dealing with a single application context in Grails. The application context you get from the different techniques described above has a parent application context. That parent contains the <tt>grailsApplication</tt>, <tt>pluginManager</tt>, and other beans configured from the <tt>web-app/WEB-INF/applicationContext.xml</tt> file. You may discover code that allows you to get the application context in a different way from those just detailed, but you may end up with a reference to the parent, which doesn&rsquo;t contain the services, controllers, etc.</p><p>To wrap up, Grails is fundamentally a Spring application in disguise. Although it hides Spring from casual inspection, it does provide some powerful techniques to interact with Spring directly. That means you can readily take advantage of existing Java/Spring libraries and make use of a framework that makes larger applications more manageable than they would otherwise be.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 329;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>