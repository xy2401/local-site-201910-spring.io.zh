<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Socializing Spring Applications</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Socializing Spring Applications" />
<meta name="twitter:description" content="&lt;p&gt;Increasingly, web surfers are using the internet to connect with friends, family, and colleagues using social networking sites. Conversations that once took place over email are now taking place in short messages written on someone&#39;s Facebook wall or in a brief tweet on Twitter. Connections once made with a handshake are now created using LinkedIn. And when a face-to-face meetings are desired, travel details can be shared using TripIt.&lt;/p&gt;
&lt;p&gt;Just as people are using these social networking sites to interact with each other, businesses are also finding ways to inject themselves into the social graph so that they can connect in a more personal way with their customers and also make their web sites an extension of their customers&#39; social experiences.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@habuma" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/52fd524c733cc1098c2eeeae38ea8a20?s=200" />

<meta property="og:title" content="Socializing Spring Applications" />
<meta property="og:image" content="https://gravatar.com/avatar/52fd524c733cc1098c2eeeae38ea8a20?s=200" />
<meta property="og:description" content="&lt;p&gt;Increasingly, web surfers are using the internet to connect with friends, family, and colleagues using social networking sites. Conversations that once took place over email are now taking place in short messages written on someone&#39;s Facebook wall or in a brief tweet on Twitter. Connections once made with a handshake are now created using LinkedIn. And when a face-to-face meetings are desired, travel details can be shared using TripIt.&lt;/p&gt;
&lt;p&gt;Just as people are using these social networking sites to interact with each other, businesses are also finding ways to inject themselves into the social graph so that they can connect in a more personal way with their customers and also make their web sites an extension of their customers&#39; social experiences.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2010-11-03 16:39:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Socializing Spring Applications</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/52fd524c733cc1098c2eeeae38ea8a20?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/cwalls">Craig Walls</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2010-11-03 16:39:00.0">November 03, 2010</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="371" href="/blog/2010/11/03/socializing-spring-applications#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>Increasingly, web surfers are using the internet to connect with friends, family, and colleagues using social networking sites. Conversations that once took place over email are now taking place in short messages written on someone's Facebook wall or in a brief tweet on Twitter. Connections once made with a handshake are now created using LinkedIn. And when a face-to-face meetings are desired, travel details can be shared using TripIt.</p>
<p>Just as people are using these social networking sites to interact with each other, businesses are also finding ways to inject themselves into the social graph so that they can connect in a more personal way with their customers and also make their web sites an extension of their customers' social experiences.</p>
<p>This week, we are pleased to have released the first milestone of <a href="http://www.springframework.org/spring-social">Spring Social</a>, a new extension to Spring that aims to provide a platform upon which social-ready Spring applications may be built. I thought I'd take this opportunity to introduce you to Spring Social and give you a taste of what it offers.</p>
<h3>Securely Sharing Social Data</h3>
<p>On the surface, developing applications that interact with the various social networks may appear straightforward. Since most of the social networks offer a REST API, Spring's <code>RestTemplate</code> would seem to be all you need. But you'll quickly discover that those social REST APIs are protected by <a href="https://oauth.net/">OAuth</a> and that signing a request sent through <code>RestTemplate</code> with OAuth credentials is a non-trivial task.</p>
<p>OAuth is an open protocol that enables a user to share their data hosted on one or more service providers with another application. With access to that data, the application can aggregate, present, and process the information in ways that provide additional value beyond what the service providers themselves ever intended or imagined.</p>
<p>Virtually all of the major service providers support OAuth, including Twitter, Facebook, LinkedIn, TripIt, and Foursquare, as well as the Google and Yahoo APIs. Therefore, OAuth is essential to developing social-ready applications.</p>
<p>At the beginning of an OAuth-secured interaction is a back-and-forth conversation that is commonly known as the "OAuth Dance". In a typical OAuth Dance, there are three parties involved:</p>
<ul>
<li>The service provider (such as Twitter or LinkedIn)</li>
<li>The user who wants to access or update data hosted by that service provider.</li>
<li>The consumer application that the user wants to share their data with.</li>
</ul>
<p>The key steps in this dance are as follows:</p>
<ol>
<li>The consumer application directs the user to the service provider's site to sign in and authorize the consumer.</li>
<li>Assuming that the user agrees to grant the consumer access to their data, the flow is sent back to the consumer application.</li>
<li>The consumer application receives an access token from the service provider.</li>
</ol>
<p>The access token received in step 3 is the "valet key" that must accompany any request to the service provider's REST API. In OAuth 1, this means that the access token, along with the request URL, parameters, and a few other bits of information are collected together in a base string, encrypted, and sent on the request in an <code>Authorization</code> header. Constructing this header and attaching it to the request is a complicated task. This is the reason that using <code>RestTemplate</code> to access OAuth-secured resources is difficult. If you get it wrong, the service provider will respond with an HTTP 401 for any resource you try to access and debugging the encrypted <code>Authorization</code> header is tricky.</p>
<h3>Working with Social Templates</h3>
<p>A key component of Spring Social is its collection of social templates. These templates (which leverage <code>RestTemplate</code> under the covers) expose operations of the service providers that they model, handling the intricacies of adding OAuth <code>Authorization</code> headers for you.</p>
<p>Spring Social 1.0.0.M1 includes 4 social templates to choose from:</p>
<ul>
<li><code>TwitterTemplate</code></li>
<li><code>FacebookTemplate</code></li>
<li><code>LinkedInTemplate</code></li>
<li><code>TripItTemplate</code></li>
</ul>
<p>To use any of these templates, simply create an instance of it, providing the OAuth connection details through constructor arguments. For example, to create an instance of <code>TwitterTemplate</code>:</p>
<pre><code class="prettyprint java">TwitterTemplate twitter = new TwitterTemplate(apiKey, apiSecret, accessToken, accessTokenSecret);
</code></pre>
<p>The four parameters to <code>TwitterTemplate</code>'s constructor are all Strings values. The API key and API secret are given to you when you register your application with Twitter (see <a href="https://dev.twitter.com/apps/new">http://dev.twitter.com/apps/new</a>). The access token and access token secret are granted to your application on a per-user basis at the end of the OAuth Dance with Twitter. At this point, I'm going to assume that you've already obtained all four of these values; we'll circle back to how to manage API keys and tokens a little later.</p>
<p>Creating instances of the other social templates isn't much different. <code>LinkedInTemplate</code> and <code>TripItTemplate</code> each have constructors with the same argument list as the <code>TwitterTemplate</code> constructor shown above. Since Facebook's API security is based on OAuth 2, <code>FacebookTemplate</code> has a slightly simpler constructor that only requires the value of the access token:</p>
<pre><code class="prettyprint java">FacebookTemplate facebook = new FacebookTemplate(accessToken);
</code></pre>
<p>Once you have an instance of one of these social templates, what can you do with it? If you're using <code>TwitterTemplate</code>, perhaps you want to know the authenticated user's Twitter screen name:</p>
<pre><code class="prettyprint java">String screenName = twitter.getProfileId();
</code></pre>
<p>Or for something a bit more involved, maybe you could send a tweet on behalf of the user:</p>
<pre><code class="prettyprint java">twitter.updateStatus(&quot;Hey, I&#39;m tweeting with #Spring Social!&quot;);
</code></pre>
<p>Similarly, with a <code>FacebookTemplate</code> in hand, you can post to the user's wall:</p>
<pre><code class="prettyprint java">facebook.updateStatus(&quot;Spring Social can also post to Facebook!&quot;);
</code></pre>
<p>And if you want to examine a user's upcoming travel itineraries, <code>TripItTemplate</code>'s <code>getTrips()</code> can oblige:</p>
<pre><code class="prettyprint java">List trips = tripIt.getTrips();
for(Trip trip : trips) {
    System.out.println(&quot;I&#39;m traveling to &quot; + trip.getPrimaryLocation() +
                                 &quot; on &quot; + trip.getStartDate());
}
</code></pre>
<p>This is just a sampling of the kinds of things you can do with Spring Social's templates. Check out the API documentation to see the other operations that are available.</p>
<h3>Managing OAuth Connections</h3>
<p>When I created the <code>TwitterTemplate</code> instance above, I glossed over where the API key/secret and the access token came from. Initially, the access token would be received after a user authorizes the application to access their data hosted on the service provider. But you probably don't want to force your users to perform authorization every time they use your application, so you'll need a way to store the access tokens long-term for reuse in future sessions.</p>
<p>In its first milestone release Spring Social doesn't provide an OAuth token management strategy, leaving it up to the application to obtain and manage OAuth details for itself. This is something that we intend to address for 1.0 Milestone 2. In the meantime, however, we can look to <a href="http://git.springsource.org/greenhouse/greenhouse">Greenhouse</a> for an example of how this might take shape.</p>
<p>In Greenhouse, all of the information about a service provider is stored in a relational database in a <code>ServiceProvider</code> table with the following schema:</p><p><a href="http://blog.springsource.com/wp-content/uploads/2010/11/SocialProvider1.png"><img src="http://blog.springsource.com/wp-content/uploads/2010/11/SocialProvider1.png" alt="" title="SocialProvider" width="191" height="225" class="alignnone size-full wp-image-6017" /></a></p>
<p>As you can see, the <code>ServiceProvider</code> table includes, among other things, the provider's API key and secret. To access an individual service provider record, Greenhouse uses <code>JdbcServiceProviderFactory</code>, an implementation of a <code>ServiceProvider</code> interface:</p>
<pre><code class="prettyprint java">package com.springsource.greenhouse.connect;

public interface ServiceProviderFactory {

    ServiceProvider getServiceProvider(String name);

    &lt;S&gt; ServiceProvider&lt;S&gt; getServiceProvider(String name, Class&lt;S&gt; serviceType);

}
</code></pre>
<p>To retrieve a Twitter service provider from the database, Greenhouse simply calls the <code>getServiceProvider()</code> method, passing in "twitter" (the provider's name) as a parameter. In the case of Twitter, this ultimately returns an instance of <code>TwitterServiceProvider</code> which is an implementation of the <code>ServiceProvider</code> interface.</p>
<p>The ServiceProvider has several methods, but two of them are interesting with regard to token management. The first, <code>connect()</code>, is used by Greenhouse to create a connection between one of its users and their social identity on the service provider:</p>
<pre><code class="prettyprint java">void connect(Long accountId, AuthorizedRequestToken requestToken);
</code></pre>
<p>At the point where the <code>connect()</code> method is called, Greenhouse has gone through enough of the OAuth dance to have an authorized request token in hand. Passing those along with the user's account ID will create a connection in the <code>AccountConnection</code> table. The <code>AccountConnection</code> table has the following schema:</p><p><a href="http://blog.springsource.com/wp-content/uploads/2010/11/AccountConnection1.png"><img src="http://blog.springsource.com/wp-content/uploads/2010/11/AccountConnection1.png" alt="" title="AccountConnection" width="502" height="167" class="alignnone size-full wp-image-6027" /></a></p>
<p>With the connection having been made, you can use <code>ServiceProvider</code>'s <code>getServiceOperations()</code> method to get an instance of <code>TwitterOperations</code> (the interface that <code>TwitterTemplate</code> is based on):</p>
<pre><code class="prettyprint java">TwitterOperations twitter = twitterProvider.getServiceOperations(accountId);
</code></pre>
<p>Under the covers of <code>getServiceOperations()</code>, the <code>ServiceProvider</code> implementation retrieves the access token and uses it along with its own API key and secret to construct a TwitterTemplate, freeing the application from having to deal with the access token directly.</p>
<p>In Greenhouse, the <code>TwitterOperations</code> instance is a request-scoped bean, created via a factory method in <code>ServiceProvidersApiConfiguration</code>, using Spring JavaConfig like this:</p>
<pre><code class="prettyprint java">@Bean
@Scope(value=&quot;request&quot;, proxyMode=ScopedProxyMode.INTERFACES)
public TwitterOperations twitter(ServiceProvider&lt;TwitterOperations&gt; twitterProvider, @Value(&quot;#{request.getAttribute(&#39;account&#39;)}&quot;) Account account) {

    return twitterProvider.getServiceOperations(accountId(account));

}
</code></pre>
<p>As a Spring bean, the <code>TwitterOperations</code> can be injected into any other Spring bean that needs to exchange data with Twitter. For instance, in Greenhouse, the <code>EventsController</code> is the Spring MVC controller that handles web interaction for all event-oriented requests. It uses a <code>TwitterOperations</code> to post tweets about an event on the user's behalf. It is injected with the <code>TwitterOperations</code> bean through its constructor:</p>
<pre><code class="prettyprint java"><br />@Inject
public EventsController(EventRepository eventRepository, TwitterOperations twitterApi) {
    this.eventRepository = eventRepository;
    this.twitterApi = twitterApi;
}
</code></pre>
<p>As I mentioned, we intend to transition the <code>ServiceProvider</code> facility from Greenhouse to Spring Social in milestone 2. Obviously, the current implementation supports relational storage of OAuth details, but we're eager to hear from you with ideas on other implementations that maintain OAuth information in other kinds of stores.</p>
<h3>Running Greenhouse</h3>
<p>Although you can view the running Greenhouse application at <a target="_blank" href="http://greenhouse.springsource.org">http://greenhouse.springsource.org</a>, you'll probably want to checkout the Greenhouse source code and try it out for yourself as you explore Spring Social. To do that, follow the following steps:</p>
<ol>
<li>Checkout the Greenhouse source code: <br /><code>git clone git://git.springsource.org/greenhouse/greenhouse.git</code></li>
<li>Import the Greenhouse project into <a target="_blank" href="http://www.springsource.com/developer/sts">SpringSource Tool Suite</a></li>
<li>Drag the Greenhouse project into the SpringSource tcServer (under the Servers tab) to deploy the application.</li>
<li>Edit the run configuration for tcServer to add "-DspringProfiles=embedded" to the end of the list of VM arguments.</li>
<li>Start the server and access http://localhost:8080/greenhouse in your web browser.</li>
</ol>
<p>Step 4 is required because Greenhouse uses the new environment beans feature of Spring 3.1, which makes it possible to identify beans that will only be created for certain profiles. Setting that property indicates that the application should be run with the "embedded" profile.</p>
<h3>Conclusion</h3>
<p>Spring Social 1.0 M1 is the first step in an exciting quest to bring social networking capabilities to Spring. I encourage you to <a href="http://www.springsource.com/download/community?project=Spring%20Social">download Spring Social</a>, <a href="http://git.springsource.org/spring-social">check out the code</a>, and provide feedback either through <a href="http://jira.springsource.org/browse/SOCIAL">issue tracking</a>, the <a target="_blank" href="http://forum.springsource.org/forumdisplay.php?f=82">Spring Social Forum</a>, or via the <a href="https://lists.springsource.com/listmanager/listinfo/greenhouse-dev">Greenhouse mailing list</a>.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 371;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>