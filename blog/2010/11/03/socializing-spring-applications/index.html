<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>春季应用社交</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Socializing Spring Applications">
<meta name="twitter:description" content="<p>Increasingly, web surfers are using the internet to connect with friends, family, and colleagues using social networking sites. Conversations that once took place over email are now taking place in short messages written on someone's Facebook wall or in a brief tweet on Twitter. Connections once made with a handshake are now created using LinkedIn. And when a face-to-face meetings are desired, travel details can be shared using TripIt.</p>
<p>Just as people are using these social networking sites to interact with each other, businesses are also finding ways to inject themselves into the social graph so that they can connect in a more personal way with their customers and also make their web sites an extension of their customers' social experiences.</p>
">
<meta name="twitter:creator" content="@habuma">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/52fd524c733cc1098c2eeeae38ea8a20?s=200">

<meta property="og:title" content="Socializing Spring Applications">
<meta property="og:image" content="https://gravatar.com/avatar/52fd524c733cc1098c2eeeae38ea8a20?s=200">
<meta property="og:description" content="<p>Increasingly, web surfers are using the internet to connect with friends, family, and colleagues using social networking sites. Conversations that once took place over email are now taking place in short messages written on someone's Facebook wall or in a brief tweet on Twitter. Connections once made with a handshake are now created using LinkedIn. And when a face-to-face meetings are desired, travel details can be shared using TripIt.</p>
<p>Just as people are using these social networking sites to interact with each other, businesses are also finding ways to inject themselves into the social graph so that they can connect in a more personal way with their customers and also make their web sites an extension of their customers' social experiences.</p>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2010-11-03 16:39:00.0">
</head>
<body >

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">春季应用社交</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/52fd524c733cc1098c2eeeae38ea8a20?s=20&d=mm"> <a class="author" rel="author" href="/team/cwalls">克雷格·沃尔斯</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2010-11-03 16:39:00.0">2010年11月3日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2010/11/03/socializing-spring-applications#disqus_thread" data-disqus-identifier="371">
</a></div>
</div>
</header>
<div class="blog--post"><p>越来越多的网络冲浪者正在使用Internet通过社交网站与朋友，家人和同事联系。曾经通过电子邮件进行的对话现在以写在某人的Facebook墙上或Twitter上的简短推文中的短消息形式进行。握手建立的连接现在可以使用LinkedIn创建。而且，当需要面对面开会时，可以使用TripIt共享旅行详细信息。</p>
<p>就像人们使用这些社交网站进行交互一样，企业也在寻找方法将自己注入社交图谱，以便他们可以以更个性化的方式与客户联系，并使他们的网站成为他们的扩展。客户的社交经验。</p>
<p>本周，我们很高兴发布了<a href="http://www.springframework.org/spring-social">Spring Social</a>的第一个里程碑，这是<a href="http://www.springframework.org/spring-social">Spring</a>的新扩展，旨在提供一个平台，在该平台上可以构建支持社交功能的Spring应用程序。我以为我会借此机会向您介绍Spring Social，并带您对其功能有所了解。</p>
<h3>安全共享社交数据</h3>
<p>从表面上看，开发与各种社交网络交互的应用程序可能看起来很简单。由于大多数社交网络都提供REST API，因此Spring的<code>RestTemplate</code>似乎就是您所需要的。但是您会很快发现，这些社交REST API受<a href="https://oauth.net/">OAuth</a>保护，并且对通过以下方式发送的请求进行签名<code>RestTemplate</code>使用OAuth凭据是一项艰巨的任务。</p>
<p>OAuth是一种开放协议，使用户可以与另一个应用程序共享一个或多个服务提供商上托管的数据。通过访问该数据，应用程序可以以提供额外价值的方式来聚合，呈现和处理信息，这些价值超出了服务提供商本身的预期或想象。</p>
<p>几乎所有主要的服务提供商都支持OAuth，包括Twitter，Facebook，LinkedIn，TripIt和Foursquare以及Google和Yahoo API。因此，OAuth对于开发社交应用程序至关重要。</p>
<p>在OAuth保护的互动的开始，是来回的对话，通常称为“ OAuth Dance”。在典型的OAuth舞蹈中，涉及三个方面：</p>
<ul>
<li>服务提供商（例如Twitter或LinkedIn）</li>
<li>想要访问或更新该服务提供商托管的数据的用户。</li>
<li>用户要与其共享数据的使用者应用程序。</li>
</ul>
<p>舞蹈的主要步骤如下：</p>
<ol>
<li>消费者应用程序将用户定向到服务提供商的站点以登录并授权消费者。</li>
<li>假设用户同意授予消费者对其数据的访问权限，则将流发送回消费者应用程序。</li>
<li>消费者应用程序从服务提供商接收访问令牌。</li>
</ol>
<p>在步骤3中收到的访问令牌是“代客密钥”，必须对服务提供商的REST API提出任何请求。在OAuth 1中，这意味着访问令牌以及请求URL，参数和其他一些信息以基本字符串的形式收集在一起，进行加密，然后在请求中以<code>Authorization</code>标头。构造此标头并将其附加到请求是一项复杂的任务。这就是使用<code>RestTemplate</code>访问受OAuth保护的资源非常困难。如果弄错了，服务提供商将为您尝试访问和调试加密的任何资源提供HTTP 401响应。 <code>Authorization</code>标头很棘手。</p>
<h3>使用社交模板</h3>
<p>Spring Social的关键组成部分是其社交模板的集合。这些模板（利用<code>RestTemplate</code>在幕后）公开了他们建模的服务提供商的操作，处理了添加OAuth的复杂性<code>Authorization</code>标头。</p>
<p>春季社交1.0.0。M1包含4种社交模板供您选择：</p>
<ul>
<li><code>TwitterTemplate</code></li>
<li><code>FacebookTemplate</code></li>
<li><code>LinkedInTemplate</code></li>
<li><code>TripItTemplate</code></li>
</ul>
<p>要使用这些模板中的任何一个，只需创建一个实例，即可通过构造函数参数提供OAuth连接详细信息。例如，创建一个实例<code>TwitterTemplate</code> ：</p>
<pre><code class="prettyprint java">TwitterTemplate twitter = new TwitterTemplate(apiKey, apiSecret, accessToken, accessTokenSecret);
</code></pre>
<p>四个参数<code>TwitterTemplate</code>的构造函数都是Strings值。在Twitter上注册应用程序时，会向您提供API密钥和API密钥（请参阅<a href="https://dev.twitter.com/apps/new">http://dev.twitter.com/apps/new</a> ）。 OToken Dance与Twitter结束时，将按用户将访问令牌和访问令牌密钥授予您的应用程序。在这一点上，我将假设您已经获得了所有这四个值。稍后，我们将回过头来介绍如何管理API密钥和令牌。</p>
<p>创建其他社交模板的实例没有太大不同。 <code>LinkedInTemplate</code>和<code>TripItTemplate</code>每个都具有与相同的参数列表的构造函数<code>TwitterTemplate</code>上面显示的构造函数。由于Facebook的API安全性基于OAuth 2， <code>FacebookTemplate</code>有一个稍微简单的构造函数，只需要访问令牌的值即可：</p>
<pre><code class="prettyprint java">FacebookTemplate facebook = new FacebookTemplate(accessToken);
</code></pre>
<p>一旦有了这些社交模板之一的实例，该怎么办？如果您正在使用<code>TwitterTemplate</code> ，也许您想知道经过身份验证的用户的Twitter屏幕名称：</p>
<pre><code class="prettyprint java">String screenName = twitter.getProfileId();
</code></pre>
<p>或者，如果涉及更多内容，也许您可以代表用户发送一条推文：</p>
<pre><code class="prettyprint java">twitter.updateStatus(&quot;Hey, I&#39;m tweeting with #Spring Social!&quot;);
</code></pre>
<p>同样地， <code>FacebookTemplate</code>您可以将其张贴在用户的墙上：</p>
<pre><code class="prettyprint java">facebook.updateStatus(&quot;Spring Social can also post to Facebook!&quot;);
</code></pre>
<p>如果您想查看用户的即将到来的旅行路线， <code>TripItTemplate</code>的<code>getTrips()</code>可以要求：</p>
<pre><code class="prettyprint java">List trips = tripIt.getTrips();
for(Trip trip : trips) {
    System.out.println(&quot;I&#39;m traveling to &quot; + trip.getPrimaryLocation() +
                                 &quot; on &quot; + trip.getStartDate());
}
</code></pre>
<p>这只是您可以使用Spring Social模板执行的各种操作的示例。查阅API文档以查看其他可用操作。</p>
<h3>管理OAuth连接</h3>
<p>当我创建<code>TwitterTemplate</code>在上面的实例中，我介绍了API密钥/秘密和访问令牌的来源。最初，访问令牌将在用户授权应用程序访问其托管在服务提供商上的数据之后接收。但是您可能不希望强迫用户每次使用应用程序时都执行授权，因此您需要一种长期存储访问令牌以在将来的会话中重用的方法。</p>
<p>在其第一个里程碑版本中，Spring Social不提供OAuth令牌管理策略，而是由应用程序自行获取和管理OAuth详细信息。这是我们计划针对1.0里程碑2解决的问题。但是，与此同时，我们可以向<a href="http://git.springsource.org/greenhouse/greenhouse">Greenhouse</a>举一个示例，说明如何实现这一目标。</p>
<p>在Greenhouse中，有关服务提供商的所有信息都存储在服务器的关系数据库中。 <code>ServiceProvider</code>具有以下架构的表：</p><p><a href="http://blog.springsource.com/wp-content/uploads/2010/11/SocialProvider1.png"><img src="http://blog.springsource.com/wp-content/uploads/2010/11/SocialProvider1.png" alt="" title="社会提供者" width="191" height="225" class="alignnone size-full wp-image-6017"></a></p>
<p>如您所见， <code>ServiceProvider</code>该表除其他外包括提供商的API密钥和机密。要访问单个服务提供商的记录，Greenhouse使用<code>JdbcServiceProviderFactory</code> ，一个<code>ServiceProvider</code>接口：</p>
<pre><code class="prettyprint java">package com.springsource.greenhouse.connect;

public interface ServiceProviderFactory {

    ServiceProvider getServiceProvider(String name);

    &lt;S&gt; ServiceProvider&lt;S&gt; getServiceProvider(String name, Class&lt;S&gt; serviceType);

}
</code></pre>
<p>要从数据库中检索Twitter服务提供商，Greenhouse只需调用<code>getServiceProvider()</code>方法，传入“ twitter”（提供者的名称）作为参数。以Twitter为例，这最终会传回<code>TwitterServiceProvider</code>这是<code>ServiceProvider</code>接口。</p>
<p>ServiceProvider有几种方法，但是其中两种在令牌管理方面很有趣。首先， <code>connect()</code> ，由Greenhouse用于在其用户之一与他们在服务提供商上的社交身份之间建立联系：</p>
<pre><code class="prettyprint java">void connect(Long accountId, AuthorizedRequestToken requestToken);
</code></pre>
<p>在那个地方<code>connect()</code>调用方法之后，Greenhouse经过了足够多的OAuth跳舞，可以拥有授权的请求令牌。将这些密码与用户的帐户ID一起传递会在<code>AccountConnection</code>表。的<code>AccountConnection</code>表具有以下架构：</p><p><a href="http://blog.springsource.com/wp-content/uploads/2010/11/AccountConnection1.png"><img src="http://blog.springsource.com/wp-content/uploads/2010/11/AccountConnection1.png" alt="" title="帐户连接" width="502" height="167" class="alignnone size-full wp-image-6027"></a></p>
<p>建立连接后，您可以使用<code>ServiceProvider</code>的<code>getServiceOperations()</code>获取实例的方法<code>TwitterOperations</code> （该界面<code>TwitterTemplate</code>是根据）：</p>
<pre><code class="prettyprint java">TwitterOperations twitter = twitterProvider.getServiceOperations(accountId);
</code></pre>
<p>在幕后<code>getServiceOperations()</code> ， <code>ServiceProvider</code>实现检索访问令牌并将其与自己的API密钥和密钥一起使用以构造TwitterTemplate，从而使应用程序不必直接处理访问令牌。</p>
<p>在温室里， <code>TwitterOperations</code>实例是一个请求范围的Bean，通过工厂方法在<code>ServiceProvidersApiConfiguration</code> ，使用Spring JavaConfig像这样：</p>
<pre><code class="prettyprint java">@Bean
@Scope(value=&quot;request&quot;, proxyMode=ScopedProxyMode.INTERFACES)
public TwitterOperations twitter(ServiceProvider&lt;TwitterOperations&gt; twitterProvider, @Value(&quot;#{request.getAttribute(&#39;account&#39;)}&quot;) Account account) {

    return twitterProvider.getServiceOperations(accountId(account));

}
</code></pre>
<p>作为春豆， <code>TwitterOperations</code>可以注入任何其他需要与Twitter交换数据的Spring bean中。例如，在温室中， <code>EventsController</code>是Spring MVC控制器，用于处理所有面向事件的请求的Web交互。它使用<code>TwitterOperations</code>代表用户发布有关事件的推文。它被注入<code>TwitterOperations</code> bean通过其构造函数：</p>
<pre><code class="prettyprint java"><br />@Inject
public EventsController(EventRepository eventRepository, TwitterOperations twitterApi) {
    this.eventRepository = eventRepository;
    this.twitterApi = twitterApi;
}
</code></pre>
<p>正如我提到的，我们打算过渡到<code>ServiceProvider</code>在里程碑2中从Greenhouse到Spring Social的设施。显然，当前的实现支持OAuth详细信息的关系存储，但是我们很想听听您关于在其他类型的商店中维护OAuth信息的其他实现的想法。</p>
<h3>运行温室</h3>
<p>尽管您可以在<a href="http://greenhouse.springsource.org" target="_blank">http://greenhouse.springsource.org上</a>查看正在运行的Greenhouse应用程序，但您可能希望检出Greenhouse源代码并在探索Spring Social时自己尝试一下。为此，请按照下列步骤操作：</p>
<ol>
<li>签出温室源代码：<br><code>git clone git://git.springsource.org/greenhouse/greenhouse.git</code></li>
<li>将Greenhouse项目导入<a href="http://www.springsource.com/developer/sts" target="_blank">SpringSource Tool Suite</a></li>
<li>将Greenhouse项目拖到SpringSource tcServer中（在Servers选项卡下）以部署应用程序。</li>
<li>编辑tcServer的运行配置，以将“ -DspringProfiles = embedded”添加到VM参数列表的末尾。</li>
<li>启动服务器，然后在Web浏览器中访问http：// localhost：8080 / greenhouse。</li>
</ol>
<p>需要执行步骤4，因为Greenhouse使用了Spring 3.1的新环境bean功能，这使得可以标识仅为某些概要文件创建的bean。设置该属性表示应用程序应使用“嵌入式”配置文件运行。</p>
<h3>结论</h3>
<p>Spring Social 1.0 M1是向Spring带来社交网络功能的令人兴奋的探索的第一步。我鼓励您<a href="http://www.springsource.com/download/community?project=Spring Social">下载Spring Social</a> ， <a href="http://git.springsource.org/spring-social">检查代码</a> ，并通过<a href="http://jira.springsource.org/browse/SOCIAL">问题跟踪</a> ， <a href="http://forum.springsource.org/forumdisplay.php?f=82" target="_blank">Spring Social论坛</a>或<a href="https://lists.springsource.com/listmanager/listinfo/greenhouse-dev">Greenhouse邮件列表</a>提供反馈。</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 371;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>