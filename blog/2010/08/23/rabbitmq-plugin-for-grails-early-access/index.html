<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>用于Grails的RabbitMQ插件-抢先体验</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="RabbitMQ Plugin for Grails - Early Access">
<meta name="twitter:description" >
<meta property="og:title" content="RabbitMQ Plugin for Grails - Early Access">
<meta property="og:description" >
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2010-08-23 15:45:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">用于Grails的RabbitMQ插件-抢先体验</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="null?s=20&d=mm"> <span class="author">彼得·莱德布鲁克</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2010-08-23 15:45:00.0">2010年8月23日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2010/08/23/rabbitmq-plugin-for-grails-early-access#disqus_thread" data-disqus-identifier="352">
</a></div>
</div>
</header>
<div class="blog--post"><p><a href="https://www.rabbitmq.com/">RabbitMQ</a>是基于<a href="http://blog.springsource.com/2010/06/14/understanding-amqp-the-protocol-used-by-rabbitmq/">高级消息队列协议（AMQP）</a>的轻量级，可靠，可伸缩且可移植的消息代理。它是异构系统和云平台的理想选择，但几乎可用于任何大小的消息传递需求。您（通常）不通过JMS API访问它，实际上JMS插件无济于事，但是现在有一个新的插件专用于简化Grails应用程序中的RabbitMQ的使用。</p><p>插件的当前版本（0.2）相对有限，但是您已经可以发送和接收消息。我鼓励您尝试一下并提供反馈-您有机会影响其发展！</p><p><b>更新</b>随播视频现在可用：</p><p><a href="http://videos.springsource.org/grails/rabbitmq_grails_earlyaccess_web.mov"><img src="http://blog.springsource.com/wp-content/uploads/2010/08/grails-rabbitmq-thmb.png" alt="" title="grails-rabbitmq-thmb" width="200" height="150" class="aligncenter size-full wp-image-5548"></a></p><p><b>更新</b>截屏中创建的示例项目的<a href="http://s3.springsource.com/MRKT/grails/grailsrabbitdemo.zip">源代码</a> 。</p>
<h2>安装代理</h2><p>在尝试插件之前，您将必须在某处设置RabbitMQ服务器。查看RabbitMQ <a href="https://www.rabbitmq.com/server.html">服务器下载页面，</a>然后找到适合您平台的软件包。然后按照适当的<a href="https://www.rabbitmq.com/install.html">安装说明进行操作</a> 。</p><p>我使用Ubuntu虚拟机来运行代理，因为安装是单行的：<br></p><pre><br /> sudo apt-get install rabbitmq-server<br /></pre><br>该命令不仅将安装服务器，还将其配置为在引导时启动。要检查代理是否正在运行，可以执行以下命令：<br><pre><br /> sudo rabbitmqctl status<br /></pre><br>这应该显示看起来像这样的输出<br><pre><br /> Status of node <a href="/cdn-cgi/l/email-protection#cee8edfffffaf5e8edb6f8fff5e8edf7f6f5ace8edb6f8f7f5e8edb6f9faf5e8edf8faf5e8edb6f9fbf5e8edf7f6f5e8edb6f9fbf5a0bae8edb6f9fbf5">&#114;&#x61;&#98;b&#x69;&#x74;&#64;&#x75;&#98;&#x75;nt&#x75;</a> &hellip;<br /> [{running_applications,[{rabbit,&ldquo;RabbitMQ&rdquo;,&ldquo;1.7.2&rdquo;},<br /> {mnesia,&ldquo;MNESIA CXC 138 12&rdquo;,&ldquo;4.4.12&rdquo;},<br /> {os_mon,&ldquo;CPO CXC 138 46&rdquo;,&ldquo;2.2.4&rdquo;},<br /> {sasl,&ldquo;SASL CXC 138 11&rdquo;,&ldquo;2.1.8&rdquo;},<br /> {stdlib,&ldquo;ERTS CXC 138 10&rdquo;,&ldquo;1.16.4&rdquo;},<br /> {kernel,&ldquo;ERTS CXC 138 10&rdquo;,&ldquo;2.13.4&rdquo;}]},<br /> {nodes,[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="6b190a0909021f2b1e091e051f1e">[email&#160;protected]</a>]},<br /> {running_nodes,[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c5b7a4a7a7acb185b0a7b0abb1b0">[email&#160;protected]</a>]}]<br /> &hellip;done.</p><p></pre><br>假定它已安装OK并且正在运行，则可以从Grails应用程序开始使用它。<p></p>
<h2>接收讯息</h2><p>与代理进行交互的第一步涉及安装插件：<br></p><pre><br /> grails install-plugin rabbitmq 0.2<br /></pre><br>完成后，您将看到一条消息，说明您必须先将一些设置添加到<tt>grails-app / conf / Config.groovy</tt>才能使用。具体来说，您必须为代理配置连接工厂，即代理运行的位置以及连接到代理时使用的凭据。因此，在编辑器中打开<tt>Config.groovy</tt>并添加以下内容：<p></p>
<pre><code class="prettyprint groovy">rabbitmq {
    connectionfactory {
        username = &#39;guest&#39;
        password = &#39;guest&#39;
        hostname = &#39;localhost&#39;
        consumers = 5
    }

    queues = {
        msgs()
    }
}
</code></pre><p>这会将插件配置为使用在本地计算机上运行的默认RabbitMQ服务器。如果代理未在本地运行或在虚拟机中运行，则必须更改主机名。并且冒着明显的风险，请确保对代理的生产实例使用更安全的凭据！</p><p>上面的代码还配置了一个名为“ msgs”的队列。重要的是要了解，此设置可确保在应用程序启动时该队列已存在，即，如果不存在，则插件将创建该队列。如果其他应用程序要创建队列，那么你就<em>不会</em>需要配置队列<tt>Config.groovy中</tt> 。有关插件配置的更多信息，请参阅插件的<a href="https://grails-plugins.github.com/grails-rabbitmq/docs/manual/guide/2. Configuration.html#2.1 Configuring Queues">用户指南</a> 。</p><p>现在我们已经建立了一个队列，我们如何处理来自它的消息？简单：创建服务！这是一个示例（文件位置： <tt>grails-app / services / org / example / ConsumerService.groovy</tt> ）：</p>
<pre><code class="prettyprint groovy">package org.example

class ConsumerService {
    static rabbitQueue = &quot;msgs&quot;

    void handleMessage(msg) {
        println &quot;Received message: $msg&quot;
    }
}
</code></pre><p>静态<tt>RabbitQueue</tt>属性告诉插件此服务应侦听哪个队列。在这种情况下，这就是我们在<tt>Config.groovy中</tt>配置的那个。每当消息在队列上可用时，都会调用<tt>handleMessage（）</tt>方法，并且消息的内容将作为参数传递。</p><p>我们现在很高兴出发；我们要做的就是将一些消息发布到该队列。我为此工作借用<a href="https://ndpar.blogspot.com/2010/03/get-started-with-rabbitmq.html">了Groovy脚本</a>并使其可用。目前，它已硬编码为“ localhost”，但是您可以根据需要轻松更改此名称。假设Grails应用程序正在运行，并且已经在路径上安装了Groovy，则可以这样调用脚本：<br></p><pre><br /> groovy publisher.groovy msgs &ldquo;Hello world&rdquo;<br /></pre><br>这会将消息内容“ Hello world”发送到“ msgs”队列。希望您很快会看到<br><pre><br />Received message: Hello world<br /></pre><br>在Grails应用程序的输出中。就是这么简单-好又容易。<p></p>
<h3>消息类型</h3><p>在向您展示如何从Grails应用程序发送消息之前，请先提个警告：AMQP消息的内容基本上是字节序列。通常，由使用者将字节序列（Java中的字节数组）转换为适当的格式，但是如果消息具有适当的内容类型标头，则Grails插件将自动执行转换。实际上，这种自动转换由<a href="http://www.springsource.org/spring-amqp">Spring AMQP</a>库处理，该插件在后台使用。</p><p>这对您意味着什么？好吧，如果您对使用者和发布者都使用了插件或Spring AMQP，则不必担心转换。如果您将地图作为消息发布，则消费者将其视为地图。但是，如果您使用原始的RabbitMQ Java客户端或其他语言/平台，则必须确保内容类型标头由发布者设置，或者自己在使用者中执行数据转换。</p><p>经过一点点转移之后，让我们看一下发送消息。</p>
<h2>传送讯息</h2><p>通过RabbitMQ发送消息比接收消息更容易。该插件会向所有工件（包括控制器和服务<tt>）</tt>动态添加一个名为<tt>RabbitSend（）</tt>的方法。例如，我们可以从如下服务中使用它：</p>
<pre><code class="prettyprint groovy">package org.example

class PublishService {
    void sendMessage(String msg) {
        rabbitSend &#39;msgs&#39;, msg
    }
}
</code></pre><p>该服务仅向“ msgs”队列发送一些文本消息。如果您想要更多的灵活性，则可以使用<tt>rabbitSend（）</tt>方法的另一种形式：<br></p><pre><br /> rabbitSend(String exchange, String routingKey, msg)<br /></pre><br>这将使用给定的路由密钥将消息发送到命名的交换机。尽管该插件本身还不能创建交换，但是它可以与现有的交换进行交互，这使得这种形式的方法比起初看起来更有用。有关交换和路由密钥的更多信息，请参见我的<a href="http://blog.springsource.com/2010/06/14/understanding-amqp-the-protocol-used-by-rabbitmq/">AMQP博客文章</a> 。<p></p><p><b>警告</b>您可能会<tt>偶然</tt>遇到<tt>RabbitSend（msg）</tt> ，即该方法仅接收一条消息，但没有做任何有用的事情-除非您重写<tt>RabbitTemplate</tt> bean，否则该任务不在本文的讨论范围之内。</p><p>正如我之前所指出的，该插件的当前版本确实可以作为早期访问预览提供给那些在此阶段不需要全功能支持但想开始使用RabbitMQ的用户。也就是说，点对点消息传递工作正常，并且如果您能够通过其他方法创建交换，则可以灵活地使用所选的任何路由密钥向他们发送消息。那么，为什么不尝试一下呢？</p></div>
</div>
<section id="disqus_thread"></section>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 352;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>