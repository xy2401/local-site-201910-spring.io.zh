<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>更多Grails 1.3功能</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="More Grails 1.3 features">
<meta name="twitter:description" >
<meta property="og:title">
<meta property="og:type" content="article" 2010="" 05="" 18="" managing-plugins-with-grails-1-3="" ="=">I described how Grails now treats plugins like normal dependencies that can be pulled from Maven-compatible repositories. Although this was the big new feature for 1.3, it wasn’t the only one. In this post, I’ll look at some of the others, starting with a feature that I only recently found out about.
<h2>Named queries</h2>
<p>GORM provides three distinct ways of performing database queries:<br></p>
<ul>
 <br>
 <li>dynamic finders, e.g. Book.findByTitleAndAuthorLike(…);</li>
 <br>
 <li>criteria queries, which use a nice DSL; and</li>
 <br>
 <li>HQL, Hibernate’s SQL-like query language.</li>
 <br>
</ul>
" > <meta>
<meta property="og:article:published_time" content="2010-05-24 17:38:00.0">
</head>
<body >

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">更多Grails 1.3功能</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="null?s=20&d=mm"> <span class="author">彼得·莱德布鲁克</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2010-05-24 17:38:00.0">2010年5月24日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2010/05/24/more-grails-1-3-features#disqus_thread" data-disqus-identifier="323">
</a></div>
</div>
</header>
<div class="blog--post"><p>上周， <a href="/2010/05/18/managing-plugins-with-grails-1-3/">我描述</a>了Grails现在如何将插件像普通的依赖项一样对待，这些依赖项可以从Maven兼容的存储库中提取。尽管这是1.3版的重要新功能，但它并不是唯一的功能。在这篇文章中，我将介绍其他一些功能，从我最近才发现的功能开始。</p>
<h2>命名查询</h2><p>GORM提供了三种不同的执行数据库查询的方式：<br></p><ul><br><li>动态查找器，例如Book.findByTitleAndAuthorLike（…）；</li><br><li>标准查询，使用良好的DSL；和</li><br><li>HQL，Hibernate的类似SQL的查询语言。</li><br></ul><br>这三个功能提供了易用性和强大功能的强大组合，为您提供了所需的灵活性。但是仍然缺少一些东西。<p></p><p>开发一个简单的Grails应用程序，您很快就会意识到您经常一次又一次地使用相同的查询。你该怎么办？复制和粘贴技术很简单，但是会给您带来主要的维护问题。您可以为每个常见查询编写服务方法，但最终会得到非常细粒度的服务和漂亮的域模型。这些查询的理想位置是域类本身。</p><p>那便是命名查询的来源-一项功能已悄悄进入Grails 1.2。</p>
<h3>一个例子</h3><p>让我们考虑一个与报表相关的简单域模型：<br>[标题ID =“ attachment_4791” align =“ alignnone” width =“ 398”] <img src="http://blog.springsource.com/wp-content/uploads/2010/05/report-model.png" alt="报表的领域模型" title="报表的领域模型" width="398" height="235" class="size-full wp-image-4791"> [/字幕]</p><p>基本想法是，报告可以包含大约一台或多台服务器，并且每月可能生成一次或多次。因此， <tt>陶氏</tt>代表“一周中的一天”和<tt>WOM</tt>代表“月的一周”。每个服务器都有一个关联的位置，在简化后的模型中，这只是一个城市的名称。</p><p>现在考虑应用程序可能希望从该模型中提取什么样的信息：也许是在一个月的第一周生成的所有报告，或者是有关特定服务器的所有报告。我们可以向<tt>Report</tt>类添加静态方法以提供此类查询，但是命名查询为我们提供了一些其他好处，您将在稍后看到。</p><p>正如使用Grails所期望的那样，创建命名查询非常简单。只需将静态<tt>namedQueries</tt>属性添加到相关的域类中，然后为其分配一个闭包即可：</p>
<pre><code class="prettyprint groovy">class Report {
    String name

    static hasMany = [frequencies: Frequency, servers: Server]

    static namedQueries = {
        inFirstWeek {
            frequencies {
                eq(&quot;wom&quot;, 1)
            }
        }

        inWeek { wom -&gt;
            frequencies {
                eq(&quot;wom&quot;, wom)
            }
        }

        dilbertsReports {
            servers {
                eq(&quot;mgrEmail&quot;, &quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5e3a37323c3b2c2a1e303129363b2c3b70312c39">[email&#160;protected]</a>&quot;)
            }
        }

        inCity { city -&gt;
            servers {
                location {
                    eq(&quot;city&quot;, city)
                }
            }
        }
}
</code></pre><p>上面的代码设置了四个查询：inFirstWeek，inWeek，dilbertsReports和inCity。然后，您可以在可以使用动态查找器的位置使用它们，例如在控制器操作或服务方法中。如果要检索该月第一周生成的所有报告，请按如下所示调用相关的命名查询：</p>
<pre><code class="prettyprint groovy">Report.inFirstWeek.list()
</code></pre><p>如果要在一个月的其他几周中生成所有报告，请改用<tt>inWeek</tt> ：</p>
<pre><code class="prettyprint groovy">Report.inWeek(2).list()
</code></pre><p>看看如何将参数传递给命名查询？只要确保您的命名查询闭包声明了适当数量的参数即可。</p><p>希望您可以看到声明和使用命名查询是多么容易，但是在继续之前，有几点需要澄清。</p><p>首先，您必须在Grails的标准DSL中编写查询。如果您一直在推迟有关标准DSL的学习，那么您现在就有充分的理由停止拖延！</p><p>其次，您将DSL作为静态属性（如果未传递任何参数）或方法调用，然后调用标准的GORM检索方法，例如<tt>list（）</tt> ， <tt>get（）</tt>或动态查找器。这意味着您可以为命名查询添加额外的过滤。还需要指出的是， <em>如果命名查询的结果包含必需的实体</em> ，则<tt>get（）</tt>将仅返回域实例。否则， <tt>get（）</tt>仅返回<tt>null</tt> 。</p><p>换句话说，假设<tt>inFirstWeek</tt>查询返回ID为1、3和6的域实例。然后</p>
<pre><code class="prettyprint groovy">Report.inFirstWeek.get(3)
</code></pre><p>将返回ID为3的域实例，而</p>
<pre><code class="prettyprint groovy">Report.inFirstWeek.get(2)
</code></pre><p>即使<tt>Report.get（2）</tt>返回真实域实例，也将返回<tt>null</tt> 。因此，命名查询就像一个过滤器。</p><p>到目前为止，一切都很好。命名查询与<tt>get（）</tt> ， <tt>list（）</tt>和动态查找器结合的方式可能足以作为立即使用它们的理由。但是Grails 1.3包含了另一个技巧。</p>
<h3>链接查询</h3><p>命名查询的任意组合听起来如何？好吧，通过链接命名查询，就可以了。例如，如果我想要在该月的第一周生成的所有Dilbert的报告，我可以致电</p>
<pre><code class="prettyprint groovy">Report.dilbertsReports.inFirstWeek.list()
</code></pre><p>另外，如果我想获得有关伦敦服务器的所有第一周报告，我可以使用</p>
<pre><code class="prettyprint groovy">Report.inFirstWeek.inCity(&quot;London&quot;).list()
</code></pre><p>实际上，您可以根据需要链接任意数量的命名查询，只要它们都返回相同类型的域类即可。</p><p>命名查询提供了一种强大的查询重用技术，该技术既易于实现也易于使用。现在，您可以拥有一个非常丰富的域模型，其中包含易于阅读和理解的客户端代码。那有多好？</p><p>现在，我想快速了解一下Grails 1.3的其他功能。</p>
<h2>最好的休息</h2><p>较小但仍有用的功能使其成为Grails 1.3发行版。其中最重要的是对Groovy 1.7的升级（Grails 1.2和以前的版本基于Groovy 1.6）。<br></p><h3>Groovy 1.7</h3><br>Groovy 1.7版本中加入了许多修复和增强功能，但是对于Grails开发人员来说，也许最重要的是以下两个：<br><ol><br><li>现在支持匿名和内部类-因此与Wicket之类的框架进行集成应该容易得多。</li><br><li>强大的断言-现在，您可以使用Groovy <tt>断言</tt>关键字而不是JUnit / TestNG替代方案，以获取断言为何失败的令人印象深刻的诊断信息。我最喜欢的新功能！</li><br></ol><br><h3>脏检查</h3><br>不，这与家务无关！众所周知，Hibernate将自动检查域实例是否已被修改，并在会话结束时保留更改。现在，GORM允许您通过<tt>isDirty（）</tt>方法访问此功能：<p></p>
<pre><code class="prettyprint groovy">def book = Book.get(10)
assert !book.dirty

book.title = &quot;Unknown&quot;
assert book.dirty
assert book.isDirty(&quot;title&quot;)
assert !book.isDirty(&quot;author&quot;)
</code></pre><p>查看如何还检查单个字段是否已被修改？<br></p><h3>全局布局</h3><br>如您所知，Grails允许您通过<tt><meta></tt>标签或按照惯例。它不允许您执行的操作是为视图指定默认布局作为后备选项。现在，该缺陷已得到纠正，您可以通过Config.groovy中的设置来指定默认布局：<p></p>
<pre><code class="prettyprint groovy">grails.sitemesh.default.layout = &#39;defaultLayout&#39;
</code></pre><p>或通过创建文件<tt>grails-app / views / layouts / application.gsp</tt> 。第一种方法是从<tt>grails-app / views / layouts / defaultLayout.gsp获取布局</tt> 。<br></p><h3>JUnit 4</h3><br>对于所有在那里的测试爱好者，Grails最终默认情况下都附带了JUnit 4，因此您现在可以将测试用例注释到您的内心世界中。<p></p><p>到此，我将总结本期Grails 1.3功能。希望您能充分利用命名查询！下次，我将介绍就地插件。</p></div>
</div>
<section id="disqus_thread"></section>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 323;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>