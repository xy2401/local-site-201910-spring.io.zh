<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>Spring Security命名空间的背后</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Behind the Spring Security Namespace">
<meta name="twitter:description" >
<meta name="twitter:creator" content="@tekul">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/91c15183d9efc15c30ff1e65f084314d?s=200">

<meta property="og:title" content="Behind the Spring Security Namespace">
<meta property="og:image" content="https://gravatar.com/avatar/91c15183d9efc15c30ff1e65f084314d?s=200">
<meta property="og:description" >
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2010-03-06 21:38:00.0">
</head>
<body >

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Security命名空间的背后</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/91c15183d9efc15c30ff1e65f084314d?s=20&amp;d=mm"> <span class="author">卢克·泰勒</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2010-03-06 21:38:00.0">2010年3月6日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2010/03/06/behind-the-spring-security-namespace#disqus_thread" data-disqus-identifier="305">
</a></div>
</div>
</header>
<div class="blog--post"><p>通过在Spring Security 2中引入安全模式，使简单安全的应用程序的启动和运行变得更加容易。在较旧的版本中，用户必须分别声明和连接所有实现Bean，从而导致难以理解和维护的庞大而复杂的Spring应用程序上下文文件。学习曲线非常陡峭，我仍然记得，当我在2004年开始从事该项目（当时是Acegi Security）时，花了一些时间才得以解决。从积极的方面来说，对框架的基本构建模块的了解意味着，一旦您设法将工作配置在一起，几乎不可能不对重要的类以及它们如何协同工作有所了解。这些知识反过来又使您处于良好的位置，可以利用自定义的机会，这是使用Spring Security的最大好处之一。</p><p>现在，我们有许多Spring Security用户已经开始使用名称空间，并从其提供的简单性和快速开发机会中受益，但是当您想超越名称空间提供的功能时，事情会变得更加困难。到那时，您必须开始了解框架体系结构以及自定义类将如何适应。您必须知道要扩展的类，要实现的策略接口以及在何处插入它们。学习曲线仍然存在，它刚刚移动。命名空间有意提供了Spring Security所解决问题域的高级视图，因此它实际上隐藏了实现细节，从而使得很难知道实际情况。它确实提供了很多扩展点，但是无论出于何种原因，您可能都觉得需要更深入地研究。</p><p>在本文中，我们将研究Web应用程序的简单名称空间配置，以及它作为成熟的Spring bean配置的外观。我们不会详细介绍bean的功能，但是您可以在参考手册和Javadoc中找到有关特定类和接口的更多信息。这里的材料主要针对已经熟悉基础知识的现有用户，因此，如果您还没有使用过Spring Security，则至少应阅读<a href="http://static.springsource.org/spring-security/site/docs/3.0.x/reference/ns-config.html">参考手册中</a>的名称空间一章，并花一些时间来查看示例应用程序。</p>
<h2>命名空间配置</h2><p>首先让我们看一下我们要替换的名称空间配置。</p>
<pre><code class="prettyprint xml"><br />&lt;beans:beans xmlns=&quot;http://www.springframework.org/schema/security&quot;
    xmlns:beans=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;
      http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
      http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.0.xsd&quot;&gt;

    &lt;http&gt;
        &lt;intercept-url pattern=&quot;/secure/extreme/**&quot; access=&quot;ROLE_SUPERVISOR&quot; /&gt;
        &lt;intercept-url pattern=&quot;/secure/**&quot; access=&quot;IS_AUTHENTICATED_FULLY&quot; /&gt;
        &lt;intercept-url pattern=&quot;/login.htm&quot; access=&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot; /&gt;
        &lt;intercept-url pattern=&quot;/images/*&quot; filters=&quot;none&quot; /&gt;
        &lt;intercept-url pattern=&quot;/**&quot; access=&quot;ROLE_USER&quot; /&gt;
        &lt;form-login login-page=&quot;/login.htm&quot; default-target-url=&quot;/home.htm&quot; /&gt;
        &lt;logout logout-success-url=&quot;/logged_out.htm&quot; /&gt;
    &lt;/http&gt;

    &lt;authentication-manager&gt;
        &lt;authentication-provider&gt;
            &lt;password-encoder hash=&quot;md5&quot;/&gt;
            &lt;user-service&gt;
                &lt;user name=&quot;bob&quot; password=&quot;12b141f35d58b8b3a46eea65e6ac179e&quot; authorities=&quot;ROLE_SUPERVISOR, ROLE_USER&quot; /&gt;
                &lt;user name=&quot;sam&quot; password=&quot;d1a5e26d0558c455d386085fad77d427&quot; authorities=&quot;ROLE_USER&quot; /&gt;
            &lt;/user-service&gt;
        &lt;/authentication-provider&gt;
    &lt;/authentication-manager&gt;

&lt;/beans:beans&gt;
</code></pre><p>这是一个非常简单的示例，类似于您将在在线示例以及该项目随附的示例应用程序中看到的示例。它定义了一个要进行身份验证的用户帐户的内存列表，以及每个用户的权限列表（在这种情况下为简单角色）。它还在Web应用程序中配置了一组受保护的URL模式，基于表单的身份验证机制以及对基本注销URL的支持。</p><p>我们如何用老式的bean配置重现它？在Acegi Security时代中的那些人，可以沿着记忆通道旅行。</p>
<h2>春豆版本</h2>
<h3>认证豆</h3><p>让我们<authentication-manager>首先看一下<authentication-manager>元素（从Spring Security 3.0开始） ，该<authentication-manager>元素必须在任何基于命名空间的配置中声明。在此示例中，该<http>部分取决于此元素（表单登录身份验证机制使用它来进行身份验证）。实际的依赖关系依赖于<tt>AuthenticationManager</tt>接口，该接口封装了Spring Security配置提供的认证服务。您可以在此级别提供自己的实现，但是大多数人使用默认的<tt>ProviderManager</tt> ，它委托给<tt>AuthenticationProvider</tt>实例列表。配置如下所示：</http></authentication-manager></p>
<pre><code class="prettyprint xml"><br />&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:sec=&quot;http://www.springframework.org/schema/security&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;
      http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
      http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.0.xsd&quot;&gt;

    &lt;bean id=&quot;authenticationManager&quot; class=&quot;org.springframework.security.authentication.ProviderManager&quot;&gt;
        &lt;property name=&quot;providers&quot;&gt;
            &lt;list&gt;
                &lt;ref bean=&quot;authenticationProvider&quot; /&gt;
                &lt;ref bean=&quot;anonymousProvider&quot; /&gt;
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;

    &lt;bean id=&quot;authenticationProvider&quot; class=&quot;org.springframework.security.authentication.dao.DaoAuthenticationProvider&quot;&gt;
        &lt;property name=&quot;passwordEncoder&quot;&gt;
            &lt;bean class=&quot;org.springframework.security.authentication.encoding.Md5PasswordEncoder&quot; /&gt;
        &lt;/property&gt;
        &lt;property name=&quot;userDetailsService&quot; ref=&quot;userService&quot; /&gt;
    &lt;/bean&gt;

    &lt;bean id=&quot;anonymousProvider&quot; class=&quot;org.springframework.security.authentication.AnonymousAuthenticationProvider&quot;&gt;
        &lt;property name=&quot;key&quot; value=&quot;SomeUniqueKeyForThisApplication&quot; /&gt;
    &lt;/bean&gt;

    &lt;sec:user-service id=&quot;userService&quot;&gt;
        &lt;sec:user name=&quot;bob&quot; password=&quot;12b141f35d58b8b3a46eea65e6ac179e&quot; authorities=&quot;ROLE_SUPERVISOR, ROLE_USER&quot; /&gt;
        &lt;sec:user name=&quot;sam&quot; password=&quot;d1a5e26d0558c455d386085fad77d427&quot; authorities=&quot;ROLE_USER&quot; /&gt;
    &lt;/sec:user-service&gt;

&lt;/beans&gt;
</code></pre><p>在此阶段，我们将<user-service>元素留<user-service>在原处，以说明可以单独使用它来创建<tt>UserDetailsService</tt>实例，该实例将注入<tt>DaoAuthenticationProvider中</tt> 。我们还切换到使用“ beans”作为默认的XML名称空间。从现在开始我们将假设这一点。<tt>UserDetailsService</tt>是框架中的重要接口，并且只是用于提供用户信息的DAO。它的唯一责任是为命名用户帐户加载数据。豆等效</user-service></p>
<pre><code class="prettyprint xml"><br />&lt;bean id=&quot;userService&quot; class=&quot;org.springframework.security.core.userdetails.memory.InMemoryDaoImpl&quot;&gt;
    &lt;property name=&quot;userMap&quot;&gt;
        &lt;value&gt;
            bob=12b141f35d58b8b3a46eea65e6ac179e,ROLE_SUPERVISOR,ROLE_USER
            sam=d1a5e26d0558c455d386085fad77d427,ROLE_USER
        &lt;/value&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre><p>在这种情况下，名称空间语法更加清晰，但是您可能希望使用自己的<tt>UserDetailsService</tt>实现。Spring Security还具有标准的JDBC和LDAP版本。我们还添加了<tt>AnonymousAuthenticationProvider</tt> ，它纯粹是为了支持出现在下面的Web配置中的<tt>AnonymousAuthenticationFiter</tt> 。</p>
<h3>Web Bean</h3><p>现在，我们来看看如何<http>扩展该<http>块。这更加复杂，因为创建的bean不会明显映射到名称空间中使用的元素名称。</http></p>
<h4><tt>FilterChainProxy</tt></h4><p>您可能已经知道，Spring Security的Web功能是使用servlet过滤器实现的。它在应用程序上下文中维护自己的过滤器链，并使用在web.xml文件中定义的Spring <tt>DelegatingFilterProxy</tt>的实例对此进行委托。实现此委托过滤器链（或可能有多个链）的类称为<tt>FilterChainProxy</tt> 。您可以将<http>块视为创建<tt>FilterChainProxy bean</tt> 。<tt>FilterChainProxy</tt>具有一个名为<tt>filterChainMap</tt>的属性，该属性是模式到过滤器bean列表的映射。因此，例如，您可能会遇到以下情况：</http></p>
<pre><code class="prettyprint xml"><br />    &lt;bean id=&quot;filterChainProxy&quot; class=&quot;org.springframework.security.web.FilterChainProxy&quot;&gt;
        &lt;property name=&quot;matcher&quot;&gt;
            &lt;bean class=&quot;org.springframework.security.web.util.AntUrlPathMatcher&quot;/&gt;
        &lt;/property&gt;
        &lt;property name=&quot;filterChainMap&quot;&gt;
            &lt;map&gt;
                &lt;entry key=&quot;/somepath/**&quot;&gt;
                    &lt;list&gt;
                      &lt;ref local=&quot;filter1&quot;/&gt;
                    &lt;/list&gt;
                &lt;/entry&gt;
                &lt;entry key=&quot;/images/*&quot;&gt;
                    &lt;list/&gt;
                &lt;/entry&gt;
                &lt;entry key=&quot;/**&quot;&gt;
                    &lt;list&gt;
                      &lt;ref local=&quot;filter1&quot;/&gt;
                      &lt;ref local=&quot;filter2&quot;/&gt;
                      &lt;ref local=&quot;filter3&quot;/&gt;
                    &lt;/list&gt;
                &lt;/entry&gt;
            &lt;/map&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
</code></pre><p>其中filter1，filter2等是应用程序上下文中实现<tt>javax.servlet的其他bean的名称<tt>。过滤器</tt>界面。</p><p>因此， <tt>FilterChainProxy</tt>将传入的请求与过滤器列表进行匹配，并将请求通过它找到的第一个匹配链传递。请注意，除了“ / images / *”模式（映射到一个空的过滤器链）以外，这些均未与<intercept-url>&lt;名称空间=“”元素中的模式相关。=“”“ =” =“ <http="">当前配置仅能够维护映射到所有请求的过滤器的单个列表（那些配置为完全绕过过滤器链的请求除外）。</http=""></intercept-url> &lt;&gt;</p><p>由于上面的配置有些冗长，因此可以使用更紧凑的名称空间语法来配置<tt>FilterChainProxy</tt>映射，而不会丢失任何功能。上面的等价于是：</p>
<pre><code class="prettyprint xml"><br />    &lt;bean id=&quot;filterChainProxy&quot; class=&quot;org.springframework.security.web.FilterChainProxy&quot;&gt;
        &lt;sec:filter-chain-map path-type=&quot;ant&quot;&gt;
            &lt;sec:filter-chain pattern=&quot;/somepath/**&quot; filters=&quot;filter1&quot;/&gt;
            &lt;sec:filter-chain pattern=&quot;/images/*&quot; filters=&quot;none&quot;/&gt;
            &lt;sec:filter-chain pattern=&quot;/**&quot; filters=&quot;filter1, filter2, filter3&quot;/&gt;
        &lt;/sec:filter-chain-map&gt;
    &lt;/bean&gt;
</code></pre><p>现在将过滤器链指定为Bean名称的有序列表，按照应用过滤器的顺序。那么，我们原始的名称空间配置会创建哪些过滤器？在这种情况下， <tt>FilterChainProxy</tt>将为：</p>
<pre><code class="prettyprint xml"><br />    &lt;alias name=&quot;filterChainProxy&quot; alias=&quot;springSecurityFilterChain&quot;/&gt;

    &lt;bean id=&quot;filterChainProxy&quot; class=&quot;org.springframework.security.web.FilterChainProxy&quot;&gt;
        &lt;sec:filter-chain-map path-type=&quot;ant&quot;&gt;
            &lt;sec:filter-chain pattern=&quot;/images/*&quot; filters=&quot;none&quot;/&gt;
            &lt;sec:filter-chain pattern=&quot;/**&quot; filters=&quot;securityContextFilter, logoutFilter, formLoginFilter, requestCacheFilter, 
                     servletApiFilter, anonFilter, sessionMgmtFilter, exceptionTranslator, filterSecurityInterceptor&quot; /&gt;
        &lt;/sec:filter-chain-map&gt;
    &lt;/bean&gt;
</code></pre><p>因此，这里有九个过滤器，其中一些是可选的，其中一些是必不可少的。此时，您可以看到您现在接触了名称空间保护您免受攻击的许多细节。您可以控制使用的过滤器和调用它们的顺序，这两者都是至关重要的。</p><p>我们还为bean添加了别名，以匹配先前在<tt>web.xml中</tt>使用的名称。或者，您可以直接使用“ filterChainProxy”。</p>
<h4>滤豆</h4><p>现在，我们将看看这九个过滤器bean和支持它们的其他bean。</p>
<pre><code class="prettyprint xml"><br />&lt;bean id=&quot;securityContextFilter&quot; class=&quot;org.springframework.security.web.context.SecurityContextPersistenceFilter&quot; &gt;
    &lt;property name=&quot;securityContextRepository&quot; ref=&quot;securityContextRepository&quot; /&gt;
&lt;/bean&gt;

&lt;bean id=&quot;securityContextRepository&quot; 
        class=&quot;org.springframework.security.web.context.HttpSessionSecurityContextRepository&quot; /&gt;

&lt;bean id=&quot;logoutFilter&quot; class=&quot;org.springframework.security.web.authentication.logout.LogoutFilter&quot;&gt;
    &lt;constructor-arg value=&quot;/logged_out.htm&quot; /&gt;
    &lt;constructor-arg&gt;
        &lt;list&gt;&lt;bean class=&quot;org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler&quot; /&gt;&lt;/list&gt;
    &lt;/constructor-arg&gt;
&lt;/bean&gt;

&lt;bean id=&quot;formLoginFilter&quot; class=&quot;org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter&quot;&gt;
    &lt;property name=&quot;authenticationManager&quot; ref=&quot;authenticationManager&quot; /&gt;
    &lt;property name=&quot;authenticationSuccessHandler&quot;&gt;
        &lt;bean class=&quot;org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler&quot;&gt;
            &lt;property name=&quot;defaultTargetUrl&quot; value=&quot;/index.jsp&quot; /&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name=&quot;sessionAuthenticationStrategy&quot;&gt;
        &lt;bean class=&quot;org.springframework.security.web.authentication.session.SessionFixationProtectionStrategy&quot; /&gt;
    &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id=&quot;requestCacheFilter&quot; class=&quot;org.springframework.security.web.savedrequest.RequestCacheAwareFilter&quot; /&gt;

&lt;bean id=&quot;servletApiFilter&quot; class=&quot;org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter&quot; /&gt;

&lt;bean id=&quot;anonFilter&quot; class=&quot;org.springframework.security.web.authentication.AnonymousAuthenticationFilter&quot; &gt;
    &lt;property name=&quot;key&quot; value=&quot;SomeUniqueKeyForThisApplication&quot; /&gt;
    &lt;property name=&quot;userAttribute&quot; value=&quot;anonymousUser,ROLE_ANONYMOUS&quot; /&gt;
&lt;/bean&gt;

&lt;bean id=&quot;sessionMgmtFilter&quot; class=&quot;org.springframework.security.web.session.SessionManagementFilter&quot; &gt;
    &lt;constructor-arg ref=&quot;securityContextRepository&quot; /&gt;
&lt;/bean&gt;

&lt;bean id=&quot;exceptionTranslator&quot; class=&quot;org.springframework.security.web.access.ExceptionTranslationFilter&quot;&gt;
    &lt;property name=&quot;authenticationEntryPoint&quot;&gt;
        &lt;bean class=&quot;org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint&quot;&gt;
            &lt;property name=&quot;loginFormUrl&quot; value=&quot;/login.htm&quot;/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id=&quot;filterSecurityInterceptor&quot; class=&quot;org.springframework.security.web.access.intercept.FilterSecurityInterceptor&quot;&gt;
    &lt;property name=&quot;securityMetadataSource&quot;&gt;
        &lt;sec:filter-security-metadata-source&gt;
            &lt;sec:intercept-url pattern=&quot;/secure/extreme/*&quot; access=&quot;ROLE_SUPERVISOR&quot;/&gt;
            &lt;sec:intercept-url pattern=&quot;/secure/**&quot; access=&quot;IS_AUTHENTICATED_FULLY&quot; /&gt;
            &lt;sec:intercept-url pattern=&quot;/login.htm&quot; access=&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot; /&gt;
            &lt;sec:intercept-url pattern=&quot;/**&quot; access=&quot;ROLE_USER&quot; /&gt;
        &lt;/sec:filter-security-metadata-source&gt;
    &lt;/property&gt;
    &lt;property name=&quot;authenticationManager&quot; ref=&quot;authenticationManager&quot; /&gt;
    &lt;property name=&quot;accessDecisionManager&quot; ref=&quot;accessDecisionManager&quot; /&gt;
&lt;/bean&gt;

</code></pre><p>再次，我们使用了一个方便的名称空间元素<tt>filter-security-metadata-source</tt>创建<tt>FilterSecurityInterceptor</tt>所使用的<tt>SecurityMetadataSource</tt>实例，但是您可以在此处插入自己的bean（有关示例，请参见此<a href="http://static.springsource.org/spring-security/site/faq.html#faq-dynamic-url-metadata">FAQ</a> ）。<tt>filter-security-metadata-source</tt>元素创建<tt>DefaultFilterInvocationSecurityMetadataSource</tt>的实例。</p>
<h5><tt>SecurityContextPersistenceFilter</tt></h5><p>该过滤器必须包含在任何过滤器链中。它负责在请求之间存储身份验证信息（ <tt>SecurityContext</tt>实例）。它还用于设置在请求期间将其存储在其中的线程局部变量，并在请求完成时将其清除。它的默认策略是将<tt>SecurityContext</tt>存储在HTTP会话中，因此使用<tt>HttpSessionSecurityContextRepository</tt> bean。</p>
<h5>访问控制</h5><p><tt>FilterSecurityInterceptor</tt>位于堆栈的末尾，并将配置的安全约束应用于传入的请求。如果请求未被授权（或者因为用户未通过身份验证，或者因为他们没有所需的权限），它将引发异常。这将由<tt>ExceptionTranslationFilter</tt>处理，该<tt>异常翻译过滤</tt>器将向用户发送拒绝访问消息，或者通过调用配置的<tt>AuthenticationEntryPoint</tt>启动身份验证过程。在这种情况下，将使用<tt>LoginUrlAuthenticationEntryPoint</tt> ，它将用户重定向到登录页面。在执行此操作之前， <tt>ExceptionTranslationFilter</tt>将缓存当前的请求信息，以便可以在身份验证后将其还原（如果需要）。</p>
<h5>认证过程</h5><p><tt>UsernamePasswordAuthenticationFilter</tt>负责处理提交的登录表单（由<form-login>命名空间元素创建<form-login>）。Bean已配置了<tt>SavedRequestAwareAuthenticationSuccessHandler</tt> ，这意味着它将在用户被要求进行身份验证之前将用户重定向到他们最初请求的URL。然后，原始请求由<tt>RequestCacheFilter</tt>恢复，后者使用请求包装程序，使用户可以从上次中断的地方继续。</form-login></p>
<h5>其他杂项过滤器</h5><p><tt>LogoutFilter</tt>仅负责处理注销链接（默认情况下为<tt>/ j_spring_security_logout</tt> ），清除安全上下文并使会话无效。<tt>AnonymousAuthenticationFilter</tt>负责为匿名用户填充安全上下文，从而使对某些URL放宽的默认安全限制更容易应用。例如，在上述配置中， <tt>IS_AUTHENTICATED_ANONYMOUSLY</tt>属性表示匿名用户可以访问登录页面（但无其他权限）。有关更多信息，请查阅手册中有关该章的章节。它的使用是可选的，如果不使用它，则可以删除多余的<tt>AnonymousAuthenticationProvider</tt> 。</p><p><tt>SecurityContextHolderAwareRequestFilter</tt>使用访问SecurityContext的请求包装器提供标准的servlet API安全方法。如果不需要这些方法，则可以省略此过滤器。如果<em>在当前请求期间对</em>用户进行了身份验证（例如，通过“记住我”身份验证），则<tt>SessionManagementFilter</tt>负责应用与会话相关的策略。在默认配置下，它将创建一个新会话（从现有会话中复制属性），目的是更改会话标识符，并提供针对会话固定攻击的防御。当使用Spring Security的并发会话控制时，也可以使用它。在此配置中， <tt>UsernamePasswordAuthenticationFilter</tt>是唯一的身份验证机制，并且还注入了<tt>SessionFixationProtectionStrategy</tt> 。这意味着我们可以安全地删除会话管理过滤器。</p>
<h4><tt>AccessDecisionManager</tt></h4><p>如果您一直在密切注意，您会注意到我们仍然缺少上述配置中的bean参考。安全拦截器需要使用<tt>AccessDecisionManager</tt>进行配置。如果您使用的是名称空间，则可以在内部创建名称空间，尽管您也可以插入自定义bean。没有命名空间，我们需要显式提供一个。命名空间内部版本的等效形式如下所示：</p>
<pre><code class="prettyprint xml"><br />    &lt;bean id=&quot;accessDecisionManager&quot; class=&quot;org.springframework.security.access.vote.AffirmativeBased&quot;&gt;
        &lt;property name=&quot;decisionVoters&quot;&gt;
            &lt;list&gt;
                &lt;bean class=&quot;org.springframework.security.access.vote.RoleVoter&quot;/&gt;
                &lt;bean class=&quot;org.springframework.security.access.vote.AuthenticatedVoter&quot;/&gt;                
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
</code></pre>
<h4><tt>WebInvocationPrivilegeEvaluator</tt></h4><p>这是名称空间注册的另一个bean，即使它不是直接需要的（它可以在某些JSP标记中使用）。它允许您查询是否允许当前用户调用特定的URL。在控制器bean中，建立应该在显示的视图中提供哪些信息或导航链接可能很有用。</p>
<pre><code class="prettyprint xml"><br />    &lt;bean id=&quot;webPrivilegeEvaluator&quot; class=&quot;org.springframework.security.web.access.DefaultWebInvocationPrivilegeEvaluator&quot;&gt;
        &lt;constructor-arg ref=&quot;filterSecurityInterceptor&quot; /&gt;
    &lt;/bean&gt;
</code></pre>
<h5>结论</h5><p>再次，本文无意详细解释所有这些bean的工作原理，而主要是提供参考，以帮助从基本名称空间配置继续进行，并了解其底层。如您所见，这非常复杂！但是请记住，可以将其中的许多bean插入名称空间配置本身，现在您可以看到它们的实际运行方向。现在，您知道涉及哪些类，您知道了在哪里可以找到《 Spring Security参考手册》，Javadoc以及源代码本身中的更多信息。</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 305;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
 <a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>