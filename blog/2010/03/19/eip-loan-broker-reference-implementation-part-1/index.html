<html dir="ltr" data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>EIP“贷款经纪人”参考实施（第1部分）</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>System.config({baseURL: "/b92013b"});</script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>System.import('app/main.js')</script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="EIP 'Loan Broker' Reference Implementation (Part 1)">
<meta name="twitter:description" content="<p>We are pleased to announce the first installment of the ‘Loan Broker’ Reference Implementation.<br><a href=" http:="" ="" www.enterpriseintegrationpatterns.com="" composedmessagingexample.htm="="></head><body dir="ltr">‘Loan Broker’ concept has become a de-facto reference domain for showcasing <a href="http://www.eaipatterns.com/" target="_blank">Enterprise Integration Patterns</a> (EIP) - <em>by Gregor Hohpe ad Bobby Woolf</em>, and this installment of the Loan Broker RI demonstrates how <em>Enterprise Integration Patterns</em> are realized and applied using <a href="http://www.springsource.org/spring-integration" target="_blank">Spring Integration</a> (SI) framework.<br>
<h3>Introduction</h3>
<br>
<img class="size-full wp-image-4406 alignleft" title="磅管过滤器" src="http://blog.springsource.com/wp-content/uploads/2010/03/lb-pipesFilters.png" alt="磅管过滤器" width="387" height="95">
<p></p>
<p>At the core of EIP architecture are the very simple yet powerful concepts of <a href="http://www.eaipatterns.com/PipesAndFilters.html" target="_blank">Pipes and Filters</a> and <a href="http://www.eaipatterns.com/Message.html" target="_blank">Message</a>. Endpoints (Filters) are connected with one another via Channels (Pipes). The producing endpoint sends Message to the Channel and the Message is retrieved by the Consuming endpoint.  This architecture is meant to define various mechanisms that describe <strong>How</strong><em> </em>information is exchanged between the endpoints, without any awareness of <strong>What</strong> those endpoints are or <strong>What</strong> information they are exchanging, thus providing for a very <em>loosely coupled and flexible collaboration model while also, decoupling <span style="text-decoration:underline">Integration concerns</span> from <span style="text-decoration:underline">Business concerns</span></em>. EIP extends this architecture by further defining:<br></p>
">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=200">

<meta property="og:title" content="EIP 'Loan Broker' Reference Implementation (Part 1)">
<meta property="og:image" content="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=200">
<meta property="og:description" content="<p>We are pleased to announce the first installment of the ‘Loan Broker’ Reference Implementation.<br><a href=" http:="" ="" www.enterpriseintegrationpatterns.com="" composedmessagingexample.htm="=">‘Loan Broker’ concept has become a de-facto reference domain for showcasing <a href="http://www.eaipatterns.com/" target="_blank">Enterprise Integration Patterns</a> (EIP) - <em>by Gregor Hohpe ad Bobby Woolf</em>, and this installment of the Loan Broker RI demonstrates how <em>Enterprise Integration Patterns</em> are realized and applied using <a href="http://www.springsource.org/spring-integration" target="_blank">Spring Integration</a> (SI) framework.<br>
<h3>Introduction</h3>
<br>
<img class="size-full wp-image-4406 alignleft" title="磅管过滤器" src="http://blog.springsource.com/wp-content/uploads/2010/03/lb-pipesFilters.png" alt="磅管过滤器" width="387" height="95">
<p></p>
<p>At the core of EIP architecture are the very simple yet powerful concepts of <a href="http://www.eaipatterns.com/PipesAndFilters.html" target="_blank">Pipes and Filters</a> and <a href="http://www.eaipatterns.com/Message.html" target="_blank">Message</a>. Endpoints (Filters) are connected with one another via Channels (Pipes). The producing endpoint sends Message to the Channel and the Message is retrieved by the Consuming endpoint.  This architecture is meant to define various mechanisms that describe <strong>How</strong><em> </em>information is exchanged between the endpoints, without any awareness of <strong>What</strong> those endpoints are or <strong>What</strong> information they are exchanging, thus providing for a very <em>loosely coupled and flexible collaboration model while also, decoupling <span style="text-decoration:underline">Integration concerns</span> from <span style="text-decoration:underline">Business concerns</span></em>. EIP extends this architecture by further defining:<br></p>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2010-03-19 00:18:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">// Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }</script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">EIP“贷款经纪人”参考实施（第1部分）</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=20&d=mm"> <span class="author">奥列格·朱拉库斯基（Oleg Zhurakousky）</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2010-03-19 00:18:00.0">2010年3月19日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2010/03/19/eip-loan-broker-reference-implementation-part-1#disqus_thread" data-disqus-identifier="310">
</a></div>
</div>
</header>
<div class="blog--post"><p>我们很高兴地宣布“贷款经纪人”参考实施的第一期。<br><a href="http://www.enterpriseintegrationpatterns.com/ComposedMessagingExample.html">“贷款经纪人”的</a>概念已成为展示<a href="http://www.eaipatterns.com/" target="_blank">企业集成模式</a> （EIP）的实际参考域<em>-Gregor Hohpe和Bobby Woolf撰写的</em>本期贷款经纪人RI展示了如何使用<a href="http://www.springsource.org/spring-integration" target="_blank">Spring Integration</a>实现和应用<em>企业集成模式</em> （ SI）框架。<br></p><h3>介绍</h3><br><img class="size-full wp-image-4406 alignleft" title="磅管过滤器" src="http://blog.springsource.com/wp-content/uploads/2010/03/lb-pipesFilters.png" alt="磅管过滤器" width="387" height="95"><p></p><p>EIP体系结构的核心是非常简单但功能强大的<a href="http://www.eaipatterns.com/PipesAndFilters.html" target="_blank">管道和过滤器</a>以及<a href="http://www.eaipatterns.com/Message.html" target="_blank">消息</a>概念。端点（过滤器）通过通道（管道）相互连接。产生端点将消息发送到通道，并且该消息由消耗端点检索。该架构旨在定义描述<strong>如何</strong>各种机制<em> </em>信息在端点之间交换，没有他们交换的这些端点是<strong>什么</strong>任何意识或者<strong>什么样</strong>的信息，从而提供了一个非常<em>松耦合，灵活的合作模式，同时，脱钩<span style="text-decoration:underline">企业的关注</span> <span style="text-decoration:underline">整合的担忧</span></em> 。EIP通过进一步定义来扩展此体系结构：<br></p><ul><br> <li><em><span style="text-decoration:underline">管道</span>的类型（点对点通道，发布-订阅通道，通道适配器等）</em></li><br> <li><em>核心<span style="text-decoration:underline">过滤器</span>和<span style="text-decoration:underline">过滤器</span> <span style="text-decoration:underline">如何与管道协作的</span>模式</em> <em>（消息路由器，拆分器和聚合器，各种消息转换模式等）</em></li><br></ul><br><blockquote><strong>Spring Integration（SI）消息传递框架旨在提供基于企业集成模式之上的基于POJO的编程模型。</strong></blockquote><br><h3>用例</h3><br><a href="http://www.enterpriseintegrationpatterns.com/ComposedMessagingExample.html">在EIP手册的第9章中</a>很好地描述了该用例的详细信息和变体，但这是简要的摘要。<br>消费者在购买最佳贷款报价时购买了贷款经纪人的服务，该经纪人处理诸如以下的详细信息：<br><ol><br> <li><em>消费者预筛选（例如，获取和查看消费者的信用记录）</em></li><br> <li><em>确定最合适的银行（例如，基于消费者的信用记录/得分）</em></li><br> <li><em>向每个选定的银行发送贷款报价请求</em></li><br> <li><em>收集各银行的回应</em></li><br> <li><em>根据消费者的需求过滤响应并确定最佳报价。</em></li><br> <li><em>将贷款报价传递回消费者。</em></li><br></ol><br>显然，获得贷款报价的实际过程要复杂一些，但由于我们的目标是演示如何在SI中实现和实现企业集成模式，因此已简化了用例，仅关注流程的集成方面。 。这不是尝试为您提供有关消费金融的建议。<br><img class="size-full wp-image-4273 alignleft" title="贷款经纪人1" src="http://blog.springsource.com/wp-content/uploads/2010/03/loan-broker-1.png" alt="贷款经纪人1" width="348" height="135"><br>如您所见，通过雇用贷款经纪人，消费者与贷款经纪人的业务细节隔离了，并且每个贷款经纪人的业务都可能相互依赖以保持竞争优势，因此我们组装/实施的任何内容都必须灵活，因此任何可以快速，轻松地进行更改。<br>说到变化，贷款经纪人注册机构的第一部分实际上并没有与任何“假想”的银行或信贷机构进行对话。这些服务已被取消。我们的目标是组装，协调和测试整个过程的<em>集成方面</em> 。只有这样，我们才能开始考虑将这种过程连接到真实服务。我们将在第2部分中做到这一点，您将在其中认识到将<em>集成</em>和<em>业务</em>问题分开的真正好处。您将看到，描述此过程的过程和配置<span style="text-decoration:underline">不会改变，</span>而不管特定的贷款经纪人正在处理的银行数量或所使用的通信介质（或协议）的类型（JMS，WS，TCP等）如何。与这些银行沟通。<br><h3>设计</h3><br>在分析上述6个需求时，您会很快发现它们全部都属于“集成关注点”类别。例如，在消费者预筛选步骤中，我们需要收集有关消费者和消费者需求的其他信息，并使用其他元信息来<em>丰富</em>贷款请求。然后，我们必须<em>过滤</em>这些信息以<em>选择</em>最合适的Bank列表，依此类推。<em>丰富，过滤，选择</em> -这些都是EIP以模式形式定义解决方案的<em>集成问题</em> 。SI提供了这些模式的实现。<p></p><p><strong>提交贷款报价请求<a href="http://www.eaipatterns.com/MessagingGateway.html" target="_blank">-Messaging Gateway</a></strong></p><p><img class="size-full wp-image-4378 alignleft" title="磅网关" src="http://blog.springsource.com/wp-content/uploads/2010/03/lb-gateway1.png" alt="磅网关" width="304" height="73"></p><p>Messaging Gateway模式提供了一种简单的机制来访问消息传递系统，包括我们的贷款经纪人。在SI中，您将网关定义为普通的旧Java接口（无需提供实现），通过XML对其进行配置<em><strong><gateway></gateway></strong></em>元素或通过注释，并将其用作其他任何Spring bean。SI将通过生成消息（有效载荷映射到方法的输入参数）并将其发送到指定的通道，来将方法调用委托和映射到消息传递基础结构。</p><p><em><a href="https://src.springframework.org/svn/spring-integration/trunk/spring-integration-samples/loan-broker/src/main/java/org/springframework/integration/loanbroker/LoanBrokerGateway.java" target="_blank">LoanBrokerGateway.java</a></em>是代表使用者使用的消息网关的接口</p><p><em>网关XML配置：</em></p>
<pre><code class="prettyprint xml"><int:gateway id="loanBrokerGateway"
		     default-request-channel="loanBrokerPreProcessingChannel"
		     service-interface="org.springframework.integration.loanbroker.LoanBrokerGateway"/>
</code></pre><p>在上述配置中，每当在“ <strong>loanBrokerGateway</strong> ” bean上调用任何方法时，都会构造一条消息并将其发送到“ <strong>loanBrokerPreProcessingChannel</strong> ”。</p><p>我们对消息传递网关（ <a href="https://src.springframework.org/svn/spring-integration/trunk/spring-integration-samples/loan-broker/src/main/java/org/springframework/integration/loanbroker/LoanBrokerGateway.java" target="_blank">LoanBrokerGateway.java</a> ）的定义为消费者提供了两种与贷款经纪人进行交互的方式。消费者可以通过调用<em>getLoanQuote（loanRequest）</em>方法来请求一个（最佳）报价，或者通过调用<em>getAllLoanQuotes（loanRequest）</em>方法来<em>请求</em>所有报价。这意味着我们的贷款经纪人必须了解贷款请求的类型。我们还知道，有一些预筛选步骤，例如获取和评估消费者的信用评分，仅仅是因为某些首屈一指的银行通常只会接受来自满足最低信用评分要求的消费者的报价请求。<br></p><blockquote>本质上，这整个过程类似于医生拜访的地方，在见到真正的医生之前，您会遇到需要您测量温度，血压等的护士，并写出医生所需的“元信息”列表。</blockquote><br>在EIP中， <em>消息</em>是一种简单的结构，由<em>消息有效负载</em>和<em>消息头组成</em> 。<em>消息头</em>是一种很好的机制，用于存储与<em>Message</em>相关的元信息。那么，我们如何利用其他信息丰富我们的信息呢？EIP定义了<a href="http://www.enterpriseintegrationpatterns.com/DataEnricher.html">Content Enricher</a>模式，该模式描述了如何使用其他信息来增强<em>消息</em> 。Spring Integration提供了<em><strong><header-enricher></header-enricher></strong></em>元素，可让您快速丰富运输途中的邮件。但是，由于我们的贷款经纪人必须在发送报价之前执行多项任务，因此，如果有一种机制可以由一组单独的任务和独立的任务组成一个流程，那就太好了。<p></p><p><strong>贷款请求预清理– <a href="http://www.eaipatterns.com/DistributionAggregate.html" target="_blank">组成的消息处理器</a>和<a href="http://www.enterpriseintegrationpatterns.com/DataEnricher.html">内容增强器</a></strong></p><p><em>组合消息处理器</em>模式描述了围绕构建端点的规则，这些端点维护对由多个消息处理器组成的消息流的控制。在我们的情况下，预筛选流程包括3个步骤： <em>a）确定贷款请求的类型；</em> <em>b）获取消费者的信用记录和得分；</em> <em>c）（基于一些标准）确定频道列表（每个频道对应于一个单独的银行）</em> 。</p><p>Spring Integration允许您通过<strong><chain></chain></strong>元件</p>
<pre><code class="prettyprint xml"><int:chain id="preScreening" input-channel="loanBrokerPreProcessingChannel" output-channel="banksDistributionChannel">
	<int:header-enricher>
		<int:header name="RESPONSE_TYPE"
			expression="headers.history.iterator().next().attributes['method'].equals('getLoanQuote') ? 'BEST' : 'ALL'" />
	</int:header-enricher>
	<int:header-enricher>
		<int:header name="CREDIT_SCORE" ref="creditBureau" method="getCreditScore"/>
	</int:header-enricher>
	<int:header-enricher>
		<int:header name="BANKS" ref="bankSelector" method="selectBankChannels"/>
	</int:header-enricher>
</int:chain>
</code></pre><p><img class="size-full wp-image-4379 alignleft" title="磅链" src="http://blog.springsource.com/wp-content/uploads/2010/03/lb-chain1.png" alt="磅链" width="526" height="79"></p><p>这将创建一个bean“ <strong>preScreening</strong> ”作为SI <em>链</em>端点，该端点还定义了一个<em>输入/</em> <em>输出</em> <em>通道</em>以接收和发送消息。上面的<em>链</em>由3个<em>头部更丰富的</em>处理器组成。第一个将通过<a href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/expressions.html" target="_blank">SpEL</a>设置<strong>RESPONSE_TYPE</strong>标头，同时访问<a href="http://www.eaipatterns.com/MessageHistory.html" target="_blank">消息历史记录</a>并根据调用的Gateway方法确定此标头的值。</p><blockquote>此示例说明了在确定标头值时如何使用SpEL执行简单的评估，但是我们不主张使用SpEL执行复杂的业务逻辑</blockquote>接下来，我们有一个<em>标头增强器</em> ，该<em>标头增强</em>器映射到一个负责从信用局（当前为<a href="https://src.springframework.org/svn/spring-integration/trunk/spring-integration-samples/loan-broker/src/main/java/org/springframework/integration/loanbroker/stubs/CreditBureauStub.java" target="_blank">CreditBureauStub</a>存根）获取信用评分的进程，并设置<strong>CREDIT_SCORE</strong>标头。最后一个<em>标题增强器</em>使用<a href="https://src.springframework.org/svn/spring-integration/trunk/spring-integration-samples/loan-broker/src/main/java/org/springframework/integration/loanbroker/BanksChannelSelector.java" target="_blank">BankChannelSelector</a> （请参阅<a href="https://src.springframework.org/svn/spring-integration/trunk/spring-integration-samples/loan-broker/src/main/resources/loan-broker-config.xml" target="_blank">bankSelector</a>配置）。<em>BankChannelSelector.selectBankChannels（..）</em>方法的实现将Message作为输入，并返回<string>包含通道名称的 Set <string>值，该值将设置为<strong>BANKS</strong>标头。<br>这样就完成了我们的预筛选过程，我们的贷款经纪人现在准备通过<em>bankDistributionChannel</em>向每个选定的银行发送贷款请求。<p></p><p><strong>BANKS</strong>标头定义动态生成和过滤的通道列表，每个通道充当代表Bank的接收者。我们需要一个端点，使我们可以向所有收件人发送相同的<em>消息</em> 。</p><p><strong>将贷款报价请求分发给选定的银行- <a href="http://www.eaipatterns.com/RecipientList.html" target="_blank">收件人列表</a></strong></p><p><img class="size-full wp-image-4387 alignleft" title="lb-收件人列表" src="http://blog.springsource.com/wp-content/uploads/2010/03/lb-recipientList.png" alt="lb-收件人列表" width="518" height="179"><br>EIP定义了各种类型的路由模式，这些模式均源自<a href="http://www.eaipatterns.com/MessageRouter.html" target="_blank">消息路由器</a> 。其中之一是<a href="http://www.eaipatterns.com/RecipientList.html" target="_blank">收件人列表</a>路由器，它将邮件路由到列表中的所有收件人。SI提供了<strong><router></router></strong>元素，该元素允许我们配置路由器，在本例中，它将从<em>bankDistributionChannel</em>接收<em>消息</em> 。该路由器将通过SpEL表达式从<strong>BANKS</strong> <em>消息标头中</em>获取存储库通道列表（此列表在预筛选步骤中设置），并将<em>消息</em>分发到这些<em>通道</em> 。</p><p>下面的XML配置显示了如何配置此路由器：</p>
<pre><code class="prettyprint xml"><int:router id="bankRecipientListRouter" input-channel="banksDistributionChannel" 
								expression="headers['BANKS']" 
								apply-sequence="true"/>
</code></pre>
<blockquote>通过传递消息时，通过通道（管道）连接各个端点（过滤器），您可以清楚地看到我们如何组装贷款经纪人。您还可以看到，我们仅通过使用Spring Integration API（仅BankChannelSelector.java）通过基于POJO的编程技术来完成该任务。SI负责将POJO与Messaging基础结构接口。</blockquote><p>贷款经纪人需要做的最后一件事是从银行接收贷款报价，按消费者汇总（我们不想显示一个消费者对另一个消费者的报价），根据消费者的选择标准（单个）汇总响应最佳报价或所有报价）并回复给消费者。</p><p><strong>汇总贷款报价响应- <a href="http://www.eaipatterns.com/Aggregator.html" target="_blank">汇总器</a></strong></p><p>聚集器模式描述了一个端点，该端点将相关<em>消息</em>分组为单个<em>消息</em> 。可以提供标准和规则来确定<em>聚合</em>和<em>关联</em>策略。SI提供了Aggregator模式的几种实现以及方便的基于名称空间的配置。</p><p><img class="size-full wp-image-4410 alignleft" title="磅完整" src="http://blog.springsource.com/wp-content/uploads/2010/03/lb-complete.png" alt="磅完整" width="521" height="180"></p><p>我们的贷款经纪人通过定义了一个<em>“ <strong>loanQuoteAggregator</strong></em> ” bean <em><strong><aggregator></aggregator></strong></em>提供默认<em>聚合器</em>和<em>关联</em>策略的元素。默认的关联策略基于<em>$ corelationId</em>标头关联消息（请参阅“ <a href="http://www.eaipatterns.com/CorrelationIdentifier.html" target="_blank">关联标识符”</a>模式）。有趣的是，我们从未提供此标头的值。当它为每个银行生成单独的消息时，它是由收件人列表路由器自动设置的。</p><p>一旦消息关联，它们就被释放到实际的Aggregator实现中。尽管SI提供了默认的Aggregator，但其策略（从所有消息中收集有效负载列表并使用此列表构造新消息作为有效负载）不能满足我们的要求。原因是我们的消费者可能需要一个最佳报价或所有报价。为了传达消费者的请求，在过程的早期，我们设置了RESPONSE_TYPE标头。现在，我们必须评估此标头并返回<em>所有报价</em> （默认的聚合策略将起作用）或<em>最佳报价</em> （默认的聚合策略将不起作用，因为我们必须确定哪个贷款报价是最佳的）。</p>
<pre><code class="prettyprint xml"><int:aggregator id="loanQuoteAggregator" input-channel="quotesAggregationChannel" method="aggregateQuotes">
	<bean class="org.springframework.integration.loanbroker.LoanQuoteAggregator"/>
</int:aggregator>
</code></pre><p>显然，选择最佳报价可能是基于复杂的标准，并且会影响聚合器的复杂性，但是现在我们将其简化。如果消费者想要最好的报价，我们将选择最低利率的报价。为此， <a href="https://src.springframework.org/svn/spring-integration/trunk/spring-integration-samples/loan-broker/src/main/java/org/springframework/integration/loanbroker/LoanQuoteAggregator.java" target="_blank">LoanQuoteAggregator.java</a>将对所有引号进行排序并返回第一个。<a href="https://src.springframework.org/svn/spring-integration/trunk/spring-integration-samples/loan-broker/src/main/java/org/springframework/integration/loanbroker/domain/LoanQuote.java" target="_blank">LoanQuote.java</a>实现了Comparable，它根据<em>rate</em>属性比较报价。</p><p>创建响应消息后，它将发送到启动该过程的消息传递网关（因此是使用者）的<em>默认答复通道</em> 。我们的消费者得到了贷款报价！</p><p>需要注意的一件事是，我们尚未在上定义<i>default-reply-channel</i>属性<em><strong><gateway></gateway></strong></em>元件。实际上，我们还没有明确定义单个<em>通道</em> 。与其他消息系统类似，SI将根据需要自动创建<em>输入</em>和默认<em>回复</em>通道，为您提供了另一种进一步简化Spring Application Context配置的方式。<br></p><h3>结论</h3><br>“贷款经纪人”用例的参考实现是使用Spring Integration框架完成的。基于POJO的轻量级可嵌入消息传递框架，具有松散耦合的编程模型，旨在简化异构系统的集成，而无需类似重量级的ESB引擎或专有的开发和部署环境。它建立在<em><strong>企业集成模式</strong></em>之上。<em>“模式”旨在描述您的解决方案的“构建基块”-它们本身并不是解决方案。因此，模式可以通过轻量级，可嵌入的框架（最好用于支持您的解决方案）而不是旨在控制该解决方案的笨重的现成产品来最好地实现。这是大型供应商都对SOA犯错的地方……” <a href="http://www.infoq.com/articles/Spring-Integration-Joshua-Long#view_38115" target="_blank">-Tom McCuch</a> （SpringSource）在<a href="http://www.infoq.com/articles/Spring-Integration-Joshua-Long" target="_blank">Joshua Long的</a> InfoQ文章中评论</em> 。<br>集成问题存在于所有类型的应用程序中（不是基于服务器的），如果这些应用程序需要相互集成，则不需要更改设计，测试和部署策略。我（开发人员）不应仅仅因为我对集成的关注而将我的SWT或基于控制台的应用程序移植到类似ESB的服务器或实现专有接口。我只想拥有一个框架，只要我对它们或代码或基础结构的更改很少甚至没有更改，就可以解决这些问题。<em>Spring Integration</em>就是那个框架。<p></p><p>在下一部分中，我们将通过使用这些适配器替换存根服务来演示Spring Integration中可用的各种远程适配器和技术，并将介绍与“贷款经纪人”用例有关的异步集成样式。</p><p><strong>资源</strong> ：</p><p><a href="http://www.springsource.org/spring-integration" target="_blank">Spring Integration 2.0发行版提供了“贷款经纪人”参考实现</a><a href="http://www.springsource.org/spring-integration" target="_blank">。M3</a> （请参见下载部分）。它作为独立的Eclipse / Maven项目分发。您也可以从Subversion存储库中将其作为项目检出。<br></p><blockquote>$> svn co <a href="https://src.springframework.org/svn/spring-integration/trunk/spring-integration-samples/loan-broker/">https://src.springframework.org/svn/spring-integration/trunk/spring-integration-samples/loan-broker/</a> loan-broker<br>$> CD贷款经纪人<br>$> mvn安装</blockquote><p></p><p><strong>相关链接</strong> ：<br><a href="http://www.springsource.org/spring-integration" target="_blank">春季整合</a><br><a href="https://www.manning.com/fisher/" target="_blank">春季整合行动</a><br><a href="http://www.eaipatterns.com/index.html" target="_blank">企业整合模式</a><br><a href="http://www.infoq.com/articles/Spring-Integration-Joshua-Long" target="_blank">Spring集成入门（Joshua Long）</a><br><a href="https://tom-mccuch.blogspot.com/" target="_blank">敏捷SOA-第1、2和3部分（Tom McCuch）</a></p><p>感谢Gary Russel <em>（Spring Source，SI comitter）</em>和Dave Turanski <em>（Spring Source）</em>为这个博客提供帮助！</p></string></string></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">var disqus_shortname = 'spring-io';
      var disqus_identifier = 310;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));</script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });</script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>