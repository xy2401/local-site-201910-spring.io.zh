<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Spring Integration Scripting Support - Part 1</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Spring Integration Scripting Support - Part 1" />
<meta name="twitter:description" content="&lt;p&gt;Spring Integration scripting support, available in the 2.1 release, builds upon the Groovy scripting support introduced in 2.0. &amp;nbsp;If you are familiar with Spring Integration, consider scripting support as another tool in your toolbox that you will find useful in certain situations. &amp;nbsp;If you have existing code written in languages such as Groovy, Python, Ruby, or Javascript and need to integrate them with each other or into a Java application, &amp;nbsp;Spring Integration provides a simple way to do this. &amp;nbsp;Whatever the case, this post covers the basics to get you started using your favorite scripting language with Spring Integration.&lt;br&gt;&lt;/p&gt;
" />
<meta name="twitter:creator" content="@dturanski" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/1298cda9d866a053f693e17eee10902b?s=200" />

<meta property="og:title" content="Spring Integration Scripting Support - Part 1" />
<meta property="og:image" content="https://gravatar.com/avatar/1298cda9d866a053f693e17eee10902b?s=200" />
<meta property="og:description" content="&lt;p&gt;Spring Integration scripting support, available in the 2.1 release, builds upon the Groovy scripting support introduced in 2.0. &amp;nbsp;If you are familiar with Spring Integration, consider scripting support as another tool in your toolbox that you will find useful in certain situations. &amp;nbsp;If you have existing code written in languages such as Groovy, Python, Ruby, or Javascript and need to integrate them with each other or into a Java application, &amp;nbsp;Spring Integration provides a simple way to do this. &amp;nbsp;Whatever the case, this post covers the basics to get you started using your favorite scripting language with Spring Integration.&lt;br&gt;&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2011-12-08 18:48:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Integration Scripting Support - Part 1</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/1298cda9d866a053f693e17eee10902b?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/dturanski">David Turanski</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2011-12-08 18:48:00.0">December 08, 2011</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="453" href="/blog/2011/12/08/spring-integration-scripting-support-part-1#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>Spring Integration scripting support, available in the 2.1 release, builds upon the Groovy scripting support introduced in 2.0.  If you are familiar with Spring Integration, consider scripting support as another tool in your toolbox that you will find useful in certain situations.  If you have existing code written in languages such as Groovy, Python, Ruby, or Javascript and need to integrate them with each other or into a Java application,  Spring Integration provides a simple way to do this.  Whatever the case, this post covers the basics to get you started using your favorite scripting language with Spring Integration.<br /><h3><strong>Scripting vs SpEL</strong></h3><br />If you are already using Spring Integration, you are probably  familiar with it&rsquo;s built-in support for the<a href="http://static.springsource.org/spring/docs/current/spring-framework-reference/html/expressions.html"> Spring Expression Language (SpEL)</a>. This provides a light weight alternative to providing a Spring bean to implement simple integration functionality such as transformation, content-based routing, or filtering.  The following example shows how SpEL is used to implement a simple transformer that converts a message payload to upper case and appends a string containing the current time.  Spring Integration automatically binds the Message as the expression context so its <em>payload</em> and <em>headers</em> properties may be referenced in the expression.  Also note how you can incorporate external java classes (java.lang.System) into the SpEL expression.</p>
<pre><code class="prettyprint xml"><br />&lt;int:transformer input-channel=&quot;inChannel&quot;
   output-channel=&quot;outChannel&quot;
   expression=&quot;payload.toUpperCase() + &#39;- [&#39; + T(java.lang.System).currentTimeMillis() + &#39;]&#39;&quot;/&gt;
</code></pre><p>This is a common pattern in Spring Integration. Many of the endpoints provided out of the box include the <em>expression</em> attribute whose contents is interpreted as a SpEL expression that operates on the Message.</p><p>The same thing may be accomplished with an inline script, written in Ruby for example:</p>
<pre><code class="prettyprint xml"><br />&lt;int:transformer input-channel=&quot;inChannel&quot;
    output-channel=&quot;outChannel&quot;&gt;
    &lt;int-script:script lang=&quot;ruby&quot;&gt;
      &quot;#{payload.upcase} -[#{Time.now.to_i}]&quot;
    &lt;/int-script:script&gt;
&lt;/int:transformer&gt;
</code></pre><p>Observe that the body of the script is enclosed within the <em>script</em> tag defined in the scripting namespace introduced in Spring Integration 2.1.  The <em>lang</em> attribute specifies the scripting language (more on that later).  Similar to SpEL, the message payload and headers are automatically bound as script variables.</p><p>If the endpoint implementation requires only a single expression, as in the above example, most people will find SpEL a little more convenient than an inline script.  However, as we will see, scripting  offers additional power and flexibility when needed.<br /><h3>Scripting Basics</h3><br />The simple example above illustrates how to use an inline script in Spring Integration.  In some cases, it is advisable to enclose the body of the script in a CDATA section:</p>
<pre><code class="prettyprint xml"><br />&lt;router input-channel=&quot;inlineScriptInput&quot;&gt;
&lt;int-script:script lang=&quot;javascript&quot;&gt;&lt;![CDATA[
     (function(){
      return payload.length &gt; 5 ? &quot;longStrings&quot; : &quot;shortStrings&quot;;
     })();
   ]]&gt;
   &lt;/int-script:script&gt;
&lt;/router&gt;
</code></pre><p>This is especially true for languages, such as Python, in which line breaks and indentations are part of the syntax.  However, you may also reference an external script with the <em>location</em> attribute :</p>
<pre><code class="prettyprint xml"><br />&lt;script:script lang=&quot;groovy&quot; location=&quot;file:scripts/groovy/myscript.groovy&quot;&gt;
</code></pre><p>As with any Spring resource, you may specify a location on the classpath, the file system, or a web application context.  Using an external script opens up some additional capabilities. For starters, you can provide custom variable bindings to provide additional inputs to the script. These may be primitive types or Spring beans:</p>
<pre><code class="prettyprint xml"><br />&lt;int:service-activator ...&gt;
   &lt;int-script:script language=&quot;python&quot; location=&quot;authorizeCredit.py&quot; refresh-check-delay=&quot;60&quot;&gt;
      &lt;int-script:variable name=&quot;creditService&quot; ref=&quot;creditService&quot;/&gt;
      &lt;int-script:variable name=&quot;maximumAmount&quot; value=&quot;1000.00&quot;/&gt;
   &lt;/int:script:script&gt;
&lt;/int:service-activator&gt;
&lt;bean id=&quot;creditService&quot; class=&quot;com.example.CreditService&quot;&gt;
...
&lt;/bean&gt;
</code></pre><p>Another option provided with external scripts is the ability to periodically update the script contents at runtime.  For example,  if a script is updated on the file system the application context can refresh the script in near real time. To enable this feature simply provide the optional <em>refresh-check-delay </em>attribute, as shown above,  with a value is specified in seconds.  If the value is 0, the refresh happens immediately.  A value less than zero disables refresh.<br /><h3>Under the Hood</h3><br />Spring Integration&rsquo;s scripting support is backed by the JSR223 scripting engine included in Java 6.  Java implements standard APIs required to use JSR233 compliant scripting engines developed by third party providers.  Java 6 does not mandate any particular scripting language but the JDK and JRE does include the Mozilla Rhino Javascript engine.  Scripting engines for other languages require external dependencies such as Groovy, JRuby, and Jython.   If you want to use Python you need  to add the jython library as a runtime dependency in your Maven pom file, for example.</p><p>Likewise, Spring Integration does not mandate or endorse any particular scripting language. We have successfully tested the spring-integration-scripting module with the above languages but your mileage may vary depending on the nuances of the implementation.  As with other JSR specifications, compliance is subject to interpretation.  Additionally, each language implementation must provide a way to import and access Java classes from a scripting environment.  How this is done is not part of the JSR223 specification.</p><p>For example, one minor limitation arises when using Python with Spring Integration. When executing a script, the value returned is expected to be the value of the last executed expression in the main body of the script. Many object oriented scripting languages support return statements in &ldquo;bare&rdquo; scripts.  And the return may be implicit or explicit (the &lsquo;return&rsquo; keyword is optional).  Let&rsquo;s take another look at the first example:</p>
<pre><code class="prettyprint xml"><br />&lt;int:transformer input-channel=&quot;inChannel&quot;
    output-channel=&quot;outChannel&quot;&gt;
    &lt;int-script:script lang=&quot;ruby&quot;&gt;
    &quot;#{payload.upcase} -[#{Time.now.to_i}]&quot;
    &lt;/int-script:script&gt;
&lt;/int:transformer&gt;
</code></pre><p>The body of the script is a single expression with an implicit return.  We could just as well use an explicit return:</p>
<pre><code class="prettyprint xml"><br />&lt;int:transformer input-channel=&quot;inChannel&quot;
    output-channel=&quot;outChannel&quot;&gt;
    &lt;int-script:script lang=&quot;ruby&quot;&gt;
    return &quot;#{payload.upcase} -[#{Time.now.to_i}]&quot;
   &lt;/int-script:script&gt;
&lt;/int:transformer&gt;
</code></pre><p>Or  assign a variable to an expression and return the variable:</p>
<pre><code class="prettyprint xml"><br />&lt;int:transformer input-channel=&quot;inChannel&quot;
 output-channel=&quot;outChannel&quot;&gt;
 &lt;int-script:script lang=&quot;ruby&quot;&gt;
 val = &quot;#{payload.upcase} -[#{Time.now.to_i}]&quot;;
 val
 &lt;/int-script:script&gt;
&lt;/int:transformer&gt;
</code></pre><p>Python works a bit differently.  For starters, implicit return is not supported.  Also a return statement outside of a function or method is not permitted.  Bare expressions are valid in Python but the language makes a subtle distinction between expressions and statements which <a href="https://stackoverflow.com/questions/1887320/get-data-back-from-jython-scripts-using-jsr-223">affects the JSR233 implementation</a>.   For example, if you evaluate the following script with JSR223 with the engine.eval(), you get a null return:</p>
<pre><code class="prettyprint python"><br />def multiply(x,y):
    return x*y
multiply(5,7)
</code></pre><p>Instead, you must assign the result to a variable, e.g., &ldquo;answer&rdquo;,  and invoke engine.get(&ldquo;answer&rdquo;) following the the eval() invocation to get the expected result, 35.</p>
<pre><code class="prettyprint python"><br />def multiply(x,y):
     return x*y
answer = multiply(5,7)
</code></pre><p>Spring Integration includes a work around to address this limitation. If the last statement in the script is a variable assignment, it will parse the variable name and return the value of engine.get().<br /><h3>Scripting vs Spring Beans</h3><br />We have seen how scripting provides an alternative to SpEL expressions when more power and flexibility is needed.  However it is not always obvious when scripting is a better choice than a full blown Spring bean. The sweet spot for scripting seems to be somewhere in the middle of the logic complexity spectrum - more powerful than SpEL but more lightweight than a Spring bean. As is often the case in software design, do the simplest thing that works. If a SpEL expression will do the trick there is no reason to use a script.  If more than one line of code is required, or your application can benefit from  meta-programming features not available in Java, or automatic refresh capabilities, scripting may be the ideal choice. If the logic requires more than a few lines of code, or performance is more important than flexibility, a Spring bean is a better choice</p><p>In the context of this discussion, I have deliberately avoided the term <em>POJO</em> in favor of the more generic <em>Spring bean</em>.  This is to point out that it is possible to implement Spring beans in languages such as Groovy and Scala already without any help from the Spring framework.  Additionally, Core Spring already provides <a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/htmlsingle/spring-framework-reference.html#dynamic-language">dynamic language support</a> allowing you to implement Spring beans in JRuby or BeanShell, for example.  So, even without Spring Integration&rsquo;s scripting support, any Spring bean that follows the appropriate conventions may implement a Spring Integration endpoint.<br /><h3>JSR223 vs Groovy</h3><br />Spring Integration&rsquo;s scripting support builds on Spring Integration&rsquo;s Groovy support introduced in the 2.0 release. The groovy namespace offers similar capabilities and syntax backed by Spring&rsquo;s Groovy scripting API rather than JSR223.  As a consequence, Groovy support offers additional features specific to Groovy.  In many cases, the usage is virtually identical:</p>
<pre><code class="prettyprint xml"><br />&lt;int-groovy:script location=&quot;myScript.groovy&quot;&gt;
   &lt;int-groovy:variable name=&quot;foo&quot; value=&quot;foo&quot;/&gt;
   &lt;int-groovy:variable name=&quot;bar&quot; value=&quot;bar&quot;/&gt;
   &lt;int-groovy:variable name=&quot;date&quot; ref=&quot;date&quot;/&gt;
&lt;/int-groovy:script&gt;

&lt;int-script:script lang=&quot;groovy&quot; location=&quot;myScript.groovy&quot;&gt;
   &lt;int-script:variable name=&quot;foo&quot; value=&quot;foo&quot;/&gt;
   &lt;int-script:variable name=&quot;bar&quot; value=&quot;bar&quot;/&gt;
   &lt;int-script:variable name=&quot;date&quot; ref=&quot;date&quot;/&gt;
&lt;/int-script:script&gt;
</code></pre><p>If you are only interested in Groovy, native support is a better choice. In addition, Spring Integration&rsquo;s Groovy support includes the Groovy control bus which allows you to manage your application at runtime using Groovy scripts.<br /><h3>Some Final Words</h3><br />In this post we have covered the basics of Spring Integration&rsquo;s scripting support providing an easy way to use scripts written in any language in a Spring Integration application. In addition to simplifying integration steps, it is now possible to use Spring Integration to glue together existing scripts written in multiple languages.  In Part 2, we will look at some additional Spring Integration scripting examples.  If you have any good use cases or ideas for scripting, I&rsquo;d love to hear about them!</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 453;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>