<html dir="ltr" data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>Spring集成脚本支持-第1部分</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>System.config({baseURL: "/b92013b"});</script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>System.import('app/main.js')</script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Spring Integration Scripting Support - Part 1">
<meta name="twitter:description" content="<p>Spring Integration scripting support, available in the 2.1 release, builds upon the Groovy scripting support introduced in 2.0.  If you are familiar with Spring Integration, consider scripting support as another tool in your toolbox that you will find useful in certain situations.  If you have existing code written in languages such as Groovy, Python, Ruby, or Javascript and need to integrate them with each other or into a Java application,  Spring Integration provides a simple way to do this.  Whatever the case, this post covers the basics to get you started using your favorite scripting language with Spring Integration.<br></p>
">
<meta name="twitter:creator" content="@dturanski">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/1298cda9d866a053f693e17eee10902b?s=200">

<meta property="og:title" content="Spring Integration Scripting Support - Part 1">
<meta property="og:image" content="https://gravatar.com/avatar/1298cda9d866a053f693e17eee10902b?s=200">
<meta property="og:description" content="<p>Spring Integration scripting support, available in the 2.1 release, builds upon the Groovy scripting support introduced in 2.0.  If you are familiar with Spring Integration, consider scripting support as another tool in your toolbox that you will find useful in certain situations.  If you have existing code written in languages such as Groovy, Python, Ruby, or Javascript and need to integrate them with each other or into a Java application,  Spring Integration provides a simple way to do this.  Whatever the case, this post covers the basics to get you started using your favorite scripting language with Spring Integration.<br></p>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2011-12-08 18:48:00.0">
</head>
<body dir="ltr">

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">// Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }</script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring集成脚本支持-第1部分</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/1298cda9d866a053f693e17eee10902b?s=20&d=mm"> <a class="author" rel="author" href="/team/dturanski">大卫·图兰斯基</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2011-12-08 18:48:00.0">2011年12月8日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2011/12/08/spring-integration-scripting-support-part-1#disqus_thread" data-disqus-identifier="453">
</a></div>
</div>
</header>
<div class="blog--post"><p>2.1发行版中提供了Spring Integration脚本支持，它基于2.0中引入的Groovy脚本支持。如果您熟悉Spring Integration，可以考虑将脚本支持作为工具箱中的另一工具，在某些情况下会发现有用。如果您已经用Groovy，Python，Ruby或Java语言等语言编写了现有代码，并且需要将它们彼此集成或集成到Java应用程序中，那么Spring Integration提供了一种简单的方法来实现。无论如何，这篇文章涵盖了一些基础知识，可以帮助您开始使用自己喜欢的脚本语言和Spring Integration。<br></p><h3><strong>脚本与SpEL</strong></h3><br>如果您已经在使用Spring Integration，则可能熟悉它对<a href="http://static.springsource.org/spring/docs/current/spring-framework-reference/html/expressions.html">Spring Expression Language（SpEL）</a>的内置支持。与提供Spring bean来实现简单的集成功能（例如转换，基于内容的路由或过滤）相比，这提供了一种轻巧的选择。下面的示例演示如何使用SpEL来实现一个简单的转换器，该转换器将消息有效负载转换为大写并附加包含当前时间的字符串。Spring Integration自动将Message绑定为表达式上下文，以便可以在表达式中引用其<em>有效负载</em>和<em>标头</em>属性。还要注意如何合并外部java类（java.lang。系统）进入SpEL表达式。<p></p>
<pre><code class="prettyprint xml"><br><int:transformer input-channel="inChannel"
   output-channel="outChannel"
   expression="payload.toUpperCase() + '- [' + T(java.lang.System).currentTimeMillis() + ']'"/>
</code></pre><p>这是Spring Integration中的常见模式。开箱即用提供的许多端点都包括<em>expression</em>属性，其内容被解释为对Message进行操作的SpEL表达式。</p><p>可以用内联脚本来完成同一件事，例如，用Ruby编写：</p>
<pre><code class="prettyprint xml"><br><int:transformer input-channel="inChannel"
    output-channel="outChannel">
    <int-script:script lang="ruby">
      "#{payload.upcase} -[#{Time.now.to_i}]"
    </int-script:script>
</int:transformer>
</code></pre><p>请注意，脚本主体包含在Spring Integration 2.1中引入的脚本命名空间中定义的<em>script</em>标签内。<em>lang</em>属性指定脚本语言（稍后会详细介绍）。与SpEL相似，消息有效负载和标头会自动绑定为脚本变量。</p><p>如果端点实现只需要一个表达式，如上例所示，大多数人会发现SpEL比内联脚本更方便。但是，正如我们将看到的，脚本在需要时提供了额外的功能和灵活性。<br></p><h3>脚本基础</h3><br>上面的简单示例说明了如何在Spring Integration中使用内联脚本。在某些情况下，建议将脚本主体包含在CDATA节中：<p></p>
<pre><code class="prettyprint xml"><br><router input-channel="inlineScriptInput">
<int-script:script lang="javascript"><![CDATA[
     (function(){
      return payload.length > 5 ? "longStrings" : "shortStrings";
     })();
   ]]>
   </int-script:script>
</router>
</code></pre></div></div></article></div></div></div></div></body></html>