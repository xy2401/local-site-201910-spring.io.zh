<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Social Coding: Pull Requests - What to Do When Things Get Complicated</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Social Coding: Pull Requests - What to Do When Things Get Complicated" />
<meta name="twitter:description" content="&lt;p&gt;Scenario: you want to contribute some code to an open source project hosted on a public git repository service like github. Lots of people make pull requests to projects I&#39;m involved in and many times they are more complicated to merge than they need to be, which slows down the process a bit. The basic workflow is conceptually simple:&lt;/p&gt;
&lt;ol&gt; 
 &lt;li&gt;fork a public open source project&lt;/li&gt; 
 &lt;li&gt;make some changes to it locally and push them up to your own remote fork&lt;/li&gt; 
 &lt;li&gt;ask the project lead to merge your changes with the main codebase&lt;/li&gt; 
&lt;/ol&gt;
" />
<meta name="twitter:creator" content="@david_syer" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=200" />

<meta property="og:title" content="Social Coding: Pull Requests - What to Do When Things Get Complicated" />
<meta property="og:image" content="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=200" />
<meta property="og:description" content="&lt;p&gt;Scenario: you want to contribute some code to an open source project hosted on a public git repository service like github. Lots of people make pull requests to projects I&#39;m involved in and many times they are more complicated to merge than they need to be, which slows down the process a bit. The basic workflow is conceptually simple:&lt;/p&gt;
&lt;ol&gt; 
 &lt;li&gt;fork a public open source project&lt;/li&gt; 
 &lt;li&gt;make some changes to it locally and push them up to your own remote fork&lt;/li&gt; 
 &lt;li&gt;ask the project lead to merge your changes with the main codebase&lt;/li&gt; 
&lt;/ol&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2011-07-18 11:02:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Social Coding: Pull Requests - What to Do When Things Get Complicated</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/dsyer">Dave Syer</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2011-07-18 11:02:00.0">July 18, 2011</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="426" href="/blog/2011/07/18/social-coding-pull-requests-what-to-do-when-things-get-complicated#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>Scenario: you want to contribute some code to an open source project hosted on a public git repository service like github. Lots of people make pull requests to projects I'm involved in and many times they are more complicated to merge than they need to be, which slows down the process a bit. The basic workflow is conceptually simple:</p>
<ol>
<li>fork a public open source project</li>
<li>make some changes to it locally and push them up to your own remote fork</li>
<li>ask the project lead to merge your changes with the main codebase</li>
</ol>
<p>and there is an excellent account of this basic workflow in <a href="http://blog.springsource.com/2010/12/21/social-coding-in-spring-projects">a blog by Keith Donald</a>.</p>
<p>Complications arise when the main codebase changes in between the time you fork it and the time you send the pull request, or (worse) you want to send multiple pull requests for different features or bugfixes, and need to keep them separate so the project owner can deal with them individually. This tutorial aims to help you navigate the complications using git.</p>
<p>The descriptions here use github domain language ("pull request", "fork", "merge" etc.), but the same principles apply to other public git services. We assume for the purposes of this tutorial that the public project is accepting pull requests on its master branch. Most Spring projects work that way, but some other public projects don't. You can substitute the word "master" below with the correct branch name and the same examples should all be roughly correct.</p>
<p>To help you follow what's going on locally, the shell commands below beginning with "$" can be extracted into a script and run in the order they appear. The endpoint should be a local repository in a directory called "work" that has an origin linked to its master branch (simulating the remote public project) and two branches on a private fork. The two branches have the same contents at their heads, but different commit histories (as per the ASCII diagram at the bottom).</p>
<h2>The Two Remote Repositories</h2>
<p>If you are going to send a pull request, there are two remote repositories in the mix: the main public project, and the fork where you push your changes.</p>
<p>It's a matter of taste to some extent, but what I like to do is make the main project the remote "origin" of my working copy, and use my fork as a second remote called "fork". This makes it easy to keep track of what's happening in the main project because all I have to do is</p>
<pre><code># git fetch origin
</code></pre>
<p>and all the changes are available locally. It also means that I never get confused when I do my natural git workflow</p>
<pre><code># git checkout master
# git pull --rebase
... build, test, install etc ...
</code></pre>
<p>which always brings me up to date with the main project. I can keep my fork in sync with the main project simply by doing this after a pull from master:</p>
<pre><code># git push fork
</code></pre>
<h2>Initial Set Up</h2>
<p>Let's create a simple "remote" repo to work with in a sandbox. Instead of using a git service provider we'll just do it locally in your filesystem (using UN*X commands as an example).</p>
<pre><code>$ rm -rf repo fork work
$ git init repo
$ (cd repo; echo foo &gt; foo; git add .; git commit -m "initial"; git checkout `git rev-parse HEAD`)
</code></pre>
<p>(The last checkout there was to leave the repository in a detached head state, so we can later push to it from a clone.) From now on, pretend "repo" is a public github project (e.g. <code>git://github.com/SpringSource/repo.git</code>).</p>
<p>The "fork" URL in this clone command would be something like <code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="395e504d795e504d514c5b175a5654">[email&#160;protected]</a>/myuserid/repo.git</code>. Now we'll create the fork. This is equivalent to what github does when you ask it to fork a repository:</p>
<pre><code>$ git clone repo fork
$ (cd fork; git checkout `git rev-parse HEAD`)
</code></pre>
<p>Finally we need to set up a working directory where we make our changes (remember "repo" = <code>git://github.com/SpringSource/repo.git</code>):</p>
<pre><code>$ git clone repo work
$ cd work
$ git checkout origin/master
</code></pre>
<p>Because we cloned the main public repo that is by default the
remote "origin". We are going to add a new remote so we can push our
changes:</p>
<pre><code>$ git remote add fork ../fork
$ git fetch fork
$ git push fork
</code></pre>
<p>The local repository now has a single commit and looks something
like this in <code>gitk</code> (or your favourite git visiualization
tool):</p>
<pre><code>A (origin/master, fork/master, master)
</code></pre>
<p>In this diagram, "A" is the commit label, and in brackets we list
the branches associated with the commit.</p>
<h2>Get the Latest Stuff</h2>
<p>You can always get the latest stuff from the main repo using</p>
<pre><code># git checkout master
# git pull --rebase
</code></pre>
<p>and sync it with the fork</p>
<pre><code># git push fork
</code></pre>
<p>If you operate this way, keeping master synchronized between the main repo and your fork as much as possible, and never making any local changes to the master branch, you will never have any confusion about where the rest of the world is. Also, if you are going to send multiple pull requests to the same public project, they will not overlap each other if you keep them separate on their own branches (i.e. not on master).</p>
<h2>The Pull Request</h2>
<p>When you want to start work on a pull request, start from a master branch fully up to date as above, and make a new local branch</p>
<pre><code>$ git checkout -b mynewstuff
</code></pre>
<p>Make changes, test etc:</p>
<pre><code>$ echo bar &gt; bar
$ echo myfoo &gt; foo
$ git add .
$ git commit -m "Added bar, edited foo"
</code></pre>
<p>and push it up to your fork repository with the new branch name (not master)</p>
<pre><code>$ git push fork mynewstuff
</code></pre>
<p>If nothing has changed in the origin, you can send a pull request from there.</p>
<h2>What if the Origin Changes?</h2>
<p>For the purpose of this tutorial we simulate a change in the origin like this:</p>
<pre><code>$ cd ../repo
$ git checkout master
$ echo spam &gt; spam; git add .; git commit -m "add spam"
$ git checkout `git rev-parse HEAD`
$ cd ../work
</code></pre>
<p>Now we're ready to react to the change. First we'll bring our local master up to date</p>
<pre><code>$ git checkout master
$ git pull
$ git push fork
</code></pre>
<p>The local repository now looks like this:</p>
<pre><code>A -- B (mynewstuff, fork/mynewstuff)
 \
  -- D (master, fork/master, origin/master)
</code></pre>
<p>Notice how your new stuff does not have <code>origin/master</code> as a direct ancestor (it's on another branch). This makes it awkward for the project owner to merge your changes. You can make it easier by doing some of the work yourself locally, and pushing it up to your fork before sending the pull request.</p>
<h3>Re-writing History on your Branch</h3>
<p>If you aren't collaborating with anyone on your branch it should be absolutely fine to rebase onto the latest changes from the remote repo and force a push:</p>
<pre><code># git checkout mynewstuff
# git rebase master
</code></pre>
<p>The rebase might fail if you have made changes that are incompatible with somehting that happened in the remote repo. You will want to fix the conflicts and commit them before moving on. This makes life difficult for you, but easy for the remote project owner because the pull requiest is guaranteed to merge successfully.</p>
<p>While you are re-writing history, maybe you want to squash some commits together to make the patch easier to read, e.g.</p>
<pre><code># git rebase -i HEAD~2
...
</code></pre>
<p>In any case (even if the rebase went smoothly) if you have already pushed to your fork you will need to force the next push because it has re-written history (assuming the remote repo has changed).</p>
<pre><code># git push --force fork mynewstuff
</code></pre>
<p>The local repository now looks like this (the <code>B</code> commit isn't actually identical to the previous version, but the difference isn't important here):</p>
<pre><code>A -- D (master, fork/master, origin/master) -- B (mynewstuff, fork/mynewstuff)
</code></pre>
<p>Your new branch has a direct ancestor which is <code>origin/master</code> so everyone is happy. Then you are ready to go into github UI and send a pull request for your branch against <code>repo:master</code>.</p>
<h3>What if I want to Keep my Local Commits?</h3>
<p>If you committed your changes locally in multiple steps, maybe you want to keep all you little bitty commits, and still present your pull request as a single commit to the remore repo. That's OK, you can create a new branch for that and send the pull request from there. This is also a good thing to do if you <em>are</em> collaborating with someone on your feature branch and don't want to force the push.</p>
<p>First we'll push the new stuff to the fork repo so that our collaborators can see it (this is unnecessary if you want to keep the changes local):</p>
<pre><code>$ git checkout mynewstuff
$ git push fork
</code></pre>
<p>then we'll create a new branch for the squashed pull request:</p>
<pre><code>$ git checkout master
$ git checkout -b mypullrequest
$ git merge --squash mynewstuff
$ git commit -m "comment for pull request"
$ git push fork mypullrequest
</code></pre>
<p>Here's the local repository:</p>
<pre><code>A -- B (mynewstuff, fork/mynewstuff)
 \
  -- D (master, fork/master, origin/master) -- E (mypullrequest, fork/mypullrequest)
</code></pre>
<p>You are good to go with this and your new branch has a direct ancestor which is <code>origin/master</code> so it will be trivial to merge.</p>
<p>If you weren't collaborating on the <code>mynewstuff</code> branch, you could even throw it away at this point. I often do that to keep my fork clean:</p>
<pre><code># git branch -D mynewstuff
# git push fork :mynewstuff
</code></pre>
<p>Here's the local repo, fully synchronized with both of its remotes:</p>
<pre><code>A -- D (master, fork/master, origin/master) -- E (mypullrequest, fork/mypullrequest)
</code></pre>
<h2>Continue Working on your New Stuff</h2>
<p>Let's say your pull request is rejected and the project owner wants you to make some changes, or the new stuff turns into something more interesting and you need to do some more work on it.</p>
<p>If you didn't delete it above, you can continue to work on your granular branch...</p>
<pre><code>$ git checkout mynewstuff
$ echo yetmore &gt; foo; git commit -am "yet more"
$ git push fork
</code></pre>
<p>and then move the changes over to the pull request branch when you are ready</p>
<pre><code>$ git rebase --onto mypullrequest master mynewstuff
</code></pre>
<p>All the changes we want are in place now, but the branches are on the wrong commits. As you can see below, <code>mynewstuff</code> is where I want <code>mypullrequest</code> to be, and the remote <code>fork/mynewstuff</code> doesn't have a corresponding local branch:</p>
<pre><code>A -- B -- C (fork/mynewstuff)
 \
  -- D (master, fork/master, origin/master) -- E (mypullrequest, fork/mypullrequest) -- F (mynewstuff)
</code></pre>
<p>We can use <code>git reset</code> to switch the two branches to where we want them (you can probably do this is a graphical UI if you like):</p>
<pre><code>$ git checkout mypullrequest
$ git reset --hard mynewstuff
$ git checkout mynewstuff
$ git reset --hard fork/mynewstuff
</code></pre>
<p>and the new repository looks like this:</p>
<pre><code>A -- B -- C (mynewstuff, fork/mynewstuff)
 \
  -- D (master, fork/master, origin/master) -- E (fork/mypullrequest) -- F (mypullrequest)
</code></pre>
<p>If we are OK with the pull request being 2 commits, we can just push it as it is:</p>
<pre><code>$ git checkout mypullrequest
$ git push fork
</code></pre>
<p>The endpoint looks like this:</p>
<pre><code>A -- B -- C(mynewstuff, fork/mynewstuff)
 \
  -- D (master, fork/master, origin/master) -- E -- F (mypullrequest, fork/mypullrequest)
</code></pre>
<p>Or we could rebase it to squash the commits together and force the push, scematically:</p>
<pre><code># git rebase -i HEAD~2
...
# git push --force fork
</code></pre>
<p>Because <code>origin/master</code> is a direct ancestor of <code>fork/mypullrequest</code> I know that my pull request will be trivial to merge.</p>
<h2>Wrap Up</h2>
<p>Hopefully this tutorial has given you enough git ammunition to go ahead and make some changes to your favourite open source project and be confident that the merge will be easy. Remember there is always more than one way to do it, and git is a powerful, low-level tool, so your mileage my vary and you might find variants of the approach above preferable or even necessary, depending on your changes.</p></div>
</div>
<section id="disqus_thread"></section>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 426;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>