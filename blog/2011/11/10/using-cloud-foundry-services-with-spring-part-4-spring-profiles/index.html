<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Using Cloud Foundry Services with Spring: Part 4 – Spring Profiles</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Using Cloud Foundry Services with Spring: Part 4 – Spring Profiles" />
<meta name="twitter:description" content="&lt;p&gt;Spring 3.1 adds significant new support for environments. This new &lt;a href=&quot;http://static.springsource.org/spring/docs/3.1.x/javadoc-api/org/springframework/core/env/Environment.html&quot;&gt;Environment API&lt;/a&gt; makes it easy to expose properties to an application or conditionally load a fragment of configuration.&lt;/p&gt;
&lt;p&gt;In an earlier post in this series, Ramnivas showed how &lt;a href=&quot;http://blog.springsource.com/2011/11/04/using-cloud-foundry-services-with-spring-part-2-auto-reconfiguration/&quot;&gt;Cloud Foundry can automatically connect to a database without manual configuration&lt;/a&gt;. When you need more control over this process, e.g. connecting to multiple databases, the cloud namespace condenses the configuration of a &lt;code&gt;DataSource&lt;/code&gt; into just a single line of XML. The cloud namespace is powerful, but it is only supported for applications running in Cloud Foundry. Using the cloud namespace means coupling that portion of configuration to Cloud Foundry. When not deployed to Cloud Foundry, this configuration should be disabled. Out of container testing is a fundamental tenet of Spring’s philosophy, so it would be unacceptable if an application had to be deployed &amp;nbsp;in order to run an integration test. Spring Profiles solves this problem.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@scothis" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/54721c30ab26a75864d5a9c4f2ae2084?s=200" />

<meta property="og:title" content="Using Cloud Foundry Services with Spring: Part 4 – Spring Profiles" />
<meta property="og:image" content="https://gravatar.com/avatar/54721c30ab26a75864d5a9c4f2ae2084?s=200" />
<meta property="og:description" content="&lt;p&gt;Spring 3.1 adds significant new support for environments. This new &lt;a href=&quot;http://static.springsource.org/spring/docs/3.1.x/javadoc-api/org/springframework/core/env/Environment.html&quot;&gt;Environment API&lt;/a&gt; makes it easy to expose properties to an application or conditionally load a fragment of configuration.&lt;/p&gt;
&lt;p&gt;In an earlier post in this series, Ramnivas showed how &lt;a href=&quot;http://blog.springsource.com/2011/11/04/using-cloud-foundry-services-with-spring-part-2-auto-reconfiguration/&quot;&gt;Cloud Foundry can automatically connect to a database without manual configuration&lt;/a&gt;. When you need more control over this process, e.g. connecting to multiple databases, the cloud namespace condenses the configuration of a &lt;code&gt;DataSource&lt;/code&gt; into just a single line of XML. The cloud namespace is powerful, but it is only supported for applications running in Cloud Foundry. Using the cloud namespace means coupling that portion of configuration to Cloud Foundry. When not deployed to Cloud Foundry, this configuration should be disabled. Out of container testing is a fundamental tenet of Spring’s philosophy, so it would be unacceptable if an application had to be deployed &amp;nbsp;in order to run an integration test. Spring Profiles solves this problem.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2011-11-10 19:45:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Using Cloud Foundry Services with Spring: Part 4 – Spring Profiles</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/54721c30ab26a75864d5a9c4f2ae2084?s=20&amp;d=mm" />
<span class="author">Scott Andrews</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2011-11-10 19:45:00.0">November 10, 2011</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="447" href="/blog/2011/11/10/using-cloud-foundry-services-with-spring-part-4-spring-profiles#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>Spring 3.1 adds significant new support for environments. This new <a href="http://static.springsource.org/spring/docs/3.1.x/javadoc-api/org/springframework/core/env/Environment.html">Environment API</a> makes it easy to expose properties to an application or conditionally load a fragment of configuration.</p><p>In an earlier post in this series, Ramnivas showed how <a href="http://blog.springsource.com/2011/11/04/using-cloud-foundry-services-with-spring-part-2-auto-reconfiguration/">Cloud Foundry can automatically connect to a database without manual configuration</a>. When you need more control over this process, e.g. connecting to multiple databases, the cloud namespace condenses the configuration of a <code>DataSource</code> into just a single line of XML. The cloud namespace is powerful, but it is only supported for applications running in Cloud Foundry. Using the cloud namespace means coupling that portion of configuration to Cloud Foundry. When not deployed to Cloud Foundry, this configuration should be disabled. Out of container testing is a fundamental tenet of Spring’s philosophy, so it would be unacceptable if an application had to be deployed  in order to run an integration test. Spring Profiles solves this problem.</p><p>A <em><a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/new-in-3.1.html#d0e1293">Profile</a></em> in Spring is a fragment of configuration that is only activated when a certain condition is true. Many application platforms have had a concept of development, test, and production configurations. While profiles can be used in this way, they are also much more flexible. There is no predefined set of profiles, except  a “<code>default</code>” profile that is activated when no other profiles are defined. A profile can be used to swap configurations when running in a different environment or to enable an optional feature in your application. It’s up to you how you want to use it.<br /><h2>Isolating Cloud Foundry specific configuration</h2><br />When a Spring application is deployed to Cloud Foundry, the “<code>cloud</code>” profile is automatically enabled. This allows for a pre-defined, convenient location for Cloud Foundry specific application configuration. All specific usages of the cloud namespace should occur within the cloud profile block to allow the application to run outside of Cloud Foundry environments.</p>
<pre><code class="prettyprint xml"><br />&lt;bean id=&quot;mongoTemplate&quot; class=&quot;org.springframework.data.mongodb.core.MongoTemplate&quot;&gt;
    &lt;constructor-arg ref=&quot;mongoDbFactory&quot; /&gt;
&lt;/bean&gt;
&lt;beans profile=&quot;default&quot;&gt;
    &lt;mongo:db-factory id=&quot;mongoDbFactory&quot; dbname=&quot;pwdtest&quot; host=&quot;127.0.0.1&quot; port=&quot;27017&quot; username=&quot;test_user&quot; password=&quot;efgh&quot; /&gt;
&lt;/beans&gt;
&lt;beans profile=&quot;cloud&quot;&gt;
    &lt;cloud:mongo-db-factory id=&quot;mongoDbFactory&quot; /&gt;
&lt;/beans&gt;
</code></pre><p>This sample configuration shows Spring&rsquo;s <code>MongoTemplate</code> being populated from two alternatively configured connection factories. When running on Cloud Foundry, the connection factory is automatically configured. When not running on Cloud Foundry, the connection factory is manually configured with the connection settings to a locally running MongoDB instance.<br /><h2>Enabling an application feature on Cloud Foundry</h2><br />One common question we receive is, “How do I send email from my application?” Unfortunately, SMTP is blocked from applications running on CloudFoundry.com to prevent spam and other abuse.</p><p>However, it is still possible to send email from your Cloud Foundry application. Service providers, such as <a href="http://sendgrid.com/">SendGrid</a>, can send email on your behalf via HTTP web services. When the application is running in your own datacenter, you may want to use the corporate SMTP server, and then use SendGrid when running on CloudFoundry.com.  Here is an example of how to create a service bean to connect to SendGrid in the cloud profile.</p>
<pre><code class="prettyprint xml"><br />&lt;beans profile=&quot;cloud&quot;&gt;
    &lt;bean name=&quot;mailSender&quot; class=&quot;example.SendGridMailSender&quot;&gt;
        &lt;property name=&quot;apiUser&quot; value=&quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ec9583999e89818d8580ac8883818d8582c28f8381">[email&#160;protected]</a>&quot; /&gt;
        &lt;property name=&quot;apiKey&quot; value=&quot;secureSecret&quot; /&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
<h2>Cloud Properties</h2><p>Beyond profiles, cloud specific properties are now exposed directly into the application and can be consumed with Spring’s property placeholder support. These properties include basic information about the application, such as its name and the cloud provider, and detailed connection information for all services bound to the application. This makes it easy to create your own service connection factories. If your application requires a c3p0 connection pool instead of the provided connection pool for some reason, it’s easy to do.</p>
<pre><code class="prettyprint xml"><br />&lt;beans profile=&quot;cloud&quot;&gt;
    &lt;bean id=&quot;c3p0DataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot; destroy-method=&quot;close&quot;&gt;
        &lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt;
        &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://${cloud.services.mysql.connection.host}:${cloud.services.mysql.connection.port}/${cloud.services.mysql.connection.name}&quot; /&gt;
        &lt;property name=&quot;user&quot; value=&quot;${cloud.services.mysql.connection.username}&quot; /&gt;
        &lt;property name=&quot;password&quot; value=&quot;${cloud.services.mysql.connection.password}&quot; /&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre><p>Service properties generally take the form “<code>cloud.services.{service-name}.connection.{property}</code>”. The specific connection properties that are available depend on the type of service.</p><p>For convenience, if there is a single service of a given type bound to the application, an alias will be created based on the service type instead of the service name. For a MySQL service, the properties will take the form “<code>cloud.services.mysql.connection.{property}</code>”.<br /><h2>Available today, automagically</h2><br />Both the cloud profile and properties are automatically available to all Spring applications running on Cloud Foundry. Use of Spring 3.1 (or later) is required. Our goal is to create a frictionless path to get running on Cloud Foundry while still making it easy to take control when needed.  Most importantly, we want to allow maximum portability for Spring applications to run everywhere without having to manually configure the application for each deployment environment.</p></div>
</div>
<section id="disqus_thread"></section>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 447;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>