<html dir="ltr" data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>在Spring中使用Cloud Foundry Services：第3部分-<cloud>名称空间</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>System.config({baseURL: "/b92013b"});</script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>System.import('app/main.js')</script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Using Cloud Foundry Services with Spring: Part 3 - the <cloud> namespace">
<meta name="twitter:creator" content="@trisberg" http:="" ="" blog.springsource.com="" 2011="" 11="" 04="" using-cloud-foundry-services-with-spring-part-2-auto-reconfiguration="" ="="></meta>Using Cloud Foundry Services with Spring: Part 2 - Auto-reconfiguration that when you deploy a Spring application, your use of data services will be detected, and your application will automatically be re-configured to use the cloud services available to your application. This works great for simple applications and demos, but if you have a serious production application you probably want to have more control. You also need more control if you have multiple services of the same type. Ramnivas hinted at this saying that you can opt out of auto-reconfiguration by explicitly using the cloud data service factory beans like <code>CloudMongoDbFactoryBean</code>, <code>CloudRedisConnectionFactoryBean</code> etc. The easiest way to do this is to use the <code><cloud></code> namespace for your service definitions. This blog post will cover this namespace in more detail.
" > <meta>
<meta name="twitter:image:src" content="https://gravatar.com/avatar/c2ce75a3d51fc3a2d86a3643d2e90033?s=200">

<meta property="og:title" content="Using Cloud Foundry Services with Spring: Part 3 - the <cloud> namespace">
<meta property="og:image" content="https://gravatar.com/avatar/c2ce75a3d51fc3a2d86a3643d2e90033?s=200">
<meta property="og:type" content="article" http:="" ="" blog.springsource.com="" 2011="" 11="" 04="" using-cloud-foundry-services-with-spring-part-2-auto-reconfiguration="" ="="></meta>Using Cloud Foundry Services with Spring: Part 2 - Auto-reconfiguration that when you deploy a Spring application, your use of data services will be detected, and your application will automatically be re-configured to use the cloud services available to your application. This works great for simple applications and demos, but if you have a serious production application you probably want to have more control. You also need more control if you have multiple services of the same type. Ramnivas hinted at this saying that you can opt out of auto-reconfiguration by explicitly using the cloud data service factory beans like <code>CloudMongoDbFactoryBean</code>, <code>CloudRedisConnectionFactoryBean</code> etc. The easiest way to do this is to use the <code><cloud></code> namespace for your service definitions. This blog post will cover this namespace in more detail.
" > <meta>
<meta property="og:article:published_time" content="2011-11-09 14:58:00.0">
</head>
<body dir="ltr">

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">// Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }</script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">在Spring中使用Cloud Foundry Services：第3部分- <cloud>名称空间</cloud></h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/c2ce75a3d51fc3a2d86a3643d2e90033?s=20&d=mm"> <a class="author" rel="author" href="/team/trisberg">托马斯·里斯伯格</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2011-11-09 14:58:00.0">2011年11月9日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2011/11/09/using-cloud-foundry-services-with-spring-part-3-the-cloud-namespace#disqus_thread" data-disqus-identifier="448">
</a></div>
</div>
</header>
<div class="blog--post"><p>我们在上一篇博客文章中看到<a href="http://blog.springsource.com/2011/11/04/using-cloud-foundry-services-with-spring-part-2-auto-reconfiguration/">将Cloud Foundry Services与Spring结合使用：第2部分-自动重新配置</a> ，当您部署Spring应用程序时，将检测到对数据服务的使用，并且将自动将您的应用程序重新配置为使用云适用于您的应用程序的服务。这对于简单的应用程序和演示非常有用，但是，如果您有认真的生产应用程序，则可能希望拥有更多控制权。如果您具有多个相同类型的服务，则还需要更多控制。Ramnivas暗示这句话，您可以通过显式使用诸如<code>CloudMongoDbFactoryBean</code> ， <code>CloudRedisConnectionFactoryBean</code>等云数据服务工厂bean来选择退出自动重新配置。最简单的方法是使用<code><cloud></code>服务定义的名称空间。这篇博客文章将更详细地介绍该名称空间。</p>
<h2>包括<code><cloud></code>应用程序中的名称空间。</h2><p>您需要在构建中包括org.cloudfoundry：cloudfoundry-runtime依赖项。如果您使用的是Maven，请将此依赖项添加到pom.xml中：</p>
<pre><code class="prettyprint xml"><br><dependencies>
    <dependency>
        <groupId>org.cloudfoundry</groupId>
        <artifactId>cloudfoundry-runtime</artifactId>
        <version>0.8.1</version>
    </dependency>

    <!-- additional dependency declarations -->
</dependencies>
</code></pre><p>您还需要在pom.xml中具有Spring Framework Milestone存储库。只需将此存储库声明添加到您的存储库中：</p>
<pre><code class="prettyprint xml"><br><repositories>
    <repository>
        <id>org.springframework.maven.milestone</id>
        <name>Spring Framework Maven Milestone Repository</name>
        <url>http://maven.springframework.org/milestone</url>
    </repository>

    <!-- additional repository declarations -->
</repositories>
</code></pre><p>现在我们准备添加<code><cloud></code>应用程序上下文文件的名称空间。我们需要声明名称空间（第5行），并提供架构位置（第8行）。声明之后，我们可以使用<code><cloud></code> xml文件中的名称空间元素（第10行）。这是完整的示例：</p>
<pre><code class="prettyprint xml"><br><?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:context="http://www.springframework.org/schema/context"
  xmlns:cloud="http://schema.cloudfoundry.org/spring"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd
	http://schema.cloudfoundry.org/spring http://schema.cloudfoundry.org/spring/cloudfoundry-spring-0.8.xsd">

    <cloud:mongo-db-factory id="mongoDbFactory">

    <bean id="mongoTemplate" class="org.springframework.data.mongodb.core.MongoTemplate">
        <constructor-arg ref="mongoDbFactory"/> 	
    </bean>

    <!-- more beans for your app -->

</beans>
</code></pre><p>本博文的其余部分介绍了所有可用的名称空间元素及其配置选项。</p>
<h2>可用的命名空间元素</h2>
<h3><code><cloud:data-source></code></h3><p>的<code><cloud:data-source></code>元素提供了一种方便的方法来为您的Spring应用程序配置JDBC <code>DataSource</code> 。</p><p>基本属性：</p>
<ul>
<li><strong>id-</strong>默认为服务名称</li>
<li><strong>服务名称</strong> -仅当您将多个关系数据库服务绑定到应用程序时才需要</li>
</ul><p><br></p><p>一个简单的示例<code>DataSource</code>配置将被注入到<code>JdbcTemplate</code> ，如下所示，唯一的属性用于指定数据源bean的ID。</p>
<pre><code class="prettyprint xml"><br><cloud:data-source id="dataSource" />

<bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
  <property name="dataSource" ref="dataSource" />
</bean>
</code></pre><p>有一些子元素可用于配置特定的连接和池设置。的<code><cloud:data-source></code>名称空间元素通过以下方式支持最常用的配置选项： <code><cloud:connection></code>和<code><cloud:pool></code>子元素。支持的选项说明如下：</p><p><strong><code><cloud:connection></code>选项</strong></p>
<table border="1">
<tbody>
<tr>
<th>命名空间属性</th>
<th>描述</th>
<th>类型</th>
</tr>
<tr>
<td>属性</td>
<td>建立新连接时将发送到JDBC驱动程序的连接属性。字符串格式必须为“ propertyName = property;”。</td>
<td>串</td>
</tr>
</tbody><tbody>
</tbody></table><p><br></p><p><strong><code><cloud:pool></code>选项</strong></p>
<table border="1">
<tbody>
<tr>
<th>命名空间属性</th>
<th>描述</th>
<th>类型</th>
<th>默认</th>
</tr>
<tr>
<td>泳池大小</td>
<td>池中的最大连接数或指定范围的最小和最大大小（由破折号分隔）。</td>
<td>整型</td>
<td>使用Apache Commons Pool的默认设置（最小为0，最大为8）</td>
</tr>
<tr>
<td>最大等待时间</td>
<td>在引发异常之前，池将等待（没有可用连接时）连接返回的最大毫秒数。 -1表示无限等待。</td>
<td>整型</td>
<td>使用Apache Commons Pool的默认设置，该设置是无限的（-1）</td>
</tr>
</tbody><tbody>
</tbody></table><p><br></p><p>这是指定了其他设置的<code>DataSource</code>配置的示例：</p>
<pre><code class="prettyprint xml"><br><cloud:data-source id="mydatasource">
    <cloud:connection properties="charset=utf-8;" />
    <cloud:pool pool-size="5-10" max-wait-time="2000" />
</cloud:data-source>
</code></pre>
<h3><code><cloud:mongo-db-factory></code></h3><p>的<code><cloud:mongo-db-factory></code>元素提供了一种方便的方法来为您的Spring应用程序配置MongoDB连接工厂。</p><p>基本属性：</p>
<ul>
<li><strong>id-</strong>默认为服务名称</li>
<li><strong>服务名称</strong> -仅在您将多个MongoDB服务绑定到应用程序时才需要</li>
<li><strong>write-</strong> concern-用于创建的所有数据库连接（NONE，NORMAL，SAFE，FSYNC_SAFE）的WriteConcern。如果未指定，则不会为数据库连接设置WriteConcern，并且所有写操作均默认为NORMAL</li>
</ul><p><br></p><p>write-concern属性的值与<code>com.mongodb.WriteConcern</code></p><code>com.mongodb.WriteConcern</code></div><code>com.mongodb.WriteConcern</code></div><code>com.mongodb.WriteConcern</code></article><code>com.mongodb.WriteConcern</code></div><code>com.mongodb.WriteConcern</code></div><code>com.mongodb.WriteConcern</code></div><code>com.mongodb.WriteConcern</code></div><code>com.mongodb.WriteConcern</code></body></html>