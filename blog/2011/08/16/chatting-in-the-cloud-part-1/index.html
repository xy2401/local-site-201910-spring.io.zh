<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Chatting in the Cloud: Part 1</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Chatting in the Cloud: Part 1" />
<meta name="twitter:description" content="&lt;p&gt;Last week the availability of &lt;a target=&quot;_blank&quot; href=&quot;http://www.rabbitmq.com/&quot;&gt;RabbitMQ&lt;/a&gt; as a service on &lt;a target=&quot;_blank&quot; href=&quot;http://cloudfoundry.com/&quot;&gt;Cloud Foundry&lt;/a&gt; was &lt;a target=&quot;_blank&quot; href=&quot;http://blog.cloudfoundry.com/post/8713844574/rabbitmq-cloud-foundry-cloud-messaging-that-just-works&quot;&gt;announced&lt;/a&gt;. Any application running on Cloud Foundry may now send and receive messages via a RabbitMQ broker that can be provisioned as a service with a single command (e.g. &lt;em&gt;‘vmc create-service rabbitmq’&lt;/em&gt;). Instances of the messaging service may be shared between applications, and since RabbitMQ is a protocol-based broker, those applications may even be written in different languages. So, this is an exciting announcement for those interested in modular, polyglot, event-driven applications running in the cloud. I will be posting a series of blogs that focus on those types of applications. In this post, I am going to keep things simple and focus on the initial experience for Spring developers.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@m_f_" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/443e6ec0242c3f54001dae34374780e2?s=200" />

<meta property="og:title" content="Chatting in the Cloud: Part 1" />
<meta property="og:image" content="https://gravatar.com/avatar/443e6ec0242c3f54001dae34374780e2?s=200" />
<meta property="og:description" content="&lt;p&gt;Last week the availability of &lt;a target=&quot;_blank&quot; href=&quot;http://www.rabbitmq.com/&quot;&gt;RabbitMQ&lt;/a&gt; as a service on &lt;a target=&quot;_blank&quot; href=&quot;http://cloudfoundry.com/&quot;&gt;Cloud Foundry&lt;/a&gt; was &lt;a target=&quot;_blank&quot; href=&quot;http://blog.cloudfoundry.com/post/8713844574/rabbitmq-cloud-foundry-cloud-messaging-that-just-works&quot;&gt;announced&lt;/a&gt;. Any application running on Cloud Foundry may now send and receive messages via a RabbitMQ broker that can be provisioned as a service with a single command (e.g. &lt;em&gt;‘vmc create-service rabbitmq’&lt;/em&gt;). Instances of the messaging service may be shared between applications, and since RabbitMQ is a protocol-based broker, those applications may even be written in different languages. So, this is an exciting announcement for those interested in modular, polyglot, event-driven applications running in the cloud. I will be posting a series of blogs that focus on those types of applications. In this post, I am going to keep things simple and focus on the initial experience for Spring developers.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2011-08-16 18:07:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Chatting in the Cloud: Part 1</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/443e6ec0242c3f54001dae34374780e2?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/mfisher">Mark Fisher</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2011-08-16 18:07:00.0">August 16, 2011</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="434" href="/blog/2011/08/16/chatting-in-the-cloud-part-1#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>Last week the availability of <a target="_blank" href="https://www.rabbitmq.com/">RabbitMQ</a> as a service on <a target="_blank" href="http://cloudfoundry.com/">Cloud Foundry</a> was <a target="_blank" href="http://blog.cloudfoundry.com/post/8713844574/rabbitmq-cloud-foundry-cloud-messaging-that-just-works">announced</a>. Any application running on Cloud Foundry may now send and receive messages via a RabbitMQ broker that can be provisioned as a service with a single command (e.g. <em>&lsquo;vmc create-service rabbitmq&rsquo;</em>). Instances of the messaging service may be shared between applications, and since RabbitMQ is a protocol-based broker, those applications may even be written in different languages. So, this is an exciting announcement for those interested in modular, polyglot, event-driven applications running in the cloud. I will be posting a series of blogs that focus on those types of applications. In this post, I am going to keep things simple and focus on the initial experience for Spring developers.</p><p>First, I would encourage you to check out <a target="_blank" href="http://support.cloudfoundry.com/entries/20322602-getting-started-with-the-rabbitmq-service-from-a-spring-application">this tutorial</a> as the best way to get started even if you have no previous experience with Cloud Foundry. There you will see how a simple Spring application can be built with Maven and deployed to Cloud Foundry with the <a target="_blank" href="http://support.cloudfoundry.com/entries/20012337-getting-started-guide-command-line-vmc-users">VMC command line tool</a>. That application then introduces RabbitMQ with its MVC controller being enhanced to publish and retrieve Messages. It shows how to configure and use the RabbitMQ service through the <a target="_blank" href="http://www.springsource.org/spring-amqp">Spring AMQP</a> library.</p><p>Also, on the day of the original Cloud Foundry announcement (and the same day as these <a target="_blank" href="https://blogs.vmware.com/console/2011/04/cloud-foundry-delivering-on-vmwares-open-paas-strategy.html">blog</a> <a target="_blank" href="http://blog.springsource.com/2011/04/12/launching-cloud-foundry/">posts</a>), I posted <a target="_blank" href="http://blog.springsource.com/2011/04/12/cloud-foundry-for-spring-developers/">another blog</a> that covered the basics of the &ldquo;cloud&rdquo; namespace support. Reading through that may also help set the stage for what you&rsquo;re about to see. Specifically, we&rsquo;ve extended the &ldquo;cloud&rdquo; namespace to include support for a RabbitMQ ConnectionFactory, and that will be covered when we get to the configuration overview below.</p><p>Now, I would like to introduce another sample application that demonstrates a simple chat server. RabbitMQ provides a great backbone for a versatile chat app since it supports different types of exchanges, such as &ldquo;direct&rdquo;/point-to-point, &ldquo;topic&rdquo;-based publish/subscribe, and &ldquo;fanout&rdquo; for simple broadcasting. Also RabbitMQ supports a wide variety language bindings. Add the fact that it&rsquo;s basically just a flip of a switch to enable messaging in the cloud, and now many different apps can easily share the service. As mentioned above, I will be progressively enhancing the sample and posting a few more blog posts down the road to cover those exchange types and some polyglot chatting, but for now my goal is to provide an accessible starting point with just global broadcasting through a fanout exchange. The current state of the application is not much more complex than that featured in the tutorial. I will be walking through some of the configuration and code, but if you want to follow along and delve into more detail, I recommend cloning the sample from the SpringSource <a target="_blank" href="https://github.com/SpringSource/cloudfoundry-samples">cloudfoundry-samples</a> repository on github.</p>
<h2>The 'rabbit-chat' Sample Application</h2><p>Here&rsquo;s what the running application looks like:</p><p><a href="http://blog.springsource.com/wp-content/uploads/2011/08/rabbit-chat-browser.png"><img src="http://blog.springsource.com/wp-content/uploads/2011/08/rabbit-chat-browser.png" alt="" title="rabbit-chat-browser" width="604" height="546" class="alignnone size-full wp-image-9386" /></a></p><p>That form will submit HTTP POST requests using jQuery:</p>
<pre><code class="prettyprint javascript"><br />$(&#39;#chatForm&#39;).submit(
	function() {
		$.post(
			$(&#39;#chatForm&#39;).attr(&quot;action&quot;),
			$(&#39;#chatForm&#39;).serialize(),
			function(response) {
				if (response) {
					confirm(response.id);
				}
			});
		$(&#39;#text&#39;).val(&quot;&quot;);
		return false;
	});
</code></pre><p>And, the chat log will be regularly updated via polling - also using jQuery&rsquo;s AJAX support:</p>
<pre><code class="prettyprint javascript"><br />$.ajax({
	url : &quot;chatlog&quot;,
	success : function(message) {
		if (message &amp;&amp; message.length) {
			var messagesDiv = $(&#39;#messages&#39;);
			messagesDiv.html(message);
			messagesDiv.animate({ scrollTop: messagesDiv.attr(&quot;scrollHeight&quot;) - messagesDiv.height() }, 150);
		}
		timer = poll();
	},
	error : function() {
		timer = poll();
	},
	cache : false
});
</code></pre>
<h2>The Java Code</h2><p>If you clone the repository and cd into the &lsquo;rabbit-chat&rsquo; directory, you will see the following structure:</p><p><code><br /><pre style="background-color:black;color:white"><br />├── pom.xml<br />├── src<br />│   └── main<br />│   ├── java<br />│   │   └── org<br />│   │   └── cloudfoundry<br />│   │   └── samples<br />│   │   └── rabbitmq<br />│   │   └── chat<br />│   │   └── ChatController.java<br />│   ├── resources<br />│   │   └── static<br />│   │   └── js<br />│   │   └── jquery.min.js<br />│   └── webapp<br />│   └── WEB-INF<br />│   ├── spring<br />│   │   └── servlet-context.xml<br />│   ├── views<br />│   │   └── chat.jsp<br />│   └── web.xml<br /></pre><br /></code></p><p>The <a target="_blank" href="https://github.com/SpringSource/cloudfoundry-samples/blob/master/rabbit-chat/pom.xml">pom.xml</a> file declares the dependencies. Of particular interest are the following:<br /><ul><br /> <li>spring-webmvc (3.0.5.RELEASE)</li><br /> <li>spring-rabbit (1.0.0.RC3)</li><br /> <li>cloudfoundry-runtime (0.7.1)</li><br /></ul></p><p>The <a target="_blank" href="https://github.com/SpringSource/cloudfoundry-samples/blob/master/rabbit-chat/src/main/webapp/WEB-INF/web.xml">web.xml</a> file declares a Spring MVC DispatcherServlet and a single catch-all servlet-mapping (&ldquo;/&rdquo;).</p><p>As you can see there is a single controller called &ldquo;ChatController&rdquo;. It is configured via annotations. It uses the @Controller and @RequestMapping annotations as well as @Autowired. Since ChatController is really the heart of the application (and its only Java code), let&rsquo;s have a quick look at the entire implementation:</p>
<pre><code class="prettyprint java"><br />@Controller
public class ChatController {

	@Autowired
	private volatile AmqpTemplate amqpTemplate;

	private final Queue&lt;String&gt; messages = new LinkedBlockingQueue&lt;String&gt;();

	@RequestMapping(value = &quot;/&quot;)
	public String home() {
		return &quot;WEB-INF/views/chat.jsp&quot;;
	}

	@RequestMapping(value = &quot;/publish&quot;, method = RequestMethod.POST)
	@ResponseStatus(value = HttpStatus.OK)
	public void publish(@RequestParam String username, @RequestParam String text) {
		this.amqpTemplate.convertAndSend(username + &quot;: &quot; + text);
	}

	@RequestMapping(value = &quot;/chatlog&quot;)
	@ResponseBody
	public String chatlog() {
		return StringUtils.arrayToDelimitedString(this.messages.toArray(), &quot;&lt;br/&gt;&quot;);
	}

	/**
	 * This method is invoked when a RabbitMQ Message is received.
	 */
	public void handleMessage(String message) {
		if (messages.size() &gt; 100) {
			messages.remove();
		}
		messages.add(message);
	}
}
</code></pre><p>There are 3 controller methods (those annotated with @RequestMapping), and each one has a single line of code. The simplest of these is <em>home()</em> which returns the location of the JSP to render. I would typically use a Spring MVC ViewResolver, but since it&rsquo;s just a single page app using AJAX, that is the only view that is ever rendered directly. As you can see, <em>home()</em> will be invoked anytime you request the application root.</p><p>The <em>publish(..)</em> method is invoked for HTTP POST requests to the relative URL &ldquo;/publish&rdquo;, and it expects two parameters in the request: username and text. Those are provided by the HTML form that you saw in the previous section. It is rendered by <a target="_blank" href="https://github.com/SpringSource/cloudfoundry-samples/blob/master/rabbit-chat/src/main/webapp/WEB-INF/views/chat.jsp">chat.jsp</a>. The publish method does nothing more than concatenate the username + text values into a single String to be converted into an AMQP Message and sent by the <em>AmqpTemplate</em> after which it responds with a simple HTTP 200 (OK) status. The template instance has been autowired into the Controller. We will look at the AmqpTemplate configuration shortly along with the underlying <em>ConnectionFactory</em> that enables use of the RabbitMQ service on Cloud Foundry.</p><p>The <em>chatlog()</em> method simply returns up to 100 of the most recent messages that have been part of the chat. It&rsquo;s the method being polled by the AJAX request shown in the previous section. The <em>handleMessage(..)</em> method is responsible for queuing those chat messages, and so that is the one connected to an underlying message listener. That pretty much covers the application&rsquo;s functionality.</p>
<h2>The Spring Configuration</h2><p>Now, we can walk through the configuration for this application. This could have been done completely in Java with annotations, but hopefully you agree that this is a rather concise configuration file:</p>
<pre><code class="prettyprint xml"><br />&lt;context:component-scan base-package=&quot;org.cloudfoundry.samples.rabbitmq.chat&quot;/&gt;

&lt;mvc:annotation-driven/&gt;

&lt;mvc:resources location=&quot;file:./src/main/resources/static/,classpath:/static/&quot; mapping=&quot;static/**&quot;/&gt;

&lt;rabbit:queue id=&quot;chatQueue&quot;/&gt;

&lt;rabbit:fanout-exchange name=&quot;chatExchange&quot;&gt;
	&lt;rabbit:bindings&gt;
		&lt;rabbit:binding queue=&quot;chatQueue&quot;/&gt;
	&lt;/rabbit:bindings&gt;
&lt;/rabbit:fanout-exchange&gt;

&lt;rabbit:template connection-factory=&quot;rabbitConnectionFactory&quot; exchange=&quot;chatExchange&quot;/&gt;

&lt;rabbit:admin connection-factory=&quot;rabbitConnectionFactory&quot;/&gt;

&lt;rabbit:listener-container&gt;
	&lt;rabbit:listener queues=&quot;chatQueue&quot; ref=&quot;chatController&quot; method=&quot;handleMessage&quot;/&gt;
&lt;/rabbit:listener-container&gt;

&lt;cloud:rabbit-connection-factory id=&quot;rabbitConnectionFactory&quot;/&gt;
</code></pre><p>The &lsquo;component-scan&rsquo; element enables the @Contoller-annotated class to be registered as a Spring-managed object, and it also activates the support for @Autowired. The two elements with the &lsquo;mvc&rsquo; prefix simply setup the MVC @RequestMapping support and enable the loading of static resources (in this case used for the jQuery support that is provided in the &lsquo;resources/static/js&rsquo; directory).</p><p>The rest of the elements are relevant for the RabbitMQ configuration. The &ldquo;rabbit:admin&rdquo; generates an instance of <em>RabbitAdmin</em> that is responsible for recognizing Exchanges, Queues, and Bindings that are defined within the same application context. Notice that the queue element has &ldquo;chatQueue&rdquo; as its <strong>id</strong> but that id does not have a &ldquo;name&rdquo; attribute. That will trigger the creation of a Queue with a unique, generated name that is exclusive to this particular application. In other words, the &ldquo;id&rdquo; attribute&rsquo;s value does not map to the Queue&rsquo;s name; it is the id of the Spring bean, but not of the RabbitMQ Queue. Even though it has a generated name, it needs to be identifiable for referencing within this application context. For example, you can see that it is referenced in the binding for the &ldquo;chatExchange&rdquo; that is defined here as a Fanout Exchange. That exchange will also be declared against the broker, since the &ldquo;rabbit:admin&rdquo; element is present.</p><p>The &ldquo;rabbit:template&rdquo; is pretty straightforward. It requires a reference to the ConnectionFactory (don&rsquo;t worry, we&rsquo;ll get to that one in a moment), and if you want its &ldquo;send&rdquo; methods to publish to an Exchange other than the no-name default Exchange, you can provide that here. We are publishing to the &ldquo;chatExchange&rdquo; that we just discussed.</p><p>The &ldquo;rabbit:listener-container&rdquo; is practically identical to the element of the same name in Spring&rsquo;s JMS support. This one is listening to the &ldquo;chatQueue&rdquo;, and remember that&rsquo;s just a reference to the bean id, the real name of that particular Queue is generated by the broker. Whenever a Message arrives on that Queue, the &ldquo;handleMessage&rdquo; method we saw earlier will be invoked. The listener container&rsquo;s adapter will automatically handle the conversion of the Message body in a case like this where the method argument is a String. Since that method argument does not need to accept an actual Message instance, and the method name can be anything we want it to be, we refer to this as a &ldquo;Message-driven POJO&rdquo;. In other words, it has no direct dependency on the messaging API. Its being invoked by the listener container is a form of Inversion of Control.</p><p>Finally, there is the Connection Factory configuration. In this case, we are using the &ldquo;cloud&rdquo; namespace and its &ldquo;rabbit-connection-factory&rdquo; element. As long as your application is bound to a single &ldquo;rabbitmq&rdquo; service in Cloud Foundry, no other information is necessary for creating the ConnectionFactory instance. The code underlying that namespace support will determine the credentials from the environment itself. That namespace support is provided by the &ldquo;cloudfoundry-runtime&rdquo; library which you can see declared in this application&rsquo;s <a target="_blank" href="https://github.com/SpringSource/cloudfoundry-samples/blob/master/rabbit-chat/pom.xml">pom.xml</a> file.</p>
<h2>Running the Application</h2><p>You can run the application using either the <a target="_blank" href="http://support.cloudfoundry.com/entries/20012337-getting-started-guide-command-line-vmc-users">vmc command line tool</a> or <a target="_blank" href="https://cloudfoundry.zendesk.com/entries/20012462-getting-started-guide-sts-users">SpringSource Tool Suite</a>. With <em>vmc</em> you would have something like the following:</p><p><code><br /><pre style="background-color:black;color:white"><br />$ vmc push<br />Would you like to deploy from the current directory? [Yn]: y<br />Application Name: rabbit-chat-sample<br />Application Deployed URL: &lsquo;rabbit-chat-sample.cloudfoundry.com&rsquo;?<br />Detected a Java SpringSource Spring Application, is this correct? [Yn]: y<br />Memory Reservation [Default:512M] (64M, 128M, 256M, 512M or 1G)<br />Creating Application: OK<br />Would you like to bind any services to &lsquo;rabbit-chat-sample&rsquo;? [yN]: y<br />Would you like to use an existing provisioned service [yN]? n<br />The following system services are available:<br />1. mongodb<br />2. mysql<br />3. postgresql<br />4. rabbitmq<br />5. redis<br />Please select one you wish to provision: 4<br />Specify the name of the service [rabbitmq-5e262]:<br />Creating Service: OK<br />Binding Service: OK<br />Uploading Application:<br /> Checking for available resources: OK<br /> Processing resources: OK<br /> Packing application: OK<br /> Uploading (3K): OK<br />Push Status: OK<br />Staging Application: OK<br />Starting Application: OK<br /></pre><br /></code></p><p>If using STS, you just need to enable the Cloud Foundry support (available from the Dashboard&rsquo;s &ldquo;Extensions&rdquo; tab), and then create a new server instance (see the <a target="_blank" href="https://cloudfoundry.zendesk.com/entries/20012462-getting-started-guide-sts-users">Getting Started Guide</a> for all the details) to which you can simply drag the application. Once the application is added to the server instance, you can provision and bind services through the UI. The following screenshot shows the &lsquo;rabbit-chat&rsquo; sample application.</p><p><a href="http://blog.springsource.com/wp-content/uploads/2011/08/rabbit-chat-sts.png"><img src="http://blog.springsource.com/wp-content/uploads/2011/08/rabbit-chat-sts.png" alt="" title="rabbit-chat-sts" width="754" height="476" class="alignnone size-full wp-image-9379" /></a></p>
<h2>Scaling the Application</h2><p>Remember the discussion of the &ldquo;chatQueue&rdquo; id and how the Queue&rsquo;s name would be generated since it was using the id rather than name attribute? Well, the reason we are using id instead of name here is that we want each instance of the application to have its own exclusive, and effectively anonymous, Queue. It is the Fanout Exchange that has a single named instance. Each instance of the application will bind its own Queue to that Exchange. This decoupling of Exchanges and Queues is quite appropriate for a scalable cloud application (especially since those Queues whose names are generated will be deleted automatically when their owning instance is shutdown).</p><p>To scale the application, you can use VMC at the command line:</p><p><code><br /><pre style="background-color:black;color:white"><br />$ vmc instances rabbit-chat-sample +1<br />Scaling Application instances up to 2: OK<br /></pre><br /></code></p><p>Or, you can use the STS support. Here&rsquo;s a focused view of the &lsquo;instances&rsquo; configuration taken from the same screenshot posted above:</p><p><a href="http://blog.springsource.com/wp-content/uploads/2011/08/rabbit-chat-sts-instances.png"><img src="http://blog.springsource.com/wp-content/uploads/2011/08/rabbit-chat-sts-instances.png" alt="" title="rabbit-chat-sts-instances" width="449" height="176" class="alignnone size-full wp-image-9380" /></a></p>
<h2>What's Next?</h2><p>This blog is intended to be the first of a series. In upcoming posts, we will explore the following:</p>
<ul>
<li>Enhancement of the messaging functionality beyond the currently global broadcasting in order to demonstrate both point-to-point messaging (for chatting with a single named user) as well as publish/subscribe with dynamically allocated Exchanges to represent a "chat room".</li>
<li>Addition of a Node.js app that sits alongside the Java app and participates in the same chat since both apps are bound to the same RabbitMQ service instance.</li>
<li>Inclusion of Spring 3.1 profile support to show how this same configuration file could be modified to work equally well against Cloud Foundry or an alternative deployment, such as a local Tomcat instance.</li>
</ul></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 434;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>