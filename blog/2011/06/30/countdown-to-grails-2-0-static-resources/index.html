<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Countdown to Grails 2.0: Static resources</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Countdown to Grails 2.0: Static resources" />
<meta name="twitter:description" content="&lt;p&gt;Web applications typically rely heavily on what we call static resources, such as Javascript, CSS and image files. In a Grails application, they are put into a project’s &lt;tt&gt;web-app&lt;/tt&gt; directory and then referenced from the HTML. For example,&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;prettyprint html&quot;&gt;&amp;lt;link rel=&quot;stylesheet&quot; href=&quot;${resource(dir: &#39;css&#39;, file: &#39;main.css&#39;)}&quot; type=&quot;text/css&quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;will create a link to the file &lt;tt&gt;web-app/css/main.css&lt;/tt&gt;. All very straightforward. You might even think that the current support is more than sufficient for anyone’s needs. What else would you want to do?&lt;/p&gt;
" />

<meta property="og:title" content="Countdown to Grails 2.0: Static resources" />
<meta property="og:description" content="&lt;p&gt;Web applications typically rely heavily on what we call static resources, such as Javascript, CSS and image files. In a Grails application, they are put into a project’s &lt;tt&gt;web-app&lt;/tt&gt; directory and then referenced from the HTML. For example,&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;prettyprint html&quot;&gt;&amp;lt;link rel=&quot;stylesheet&quot; href=&quot;${resource(dir: &#39;css&#39;, file: &#39;main.css&#39;)}&quot; type=&quot;text/css&quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;will create a link to the file &lt;tt&gt;web-app/css/main.css&lt;/tt&gt;. All very straightforward. You might even think that the current support is more than sufficient for anyone’s needs. What else would you want to do?&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2011-06-30 16:08:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Countdown to Grails 2.0: Static resources</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="null?s=20&amp;d=mm" />
<span class="author">Peter Ledbrook</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2011-06-30 16:08:00.0">June 30, 2011</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="424" href="/blog/2011/06/30/countdown-to-grails-2-0-static-resources#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>Web applications typically rely heavily on what we call static resources, such as Javascript, CSS and image files. In a Grails application, they are put into a project&rsquo;s <tt>web-app</tt> directory and then referenced from the HTML. For example,</p>
<pre><code class="prettyprint html">&lt;link rel=&quot;stylesheet&quot; href=&quot;${resource(dir: &#39;css&#39;, file: &#39;main.css&#39;)}&quot; type=&quot;text/css&quot;&gt;
</code></pre><p>will create a link to the file <tt>web-app/css/main.css</tt>. All very straightforward. You might even think that the current support is more than sufficient for anyone&rsquo;s needs. What else would you want to do?</p><p>That&rsquo;s a good point. The answer depends on the complexity of your application, but let&rsquo;s start with the example CSS link above. Why do we have to type out the <tt>&lt;link rel=&ldquo;&hellip;&rdquo; href=&hellip;&gt;</tt>? Just by looking at the extension, we know that the resource is a CSS file. We also know that CSS files should be linked into an HTML page using the above element. So we&rsquo;re basically doing a lot of typing for something that Grails should be able to handle itself.</p><p>&ldquo;OK,&rdquo; I hear you say, &ldquo;but we could add a tag for CSS links.&rdquo; Indeed we could, and Grails 2 will include a <tt>&lt;g:external/&gt;</tt> tag that intelligently picks the appropriate link type for the resource. But now consider production: wouldn&rsquo;t it be a good idea to bundle CSS and Javascript files together? What about compressing them? (As an aside, Yahoo provides a tool called <a href="https://addons.mozilla.org/en-US/firefox/addon/yslow/">ySlow</a> that will give you hints on just these kinds of optimisation). So how do we implement such optimisations? You could probably do it on an ad-hoc basis, but doing so limits your options because you can&rsquo;t define relationships between resources. What we really want is some way of declaring resources in a central place and indicating which ones should be processed and bundled together.</p><p>If I have yet to persuade you that there could be a better way to manage static resources, then think about Grails plugins. Many of these provide their own static resources. In fact, some plugins provide the same resources as each other. For example older versions of the YUI, Bubbling and Grails UI plugins all include the YUI libraries. Do we really need multiple copies of entire Javascript libraries? Of course not. Part of the problem can be solved with inter-plugin dependencies, but that doesn&rsquo;t work well on its own because there is no way for a plugin to say that some of its resources depend on specific resources in another plugin. In the end, it&rsquo;s up to the developer to make sure that all the appropriate resources (including transitive dependencies) are included in each page. That may involve some trial and error to make sure all requires resources are linked into the page <i>and</i> in the correct order.</p><p>Fortunately, we can do better. Enter the <a href="http://grails.org/plugin/resources">Resources plugin</a>.</p>
<h2>Declarative resources</h2><p>By installing just this one plugin, you can start declaring your static resources (Javascript, CSS, etc.) in reusable modules. You can then define dependencies between modules so that Grails knows exactly which resources a module requires, including those specified in transitive dependencies. As an added benefit, modules ensure that resources are always declared in the correct order in a page and that there are no duplicates. In doing so, modules take much of the pain out of static resource management.</p>
<h3>Declaring modules</h3><p>You can declare resource modules in both applications and plugins. There are a couple of ways of doing this, but the most common approach is to add one or more dedicated artifacts to the project. For an application this might be <tt>grails-app/conf/ApplicationResources.groovy</tt>. As another example, the YUI plugin has <tt>grails-app/conf/YuiPluginResources.groovy</tt>. The basic structure of these files looks like this:</p>
<pre><code class="prettyprint groovy">modules = {
    core {
        resource url: &#39;js/core.js&#39;, disposition: &#39;head&#39;
        resource url: &#39;js/ui.js&#39;
        resource url: &#39;css/main.css&#39;
        resource url: &#39;css/branding.css&#39;
        resource url: &#39;css/print.css&#39;, attrs: [media: &#39;print&#39;]
    }

    utils {
        dependsOn &#39;jquery&#39;
        resource url: &#39;js/utils.js&#39; 
    }

    forms {
        dependsOn &#39;core&#39;, &#39;utils&#39;

        resource url: &#39;css/forms.css&#39;
        resource url: &#39;js/forms.js&#39;
    }
}
</code></pre><p>&ldquo;core&rdquo;, &ldquo;utils&rdquo; and &ldquo;forms&rdquo; are the names of our application modules, and as you can probably guess, the &ldquo;forms&rdquo; module depends on both &ldquo;core&rdquo; and &ldquo;utils&rdquo;. You can also see that the &ldquo;utils&rdquo; module depends on &ldquo;jquery&rdquo;, which is a module provided by the jQuery plugin. This structure is best seen in diagrammatic form:</p><p><a href="http://blog.springsource.com/wp-content/uploads/2011/06/resource-modules.png"><img src="http://blog.springsource.com/wp-content/uploads/2011/06/resource-modules.png" alt="" title="Resource module example" width="411" height="473" class="aligncenter size-full wp-image-9067" /></a></p><p>If we look a bit deeper into the above module definitions, we can see that individual resources are declared within a module using &ldquo;resource&rdquo; plus a URL. This URL is the location of the resource relative to the <tt>web-app</tt> directory in your project. If you wish, you can also add extra attributes for fine-grained control of resources, in particular via the &ldquo;disposition&rdquo; setting.</p><p>There are two standard dispositions: &ldquo;head&rdquo;, meaning that a resource goes inside the &lt;head&gt; element, and &ldquo;defer&rdquo;, which typically means the end of the body (although you have control over the exact placement as you&rsquo;ll see shortly). By default, CSS files have a disposition of &ldquo;head&rdquo; while Javascript files use &ldquo;defer&rdquo;, but these defaults can be overridden on a per-resource basis.</p><p>We now have the basis for defining simple or complex networks of resource modules, with those networks crossing application and plugin boundaries. Even better from a user&rsquo;s perspective, it&rsquo;s up to the plugins to make sure that their modules include the appropriate resources and dependencies.</p><p>So, Grails may now be aware of what static resources your application and its plugins provide, but it still doesn&rsquo;t know which pages require which resources. For that, you have to make some modifications to your GSPs.</p>
<h3>Including resources in a page</h3><p>As you know, you previously had to declare all your CSS and Javascript links explicitly in your layouts and views. So how does this change with the Resources plugin? Instead of putting in links to individual resources, you declare which modules your page requires, which makes for much conciser <tt>&lt;head&gt;</tt> blocks. In addition, you specify where in the page the resource links should go. Here&rsquo;s an example of a very simple layout using Resources:</p>
<pre><code class="prettyprint html">&lt;html&gt;
&lt;head&gt;
    ...
    &lt;r:require modules=&quot;common, jquery&quot;/&gt;
    &lt;r:layoutResources/&gt;
&lt;/head&gt;
&lt;body&gt;
    ...
    &lt;r:layoutResources/&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>As you can probably work out, the <tt>&lt;r:require&gt;</tt> tag tells Grails <i>which</i> static resources to include in the page while the <tt>&lt;r:layoutResources&gt;</tt> tags specify <i>where</i> the links should go. You should have two <tt>&lt;r:layoutResources&gt;</tt> tags: one in <tt>&lt;head&gt;</tt> and the other in <tt>&lt;body&gt;</tt>. Any resource with a disposition of &ldquo;head&rdquo; will go where the first one is, while those with a disposition of &ldquo;defer&rdquo; will be inserted at the second&rsquo;s location.</p><p>That really is it! Most of the work goes into ensuring that your module definitions are correct.</p><p>What I have covered so far works really well for CSS, Javascript and favicon files because the Resources plugin knows what links to generate for them and where to put those links. But what happens with inline images and scripts?</p>
<h3>Ad-hoc resources</h3><p>The Resources plugin calls inline images and scripts &ldquo;ad-hoc resources&rdquo;. These typically aren&rsquo;t declared in modules and are simply processed as and when they are encountered in the page. A standard inline image link looks something like:</p>
<pre><code class="prettyprint html">&lt;img src=&quot;${resource(dir:&#39;images&#39;,file:&#39;grails_logo.png&#39;)}&quot; ... /&gt;
</code></pre><p>So how do we make the Resources plugin aware of the image file? We don&rsquo;t! As of Grails 2.0, the <tt>&lt;g:resource/&gt;</tt> tag (used as a method above) automatically registers the resource with the plugin if it&rsquo;s installed. That means all the magic performed by mappers (which I&rsquo;ll talk about in a bit) will be applied to the given resource. And of course, <tt>&lt;g:resource/&gt;</tt> can be used for any type of resource, not just images.</p><p>Inline scripts are a little different because they aren&rsquo;t links to external files. Yet they can still benefit from the Resources plugin. By default all inline scripts declared with the <tt>&lt;g:javascript/&gt;</tt> tag will behave as they always have done. But if you replace <tt>&lt;g:javascript/&gt;</tt> with the <tt>&lt;r:script/&gt;</tt> tag, the inline script will be moved to the location of the second <tt>&lt;r:layoutResources/&gt;</tt> (their default disposition is &ldquo;defer&rdquo;). You can also declare an explicit disposition so that the script goes into <tt>&lt;head&gt;</tt>. Best of all, the inline scripts retain the order in which they are declared in the page.</p><p>There is one other source of ad-hoc resources to mention: CSS. Stylesheets are a common way of specifying background and other types of image, but CSS files aren&rsquo;t processed as GSP files. Is the Resources plugin aware of these links? Fortunately, yes. Even though the Resources plugin modifies the URL paths for all the resources it manages, that doesn&rsquo;t matter to you because the plugin also updates the links in the CSS files automatically. Everything will just work!</p>
<h2>Magic mappers</h2><p>On its own, the Resources plugin makes the management of static resources much simpler than before. But that&rsquo;s only part of the story. Since the plugin knows about all the resources and controls the link generation for them, it can perform extra processing to add interesting behaviour. This processing is done by an extensible pipeline of mappers:</p><p><a href="http://blog.springsource.com/wp-content/uploads/2011/06/resources-mappers1.png"><img src="http://blog.springsource.com/wp-content/uploads/2011/06/resources-mappers1.png" alt="Resources Mapper Pipeline Diagram" title="Resources Mapper Pipeline" width="700" height="159" class="aligncenter size-full wp-image-9082" /></a></p><p>Don&rsquo;t take this diagram as an absolute and correct reference: as a user, the exact pipeline and how it works doesn&rsquo;t really matter. The key is that you can if you want add your own mapper implementations or simply install a plugin that provides some mappers of its own. The result is some very powerful features for near zero effort.</p><p>For example, let&rsquo;s say you have the Resources plugin installed, some modules defined, and your GSP views and layouts set up to use the appropriate tags. Simply by installing the <a href="http://grails.org/plugin/cached-resources">Cached Resources</a> and <a href="http://grails.org/plugin/zipped-resources">Zipped Resources</a> plugins, you will immediately start satisfying some of the ySlow recommendations, such as having a long-dated Expires header and gzip compression for all your static resources (although you can disable gzip compression for specific file types such as images, which tend to be compressed already). It shouldn&rsquo;t be this easy, right? But it is.</p>
<h2>Conclusion</h2><p>The Resources plugin has been around for a little while and is already used in a few production sites. It&rsquo;s even in use on the <a href="http://grails.org/">Grails website</a>. And no wonder: it combines much improved management of static resources with a mapper pipeline that allows for easy-to-use but powerful features. Experienced web developers will notice the difference immediately, and you can expect <a href="http://grails.org/plugins/tag/resources">more and more plugins</a> to come with Resources support in the future. It even has its own <a href="https://grails-plugins.github.com/grails-resources/">user guide</a>.</p><p>Because of the advantages the plugin brings, Grails 2 makes it a default plugin for new Grails projects and also integrates it into some of the core tags, such as <tt>&lt;g:resource&gt;</tt>. But even if you can&rsquo;t use Grails 2 yet, you can still make use of it with older versions of Grails and benefit from great resource management with little effort. One of it&rsquo;s key design principles is that it can be installed in any Grails application without breaking anything.</p><p>Whichever version of Grails you use, installing this plugin will improve your life as a web developer. That&rsquo;s not something to be sniffed at.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 424;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>