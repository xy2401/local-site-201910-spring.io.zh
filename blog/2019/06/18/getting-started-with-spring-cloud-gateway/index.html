<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>Spring Cloud Gateway入门</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Getting Started with Spring Cloud Gateway">
<meta name="twitter:description" >
<meta name="twitter:creator" content="@benbravo73">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/15aba3f666761f09945e8efc6384006b?s=200">

<meta property="og:title" content="Getting Started with Spring Cloud Gateway">
<meta property="og:image" content="https://gravatar.com/avatar/15aba3f666761f09945e8efc6384006b?s=200">
<meta property="og:description" >
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2019-06-18 04:30:00.0">
</head>
<body >

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
 <div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Cloud Gateway入门</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/15aba3f666761f09945e8efc6384006b?s=20&d=mm"> <a class="author" rel="author" href="/team/benwilcock">本威尔科克</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2019-06-18 04:30:00.0">2019年6月18日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2019/06/18/getting-started-with-spring-cloud-gateway#disqus_thread" data-disqus-identifier="3711">
</a></div>
</div>
</header>
<div class="blog--post"><p>微服务架构很棒，但是随着您的应用程序编程接口（API）开始增长，与它们的维护相关的挑战也随之增加。</p>
<p>例如，随着现有API的成熟和添加新功能，它将需要客户及其陪伴。当API的详细信息发生更改时，客户需要进行调整才能使用这些更改。此过程需要时间，并且确实会减慢API的开发速度并干扰您快速迭代的能力。</p>
<p>提供多种API会带来一系列挑战。您如何将请求和响应路由到正确的API？您如何处理任何邮件差异？当端点可以移动时，如何为客户提供支持？</p>
<p>然后是与遗留系统集成的问题。不是每个人都如此幸运，他们能够将应用程序和服务构建到一个全新的生态系统中，而是需要与预先存在的系统很好地玩，以进行身份验证和其他支持服务。</p>
<p>API网关可帮助您解决这些问题以及更多问题。它是一个功能强大的体系结构工具，可用于管理微服务体系结构中的消息路由，过滤和代理。许多API管理网关都可以追溯到SOA，并且这些网关通常已实现为集中式服务器。但是随着微服务变得越来越流行，现代轻量级的独立和分散式微网关应用程序已经出现，例如<a href="https://spring.io/projects/spring-cloud-gateway">Spring Cloud Gateway</a> 。</p>
<p>在我们关于Spring Cloud Gateway的系列文章的第一篇文章中，我们将从做一个非常简单的事情开始–重新路由进入网关的请求，并将其转发到其他地方的另一个服务。我们还将在请求中插入一个简单的HTTP标头，以显示网关可能实现的另一个示例。</p><h4><a href="#tools-you-rsquo-ll-need" class="anchor" name="tools-you-rsquo-ll-need"></a>您需要的工具：</h4>
<ul>
<li><a href="https://httpie.org/">HTTPie</a> –用于HTTP调用的命令行客户端</li>
<li>您最喜欢的Java IDE（如果没有，请查看<a href="https://spring.io/tools">Spring Tools</a> ）</li>
<li>您最喜欢的命令行（例如zsh，bash，DOS命令或PowerShell）</li>
<li><a href="https://httpbin.org">Httpbin.org</a> –一个网站和诊断工具，可将Http GET请求数据转换为JSON响应</li>
</ul><h2><a href="#step-1-create-a-project" class="anchor" name="step-1-create-a-project"></a>步骤1：建立专案</h2>
<p>在一个新文件夹中，使用<a href="https://start.spring.io/">start.spring.io</a> （和<a href="https://httpie.org/">HTTPie</a> ）下载并解压缩一个新的Spring Cloud Gateway项目，如下所示……</p>
<pre><code class="prettyprint bash">http https://start.spring.io/starter.zip dependencies==cloud-gateway,actuator baseDir==spring-cloud-gateway-demo | tar -xzvf -
</code></pre>
<p>我们可以立即通过构建和运行代码并检查Spring Boot Actuator运行状况端点来断言该项目正在工作……</p>
<pre><code class="prettyprint bash">./mvnw package spring-boot:run
</code></pre>
<p>现在您的Spring Boot应用程序已启动并正在运行，将浏览器指向<a href="http://localhost:8080/actuator/health">http：// localhost：8080 / actuator / health</a> 。您应该会收到JSON格式的消息，内容为<code>{"status":"UP"}</code>这表明一切正常。现在停止服务器（ctrl + c）并继续下一节。</p><h2><a href="#step-2-add-a-re-route-instruction-to-the-gateway" class="anchor" name="step-2-add-a-re-route-instruction-to-the-gateway"></a>步骤2：向网关添加重新路由指令</h2>
<p>在您的IDE中，打开课程<code>src/main/java/com/example/demo/DemoApplication.java</code>并添加以下方法，在进行操作时更正导入语句。如果遇到问题，请在<a href="https://github.com/benwilcock/spring-cloud-gateway-demo">此处</a>查看代码示例。</p>
<pre><code class="prettyprint java">    @Bean
    public RouteLocator myRoutes(RouteLocatorBuilder builder) {
        return builder.routes()
            // Add a simple re-route from: /get to: http://httpbin.org:80
            // Add a simple &quot;Hello:World&quot; HTTP Header
            .route(p -&gt; p
            .path(&quot;/get&quot;) // intercept calls to the /get path
            .filters(f -&gt; f.addRequestHeader(&quot;Hello&quot;, &quot;World&quot;)) // add header
            .uri(&quot;http://httpbin.org:80&quot;)) // forward to httpbin
            .build();
    }
</code></pre>
<p>在这里，我们为网关构建了一条新路线。任何要求<code>http://localhost:8080/get</code>将与此路线说明相匹配，并且将对请求进行两次更改。的<code>filters()</code>方法处理诸如添加或更改标头之类的事情，在本例中，设置<code>Hello</code>值的标头<code>World</code> 。此外， <code>uri()</code>方法将我们的请求转发到新主机。请务必注意， <code>/get</code>转发消息时将保留路径。</p>
<p>现在，编译您的新代码，然后再次启动应用程序服务器，就像这样……</p>
<pre><code class="prettyprint bash">./mvnw package spring-boot:run
</code></pre>
<p>在下一节中，我们将测试构建的内容。</p><h1><a href="#step-3-test-your-new-gateway" class="anchor" name="step-3-test-your-new-gateway"></a>步骤3：测试新的网关</h1>
<p>为了测试我们构建的内容，我们可以再次使用<a href="https://httpie.org/">HTTPie</a> 。将HTTP GET请求发送到<a href="http://localhost:8080/get">http：// localhost：8080 / get</a> ，观察返回的内容，像这样……</p>
<pre><code class="prettyprint bash">http localhost:8080/get --print=HhBb
</code></pre>
<p>您应该看到非常类似于以下所示的响应。</p>
<pre><code class="prettyprint bash">GET /get HTTP/1.1
Accept: */*
Accept-Encoding: gzip, deflate
Connection: keep-alive
Host: localhost:8080
User-Agent: HTTPie/1.0.2

HTTP/1.1 200 OK
Access-Control-Allow-Credentials: true
Access-Control-Allow-Origin: *
Content-Encoding: gzip
Content-Length: 256
Content-Type: application/json
Date: Mon, 10 Jun 2019 13:13:36 GMT
Referrer-Policy: no-referrer-when-downgrade
Server: nginx
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block

{
    &quot;args&quot;: {},
    &quot;headers&quot;: {
        &quot;Accept&quot;: &quot;*/*&quot;,
        &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;,
        &quot;Forwarded&quot;: &quot;proto=http;host=\&quot;localhost:8080\&quot;;for=\&quot;0:0:0:0:0:0:0:1:52144\&quot;&quot;,
        &quot;Hello&quot;: &quot;World&quot;,
        &quot;Host&quot;: &quot;httpbin.org&quot;,
        &quot;User-Agent&quot;: &quot;HTTPie/1.0.2&quot;,
        &quot;X-Forwarded-Host&quot;: &quot;localhost:8080&quot;
    },
    &quot;origin&quot;: &quot;0:0:0:0:0:0:0:1, 2.102.147.153, ::1&quot;,
    &quot;url&quot;: &quot;https://localhost:8080/get&quot;
}
</code></pre>
<p>此输出中有一些注意事项：</p>
<ol>
<li>响应源自<a href="https://httpbin.org">httpbin.org，</a>如<code>"Host"</code>标头。</li>
<li>的<code>"X-Forwarded-Host"</code>是<code>"localhost:8080"</code> （我们的本地运行的网关应用程序）</li>
<li>Http头<code>"Hello"</code>已被插入并赋予值<code>"World"</code> 。</li>
<li>在Json回应中，完整<code>"url"</code>原始请求的<code>"https://localhost:8080/get"</code> （我们一起构建的网关服务）。</li>
</ol>
<p>执行路径是从客户端（ <a href="https://httpie.org/">HTTPie</a> ）-> DemoApplication.java（我们的网关）-> httpbin.org（我们的回显服务），然后再次返回。</p><h2><a href="#final-thoughts" class="anchor" name="final-thoughts"></a>最后的想法。</h2>
<p>而已。您现在应该已经启动并运行了一个Spring Cloud Gateway应用程序，并且已经学习了如何将收到的请求转发到另一个端点。您可以使用此技术将请求从网关应用程序自动转发到任何其他服务。</p>
<p>可以在<a href="https://github.com/benwilcock/spring-cloud-gateway-demo">此处</a>找到本文附带的代码。可在<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html">此处</a>找到有关Spring Cloud Gateway的当前GA版本（在撰写本文时为2.1.0）的完整文档。</p><h2><a href="#next-time" class="anchor" name="next-time"></a>下次。</h2>
<p>我们只是将脚趾浸入了Spring Cloud Gateway可以完成的工作中，但是希望这是一个很好的初看起来。在我们的下一篇文章中，我们将研究如何创建动态网关-一种可以在运行时发现服务位置的网关。在此之前，如果您想了解更多信息，请务必查看<a href="https://spring.io/guides/gs/gateway/">官方指南</a> <a href="https://spring.io/projects/spring-cloud-gateway">spring.io上</a>的<a href="https://spring.io/projects/spring-cloud-gateway">Spring Cloud Gateway页面</a> ，或在<a href="https://run.pivotal.io/">Pivotal Web Services</a>上设置您自己的服务和网关！</p>
<p>最后，一定要查看<a href="https://springoneplatform.io/">SpringOne Platform</a> ，这是构建人们喜欢的可伸缩应用程序的主要会议。10月7日至10日，与您的同龄人一起在德克萨斯州奥斯汀学习，分享并享受乐趣，参加迄今为止规模最大，最出色的表演。更好的是，注册时使用代码<strong>S1P_Save200</strong>保存在您的票证上。我们希望看到你在那里！</p>
<hr><h1><a href="#authors" class="anchor" name="authors"></a> s</h1>
<ul>
<li><a href="https://twitter.com/benbravo73">Ben Wilcock</a> – Pivotal Spring 营销。</li>
<li><a href="https://twitter.com/BrianMMcClain">Brian McClain</a> – Pivotal技术营销。</li>
</ul>
</div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 3711;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>