<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Spring Cloud Stream - functional and reactive</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Spring Cloud Stream - functional and reactive" />
<meta name="twitter:description" content="&lt;p&gt;In the &lt;a href=&quot;https://spring.io/blog/2019/10/14/spring-cloud-stream-demystified-and-simplified&quot;&gt;previous post&lt;/a&gt;, I tried to provide justification for our shift to a functional programming model in &lt;a href=&quot;https://spring.io/projects/spring-cloud-stream&quot;&gt;Spring Cloud Stream&lt;/a&gt; (SCSt). It’s &lt;strong&gt;&lt;em&gt;less code&lt;/em&gt;&lt;/strong&gt;, &lt;strong&gt;&lt;em&gt;less configuration&lt;/em&gt;&lt;/strong&gt;. Most importantly, though, your code is completely &lt;strong&gt;&lt;em&gt;decoupled and independent&lt;/em&gt;&lt;/strong&gt; from the internals of SCSt. &lt;/p&gt;
&lt;p&gt;In this post, I’ll dig a little deeper and summarize the core features of our functional support, specifically around its reactive features.&lt;/p&gt;
&lt;blockquote&gt; 
 &lt;p&gt;IMPORTANT: &lt;em&gt;Anything you can do with &lt;code&gt;@StreamListener/@EnableBinding&lt;/code&gt; you can also do without it. In other words, the functional support is now feature-compatible with the annotation-based support.&lt;/em&gt;&lt;/p&gt; 
&lt;/blockquote&gt;
" />
<meta name="twitter:creator" content="@z_oleg" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/b44844c62a496e582a467cf95806ae92?s=200" />

<meta property="og:title" content="Spring Cloud Stream - functional and reactive" />
<meta property="og:image" content="https://gravatar.com/avatar/b44844c62a496e582a467cf95806ae92?s=200" />
<meta property="og:description" content="&lt;p&gt;In the &lt;a href=&quot;https://spring.io/blog/2019/10/14/spring-cloud-stream-demystified-and-simplified&quot;&gt;previous post&lt;/a&gt;, I tried to provide justification for our shift to a functional programming model in &lt;a href=&quot;https://spring.io/projects/spring-cloud-stream&quot;&gt;Spring Cloud Stream&lt;/a&gt; (SCSt). It’s &lt;strong&gt;&lt;em&gt;less code&lt;/em&gt;&lt;/strong&gt;, &lt;strong&gt;&lt;em&gt;less configuration&lt;/em&gt;&lt;/strong&gt;. Most importantly, though, your code is completely &lt;strong&gt;&lt;em&gt;decoupled and independent&lt;/em&gt;&lt;/strong&gt; from the internals of SCSt. &lt;/p&gt;
&lt;p&gt;In this post, I’ll dig a little deeper and summarize the core features of our functional support, specifically around its reactive features.&lt;/p&gt;
&lt;blockquote&gt; 
 &lt;p&gt;IMPORTANT: &lt;em&gt;Anything you can do with &lt;code&gt;@StreamListener/@EnableBinding&lt;/code&gt; you can also do without it. In other words, the functional support is now feature-compatible with the annotation-based support.&lt;/em&gt;&lt;/p&gt; 
&lt;/blockquote&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2019-10-17 14:47:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Cloud Stream - functional and reactive</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/b44844c62a496e582a467cf95806ae92?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/olegz">Oleg Zhurakousky</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2019-10-17 14:47:00.0">October 17, 2019</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="3837" href="/blog/2019/10/17/spring-cloud-stream-functional-and-reactive#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>In the <a href="https://spring.io/blog/2019/10/14/spring-cloud-stream-demystified-and-simplified">previous post</a>, I tried to provide justification for our shift to a functional programming model in <a href="https://spring.io/projects/spring-cloud-stream">Spring Cloud Stream</a> (SCSt). It&rsquo;s <strong><em>less code</em></strong>, <strong><em>less configuration</em></strong>. Most importantly, though, your code is completely <strong><em>decoupled and independent</em></strong> from the internals of SCSt. </p>
<p>In this post, I’ll dig a little deeper and summarize the core features of our functional support, specifically around its reactive features.</p>
<blockquote>
<p>IMPORTANT: <em>Anything you can do with <code>@StreamListener/@EnableBinding</code> you can also do without it. In other words, the functional support is now feature-compatible with the annotation-based support.</em></p>
</blockquote>
<p>While all the features described below are the features of <a href="https://spring.io/projects/spring-cloud-function">Spring Cloud Function</a> (SCF), a dependency of SCSt, there are certain nuances one must be aware of to understand the additional meaning of functions in the context of SCSt. </p><h3><a href="#supplier-function-and-consumer" class="anchor" name="supplier-function-and-consumer"></a>Supplier, Function and Consumer</h3>
<p>Any bean of type <code>Supplier</code>, <code>Function</code>, or <code>Consumer</code> or any bean that could be mapped to <code>Supplier</code>, <code>Function</code>, or <code>Consumer</code> (such as a POJO function, Kotlin lambdas, and so on) is treated by SCSt as a <em>message handler</em> (<code>Function</code> or <code>Consumer</code> ) or <em>message source</em> (<code>Supplier</code>). Based on the type of functional strategy used, input and output bindings are automatically generated by using the following naming convention <code>&lt;function-name&gt;-&lt;in/out&gt;-&lt;index&gt;</code>.</p>
<p>Consider the following example:</p>
<pre><code class="prettyprint">@SpringBootApplication
public class SampleApplication  {
    @Bean
    public Function&lt;String, String&gt; uppercase() {
        return value -&gt; value.toUpperCase();
    }
}
</code></pre>
<p>The preceding function is treated as a message handler that consumes from <code>uppercase-in-0</code> and sends to <code>uppercase-out-0</code> bindings. The rest of the existing stream properties can be used as before. For example <code>--spring.cloud.stream.bindings.uppercase-in-0.content-type=text/plain</code>.</p>
<p>Click <a href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/docs/src/main/asciidoc/spring-cloud-stream.adoc#spring_cloud_function">here</a> for more details and configuration options.</p><h3><a href="#imperative-or-reactive" class="anchor" name="imperative-or-reactive"></a>Imperative or Reactive</h3>
<p>Functions can be <em>imperative</em> or <em>reactive</em>. Imperative functions are triggered on each individual event, while reactive functions are triggered once, passing the reference to the entire event stream abstractions (such as <code>Flux</code> and <code>Mono</code>) that are provided by <a href="https://projectreactor.io">Project Reactor</a>.</p>
<p>Consider the following pair of examples:</p>
<p><strong><em>Imperative:</em></strong></p>
<pre><code class="prettyprint">@SpringBootApplication
public class SampleApplication  {
    @Bean
    public Function&lt;String, String&gt; uppercase() {
        return value -&gt; value.toUpperCase();
    }
}
</code></pre>
<p><strong><em>Reactive:</em></strong></p>
<pre><code class="prettyprint">@SpringBootApplication
public class SampleApplication  {
    @Bean
    public Function&lt;Flux&lt;String&gt;, Flux&lt;String&gt;&gt; uppercase() {
        return flux -&gt; flux.map(value -&gt; value.toUpperCase());
    }
}
</code></pre>
<p>Aside from giving you a different (monadic) programming style to handle events (something that could easily be looked at as a matter of preference), reactive programming adds additional value for certain use cases, which would otherwise be rather complex to implement. And while it is out of scope for this post to discuss these use cases or reactive patterns in details, the state management cases (such as <em>windowing, aggregation, and grouping</em>) are still worth mentioning, as well as the cases of <em>splitting</em> a stream or <em>merging</em> multiple streams, which I discuss in the next section.</p>
<p>With regard to the binding and naming rules for reactive functions, they are the same as explained in the previous section.</p>
<blockquote>
<p>NOTE: While the earlier examples use <code>Function</code> as an example, the same rules apply for <code>Supplier</code> and <code>Consumer</code>. The <a href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/docs/src/main/asciidoc/spring-cloud-stream.adoc#spring_cloud_function">Spring Cloud Function support</a> section of the user guide as well as the <a href="https://projectreactor.io/docs">Reactor documentation</a> provides more details.</p>
</blockquote><h3><a href="#function-arity" class="anchor" name="function-arity"></a>Function Arity</h3>
<p>There are times when a stream of data needs to be categorized and organized. For example, consider a classic big-data use case of dealing with unorganized data containing, let&rsquo;s say, &lsquo;orders&rsquo; and &lsquo;invoices&rsquo;, and you want each to go into a separate data store.<br />This is where function arity (functions with multiple inputs and outputs) support comes to play.</p>
<p>Let&rsquo;s look at an example of such a function (full implementation details are available <a href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/test/java/org/springframework/cloud/stream/function/MultipleInputOutputFunctionTests.java#L342">here</a>),</p>
<pre><code class="prettyprint">@Bean
public Function&lt;Flux&lt;Integer&gt;, Tuple2&lt;Flux&lt;String&gt;, Flux&lt;String&gt;&gt;&gt; organise() {
	return flux -&gt; ...;
}
</code></pre>
<p>Given that Project Reactor is a core dependency of SCF, we are using its Tuple library. Tuples give us a unique advantage by communicating to us both <em>cardinality</em> and <em>type</em> information. Both are extremely important in the context of SCSt. Cardinality lets us know how many input and output bindings need to be created and bound to the corresponding inputs and outputs of a function. Awareness of the type information ensures proper type conversion. </p>
<p>Also, this is where the &lsquo;index&rsquo; part of the naming convention for binding names comes into play, since, in this function, the two output binding names are <code>organise-out-0</code> and <code>organise-out-1</code>.</p>
<blockquote>
<p>IMPORTANT: At the moment, function arity is only supported for reactive functions (<code>Function&lt;TupleN&lt;Flux&lt;?&gt;...&gt;, TupleN&lt;Flux&lt;?&gt;...&gt;&gt;</code>) centered on <em>Complex event processing</em> where evaluation and computation on confluence of events typically requires view into a stream of events rather than single event.</p>
</blockquote>
<p>For more up-to-date details, please read the <a href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/docs/src/main/asciidoc/spring-cloud-stream.adoc#functions-with-multiple-input-and-output-arguments">Functions with multiple input and output arguments</a> section of the user guide.</p>
</div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 3837;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>