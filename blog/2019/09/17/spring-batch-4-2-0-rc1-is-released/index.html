<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Spring Batch 4.2.0.RC1 is released!</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Spring Batch 4.2.0.RC1 is released!" />
<meta name="twitter:description" content="&lt;p&gt;On behalf of the Spring Batch team, I am pleased to announce the release of Spring Batch 4.2.0.RC1. We have been working on some performance improvements in the core framework, and this post highlights the major changes.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#major-performance-improvements&quot; class=&quot;anchor&quot; name=&quot;major-performance-improvements&quot;&gt;&lt;/a&gt;Major Performance Improvements&lt;/h2&gt;
&lt;p&gt;We have made some performance improvements, including:&lt;/p&gt;
&lt;ul&gt; 
 &lt;li&gt;&lt;a href=&quot;#enhanced-step-partitioning&quot;&gt;Enhanced Step Partitioning&lt;/a&gt;&lt;/li&gt; 
 &lt;li&gt;&lt;a href=&quot;#improved-job-stop&quot;&gt;Improved Job Stop&lt;/a&gt;&lt;/li&gt; 
 &lt;li&gt;&lt;a href=&quot;#faster-writes-with-the-jpaitemwriter&quot;&gt;Faster Writes with the &lt;code&gt;JpaItemWriter&lt;/code&gt;&lt;/a&gt;&lt;/li&gt; 
 &lt;li&gt;&lt;a href=&quot;#optimized-bean-mapping-with-the-beanwrapperfieldsetmapper&quot;&gt;Optimized Bean Mapping with the &lt;code&gt;BeanWrapperFieldSetMapper&lt;/code&gt;&lt;/a&gt;&lt;/li&gt; 
&lt;/ul&gt;
&lt;a name=&quot;enhanced-step-partitioning&quot;&gt;&lt;/a&gt;
&lt;h3&gt;&lt;a href=&quot;#enhanced-step-partitioning&quot; class=&quot;anchor&quot; name=&quot;enhanced-step-partitioning&quot;&gt;&lt;/a&gt;Enhanced Step Partitioning&lt;/h3&gt;
&lt;p&gt;Starting a partitioned step is an area where the framework wasn’t well optimized. In this version, we have dug deep into the partitioning process to figure out the root cause of this performance issue. One of the main steps of the partitioning process is to find the last step execution (to see if the current execution is a restart). We found that looking up the last step execution involved loading all step executions from all job executions for a given job instance in-memory, which is obviously inefficient!&lt;/p&gt;
" />
<meta name="twitter:creator" content="@_benas_" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/18b9001fd20c1e089d19f4a1e994bcdc?s=200" />

<meta property="og:title" content="Spring Batch 4.2.0.RC1 is released!" />
<meta property="og:image" content="https://gravatar.com/avatar/18b9001fd20c1e089d19f4a1e994bcdc?s=200" />
<meta property="og:description" content="&lt;p&gt;On behalf of the Spring Batch team, I am pleased to announce the release of Spring Batch 4.2.0.RC1. We have been working on some performance improvements in the core framework, and this post highlights the major changes.&lt;/p&gt;
&lt;h2&gt;&lt;a href=&quot;#major-performance-improvements&quot; class=&quot;anchor&quot; name=&quot;major-performance-improvements&quot;&gt;&lt;/a&gt;Major Performance Improvements&lt;/h2&gt;
&lt;p&gt;We have made some performance improvements, including:&lt;/p&gt;
&lt;ul&gt; 
 &lt;li&gt;&lt;a href=&quot;#enhanced-step-partitioning&quot;&gt;Enhanced Step Partitioning&lt;/a&gt;&lt;/li&gt; 
 &lt;li&gt;&lt;a href=&quot;#improved-job-stop&quot;&gt;Improved Job Stop&lt;/a&gt;&lt;/li&gt; 
 &lt;li&gt;&lt;a href=&quot;#faster-writes-with-the-jpaitemwriter&quot;&gt;Faster Writes with the &lt;code&gt;JpaItemWriter&lt;/code&gt;&lt;/a&gt;&lt;/li&gt; 
 &lt;li&gt;&lt;a href=&quot;#optimized-bean-mapping-with-the-beanwrapperfieldsetmapper&quot;&gt;Optimized Bean Mapping with the &lt;code&gt;BeanWrapperFieldSetMapper&lt;/code&gt;&lt;/a&gt;&lt;/li&gt; 
&lt;/ul&gt;
&lt;a name=&quot;enhanced-step-partitioning&quot;&gt;&lt;/a&gt;
&lt;h3&gt;&lt;a href=&quot;#enhanced-step-partitioning&quot; class=&quot;anchor&quot; name=&quot;enhanced-step-partitioning&quot;&gt;&lt;/a&gt;Enhanced Step Partitioning&lt;/h3&gt;
&lt;p&gt;Starting a partitioned step is an area where the framework wasn’t well optimized. In this version, we have dug deep into the partitioning process to figure out the root cause of this performance issue. One of the main steps of the partitioning process is to find the last step execution (to see if the current execution is a restart). We found that looking up the last step execution involved loading all step executions from all job executions for a given job instance in-memory, which is obviously inefficient!&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2019-09-17 12:22:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category content--title">
<div>Engineering</div>
</div>
<div class="blog-category active content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Batch 4.2.0.RC1 is released!</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon releases"></div>
<a class="category">Releases</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/18b9001fd20c1e089d19f4a1e994bcdc?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/benas">Mahmoud Ben Hassine</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2019-09-17 12:22:00.0">September 17, 2019</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="3792" href="/blog/2019/09/17/spring-batch-4-2-0-rc1-is-released#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>On behalf of the Spring Batch team, I am pleased to announce the release of Spring Batch 4.2.0.RC1. We have been working on some performance improvements in the core framework, and this post highlights the major changes.</p><h2><a href="#major-performance-improvements" class="anchor" name="major-performance-improvements"></a>Major Performance Improvements</h2>
<p>We have made some performance improvements, including:</p>
<ul>
<li><a href="#enhanced-step-partitioning">Enhanced Step Partitioning</a></li>
<li><a href="#improved-job-stop">Improved Job Stop</a></li>
<li><a href="#faster-writes-with-the-jpaitemwriter">Faster Writes with the <code>JpaItemWriter</code></a></li>
<li><a href="#optimized-bean-mapping-with-the-beanwrapperfieldsetmapper">Optimized Bean Mapping with the <code>BeanWrapperFieldSetMapper</code></a></li>
</ul>
<a name="enhanced-step-partitioning"></a><h3><a href="#enhanced-step-partitioning" class="anchor" name="enhanced-step-partitioning"></a>Enhanced Step Partitioning</h3>
<p>Starting a partitioned step is an area where the framework wasn&rsquo;t well optimized. In this version, we have dug deep into the partitioning process to figure out the root cause of this performance issue. One of the main steps of the partitioning process is to find the last step execution (to see if the current execution is a restart). We found that looking up the last step execution involved loading all step executions from all job executions for a given job instance in-memory, which is obviously inefficient!</p>
<p>We replaced this code with a SQL query that does the lookup at the database level, to return only the last step execution. The results are outstanding: Partitioning a step execution into 5000 partitions is almost 10x faster with this approach, according to our benchmark <a href="#footnotes">partitioned-step-benchmark</a>:</p>
<p><img src="https://raw.githubusercontent.com/benas/spring-batch-sandbox/master/batch2716/perf-partitioning.png" alt="perf-partitioning" /></p>
<a name="improved-job-stop"></a><h3><a href="#improved-job-stop" class="anchor" name="improved-job-stop"></a>Improved Job Stop</h3>
<p>Things can go wrong when running a job.. and gracefully stopping a destructive job should be fast and efficient in order to avoid data corruption. Up until v4.1, stopping a job using the <code>CommandLineJobRunner</code> suffered from a poor performance, due to loading all job executions in memory in order to find whether a job execution is currently running. With this approach, stopping a job can take minutes with a production database that has thousands of job executions in it!</p>
<p>In this release, we optimized the stop process by using a SQL query that does the filtering at the database level. Again, the results are impressive: With 100.000 job executions of a given job in the database, stopping the job is almost 40x faster with this approach, according to our benchmark <a href="#footnotes">stop-benchmark</a>:</p>
<p><img src="https://raw.githubusercontent.com/benas/spring-batch-sandbox/master/batch2422/perf-stop.png" alt="perf-stop" /></p>
<a name="faster-writes-with-the-jpaitemwriter"></a><h3><a href="#faster-writes-with-the-code-jpaitemwriter-code" class="anchor" name="faster-writes-with-the-code-jpaitemwriter-code"></a>Faster Writes with the <code>JpaItemWriter</code></h3>
<p>The <code>JpaItemWriter</code> uses the <code>javax.persistence.EntityManager#merge</code> function to write items in a JPA persistence context. This makes sense when the persistent state of items is unknown or known to be an update. However, in many file ingestion jobs where data is known to be new and should be considered as inserts, using <code>javax.persistence.EntityManager#merge</code> is not efficient.</p>
<p>In this release, we introduced a new option in the <code>JpaItemWriter</code> to use <code>persist</code> rather than <code>merge</code> in such scenarios. With this new option, a file ingestion job that uses the <code>JpaItemWriter</code> to insert 1 million items in a database is 2x faster according to our benchmark <a href="#footnotes">jpa-writer-benchmark</a>:</p>
<p><img src="https://raw.githubusercontent.com/benas/spring-batch-sandbox/master/batch2462/perf-jpaitemwriter.png" alt="perf-jpaitemwriter" /></p>
<a name="optimized-bean-mapping-with-the-beanwrapperfieldsetmapper"></a><h3><a href="#optimized-bean-mapping-with-the-code-beanwrapperfieldsetmapper-code" class="anchor" name="optimized-bean-mapping-with-the-code-beanwrapperfieldsetmapper-code"></a>Optimized Bean Mapping with the <code>BeanWrapperFieldSetMapper</code></h3>
<p>The <code>BeanWrapperFieldSetMapper</code> provides a nice feature that lets us use fuzzy matching of field names of a given JavaBean (Camel case, nested properties, and so on). However, when field names match column names, exact matching can be enabled by setting the <code>distanceLimit</code> parameter to 0.</p>
<p>In this release, we fixed a performance issue in the <code>BeanWrapperFieldSetMapper</code> that was introspecting field names by using reflection on each iteration, even when exact matching was requested (by setting <code>distanceLimit=0</code>). The result is that item mapping is now 1.5x faster than the previous version according to our JMH benchmark [bean-mapping-benchmark (#footnotes):</p>
<p align="center">
<img src="https://raw.githubusercontent.com/benas/spring-batch-sandbox/master/batch1801/perf-mapping.png" alt="perf-mapping">
</p><h2><a href="#feedback" class="anchor" name="feedback"></a>Feedback</h2>
<p>Please note that these numbers may vary in your case. We encourage you to try out Spring Batch 4.2.0.RC1 (which can be consumed with Spring Boot 2.2.0.M6) and share your feedback. Please refer to the change log of version <a href="https://jira.spring.io/secure/ReleaseNote.jspa?projectId=10090&version=17487">4.2.0.RC1</a> and <a href="https://jira.spring.io/secure/ReleaseNote.jspa?projectId=10090&version=17628">4.2.0.M3</a> for the complete list of changes.</p>
<p>Feel free to ping <a href="https://www.twitter.com/michaelminella">@michaelminella</a> or <a href="https://www.twitter.com/b_e_n_a_s">@b_e_n_a_s</a> on Twitter or to ask your question on <a href="https://stackoverflow.com/questions/tagged/spring-batch">StackOverflow</a> or <a href="https://gitter.im/spring-batch/Lobby">Gitter</a>. If you find any issue, please open a ticket on <a href="https://jira.spring.io/projects/BATCH/">Jira</a>.</p><h2><a href="#what-rsquo-s-next" class="anchor" name="what-rsquo-s-next"></a>What&rsquo;s next</h2>
<p>We plan to stabilize this new release candidate for the upcoming Spring Batch 4.2.0.RELEASE planned for September 30th, 2019. Stay tuned!</p><h2><a href="#footnotes" class="anchor" name="footnotes"></a>Footnotes</h2>
<p>All benchmarks have been performed on a Macbook Pro 16Go RAM, 2.9 GHz Intel Core i7 CPU, MacOS Mojave 10.14.5, Oracle JDK 1.8.0_201. You can find the source code of all benchmarks in the following links:</p>
<ul>
<li>partitioned-step-benchmark: <a href="https://github.com/benas/spring-batch-sandbox/tree/master/batch2716">https://github.com/benas/spring-batch-sandbox/tree/master/batch2716</a></li>
<li>stop-benchmark: <a href="https://github.com/benas/spring-batch-sandbox/tree/master/batch2422">https://github.com/benas/spring-batch-sandbox/tree/master/batch2422</a></li>
<li>jpa-writer-benchmark: <a href="https://github.com/benas/spring-batch-sandbox/tree/master/batch2462">https://github.com/benas/spring-batch-sandbox/tree/master/batch2462</a></li>
<li>bean-mapping-benchmark: <a href="https://github.com/benas/spring-batch-sandbox/tree/master/batch1801">https://github.com/benas/spring-batch-sandbox/tree/master/batch1801</a></li>
</ul>
<p><a href="https://spring.io/projects/spring-batch">Spring Batch Home</a> | <a href="https://github.com/spring-projects/spring-batch">Source on GitHub</a> | <a href="https://docs.spring.io/spring-batch/4.2.x/reference/html/index.html">Reference Documentation</a></p>
</div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 3792;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>