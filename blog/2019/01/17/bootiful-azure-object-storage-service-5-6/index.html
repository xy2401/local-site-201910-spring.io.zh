<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title> Bootiful Azure: Object Storage Service (5/6)</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content=" Bootiful Azure: Object Storage Service (5/6)" />
<meta name="twitter:description" content="&lt;blockquote&gt; 
 &lt;p&gt;This is part 5 of a 6 part series, with new posts Mondays and Thursdays, introducing Microsoft Azure for Spring developers. I couldn’t have put this together without input from Microsoft’s Asir Vedamuthu Selvasingh, Yitao Dong, Bruno Borges, Brian Benz and Theresa Nguyen. You can find the code for this series &lt;a href=&quot;https://github.com/joshlong/bootiful-azure-article&quot;&gt;on Github&lt;/a&gt;. Hit me up on &lt;a href=&quot;http://twitter.com/Starbuxman&quot;&gt;Twitter (@starbuxman)&lt;/a&gt; as you’re reading the installments with any feedback or questions. You can also learn more about Microsoft Azure in my &lt;a href=&quot;http://twitter.com/SpringTipsLive&quot;&gt;Spring Tips (@SpringTipsLive)&lt;/a&gt; installment, &lt;a href=&quot;https://spring.io/blog/2018/12/05/spring-tips-bootiful-microsoft-azure&quot;&gt;&lt;em&gt;Bootiful Azure&lt;/em&gt;&lt;/a&gt;&lt;/p&gt; 
&lt;/blockquote&gt;
" />
<meta name="twitter:creator" content="@starbuxman" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/fb22593caf24e4bb4c98d467cdd247e6?s=200" />

<meta property="og:title" content=" Bootiful Azure: Object Storage Service (5/6)" />
<meta property="og:image" content="https://gravatar.com/avatar/fb22593caf24e4bb4c98d467cdd247e6?s=200" />
<meta property="og:description" content="&lt;blockquote&gt; 
 &lt;p&gt;This is part 5 of a 6 part series, with new posts Mondays and Thursdays, introducing Microsoft Azure for Spring developers. I couldn’t have put this together without input from Microsoft’s Asir Vedamuthu Selvasingh, Yitao Dong, Bruno Borges, Brian Benz and Theresa Nguyen. You can find the code for this series &lt;a href=&quot;https://github.com/joshlong/bootiful-azure-article&quot;&gt;on Github&lt;/a&gt;. Hit me up on &lt;a href=&quot;http://twitter.com/Starbuxman&quot;&gt;Twitter (@starbuxman)&lt;/a&gt; as you’re reading the installments with any feedback or questions. You can also learn more about Microsoft Azure in my &lt;a href=&quot;http://twitter.com/SpringTipsLive&quot;&gt;Spring Tips (@SpringTipsLive)&lt;/a&gt; installment, &lt;a href=&quot;https://spring.io/blog/2018/12/05/spring-tips-bootiful-microsoft-azure&quot;&gt;&lt;em&gt;Bootiful Azure&lt;/em&gt;&lt;/a&gt;&lt;/p&gt; 
&lt;/blockquote&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2019-01-17 00:00:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title"> Bootiful Azure: Object Storage Service (5/6)</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/fb22593caf24e4bb4c98d467cdd247e6?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/jlong">Josh Long</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2019-01-17 00:00:00.0">January 17, 2019</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="3517" href="/blog/2019/01/17/bootiful-azure-object-storage-service-5-6#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><blockquote>
<p>This is part 5 of a 6 part series, with new posts Mondays and Thursdays, introducing Microsoft Azure for Spring developers. I couldn&rsquo;t have put this together without input from Microsoft&rsquo;s Asir Vedamuthu Selvasingh, Yitao Dong, Bruno Borges, Brian Benz and Theresa Nguyen. You can find the code for this series <a href="https://github.com/joshlong/bootiful-azure-article">on Github</a>. Hit me up on <a href="https://twitter.com/Starbuxman">Twitter (@starbuxman)</a> as you&rsquo;re reading the installments with any feedback or questions. You can also learn more about Microsoft Azure in my <a href="https://twitter.com/SpringTipsLive">Spring Tips (@SpringTipsLive)</a> installment, <a href="https://spring.io/blog/2018/12/05/spring-tips-bootiful-microsoft-azure"><em>Bootiful Azure</em></a></p>
</blockquote>
<p>Here are all the installments: </p>
<ul>
<li><a href="https://spring.io/blog/2019/01/03/bootiful-azure-taking-your-first-steps-with-microsoft-azure-1-6">Bootiful Azure: Taking Your First Steps with Microsoft Azure</a></li>
<li><a href="https://spring.io/blog/2019/01/07/bootiful-azure-sql-based-data-access-with-microsoft-sql-server-2-6">Bootiful Azure: SQL-based data access with Microsoft SQL Server</a></li>
<li><a href="https://spring.io/blog/2019/01/10/bootiful-azure-global-scale-data-access-with-cosmosdb-3-6">Bootiful Azure: Global Scale Data Access with CosmosDB</a></li>
<li><a href="https://spring.io/blog/2019/01/14/bootiful-azure-integration-with-azure-service-bus-4-6">Bootiful Azure: Integration with Azure Service Bus</a></li>
<li><a href="https://spring.io/blog/2019/01/17/bootiful-azure-object-storage-service-5-6">Bootiful Azure: Object Storage Service</a></li>
<li><a href="https://spring.io/blog/2019/01/21/bootiful-azure-to-production-6-6">Bootiful Azure: To Production!</a></li>
</ul>
<p>Now let&rsquo;s turn to something a bit more&hellip; mundane. Something that you, ideally, won&rsquo;t even think about all that often. Applications often have storage requirements: they may need to store uploaded user content (binary data like pictures or documents), generated artifacts like PDF files, videos, music, etc. They might want to store logs. It&rsquo;s not hard to think of things an application might want to durably store. </p>
<p>These applications <em>could</em> use a filesystem, such as that on the local machine or a network attached filesystem like <a href="https://en.wikipedia.org/wiki/Network_File_System">NFS (network file system)</a>. I&rsquo;ll use NFS to generically refer to any network attached file system like Samba, NFS (those mounted with the NFS protocol) itself, or legacy options like DAC, FAL, etc. NFS options provide a filesystem-like interface to files, often in a hierarchical format. NFS options are interesting because they&rsquo;re like fileystems with which we&rsquo;re all familiar, and everybody knows how to work with filesystems, right? Surely, everything looks like the hierarchy expressed in Windows Explorer? Or macOS Finder? Except, they look nothing like each other&hellip;</p>
<p>Come to think of it, I had to say &ldquo;like&rdquo; when I said that NFS options are like filesystems. Some support more nuanced permissions models than others. Some support encoding and replication of metatadata attached to files and directories in the tree. Support support different speed guarantees for different operations; some filesystems may optimize for reads versus writes. Some might optimize for directory traversals. The client&rsquo;s perspective of a file read or write is different depending on the client used. (Is a write consistent on all replication nodes immediately?) </p>
<p>Even if we assumed all the filesystems to which we wanted to write were POSIX-friendly - you could use <code>int open(const char *path, int flags)</code> or <code>java.io.File</code> - this may not be the case for our clients. What if the client doesn&rsquo;t &ldquo;speak&rdquo; filesystem, and would prefer to manipulate the data in some other way? What if the client can only speak HTTP? Or if it wanted to speak Bittorrent for more efficient consolidation of downloads through peer-to-peer networks? </p>
<p>For these reasons, and more, Amazon Web Services introduced S3, the Simple Cloud Storage Service (get it? &ldquo;S&rdquo; times 3? &ldquo;S3&rdquo;?) which has since been something of a prevailing standard that all other cloud vendors need to support. For Microsoft Azure, the Object Storage Service (OSS) is the thing that provides an S3-like experience. It is not a POSIX filesystem. You can use its API directly, as we will here, but it&rsquo;s <a href="https://www.microsoft.com/developerblog/2016/05/22/access-azure-blob-storage-from-your-apps-using-s3-api/">also possible to use the S3Proxy to proxy writes to OSS</a> using an AWS S3 client, of which there are countless! Azure&rsquo;s Object Storage Service truly is <em>boring</em> which is exactly what you want when dealing with something so fundamental as persistant volumes of file-like data. It even offers a standalone browser called <a href="https://azure.microsoft.com/en-us/features/storage-explorer/">the Microsoft Azure Storage Explorer</a> which runs (yep!) on Linux, Macintosh and Windows. That standalone browser lets you interrogate OSS stores <em>as well as</em> CosmosDB data. How&rsquo;s that for convenient? You can of course use the <code>az</code> CLI or the API itself. We&rsquo;re going to use the Spring integration for the Java API. </p><h2><a href="#configuring-azure-object-storage-service" class="anchor" name="configuring-azure-object-storage-service"></a>Configuring Azure Object Storage Service</h2>
<p>You&rsquo;ve got to create an Azure Object Storage Service account (<code>bootiful</code>) assigned to the existing resource group <code>bootiful</code>. Then, create a storage container (<code>files</code>) assigned to the just-created storage account. Here&rsquo;s a sample script.</p>
<pre><code class="prettyprint shell">#!/usr/bin/env bash

rg=$1
accountname=bootiful

az storage account create --name ${accountname} --resource-group ${rg}
az storage container create -n files --account-name ${accountname}
</code></pre>
<p>Use the following command to ascertain the connection string required to connect to the application.</p>
<pre><code class="prettyprint shell">az storage account show-connection-string --resource-group bootiful --name bootiful
</code></pre>
<p>Note the connection string for later.</p><h2><a href="#introducing-azure-object-storage-service-into-your-spring-application" class="anchor" name="introducing-azure-object-storage-service-into-your-spring-application"></a>Introducing Azure Object Storage Service into your Spring Application</h2>
<p>Add <code>com.microsoft.azure</code>: <code>azure-storage-spring-boot-starter</code> to your application&rsquo;s build file. Make sure you&rsquo;ve specified the OSS connection string for the <code>azure.storage.connection-string</code> property.</p>
<p>We&rsquo;ll read the bytes for an image of a cat in our application&rsquo;s <code>src/main/resources</code> directory and then write those bytes to the Object Storage Service as a &ldquo;block blog&rdquo;. There are other interfaces through which you can talk to OSS, but for our purposes it&rsquo;s very natural to think about it as an ensemble of &ldquo;containers&rdquo; (logical groupings of things, almost like a directory or a bucket in S3 parlance) and &ldquo;blobs.&rdquo; A blob is a file, basically, with a name and metadata associated with it. All that the following example does is store the bytes for a photo of a cat into a container called <code>files</code> under a random name prefixed with <code>cat-</code> and suffixed with <code>.jpg</code>. </p>
<pre><code class="prettyprint java">package com.example.bootifulazure;

import com.microsoft.azure.storage.CloudStorageAccount;
import com.microsoft.azure.storage.StorageException;
import com.microsoft.azure.storage.blob.CloudBlobContainer;
import com.microsoft.azure.storage.blob.CloudBlockBlob;
import lombok.extern.log4j.Log4j2;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.context.event.EventListener;
import org.springframework.core.io.Resource;
import org.springframework.stereotype.Component;

import java.io.InputStream;
import java.net.URISyntaxException;
import java.util.UUID;

@Log4j2
@Component
class ObjectStorageServiceDemo {

    private final CloudStorageAccount cloudStorageAccount;
    private final Resource resource;
    private final CloudBlobContainer files;

    ObjectStorageServiceDemo(
        CloudStorageAccount csa,
        @Value(&quot;classpath:/cat.jpg&quot;) Resource cat) throws URISyntaxException, StorageException {
        this.resource = cat;
        this.cloudStorageAccount = csa;
        this.files = this.cloudStorageAccount
            .createCloudBlobClient()
            .getContainerReference(&quot;files&quot;);
    }

    @EventListener(ApplicationReadyEvent.class)
    public void demo() throws Exception {
        CloudBlockBlob blockBlobReference = this.files.getBlockBlobReference(&quot;cat-&quot; + UUID.randomUUID().toString() + &quot;.jpg&quot;);
        try (InputStream in = this.resource.getInputStream()) {
            blockBlobReference.upload(in, this.resource.contentLength());
            log.info(&quot;uploaded blockblob to &quot; + blockBlobReference.getStorageUri());
        }

    }
}
</code></pre>
<p>The Microsoft Azure-specific bits are less than trivial. We obtain a reference to a container and then write to it and then log out the addressable URI of the resource. How <em>mundane</em>! And that&rsquo;s exactly what you want in a computing system primitive like a filesystem. It should be <em>mundane</em>. To be very honest, I was more pleased with getting to use Java 7&rsquo;s try-with-resources syntax for the <code>Autocloseable</code> <code>InputStream</code> reference! </p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 3517;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>