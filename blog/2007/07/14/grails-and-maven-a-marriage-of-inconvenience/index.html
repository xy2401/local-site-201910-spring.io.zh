<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>Grails和Maven：不便的婚姻</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Grails and Maven: a Marriage of Inconvenience">
<meta name="twitter:description" >
<meta name="twitter:creator" content="@david_syer">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=200">

<meta property="og:title" content="Grails and Maven: a Marriage of Inconvenience">
<meta property="og:image" content="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=200">
<meta property="og:description" >
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2007-07-14 08:28:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Grails和Maven：不便的婚姻</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=20&d=mm"> <a class="author" rel="author" href="/team/dsyer">戴夫·瑟</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2007-07-14 08:28:00.0">2007年7月14日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2007/07/14/grails-and-maven-a-marriage-of-inconvenience#disqus_thread" data-disqus-identifier="99">
</a></div>
</div>
</header>
<div class="blog--post"><h2>介绍</h2><p>他们说， <a href="http://grails.codehaus.org">Grails</a>似乎在不断发展壮大，看起来绝对“有腿”。我对在Web应用程序领域之外扩展这些功能很感兴趣。如果您知道我在<a href="http://www.springframework.org/spring-batch">Spring Batch</a>上所做的工作，那么您可能可以猜到那可能会把我带到哪里。但是对于本文，我只想分享一些我在Grails应用程序的基本，低级部署和构建方面的经验。</p><p>我与Maven 2有着爱恨交织的关系，而且我正在学习爱Grails，但遗憾的是，两者的配合并不好。看到更紧密的集成真的很高兴。Maven并不总是我们想要的一切，但是有些事情确实使它值得。它是一种标准（喜欢它还是讨厌它），所以当我从某个地方下载项目时，我已经知道如何构建它，它的依赖项以及文档的位置。Grails具有一些相同的功能，实际上包括基于Ant的Groovy脚本的自己非常复杂的构建工具。也许有一种中间的方法，我们可以在两全其美的环境中发挥作用？</p><p>我也知道这方面的其他活动，希望我们可以合并一些东西（可能是出于本论坛和Grails JIRA中的讨论的推动）。例如，请参见Frederick Verbist的<a href="http://blog.ithron.be/?p=5">博客</a>和Arnaud Heritier的maven <a href="http://forge.octo.com/confluence/display/MTG/Home">集成项目</a> （目前仅在进行中）。传统上，Grails团队对Maven印象深刻（例如，请参见<a href="javascript:void(0);">此处</a> ），但是我与Graeme Rocher聊天，他很愿意提出建议，所以我希望我们能在这里取得一些进展。</p>
<h2>使用Maven进行Grails的原型依赖管理</h2><p>本着为Maven集成采取一些简单步骤的精神，我附加了一组<a href="http://blog.interface21.com/main/wp-content/uploads/2007/07/grails-maven.zip">poms</a> ，它们（大致）描述了Grails的依赖结构，正如我在Grails 0.5.6中所知道的那样。如果您有任何问题，请忽略或更改Spring版本号-Grails 0.5.6使用Spring 2.0，但是我正在处理的项目需要2.1。Graham说Grails在Spring的更高版本中可能无法正常使用，因此您的里程可能会有所不同。那就是Maven的美丽吧？您可以显式地和可传递地看到项目依赖关系，并且可以通过控制方式来调整它们，以适应自己的需求和风险偏好。</p><p>除了Maveners：依赖性插件的工作要比以前好得多，并且可以使用“ mvndependency：tree”从依赖性树中打印出来。这仅适用于全新的插件，因此请确保apache-snapshots存储库位于您的插件存储库中：</p>
<pre><code class="prettyprint xml"><br />&lt;pluginRepositories&gt;
	&lt;pluginRepository&gt;
		&lt;id&gt;apache-snapshots&lt;/id&gt;
		&lt;url&gt;http://people.apache.org/maven-snapshot-repository&lt;/url&gt;
	&lt;/pluginRepository&gt;
&lt;/pluginRepositories&gt;
</code></pre><p>这比必须构建整个网站并查看相关性报告要方便得多，这是我过去经常做的事情。</p>
<h3>一个POM，一个POM，一个POM的王国...</h3><p>这是一个痴痴的Maven用户的呼声，当他第一次面对Grails项目并试图了解它们如何融合在一起时。希望我们将在这里展示如何使贫困的痴呆症患者平息。为此，我们提出了一些简单的步骤来为现有Grails项目创建Maven项目。</p><p>在随附的沙盒档案中，有三个pom，每个pom都位于自己的项目中：</p>
<ul>
<li>base =与Web应用程序无关的依赖项的基础POM。我对此非常宽容（例如，包括Spring Weblfow）。您应该能够仅通过这些依赖项启动grails控制台。
</li>
<li>web =为Web应用程序创建WAR文件所需的其他依赖关系。在某种程度上，这可能是平台依赖性的，但是这里包含的依赖性将在像Jetty 5.1这样的Servlet 2.4容器中工作（这是Grails传统上使用的）。
</li>
<li>launch = Jetty和JSP依赖项仅用于在独立或开发环境中启动Web应用程序</li>
</ul><p>要安装Grails poms，您不需要手动将任何工件添加到本地存储库。还有一些“ funnies”（我找不到的任何标准公共仓库中都没有），我已经将其包含在“ spring-ext”仓库（在pom中定义）中。如果您已连接到互联网，它应该开箱即用。</p>
<h3>运行示例的先决条件</h3><p>您将需要<a href="">Maven</a> （2.0。*）和<a href="">Grails</a> （0.5.6）来运行示例应用程序。我正在使用Maven 2.0.7。“ grails”和“ mvn”启动脚本需要在您的路径上，并且需要定义GRAIL_HOME env变量以运行Grails（标准安装过程）。</p>
<h3>测试项目</h3><p>还有一个测试项目，使用上述poms来管理Web应用程序。我决定坚持使用Grails目录布局。Graham告诉我，web-app / WEB-INF中的几乎所有“可变”内容都是在Grails 1.0中删除的，因此，我认为使用Grails制定的结构是最好的解决方法（极有可能是脆弱的，其他Grails开发人员很容易理解）。</p><p>从Grails命令行启动</p>
<pre><code class="prettyprint code">$ cd test
$ mvn package
$ grails run-app
</code></pre><p>要将其他依赖项添加到测试项目中，只需将它们添加到pom并重复该练习即可（或在Eclipse中什么也不做，请参见下文）。Maven很棒吗？</p><p>请注意，在项目pom中提供了Grails依赖项scope =。那应该意味着它们在Maven和Eclipse的类路径中，但是不包含在任何Maven包中（如果已实现）。</p>
<h3>仅限Eclipse用户</h3><p>该测试项目还包括Eclipse项目工件-使用Maven Eclipse扩展可获得最佳结果（ <a href="http://m2eclipse.codehaus.org/update-dev/)">http://m2eclipse.codehaus.org/update-dev/）</a> 。使用此Eclipse扩展，您将能够处理工作区中的其他项目，这些项目是Maven工件，如果它们是Grails项目的依赖项，它们将自动添加到类路径中，并在进行更改时动态更新。</p><p>如果不使用Maven Eclipse扩展，则可以使用Eclipse Maven插件（也称为maven-eclipse-plugin）。使用“ mvn eclipse：eclipse”更新.classpath并刷新，然后应该可以，但无法与其他Eclipse项目中的更改自动同步。</p><p>您首先需要从命令行执行“ grails软件包”（仅一次）：</p>
<pre><code class="prettyprint code">$ cd test
$ grails package
</code></pre><p>这会为您生成一个web.xml，并复制和过滤grails-app / conf中的某些属性文件。显然，可能的长期前景是web.xml将是web-app / WEB-INF中唯一生成的文件（因此每个人的scource控制系统中只有一个svn：ignore）。</p><p>在Eclipse中，您可以导入测试项目。然后，您可以执行Run…并从Java Applications中选择“测试”启动器。您可以在Grails应用程序和相关项目中进行调试，并可以动态更改代码。</p>
<h2>下一步是什么</h2><p>我附加的工具有些遗失/不舒服的地方。他们正在进行许多工作。如果有人尝试过，他们无疑将对如何做得更好提出建议。请发回此处，或在<a href="http://jira.codehaus.org/browse/GRAILS">Grails JIRA</a>上发帖</p><p>以下是一些已知的问题或烦恼：</p>
<h3>带有Grails包装的重复罐</h3><p>来自核心的某些Grails依赖项可能与poms中的依赖项（Grails poms或project pom）不同或仅以不同的方式命名。当您执行“ grails软件包”时，它将jars从GRAILS_HOME / lib复制到web-app / WEB-INF / lib，并且没有办法防止重复。例如，无论Grails不使用标准jar名称，在WEB-INF / lib中都会看到重复的名称。</p><p>Maven依赖插件不允许我们排除提供的依赖（无论如何此刻），使得问题更加复杂，因此，当您执行“ mvn软件包”时，所有Grails依赖都以./lib结尾。对于Grails开发人员来说，这是不舒服的，因为通常是从GRAILS_HOME / lib复制它们。理想情况下，在我们可以说我们确实具有Maven-Grails集成之前，将解决这种纠纷。</p>
<h3>缺少其他Maven生命周期阶段</h3><p>这个简单的演示为Grails带来了全新的打包生命周期增强。我们希望能够使用Maven为我们做更多的开发和持续集成工作。</p><p>例如，我们想从Grails项目布局中构建一个WAR文件。使用Ant和Maven并不是很难做到的。理想情况下，它将被实现为Maven插件-这几乎是Arnaud的项目，所以我希望他有所进步，但也希望他可以从这里的经验中学习。</p><p>其他有用的生命周期阶段也丢失了。例如，不能从样本中的Maven驱动测试。</p>
<h3>谷物包装周期</h3><p>Grails和Maven具有各自的“打包”周期。通常，Grails只需（在两次清洗之间）发生一次，但必须记住要这样做仍然很烦人。</p>
<h3>用于Eclipse的Groovy插件</h3><p>在.groovy源代码中突出显示语法是很好的选择，但否则，似乎Groovy插件就成为了障碍。这实际上与Maven或Grails无关，但已知会给其他Grails Eclipse用户造成问题。例如，在编辑控制器或服务时，您可能会看到讨厌的警告消息，询问您是否要终止应用程序。Groovy插件已检测到更改，并且Eclipse无法处理对classpath的更改。但是Grails可以，因此通常您可以单击“ Continue”按钮。但不总是。在项目属性中关闭Groovy编译是安全的，但是随后您将丢失非grails-app类的动态编译。</p>
<hr><p>再次附件：单击<a href="http://blog.interface21.com/main/wp-content/uploads/2007/07/grails-maven.zip">此处</a> 。</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 99;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>