<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>Spring集成样本</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Spring Integration Samples">
<meta name="twitter:description" content="<p>In my <a href=" http:="" ="" blog.interface21.com="" main="" 2007="" 12="" 14="" spring-integration-a-new-addition-to-the-spring-portfoli="="></head><body >recent post, I had mentioned that the Subversion repository for Spring Integration would be publicly accessible soon, and I’m pleased to provide that link now. You can checkout the project with the following command:
<pre><code class="prettyprint code">svn co https://anonsvn.springframework.org/svn/spring-integration/base/trunk spring-integration
</code></pre>
<p>If the checkout is successful, you should see the following directory structure:</p>
<pre><code class="prettyprint code">spring-integration/
  +--build-spring-integration/
  +--spring-build/
  +--spring-integration-core/
  +--spring-integration-samples/
</code></pre>
">
<meta name="twitter:creator" content="@m_f_">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/443e6ec0242c3f54001dae34374780e2?s=200">

<meta property="og:title" content="Spring Integration Samples">
<meta property="og:image" content="https://gravatar.com/avatar/443e6ec0242c3f54001dae34374780e2?s=200">
<meta property="og:description" content="<p>In my <a href=" http:="" ="" blog.interface21.com="" main="" 2007="" 12="" 14="" spring-integration-a-new-addition-to-the-spring-portfoli="=">recent post, I had mentioned that the Subversion repository for Spring Integration would be publicly accessible soon, and I’m pleased to provide that link now. You can checkout the project with the following command:
<pre><code class="prettyprint code">svn co https://anonsvn.springframework.org/svn/spring-integration/base/trunk spring-integration
</code></pre>
<p>If the checkout is successful, you should see the following directory structure:</p>
<pre><code class="prettyprint code">spring-integration/
  +--build-spring-integration/
  +--spring-build/
  +--spring-integration-core/
  +--spring-integration-samples/
</code></pre>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2007-12-21 22:46:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring集成样本</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/443e6ec0242c3f54001dae34374780e2?s=20&d=mm"> <a class="author" rel="author" href="/team/mfisher">马克·费舍尔</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2007-12-21 22:46:00.0">2007年12月21日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2007/12/21/spring-integration-samples#disqus_thread" data-disqus-identifier="122">
</a></div>
</div>
</header>
<div class="blog--post"><p>在我<a href="http://blog.interface21.com/main/2007/12/14/spring-integration-a-new-addition-to-the-spring-portfolio">最近的帖子中</a> ，我提到了Spring Integration的Subversion存储库将很快可以公开访问，我很高兴现在提供该链接。您可以使用以下命令检出项目：</p>
<pre><code class="prettyprint code">svn co https://anonsvn.springframework.org/svn/spring-integration/base/trunk spring-integration
</code></pre><p>如果检出成功，则应该看到以下目录结构：</p>
<pre><code class="prettyprint code">spring-integration/
  +--build-spring-integration/
  +--spring-build/
  +--spring-integration-core/
  +--spring-integration-samples/
</code></pre><p>我想借此机会浏览“ spring-integration-samples”中的几个示例。请记住，这个项目绝对是一个尚在开发中的项目（目前是0.5 SNAPSHOT），但是示例应使您对编程模型的形成方式有所了解，并且我非常期待获得一些反馈。</p>
<h2>你好，世界</h2><p>第一个示例是强制性的“ Hello World”演示。此示例演示了主要组件：消息通道和消息端点。该演示还揭示了Spring Integration方法是非侵入性的-将业务逻辑和消息传递之间的关注点完全分离。在这种情况下，“业务逻辑”是一个简单的<i>HelloService</i> ：</p>
<pre><code class="prettyprint java"><br>public class HelloService {

    public String sayHello(String name) {
        return "Hello " + name;
    }
}
</code></pre><p>本示例对消息端点使用基于XML的配置（我们将在后面看到注释方法）：</p>
<pre><code class="prettyprint xml"><br><endpoint input-channel="inputChannel"
               default-output-channel="outputChannel"
               handler-ref="helloService"
               handler-method="sayHello"/>
</code></pre><p>在这里，您可以看到“ handler-ref”只是指向一个Spring管理的bean。如果您已经使用Spring的<i>MessageListenerAdapter</i>进行异步JMS接收，则应该看起来很熟悉-特别是如果您使用的是Spring 2.5的新<i>jms</i>命名空间和“ jms：listener”元素。最后， <i>HelloWorldDemo</i>启动应用程序上下文，然后与通道进行交互：</p>
<pre><code class="prettyprint java"><br>ChannelRegistry channelRegistry = (ChannelRegistry) context.getBean(MessageBusParser.MESSAGE_BUS_BEAN_NAME);
MessageChannel inputChannel = channelRegistry.lookupChannel("inputChannel");
MessageChannel outputChannel = channelRegistry.lookupChannel("outputChannel");
inputChannel.send(new StringMessage(1, "World"));
System.out.println(outputChannel.receive().getPayload());
</code></pre><p>该示例涉及对MessageBus bean的查找-实现ChannelRegistry接口。但是，在非演示“真实世界”场景中，任何将访问通道的组件都可以通过依赖项注入来提供注册表。它需要做的就是实现<i>ChannelRegistryAware</i> （或使用@Autowired）。这与Spring其他地方使用的方法相同，例如<i>ApplicationEventPublisherAware</i> 。</p>
<h2>注释驱动的端点和订户</h2><p>下一个示例显示如何配置带有注释的消息端点。实际上，该特定端点甚至还提供了带有@Polled方法注释的，在后台转换为消息有效负载内容的数据。它可以替代地提供用于异步接收消息的输入通道。</p>
<pre><code class="prettyprint java"><br>@MessageEndpoint(defaultOutput="quotes")
public class QuotePublisher {

    @Polled(period=300)
    public Quote getQuote() {
        BigDecimal price = new BigDecimal(new Random().nextDouble() * 100);
        return new Quote(generateTicker(), price.setScale(2, RoundingMode.HALF_EVEN));
    }

    private String generateTicker() {
        // randomly generates 3-letter tickers
    }
}
</code></pre><p>在接收方，有一个@Subscriber批注：</p>
<pre><code class="prettyprint java"><br>public class QuoteSubscriber {

    @Subscriber(channel="quotes")
    public void log(Object o) {
        System.out.println(o);
    }
}
</code></pre><p>这是XML，用于注册注释后处理器和2个Spring管理的Bean（请注意，此示例将'spring-integration'模式用作主要名称空间。</p>
<pre><code class="prettyprint xml"><br><beans:beans xmlns="http://www.springframework.org/schema/integration"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:beans="http://www.springframework.org/schema/beans"
        xsi:schemaLocation="http://www.springframework.org/schema/beans
                http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
                http://www.springframework.org/schema/integration
                http://www.springframework.org/schema/integration/spring-integration-1.0.xsd">

    <message-bus/>

    <annotation-driven/>

    <channel id="quotes"/>

    <beans:bean id="publisher" class="org.springframework.integration.samples.quote.QuotePublisher"/>

    <beans:bean id="subscriber" class="org.springframework.integration.samples.quote.QuoteSubscriber"/>

</beans:beans>
</code></pre><p>顺便说一句，“注释驱动”元素还启用@Publisher注释，该注释触发AOP建议的创建，以将任何带注释的方法的返回值异步发送到通道。</p>
<h2>简单路由</h2><p>路由示例具有一个消息端点，该消息端点每3秒生成一个递增整数，以及一个路由器，该路由器解析目标通道名称（请注意，路由器方法还可以返回多个结果，并且可以返回实际的MessageChannel实例而不是名称）。</p>
<pre><code class="prettyprint java"><br>@MessageEndpoint
public class Counter {

    private AtomicInteger count = new AtomicInteger();

    @Polled(period=3000)
    public int getNumber() {
        return count.incrementAndGet();
    }

    @Router
    public String resolveChannel(int i) {
        if (i % 2 == 0) {
            return "even";
        }
        return "odd";
    }
}
</code></pre><p>在这些通道的接收端，我们有两种不同的方法可以简单地记录消息有效负载：</p>
<pre><code class="prettyprint java"><br>@Component
public class NumberLogger {

    @Subscriber(channel="even")
    public void even(int i) {
        System.out.println("even: " + i);
    }

    @Subscriber(channel="odd")
    public void odd(int i) {
        System.out.println("odd:  " + i);
    }
}
</code></pre><p>顺便说一下，请注意， <i>NumberLogger</i>带有Spring的@Component注释。@MessageEndpoint注释还包含@Component作为元注释。因此，两者都是“原型”，并且可以通过Spring 2.5的类路径扫描进行自动检测。此示例的XML非常简单：</p>
<pre><code class="prettyprint xml"><br><context:component-scan base-package="org.springframework.integration.samples.oddeven"/>

<message-bus auto-create-channels="true"/>

<annotation-driven/>
</code></pre>
<hr><p>希望这对Spring Integration编程模型提供了不错的介绍。随意签出代码并自己尝试这些示例。我目前正在编写“入门指南”，该指南将在假期后提供。如果您要签出代码，请确保经常更新。该代码在不断发展，尤其是我重构了许多核心使用者/调度程序代码，目的是提供用于添加轮询或事件驱动消息源的最简单的扩展点。在下一篇博客文章中，我计划展示具有这些扩展点的“ spring-integration-samples”的一些新功能。</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 122;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>