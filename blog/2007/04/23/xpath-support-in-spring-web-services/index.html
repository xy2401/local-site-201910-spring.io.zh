<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>Spring Web Services中的XPath支持</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="XPath Support in Spring Web Services">
<meta name="twitter:description" content="<p>Following up on my post on <a href=" http: ="" blog.springframework.com="" arjen="" archives="" 2007="" 03="" 27="" ws-duck-typing="" ="=">WS-DuckTyping, I thought it would be interesting to show what support <a href=" static.springframework.org spring-ws site "></head><body >Spring Web Services offers for XPath. Some of these features are available right now, but most will be part of the RC1 release we will release later this month. Throughout this post I will be using the contacts xml file defined in <a href="http://www.cafeconleche.org/books/effectivexml/chapters/35.html">item 35</a> of <a href="http://www.cafeconleche.org/books/effectivexml/">Effective XML</a>, by Rusty Harold. 
<h3>XPathExpression</h3>
<p>One of the options that has been available for quite a while is the <a href="http://static.springframework.org/spring-ws/site/apidocs/org/springframework/xml/xpath/XPathExpression.html"><span style="font-family:courier">XPathExpression</span></a>. This is an abstraction over compiled XPath expressions, such as the Java 5 <span style="font-family:courier">XPathExpression</span>, and Jaxen <span style="font-family:courier">XPath</span>.</p>
">
<meta name="twitter:creator" content="@poutsma">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/783fefe566e832976f50aacb1b8fd949?s=200">

<meta property="og:title" content="XPath Support in Spring Web Services">
<meta property="og:image" content="https://gravatar.com/avatar/783fefe566e832976f50aacb1b8fd949?s=200">
<meta property="og:description" content="<p>Following up on my post on <a href=" http: ="" blog.springframework.com="" arjen="" archives="" 2007="" 03="" 27="" ws-duck-typing="" ="=">WS-DuckTyping, I thought it would be interesting to show what support <a href=" static.springframework.org spring-ws site ">Spring Web Services offers for XPath. Some of these features are available right now, but most will be part of the RC1 release we will release later this month. Throughout this post I will be using the contacts xml file defined in <a href="http://www.cafeconleche.org/books/effectivexml/chapters/35.html">item 35</a> of <a href="http://www.cafeconleche.org/books/effectivexml/">Effective XML</a>, by Rusty Harold. 
<h3>XPathExpression</h3>
<p>One of the options that has been available for quite a while is the <a href="http://static.springframework.org/spring-ws/site/apidocs/org/springframework/xml/xpath/XPathExpression.html"><span style="font-family:courier">XPathExpression</span></a>. This is an abstraction over compiled XPath expressions, such as the Java 5 <span style="font-family:courier">XPathExpression</span>, and Jaxen <span style="font-family:courier">XPath</span>.</p>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2007-04-23 21:33:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Web Services中的XPath支持</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/783fefe566e832976f50aacb1b8fd949?s=20&d=mm"> <a class="author" rel="author" href="/team/apoutsma">Arjen Poutsma</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2007-04-23 21:33:00.0">2007年4月23日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2007/04/23/xpath-support-in-spring-web-services#disqus_thread" data-disqus-identifier="67">
</a></div>
</div>
</header>
<div class="blog--post"><p>紧接着我在<a href="http://blog.springframework.com/arjen/archives/2007/03/27/ws-duck-typing/">WS-DuckTyping</a>上<a href="http://blog.springframework.com/arjen/archives/2007/03/27/ws-duck-typing/">的文章</a> ，我认为展示<a href="http://static.springframework.org/spring-ws/site/">Spring Web Services</a>对XPath提供的支持会很有趣。其中一些功能现在即可使用，但大多数功能将成为本月晚些时候发布的RC1版本的一部分。在整个这篇文章中，我将使用Rusty Harold在<a href="http://www.cafeconleche.org/books/effectivexml/">有效XML的</a> <a href="http://www.cafeconleche.org/books/effectivexml/chapters/35.html">项目35</a>中定义的contacts xml文件。</p>
<h3>XPathExpression</h3><p><a href="http://static.springframework.org/spring-ws/site/apidocs/org/springframework/xml/xpath/XPathExpression.html"><span style="font-family:courier">XPathExpression</span></a>是已经使用了很长时间的选项之一。这是对已编译XPath表达式（例如Java 5 <span style="font-family:courier">XPathExpression</span>和Jaxen <span style="font-family:courier">XPath</span> ）的抽象。</p><p>最近，我添加了<a href="http://static.springframework.org/spring-ws/site/apidocs/org/springframework/xml/xpath/XPathExpressionFactoryBean.html"><span style="font-family:courier">XPathExpressionFactoryBean</span></a> ，以使其更容易将XPath表达式注入到bean中，如下所示：</p>
<pre><code class="prettyprint xml"><br />&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-2.0.xsd&quot;&gt;

    &lt;bean id=&quot;myEndpoint&quot; class=&quot;com.mycompany.ws.MyEndpoint&quot;&gt;
        &lt;constructor-arg ref=&quot;nameExpression&quot;/&gt;
    &lt;/bean&gt;

    &lt;bean id=&quot;nameExpression&quot; class=&quot;org.springframework.xml.xpath.XPathExpressionFactoryBean&quot;&gt;
        &lt;property name=&quot;expression&quot; value=&quot;/Contacts/Contact/Name&quot;/&gt;
    &lt;/bean&gt;

&lt;/beans&gt;
</code></pre><p>为简单起见，此表达式不使用名称空间，但是我们可以使用工厂bean的<span style="font-family:courier">名称空间</span>属性设置这些<span style="font-family:courier">名称空间</span> 。</p><p>该表达式可以在代码中如下使用：</p>
<pre><code class="prettyprint java"><br />public class MyEndpoint extends AbstractDomPayloadEndpoint {
    
    private XPathExpression nameExpression;

    public MyEndpoint(XPathExpression nameExpression) {
        this.nameExpression = nameExpression;
    }

    // Gets invoked for every incoming request
    protected Element invokeInternal(Element requestElement, Document responseDocument) throws Exception {
        String name = nameExpression.evaluateAsString(requestElement);
        // do something with name
        return null; // no response
    }

}
</code></pre><p><span style="font-family:courier">XPathExpression</span>最近添加的功能是<a href="http://static.springframework.org/spring-ws/site/apidocs/org/springframework/xml/xpath/NodeMapper.html"><span style="font-family:courier">NodeMapper</span></a> 。如果将表达式更改为<span style="font-family:courier">/ Contacts / Contact</span> ，则可以使用它：</p>
<pre><code class="prettyprint java"><br />public class MyEndpoint extends AbstractDomPayloadEndpoint {

    private XPathExpression nameExpression;

    public MyEndpoint(XPathExpression nameExpression) {
        this.nameExpression = nameExpression;
    }

    protected Element invokeInternal(Element requestElement, Document responseDocument) throws Exception {
        List contacts = nameExpression.evaluate(requestElement,
                new NodeMapper() {
                    public Object mapNode(Node node, int nodeNum) throws DOMException {
                        Element contactElement = (Element) node;
                        Element nameElement = (Element) contactElement.getElementsByTagName(&quot;Name&quot;).item(0);
                        Element phoneElement = (Element) contactElement.getElementsByTagName(&quot;Phone&quot;).item(0);
                        return new Contact(nameElement.getTextContent(), phoneElement.getTextContent());
                    }
                } );
        for (Iterator iterator = contacts.iterator(); iterator.hasNext();) {
            Contact contact = (Contact) iterator.next();
            System.out.println(contact);
        }
        return null; // no response
    }

}
</code></pre><p>正如我们使用Spring JDBC的<a href="http://www.springframework.org/docs/api/org/springframework/jdbc/core/RowMapper.html">RowMapper</a>映射行一样，每个结果节点都是使用匿名内部类映射的。在这种情况下，我们将创建一个<span style="font-family:courier">Contact</span> ，稍后再打印即可。</p>
<h3>XPath模板</h3><p>最近添加的另一个是<a href="http://static.springframework.org/spring-ws/site/apidocs/org/springframework/xml/xpath/XPathOperations.html"><span style="font-family:courier">XPathTemplate</span></a> 。此类遵循整个Spring使用的通用模板模式（JdbcTemplate，JmsTemplate等）。该模板可以如下使用：</p>
<pre><code class="prettyprint java"><br />public class MyEndpoint implements PayloadEndpoint {

    private XPathOperations template = new Jaxp13XPathTemplate();

    public Source invoke(Source request) throws Exception {
        String name = template.evaluateAsString(&quot;/Contacts/Contact/Name&quot;, request);
        // do something with name
        return null; // no response
    }

}
</code></pre><p>当然，可以向模板注入构造函数参数或setter。</p><p>XPath模板不使用预编译的XPath表达式，因此它们要慢一些。但是，模板稍微灵活一些，因为您可以将其重新用于多个表达式。它还支持上述<span style="font-family:courier">NodeMapper</span> 。</p>
<h3>@XPathParam</h3><p>最后，对于Java 5用户来说，还有一些新东西： <a href="http://static.springframework.org/spring-ws/site/apidocs/org/springframework/ws/server/endpoint/annotation/XPathParam.html"><span style="font-family:courier">@XPathParam</span></a>批注。您可以在方法参数上使用此注释，XPath评估将简单地注入到方法中。使用方法如下：</p>
<pre><code class="prettyprint java"><br />@Endpoint
public class MyEndpoint {

    @PayloadRoot(&quot;Contacts&quot;)
    public void handleContacts(@XPathParam(&quot;/Contacts/Contact/Name&quot;)String name) {
        // do something with name
    }

}
</code></pre><p><span style="font-family:courier">@Endpoint</span>批注是将类标记为终结点所<span style="font-family:courier">必需的</span> ， <span style="font-family:courier">@ PayloadRoot</span>表示，每当以<span style="font-family:courier">Contact</span>为根元素的SOAP请求到达时，都会调用<span style="font-family:courier">handleContacts</span>方法。最后， <span style="font-family:courier">@XPathParam</span>进行参数绑定。您可以绑定到XPath支持的所有数据类型：布尔值，双精度型，字符串，<br>节点和节点列表。当然，将所有表达式保存在一个配置文件中更为可维护，但是对于较简单的项目，这是一种合适的方法。</p><p>使用这种带注释的端点样式只需要一点点XML，就可以让Spring-WS知道endint存在并使用注释。其余的将自动提取。</p>
<pre><code class="prettyprint xml"><br />&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-2.0.xsd&quot;&gt;

    &lt;bean class=&quot;org.springframework.ws.server.endpoint.mapping.PayloadRootAnnotationMethodEndpointMapping&quot;/&gt;

    &lt;bean class=&quot;org.springframework.ws.server.endpoint.adapter.XPathParamAnnotationMethodEndpointAdapter&quot;/&gt;

    &lt;bean id=&quot;myEndpoint&quot; class=&quot;com.mycompany.ws.MyEndpoint&quot;/&gt;

&lt;/beans&gt;
</code></pre><p>这些功能中的大多数将成为我们将于本月晚些时候发布的RC1版本的一部分（还将包括我们正在开发的更新的参考文档）。不过，也有供这个版本中的快照<a href="http://static.springframework.org/spring-ws/site/downloads/snapshots.html">在这里</a> ，所以给他们一个尝试，并在报告<a href="http://forum.springframework.org/forumdisplay.php?f=39">论坛</a> 。</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 67;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>