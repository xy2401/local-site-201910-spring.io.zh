<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>So what&#39;s the deal with Spring-OSGi?</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="So what&#39;s the deal with Spring-OSGi?" />
<meta name="twitter:description" content="&lt;p&gt;Welcome to my blog!&lt;br&gt;This is my first entry…ever. I manage to resist the urge of blogging but since so many people encouraged me to write about what I do at &lt;a href=&quot;http://www.interface21.com&quot;&gt;i21&lt;/a&gt; I decided to give it a go. This and the fact that the &lt;a href=&quot;http://www.springframework.org/osgi&quot;&gt;Spring-OSGi&lt;/a&gt; had its first &lt;a href=&quot;http://sourceforge.net/project/showfiles.php?group_id=73357&amp;amp;package_id=227224&quot;&gt;release&lt;/a&gt; yesterday evening (EET time zone).&lt;/p&gt;
&lt;p&gt;I’ve been involved with Spring-OSGi since August last year and it has been quite a ride. It’s one of the most challenging projects I have worked on and I’m glad to have it released, even as a milestone, to the public. Thanks a lot to everybody involved for making this happen, especially my &lt;a href=&quot;http://static.springframework.org/maven2/spring-osgi/team-list.html&quot;&gt;team&lt;/a&gt; mates - Adrian, Andy and Hal!&lt;/p&gt;
" />

<meta property="og:title" content="So what&#39;s the deal with Spring-OSGi?" />
<meta property="og:description" content="&lt;p&gt;Welcome to my blog!&lt;br&gt;This is my first entry…ever. I manage to resist the urge of blogging but since so many people encouraged me to write about what I do at &lt;a href=&quot;http://www.interface21.com&quot;&gt;i21&lt;/a&gt; I decided to give it a go. This and the fact that the &lt;a href=&quot;http://www.springframework.org/osgi&quot;&gt;Spring-OSGi&lt;/a&gt; had its first &lt;a href=&quot;http://sourceforge.net/project/showfiles.php?group_id=73357&amp;amp;package_id=227224&quot;&gt;release&lt;/a&gt; yesterday evening (EET time zone).&lt;/p&gt;
&lt;p&gt;I’ve been involved with Spring-OSGi since August last year and it has been quite a ride. It’s one of the most challenging projects I have worked on and I’m glad to have it released, even as a milestone, to the public. Thanks a lot to everybody involved for making this happen, especially my &lt;a href=&quot;http://static.springframework.org/maven2/spring-osgi/team-list.html&quot;&gt;team&lt;/a&gt; mates - Adrian, Andy and Hal!&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2007-04-05 16:15:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">So what&#39;s the deal with Spring-OSGi?</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="null?s=20&amp;d=mm" />
<span class="author">Costin Leau</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2007-04-05 16:15:00.0">April 05, 2007</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="65" href="/blog/2007/04/05/so-what-s-the-deal-with-spring-osgi#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>Welcome to my blog!<br />This is my first entry&hellip;ever. I manage to resist the urge of blogging but since so many people encouraged me to write about what I do at <a href="http://www.interface21.com">i21</a> I decided to give it a go. This and the fact that the <a href="http://www.springframework.org/osgi">Spring-OSGi</a> had its first <a href="https://sourceforge.net/project/showfiles.php?group_id=73357&package_id=227224">release</a> yesterday evening (EET time zone).</p><p>I&rsquo;ve been involved with Spring-OSGi since August last year and it has been quite a ride. It&rsquo;s one of the most challenging projects I have worked on and I&rsquo;m glad to have it released, even as a milestone, to the public. Thanks a lot to everybody involved for making this happen, especially my <a href="http://static.springframework.org/maven2/spring-osgi/team-list.html">team</a> mates - Adrian, Andy and Hal!</p><p>In this entry, I&rsquo;d like you give you a glimpse at what Spring 1.0 M1 provides at the moment; I&rsquo;ll skip introducing OSGi since there is plenty of excellent material available on the internet (see the links at the bottom).</p><p>The basic idea behind Spring-OSGi is to make it easy to build/write/deploy Spring applications in an OSGi environment. That is, to have the comprehensive POJO based programming model that Spring offers (IoC, AOP, service abstractions) working transparently in a dynamic execution environment which is focused on versioning and modularity.</p><p>One of the biggest challenges when adopting OSGi is dealing with its dynamic nature. Services (which are are simple object instances) come and go and your application has to deal with that. The solution is not straight forward, depends from case to case and requires an application-wide scope just like exception handling and transaction do. Classloading restrictions, enforced by the modularity mentioned, combined with AOP can cause a lot of grief and force the developer to create hacks, thus throwing out the window the benefits OSGi provides.<br />These are just a <strong>few</strong> examples of the things we are addressing in Spring-OSGi which in the end, should allow a smooth adoption path to OSGi.</p><p>Let&rsquo;s take a look at some of the features you&rsquo;ll find in 1.0 M1:</p>
<ol>
<li><strong>OSGi Application Context</strong></li>
</ol><p>OSGi is based on <em>bundles</em> which are nothing more then jars with some dedicated manifest entries. They are modules, units that export and import class packages and/or services.<br />An application can be composed of one or multiple bundles. Spring-OSGi provides an application context which builds on top of a bundle and its lifecycle, giving you access to the OSGi context in which the application lives, an OSGi <a href="http://static.springframework.org/maven2/spring-osgi/apidocs/org/springframework/osgi/context/OsgiBundleScope.html">custom</a> scope as well as an <a href="http://static.springframework.org/maven2/spring-osgi/apidocs/org/springframework/osgi/context/BundleContextAware.html">extra</a> <span style="font-family:courier">Aware</span> interface. As the rest of its ilk, the interface provides the ability to do dependency lookup, something you should think twice before using as OSGi service dependency injection is fully supported.</p>
<ol>
<li><strong>Resource abstraction</strong></li>
</ol><p>Classloading is not what is used to be in OSGi - the classpath for example has a different meaning since it can be assembled from multiple bundles (which in turn, can be used in more then one classpath). Thus <span style="font-family:courier">getClass().getResource()</span> can have a different outcome as the environment in which are running has changed quite a lot. Here is an example of what you might get in case you are looking for a class:</p><p><a href="https://www.eclipse.org/equinox/">Equinox</a>: <span style="font-family:courier"><a href="bundleentry://5/my/package/MyClass.class">bundleentry://5/my/package/MyClass.class</a></span> (can be also <span style="font-family:courier">bundleresource://</span>)<br /><a href="http://www.knopflerfish.org/">Knopflerfish</a>: <span style="font-family:courier"><a href="bundle://13/my/package/MyClass.class">bundle://13/my/package/MyClass.class</a></span><br /><a href="https://incubator.apache.org/felix/">Felix</a>: <span style="font-family:courier"><a href="bundle://18.0/0/my/package/MyClass.class">bundle://18.0/0/my/package/MyClass.class</a></span></p><p>Relying on URL schemes is not portable thus one of the first things done in Spring OSGi was to encapsulate low-level access through the simple, yet effective <a href="http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/core/io/Resource.html">Resource</a> interface, so no matter what OSGi implementation you are using, you can find your files. Moreover, pattern style lookups such as myFolder/* are possible (in fact we are using <span style="font-family:courier">/META-INF/spring/*</span> to detect &lsquo;spring powered&rsquo; bundles).</p>
<ol>
<li><strong>Dynamic service support</strong></li>
</ol><p>Suppose you have the following application context:</p>
<pre><code class="prettyprint xml"><br />&lt;!-- service layer--&gt;
&lt;bean id=&quot;myService&quot; class=&quot;ServiceClass&quot;&gt;
    &lt;property name=&quot;dao&quot; ref=&quot;dao&quot;/&gt;
&lt;/bean&gt;

&lt;!-- dao layer --&gt;
&lt;bean id=&quot;dao&quot; class=&quot;poorPerformerDAO&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;someDataSource&quot;/&gt;
&lt;/bean&gt;
</code></pre><p>Most of the application have several layers which are excellent candidates for OSGi bundles since one can simply put the DAO classes in one bundle (the dao bundle), the service layer in another (service bundle) so when the DAOs implementations are updated (for example <em>poorPerformerDAO</em> above is replaced with <em>excellentPerformerDAO</em>) or a different version of the application is being deploy, no application restarts are required: one of the best reasons to choose OSGi!</p><p>However, to take advantage of the OSGi capabilities, the objects have to become services - that is, they have to be registered with the OSGi platform before being &lsquo;consumed&rsquo; while the consumer (client) has to look for them. It&rsquo;s an <a href="https://en.wikipedia.org/wiki/Service-oriented_architecture">SOA</a>-like approach which avoids tight coupling between modules so when a bundle is shut down, the services published by it disappear. Which means that one first has to use the OSGi APIs to do the registration and lookup but also has to deal with failure as services can come and go.</p><p>Spring-OSGi greatly helps in this area by allowing literally any type of object to be exported and imported in your application without any code change.</p><p>Service Bundle:</p>
<pre><code class="prettyprint java"><br />&lt;!-- service layer--&gt;
&lt;bean id=&quot;myService&quot; class=&quot;ServiceClass&quot;&gt;
    &lt;property name=&quot;dao&gt;
       &lt;osgi:reference interface=&quot;daoInterface&quot;/&gt;
    &lt;/property&gt;
&lt;/bean&gt;&lt;/code&gt;
</code></pre><p>Dao Bundle:</p>
<pre><code class="prettyprint xml"><br />&lt;!-- dao layer --&gt;
&lt;bean id=&quot;dao&quot; class=&quot;goodPerformerDAO&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;someDataSource&quot;/&gt;
&lt;/bean&gt;

&lt;osgi:service ref=&quot;dao&quot;/&gt;
</code></pre><p>With Spring-OSGi to accomodate to the OSGI environment, two lines of configurations have to be added:</p>
<ol>
<li><span style="font-family:courier"><osgi:reference ..></span> to instruct the framework what OSGi service to look for</li>
<li><span style="font-family:courier"><osgi:service ..></span> to export an existing bean as an OSGi service</li>
</ol><p>Obviously the same can be done for the <em>dataSource</em> dependency - externalize it into an OSGi bundle and just replace the straight <span style="font-family:courier">ref</span>with an <span style="font-family:courier">osgi:reference</span>. No new APIs to deal with, no exceptions to <span style="font-family:courier">try/catch/finally</span> for and especially built-in lookup behavior.<br />Spring-OSGi can be instructed so that the application context does not start unless a service implementating daoInterface is found - that is, the dao dependency can be satisfied. Moreover, at runtime if the service goes away, Spring-OSGi will automatically look for a new implementation based on your configuration (number of retries and timeout): if a call is invoked on &lsquo;dao&rsquo; bean exactly when the owning bundle is updated (for example to upgrade <em>goodPerformerDAO</em> to <em>excellentPerformerDAO</em>) instead of getting a nasty, apparently inexplicable exception, one will get an imperceptible delay caused by new service lookup. As always, the behavior is fully configured.</p><p>To some degree the exporter/importer functionality resembles <a href="http://static.springframework.org/spring/docs/2.0.x/reference/remoting.html">Spring remoting</a> with the big difference that there is no remoting involved - everything is running in the same VM and there is no serialization involved what so ever.</p>
<ol>
<li><strong>Integration testing</strong></li>
</ol><p>Testing is important (even crucial) especially when migrating an application to a new environment, as a lot of things taken for granted can simply fail: we experienced this ourselves quite early on in development. This has been a big issue since testing was anything but easy or automated when talking about OSGi since the execution environment (the OSGi platform or container if you&rsquo;d like) has to be started (no standardized API) and setup (install the bundles your test depends on). However the tricky part is that the test itself has to be OSGified - placed along side a manifest which declares the dependencies, into a bundle which has to be installed and started into the OSGi platform.</p><p>Meet <a href="http://static.springframework.org/maven2/spring-osgi/apidocs/org/springframework/osgi/test/AbstractOsgiTests.html">AbstractOsgiTests</a> &amp; <a href="http://static.springframework.org/maven2/spring-osgi/apidocs/org/springframework/osgi/test/package-summary.html">co</a>:</p>
<pre><code class="prettyprint java"><br />public class SimpleIntegrationTests extends AbstractConfigurableBundleCreatorTests
{

  public void testInstalledBundles() {
    // get access to the OSGi bundle context
     Bundle[] bundles = getBundleContext().getBundles();

     getBundleContext().installBundle(someBundleLocation);
     assertEquals(bundles.length()+1, getBundleContext().getBundles().length());
  }

  // specify the bundles to install  
  protected String[] getBundles() {
        return new String[] {
                &quot;org.springframework.osgi, commons-collections.osgi, 3.2-SNAPSHOT&quot;,
                &quot;org.springframework.osgi, org.springframework.osgi.test.simple.service,1.0-SNAPSHOT&quot;};
    }
}

</code></pre><p><span style="font-family:courier">AbstractOsgiTests</span> builds on top of JUnit so you can write and run OSGi integration tests directly from your IDE. The entire setup is handled by the testing infrastructure so you don&rsquo;t have to: no need to write a <span style="font-family:courier">MANIFEST.MF</span> for your test, to do any packaging or deployment - everything is handled automatically. And it&rsquo;s fast, extremely fast! In fact, less then 10% percent of the startup time is spent inside Spring-OSGi code - the rest is used by the OSGi platform itself. Most of our integration tests are fully executed in 1-3 seconds each. Equinox, Knopflerfish and Felix are all supported.</p><p>Well, I think that&rsquo;s enough for a first entry&hellip; I&rsquo;ll write more about Spring-OSGi features in future entries. I hope I&rsquo;ve made you curios enough to take 1.0 M1 for a spin (please note that it&rsquo;s the first milestone and it has some &lsquo;rough edges&rsquo;).</p><p>Thanks for reading!<br /> Costin</p><p><a href="http://www.osgi.org/">OSGi Alliance</a> which has some nice <a href="http://www.osgi.org/osgi_technology/index.asp?section=2">intros</a> and <a href="http://www.osgi.org/documents/collateral/TechnicalWhitePaper2005osgi-sp-overview.pdf">whitepapers</a><br /><a href="https://en.wikipedia.org/wiki/OSGi">Wikipedia</a><br />EclipseCon OSGi <a href="https://www.eclipsecon.org/2007/index.php?page=sub/&area=osgi">track</a><br />Spring-OSGi <a href="http://www.springframework.org/osgi/specification">specification</a><br />Javapolis 2006 <a href="http://www.bejug.org/confluenceBeJUG//display/PARLEYS/Spring%20OSGi">presentation</a> on Spring-OSGi (by yours truly)<br />Last, but not least, good ol&rsquo; <a href=" http://www.google.com/search?q=osgi&start=0&ie=utf-8&oe=utf-8">Google</a>.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 65;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>