<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Introducing the Spring YARN framework for developing Apache Hadoop YARN applications</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Introducing the Spring YARN framework for developing Apache Hadoop YARN applications" />
<meta name="twitter:description" content="&lt;p&gt;We’re super excited to let the cat out of the bag and release support for writing YARN based applications as part of the &lt;a href=&quot;http://www.springsource.org/node/22687&quot;&gt;Spring for Apache Hadoop 2.0 M1 release&lt;/a&gt;. In this blog post I’ll introduce you to &lt;a href=&quot;http://hadoop.apache.org/docs/r2.0.6-alpha/hadoop-yarn/hadoop-yarn-site/YARN.html&quot;&gt;YARN&lt;/a&gt;, what you can do with it, and how Spring simplifies the development of YARN based applications. &lt;/p&gt;
&lt;p&gt;If you have been following the Hadoop community over the past year or two, you’ve probably seen a lot of discussions around YARN and the next version of Hadoop’s MapReduce called MapReduce v2. YARN (Yet Another Resource Negotiator) is a component of the MapReduce project created to overcome some performance issues in Hadoop’s original design. The fundamental idea of MapReduce v2 is to split the functionalities of the JobTracker, Resource Management and Job Scheduling/Monitoring, into separate daemons. The idea is to have a global Resource Manager (RM) and a per-application Application Master (AM). A generic diagram for YARN component dependencies can be found from &lt;a href=&quot;http://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/yarn_architecture.gif&quot;&gt;YARN architecture&lt;/a&gt;.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@tunebluez" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/dbd576b7eed3f8db0503df5039166988?s=200" />

<meta property="og:title" content="Introducing the Spring YARN framework for developing Apache Hadoop YARN applications" />
<meta property="og:image" content="https://gravatar.com/avatar/dbd576b7eed3f8db0503df5039166988?s=200" />
<meta property="og:description" content="&lt;p&gt;We’re super excited to let the cat out of the bag and release support for writing YARN based applications as part of the &lt;a href=&quot;http://www.springsource.org/node/22687&quot;&gt;Spring for Apache Hadoop 2.0 M1 release&lt;/a&gt;. In this blog post I’ll introduce you to &lt;a href=&quot;http://hadoop.apache.org/docs/r2.0.6-alpha/hadoop-yarn/hadoop-yarn-site/YARN.html&quot;&gt;YARN&lt;/a&gt;, what you can do with it, and how Spring simplifies the development of YARN based applications. &lt;/p&gt;
&lt;p&gt;If you have been following the Hadoop community over the past year or two, you’ve probably seen a lot of discussions around YARN and the next version of Hadoop’s MapReduce called MapReduce v2. YARN (Yet Another Resource Negotiator) is a component of the MapReduce project created to overcome some performance issues in Hadoop’s original design. The fundamental idea of MapReduce v2 is to split the functionalities of the JobTracker, Resource Management and Job Scheduling/Monitoring, into separate daemons. The idea is to have a global Resource Manager (RM) and a per-application Application Master (AM). A generic diagram for YARN component dependencies can be found from &lt;a href=&quot;http://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/yarn_architecture.gif&quot;&gt;YARN architecture&lt;/a&gt;.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2013-09-10 20:41:24.958" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
 <a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category content--title">
<div>Engineering</div>
</div>
<div class="blog-category active content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Introducing the Spring YARN framework for developing Apache Hadoop YARN applications</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon releases"></div>
<a class="category">Releases</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/dbd576b7eed3f8db0503df5039166988?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/jvalkealahti">Janne Valkealahti</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2013-09-10 20:41:24.958">September 10, 2013</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="1154" href="/blog/2013/09/10/introducing-the-spring-yarn-framework-for-developing-apache-hadoop-yarn-applications#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>We&rsquo;re super excited to let the cat out of the bag and release support for writing YARN based applications as part of the <a href="http://www.springsource.org/node/22687">Spring for Apache Hadoop 2.0 M1 release</a>. In this blog post I’ll introduce you to <a href="https://hadoop.apache.org/docs/r2.0.6-alpha/hadoop-yarn/hadoop-yarn-site/YARN.html">YARN</a>, what you can do with it, and how Spring simplifies the development of YARN based applications. </p><p>If you have been following the Hadoop community over the past year or two, you’ve probably seen a lot of discussions around YARN and the next version of Hadoop&rsquo;s MapReduce called MapReduce v2. YARN (Yet Another Resource Negotiator) is a component of the MapReduce project created to overcome some performance issues in Hadoop&rsquo;s original design. The fundamental idea of MapReduce v2 is to split the functionalities of the JobTracker, Resource Management and Job Scheduling/Monitoring, into separate daemons. The idea is to have a global Resource Manager (RM) and a per-application Application Master (AM). A generic diagram for YARN component dependencies can be found from <a href="https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/yarn_architecture.gif">YARN architecture</a>.</p><p>MapReduce Version 2 is an application running on top of YARN. It is also possible to make similar custom YARN based application which have nothing to do with MapReduce, it is simply running YARN application. However, writing a custom YARN based application is difficult. The YARN APIs are low-level infrastructure APIs and not developer APIs. Take a look at the <a href="http://static.springsource.org/spring-hadoop/docs/2.0.0.M1/reference/html/yarn.html">documentation</a> for writing a YARN application to get an idea of what is involved.</p><p>Starting with the 2.0 version, Spring for Apache Hadoop introduces the Spring YARN sub-project to provide support for building Spring based YARN applications. This support for YARN steps in by trying to make development easier. “Spring handles the infrastructure so you can focus on your <a href="http://static.springsource.org/spring/docs/3.2.x/spring-framework-reference/html/overview.html">application</a>” applies to writing Hadoop applications as well as other types of Java applications. Spring’s YARN support also makes it easier to test your YARN application.</p><p>With Spring’s YARN support, you&rsquo;re going to use all familiar concepts of Spring Framework itself, including configuration and generally speaking what you can do in your application. At a high level, Spring YARN provides three different components, <em>YarnClient</em>, <em>YarnAppmaster</em> and <em>YarnContainer</em> which together can be called a Spring YARN Application. We provide default implementations for all components while still giving the end user an option to customize as much as he or she wants. Lets take a quick look at a very simplistic Spring YARN application which runs some custom code in a Hadoop cluster.</p><p>The <em>YarnClient</em> is used to communicate with YARN&rsquo;s Resource Manager. This provides management actions like submitting new application instances, listing applications and killing running applications. When submitting applications from the <em>YarnClient</em>, the main concerns relate to how the Application Master is configured and launched. Both the <em>YarnAppmaster</em> and <em>YarnContainer</em> share the same common launch context config logic so you&rsquo;ll see a lot of similarities in YarnClient and YarnAppmaster configuration. Similar to how the <em>YarnClient</em> will define the launch context for the <em>YarnAppmaster</em>, the <em>YarnAppmaster</em> defines the launch context for the <em>YarnContainer</em>. The Launch context defines the commands to start the container, localized files, command line parameters, environment variables and resource limits(memory, cpu).</p><p>The <em>YarnContainer</em> is a worker that does the heavy lifting of what a YARN application will actually do. The YarnAppmaster is communicating with YARN Resource Manager and starts and stops YarnContainers accordingly. </p><p>You can create a Spring application that launches an ApplicationMaster by using the YARN XML namespace to define a Spring Application Context. Context configuration for YarnClient defines the launch context for YarnAppmaster. This includes resources and libraries needed by YarnAppmaster and its environment settings. An example of this is shown below.</p>
<pre><code class="prettyprint xml">&lt;yarn:configuration /&gt;

&lt;yarn:localresources&gt;
  &lt;yarn:hdfs path=&quot;/path/to/my/libs/*.jar&quot;/&gt;
&lt;/yarn:localresources&gt;

&lt;yarn:environment&gt;
  &lt;yarn:classpath/&gt;
&lt;/yarn:environment&gt;

&lt;yarn:client app-name=&quot;my-yarn-app&quot;&gt;
  &lt;yarn:master-runner /&gt;
&lt;/yarn:client&gt;
</code></pre><p>Note: Future releases will provide a Java based API for configuration, <a href="http://blog.springsource.org/2013/07/02/spring-security-java-config-preview-introduction/">similar to what is done in Spring Security 3.2</a>.</p><p>The purpose of <em>YarnAppmaster</em> is to control the instance of a running application. The <em>YarnAppmaster</em> is responsible for controlling the lifecycle of all its <em>YarnContainers</em>, the whole running application after the application is submitted, as well as itself.</p>
<pre><code class="prettyprint xml">&lt;yarn:configuration /&gt;

&lt;yarn:localresources&gt;
  &lt;yarn:hdfs path=&quot;/path/to/my/libs/*.jar&quot;/&gt;
&lt;/yarn:localresources&gt;

&lt;yarn:environment&gt;
  &lt;yarn:classpath/&gt;
&lt;/yarn:environment&gt;

&lt;yarn:master&gt;
  &lt;yarn:container-allocator/&gt;
  &lt;yarn:container-runner/&gt;
&lt;/yarn:master&gt;
</code></pre><p>The example above is defining a context configuration for the <em>YarnAppmaster</em>. Similar to what we saw in <em>YarnClient</em> configuration, we define local resources for the <em>YarnContainer</em> and its environment. The classpath setting picks up hadoop jars as well as your own application jars in default locations, change the setting if you want to use non-default directories. Also within the <em>YarnAppmaster</em> we define components handling the container allocation and bootstrapping. Allocator component is interacting with YARN resource manager handling the resource scheduling. Runner component is responsible for bootstrapping of allocated containers.</p>
<pre><code class="prettyprint xml">&lt;yarn:container container-class=&quot;org.example.MyCustomYarnContainer&quot;/&gt;
</code></pre><p>Above example defines a simple <em>YarnContainer</em> context configuration. </p><p>To implement the functionality of the container, you implement the interface YarnContainer. The YarnContainer interface is similar to Java’s Runnable interface, its has a run() method, as well as two additional methods related to getting environment and command line information. </p><p>Below is a simple hello world application that will be run inside of a YARN container:</p>
<pre><code class="prettyprint java">public class MyCustomYarnContainer implements YarnContainer {

  private static final Log log = LogFactory.getLog(MyCustomYarnContainer.class);

  @Override
  public void run() {
    log.info(&quot;Hello from MyCustomYarnContainer&quot;);
  }

  @Override
  public void setEnvironment(Map&lt;String, String&gt; environment) {}

  @Override
  public void setParameters(Properties parameters) {}

}
</code></pre><p>We just showed the configuration of a Spring YARN Application and the core application logic so what remains is how to bootstrap the application to run inside the Hadoop cluster. The utility class, CommandLineClientRunner provides this functionality.</p><p>You can you use CommandLineClientRunner either manually from a command line or use it from your own code.</p>
<pre><code class="prettyprint"># java -cp &lt;mile long classpath&gt; org.springframework.yarn.client.CommandLineClientRunner application-context.xml yarnClient -submit
</code></pre><p>A Spring YARN Application is packaged into a jar file which then can be transferred into HDFS with the rest of the dependencies. A YarnClient can transfer all needed libraries into HDFS during the application submit process but generally speaking it is more advisable to do this manually in order to avoid unnecessary network I/O. Your application wont change until new version is created so it can be copied into HDFS prior the first application submit. You can i.e. use Hadoop&rsquo;s <em>hdfs dfs -copyFromLocal</em> command.</p><p>Below you can see an example of a typical project setup.</p>
<pre><code class="prettyprint">src/main/java/org/example/MyCustomYarnContainer.java
src/main/resources/application-context.xml
src/main/resources/appmaster-context.xml
src/main/resources/container-context.xml
</code></pre><p>As a wild guess, we&rsquo;ll make a bet that you have now figured out that you are not actually configuring YARN, instead you are configuring Spring Application Contexts for all three components, <em>YarnClient</em>, <em>YarnAppmaster</em> and <em>YarnContainer</em>.</p><p>We have just scratched the surface of what we can do with Spring YARN. While we’re preparing more blog posts, go ahead and check existing samples in <a href="https://github.com/SpringSource/spring-hadoop-samples/tree/master/yarn">GitHub</a>. Basically, to reflect the concepts we described in this blog post, see the <a href="https://github.com/SpringSource/spring-hadoop-samples/tree/master/yarn/yarn/multi-context">multi-context</a> example in our samples repository.</p><p>Future blog posts will cover topics like <a href="http://static.springsource.org/spring-hadoop/docs/2.0.0.M1/reference/html/yarn.html#yarn:testing">Unit Testing</a> and more advanced YARN application development.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 1154;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>