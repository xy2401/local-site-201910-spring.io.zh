<html  xmlns="http://www.w3.org/1999/xhtml"><head></head><body >﻿
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Spring Framework 4.0 M2：WebSocket消息传递架构SpringSource团队博客</title>

<link rel="stylesheet" href="WebSocketBlogPost_files/style.css" type="text/css" media="all">
<link rel="stylesheet" href="WebSocketBlogPost_files/skin.css" type="text/css" media="all">
<link rel="stylesheet" href="WebSocketBlogPost_files/options.css" type="text/css" media="all">
<link rel="stylesheet" href="WebSocketBlogPost_files/print.css" type="text/css" media="print">
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="https://blog.springsource.org/feed/">
<link rel="alternate" type="text/xml" title="RSS .92" href="https://blog.springsource.org/feed/rss/">
<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="https://blog.springsource.org/feed/atom/">
<link rel="pingback" href="https://blog.springsource.org/xmlrpc.php">
<link rel="icon" href="https://wp.spring.io/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="https://wp.spring.io/favicon.ico" type="image/x-icon">
<link rel="archives" title="August 2013" href="https://blog.springsource.org/2013/08/">
<link rel="archives" title="July 2013" href="https://blog.springsource.org/2013/07/">
<link rel="archives" title="June 2013" href="https://blog.springsource.org/2013/06/">
<link rel="archives" title="May 2013" href="https://blog.springsource.org/2013/05/">
<link rel="archives" title="April 2013" href="https://blog.springsource.org/2013/04/">
<link rel="archives" title="March 2013" href="https://blog.springsource.org/2013/03/">
<link rel="archives" title="February 2013" href="https://blog.springsource.org/2013/02/">
<link rel="archives" title="January 2013" href="https://blog.springsource.org/2013/01/">
<link rel="archives" title="December 2012" href="https://blog.springsource.org/2012/12/">
<link rel="archives" title="November 2012" href="https://blog.springsource.org/2012/11/">
<link rel="archives" title="October 2012" href="https://blog.springsource.org/2012/10/">
<link rel="archives" title="September 2012" href="https://blog.springsource.org/2012/09/">
<link rel="archives" title="August 2012" href="https://blog.springsource.org/2012/08/">
<link rel="archives" title="July 2012" href="https://blog.springsource.org/2012/07/">
<link rel="archives" title="June 2012" href="https://blog.springsource.org/2012/06/">
<link rel="archives" title="May 2012" href="https://blog.springsource.org/2012/05/">
<link rel="archives" title="April 2012" href="https://blog.springsource.org/2012/04/">
<link rel="archives" title="March 2012" href="https://blog.springsource.org/2012/03/">
<link rel="archives" title="February 2012" href="https://blog.springsource.org/2012/02/">
<link rel="archives" title="January 2012" href="https://blog.springsource.org/2012/01/">
<link rel="archives" title="December 2011" href="https://blog.springsource.org/2011/12/">
<link rel="archives" title="November 2011" href="https://blog.springsource.org/2011/11/">
<link rel="archives" title="October 2011" href="https://blog.springsource.org/2011/10/">
<link rel="archives" title="September 2011" href="https://blog.springsource.org/2011/09/">
<link rel="archives" title="August 2011" href="https://blog.springsource.org/2011/08/">
<link rel="archives" title="July 2011" href="https://blog.springsource.org/2011/07/">
<link rel="archives" title="June 2011" href="https://blog.springsource.org/2011/06/">
<link rel="archives" title="May 2011" href="https://blog.springsource.org/2011/05/">
<link rel="archives" title="April 2011" href="https://blog.springsource.org/2011/04/">
<link rel="archives" title="March 2011" href="https://blog.springsource.org/2011/03/">
<link rel="archives" title="February 2011" href="https://blog.springsource.org/2011/02/">
<link rel="archives" title="January 2011" href="https://blog.springsource.org/2011/01/">
<link rel="archives" title="December 2010" href="https://blog.springsource.org/2010/12/">
<link rel="archives" title="November 2010" href="https://blog.springsource.org/2010/11/">
<link rel="archives" title="October 2010" href="https://blog.springsource.org/2010/10/">
<link rel="archives" title="September 2010" href="https://blog.springsource.org/2010/09/">
<link rel="archives" title="August 2010" href="https://blog.springsource.org/2010/08/">
<link rel="archives" title="July 2010" href="https://blog.springsource.org/2010/07/">
<link rel="archives" title="June 2010" href="https://blog.springsource.org/2010/06/">
<link rel="archives" title="May 2010" href="https://blog.springsource.org/2010/05/">
<link rel="archives" title="April 2010" href="https://blog.springsource.org/2010/04/">
<link rel="archives" title="March 2010" href="https://blog.springsource.org/2010/03/">
<link rel="archives" title="February 2010" href="https://blog.springsource.org/2010/02/">
<link rel="archives" title="January 2010" href="https://blog.springsource.org/2010/01/">
<link rel="archives" title="December 2009" href="https://blog.springsource.org/2009/12/">
<link rel="archives" title="November 2009" href="https://blog.springsource.org/2009/11/">
<link rel="archives" title="October 2009" href="https://blog.springsource.org/2009/10/">
<link rel="archives" title="September 2009" href="https://blog.springsource.org/2009/09/">
<link rel="archives" title="August 2009" href="https://blog.springsource.org/2009/08/">
<link rel="archives" title="July 2009" href="https://blog.springsource.org/2009/07/">
<link rel="archives" title="June 2009" href="https://blog.springsource.org/2009/06/">
<link rel="archives" title="May 2009" href="https://blog.springsource.org/2009/05/">
<link rel="archives" title="April 2009" href="https://blog.springsource.org/2009/04/">
<link rel="archives" title="March 2009" href="https://blog.springsource.org/2009/03/">
<link rel="archives" title="February 2009" href="https://blog.springsource.org/2009/02/">
<link rel="archives" title="January 2009" href="https://blog.springsource.org/2009/01/">
<link rel="archives" title="December 2008" href="https://blog.springsource.org/2008/12/">
<link rel="archives" title="November 2008" href="https://blog.springsource.org/2008/11/">
<link rel="archives" title="October 2008" href="https://blog.springsource.org/2008/10/">
<link rel="archives" title="September 2008" href="https://blog.springsource.org/2008/09/">
<link rel="archives" title="August 2008" href="https://blog.springsource.org/2008/08/">
<link rel="archives" title="July 2008" href="https://blog.springsource.org/2008/07/">
<link rel="archives" title="June 2008" href="https://blog.springsource.org/2008/06/">
<link rel="archives" title="May 2008" href="https://blog.springsource.org/2008/05/">
<link rel="archives" title="April 2008" href="https://blog.springsource.org/2008/04/">
<link rel="archives" title="March 2008" href="https://blog.springsource.org/2008/03/">
<link rel="archives" title="February 2008" href="https://blog.springsource.org/2008/02/">
<link rel="archives" title="January 2008" href="https://blog.springsource.org/2008/01/">
<link rel="archives" title="December 2007" href="https://blog.springsource.org/2007/12/">
<link rel="archives" title="November 2007" href="https://blog.springsource.org/2007/11/">
<link rel="archives" title="October 2007" href="https://blog.springsource.org/2007/10/">
<link rel="archives" title="September 2007" href="https://blog.springsource.org/2007/09/">
<link rel="archives" title="August 2007" href="https://blog.springsource.org/2007/08/">
<link rel="archives" title="July 2007" href="https://blog.springsource.org/2007/07/">
<link rel="archives" title="June 2007" href="https://blog.springsource.org/2007/06/">
<link rel="archives" title="May 2007" href="https://blog.springsource.org/2007/05/">
<link rel="archives" title="April 2007" href="https://blog.springsource.org/2007/04/">
<link rel="archives" title="March 2007" href="https://blog.springsource.org/2007/03/">
<link rel="archives" title="February 2007" href="https://blog.springsource.org/2007/02/">
<link rel="archives" title="January 2007" href="https://blog.springsource.org/2007/01/">
<link rel="archives" title="December 2006" href="https://blog.springsource.org/2006/12/">
<link rel="archives" title="November 2006" href="https://blog.springsource.org/2006/11/">
<link rel="archives" title="October 2006" href="https://blog.springsource.org/2006/10/">
<link rel="archives" title="September 2006" href="https://blog.springsource.org/2006/09/">
<link rel="archives" title="August 2006" href="https://blog.springsource.org/2006/08/">
<link rel="archives" title="July 2006" href="https://blog.springsource.org/2006/07/">
<link rel="archives" title="May 2006" href="https://blog.springsource.org/2006/05/">
<link rel="archives" title="April 2006" href="https://blog.springsource.org/2006/04/">
<link rel="archives" title="March 2006" href="https://blog.springsource.org/2006/03/">
<link rel="archives" title="February 2006" href="https://blog.springsource.org/2006/02/">
<link rel="archives" title="August 2004" href="https://blog.springsource.org/2004/08/">
<script src="WebSocketBlogPost_files/pingpop.js" type="text/javascript">
  </script>
<script type="text/javascript" src="WebSocketBlogPost_files/prototype_002.html"></script>
<script type="text/javascript" src="WebSocketBlogPost_files/effects.js"></script>
<script type="text/javascript" src="WebSocketBlogPost_files/ajax_comments.js"></script>
<link rel="alternate" type="application/rss+xml" title="SpringSource Team Blog » Spring Framework 4.0 M2: WebSocket Messaging Architectures Comments Feed" href="https://blog.springsource.org/2013/07/24/spring-framework-4-0-m2-websocket-messaging-architectures/feed/">
<link rel="stylesheet" id="sociable-front-css-css" href="WebSocketBlogPost_files/sociable.css" type="text/css" media="all">
<script type="text/javascript" src="WebSocketBlogPost_files/l10n.html"></script>
<script type="text/javascript" src="WebSocketBlogPost_files/prototype.html"></script>
<script type="text/javascript" src="WebSocketBlogPost_files/wp-scriptaculous.html"></script>
<script type="text/javascript" src="WebSocketBlogPost_files/effects.html"></script>
<script type="text/javascript" src="WebSocketBlogPost_files/lightbox.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blog.springsource.org/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://blog.springsource.org/wp-includes/wlwmanifest.xml">
<link rel="index" title="SpringSource Team Blog" href="https://blog.springsource.org/">
<link rel="start" title="Method Injection" href="https://blog.springsource.org/2004/08/06/method-injection/">
<link rel="prev" title="Reactor 1.0.0.M1 – a foundation for asynchronous fast-data applications on the JVM" href="https://blog.springsource.org/2013/07/18/reactor-1-0-0-m1-a-foundation-for-asynchronous-fast-data-applications-on-the-jvm/">
<link rel="next" title="Spring Boot – Simplifying Spring for Everyone" href="https://blog.springsource.org/2013/08/06/spring-boot-simplifying-spring-for-everyone/">
<meta name="generator" content="WordPress 3.1.1">
<link rel="shortlink" href="https://wp.me/p1fTCJ-3DA">

<meta name="description" content="Overview As I wrote previously, a WebSocket API is only the starting point for WebSocket-style messaging applications. Many practical challenges remain. As">
<link rel="canonical" href="https://blog.springsource.org/2013/07/24/spring-framework-4-0-m2-websocket-messaging-architectures/">


<script type="text/javascript">
    //<![CDATA[
    document.write('<link rel="stylesheet" href="http://blog.springsource.org/wp-content/plugins/lightbox-2/Themes/Black/lightbox.css" type="text/css" media="screen" />');
    //]]>
    </script><link rel="stylesheet" href="WebSocketBlogPost_files/lightbox.css" type="text/css" media="screen">


<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="WebSocketBlogPost_files/ga.js" type="text/javascript"></script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-2728886-3");
pageTracker._setDomainName("none");
pageTracker._setAllowLinker(true);
pageTracker._trackPageview();
</script>
<link href="WebSocketBlogPost_files/shCore.css" type="text/css" rel="stylesheet"><link href="WebSocketBlogPost_files/shThemeDefault.css" type="text/css" rel="stylesheet"><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3">
<script type="text/javascript" src="WebSocketBlogPost_files/elqCfg.js"></script>
<script type="text/javascript" src="WebSocketBlogPost_files/elqImg.js"></script>
<script type="text/javascript" src="WebSocketBlogPost_files/navigation.js"></script>
<script src="WebSocketBlogPost_files/munchkin.js" async="" type="text/javascript"></script>


<!--[if (IE 6)|(IE 7)|(IE 8)]>
<div style="height:97px;margin-top:0px;background: #457228;">
<![endif]-->
<div style="height:97px;margin-top:0px;background:url('http://https://s3.amazonaws.com/assets.spring.io/drupal/sites/all/themes/s2org11/images/BG_SiteHeader_Glow.png') no-repeat scroll center top,url('https://s3.amazonaws.com/assets.spring.io/drupal/files/homepage/BG_SiteBillboardAndHeader_50.png') repeat-x scroll 0 0 #367b09">
<div style="margin-left:auto;margin-right:auto;width:980px">
<div style="height:80px;margin-top:0px;background:url('https://s3.amazonaws.com/assets.spring.io/drupal/files/homepage/BG_SiteTopNav_new.png') repeat-x scroll 0 0 #f1f1f1;border-radius:0 0 5px 5px">
<div style="margin-left:10px;margin-right:10px">
<table valign="top" height="80" style="font-size:14px;text-transform:uppercase;color:#666;margin:0">
<tbody><tr>
<td style="width:200px;text-align:center;padding-bottom:5px">
<a href="http://www.springsource.org/" onclick="javascript:urchinTracker('/outbound/www.springsource.org');"><img src="WebSocketBlogPost_files/logo-spring-103x60.png"></a>
<a href="http://www.gopivotal.com/" target="_blank" style="margin-left:7px">
<img src="WebSocketBlogPost_files/logo-pivotal-57x12.png" style="padding-bottom:4px">
</a>
</td>
<td width="7"> </td>
<td valign="top">
<div>
<img src="WebSocketBlogPost_files/nav_sep_line_new.png">
</div>
</td>
<td align="center" https:="" ="" s3.amazonaws.com="" assets.spring.io="" drupal="" files="" header="" nav_features_65.jp=")=" onmouseover="this.style.background = 'url(https://s3.amazonaws.com/assets.spring.io/drupal/files/header/nav_features_65_hover.jpg) no-repeat top center';this.style.textDecoration = 'none'" onmouseout="this.style.background = 'url(https://s3.amazonaws.com/assets.spring.io/drupal/files/header/nav_features_65.jpg) no-repeat top center';this.style.textDecoration = 'none'">
<div>
<a href="http://www.springsource.org/features" style="display:block;width:134px;height:65px" onclick="javascript:urchinTracker('/outbound/www.springsource.org');"></a>
<br>
</div>
</td>
<td valign="top">
<div>
<img src="WebSocketBlogPost_files/nav_sep_line_new.png">
</div>
</td>
<td align="center" style="background:url(https://s3.amazonaws.com/assets.spring.io/drupal/files/header/nav_getstarted_65.jpg) no-repeat top center;text-decoration:none" onmouseover="this.style.background = 'url(https://s3.amazonaws.com/assets.spring.io/drupal/files/header/nav_getstarted_65_hover.jpg) no-repeat top center';this.style.textDecoration = 'none'" onmouseout="this.style.background = 'url(https://s3.amazonaws.com/assets.spring.io/drupal/files/header/nav_getstarted_65.jpg) no-repeat top center';this.style.textDecoration = 'none'">
<div>
<a href="http://www.springsource.org/get-started" style="display:block;width:134px;height:65px" onclick="javascript:urchinTracker('/outbound/www.springsource.org');"></a>
<br>
</div>
</td>
<td valign="top">
<div>
<img src="WebSocketBlogPost_files/nav_sep_line_new.png">
</div>
</td>
<td align="center" style="background:url(https://s3.amazonaws.com/assets.spring.io/drupal/files/header/nav_getinvolved_65.jpg) no-repeat top center;text-decoration:none" onmouseover="this.style.background = 'url(https://s3.amazonaws.com/assets.spring.io/drupal/files/header/nav_getinvolved_65_hover.jpg) no-repeat top center';this.style.textDecoration = 'none'" onmouseout="this.style.background = 'url(https://s3.amazonaws.com/assets.spring.io/drupal/files/header/nav_getinvolved_65.jpg) no-repeat top center';this.style.textDecoration = 'none'">
<div>
<a href="http://www.springsource.org/get-involved" style="display:block;width:134px;height:65px" onclick="javascript:urchinTracker('/outbound/www.springsource.org');"></a>
<br>
</div>
</td>
<td valign="top">
<div>
<img src="WebSocketBlogPost_files/nav_sep_line_new.png">
</div>
</td>
<td align="center" style="background:url(https://s3.amazonaws.com/assets.spring.io/drupal/files/header/nav_newsevents_65.jpg) no-repeat;text-decoration:none" onmouseover="this.style.background = 'url(https://s3.amazonaws.com/assets.spring.io/drupal/files/header/nav_newsevents_65_hover.jpg) no-repeat';this.style.textDecoration = 'none'" onmouseout="this.style.background = 'url(https://s3.amazonaws.com/assets.spring.io/drupal/files/header/nav_newsevents_65.jpg) no-repeat';this.style.textDecoration = 'none'">
<div>
<a href="http://www.springsource.org/news-events" style="display:block;width:134px;height:65px" onclick="javascript:urchinTracker('/outbound/www.springsource.org');"></a>
<br>
</div>
</td>
<td valign="top">
<div>
<img src="WebSocketBlogPost_files/nav_sep_line_new.png">
</div>
</td>
<td align="left">
<!--[if lt IE 9]>
           <div style="height:15px"></div>
        <![endif]-->
<div id="search-box">
<form id="search-theme-form" action="http://www.springsource.org/search/google" method="get">
<div><div id="search" class="container-inline">
<input size="16" name="query" value="搜索" class="form-text" type="text" maxlength="128" style="border:1px solid rgb(204,204,204);width:190px;margin-left:2px;color:#999999" onblur="this.value = this.value || 'Search'; this.style.color = '#999999';" onfocus="if(this.value=='Search') {this.value='';} this.style.color = '#999999';">
<input name="output" value="xml_no_dtd" type="hidden">
<input name="client" value="google-csbe" type="hidden">
<input name="cx" value="009687201310241541466:zerjfa_shxo" type="hidden">
<input name="ie" value="utf-8" type="hidden">
<input name="oe" value="utf-8" type="hidden">
<input name="op" value="Search" type="hidden">
</div></div>
</form>
</div>
<div id="subscribe" style="color:#7e7e7e;float:left;padding-left:50px;text-shadow:0 1px 0 white;margin-top:4px">
<a href="http://www.springsource.org/newsletter-subscription" style="color:rgb(126,126,126);background-image:url(https://s3.amazonaws.com/assets.spring.io/drupal/files/header/nav_subscription_off.gif);text-decoration:none;background-position:0px 2px;background-repeat:no-repeat" onmouseover="this.style.background = 'url(https://s3.amazonaws.com/assets.spring.io/drupal/files/header/nav_subscription_on.gif) 0 2px no-repeat';this.style.textDecoration = 'none'" onmouseout="this.style.background = 'url(https://s3.amazonaws.com/assets.spring.io/drupal/files/header/nav_subscription_off.gif) 0 2px no-repeat';this.style.textDecoration = 'none'" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">
<span style="padding-left:20px;font-size:12px">订阅</span>
</a>
</div>
</td>

</tr>
</tbody></table>
</div>
</div></div></div>
<!--[if (IE 6)|(IE 7)|(IE 8)]>
</div><![endif]-->

<div id="page">
<div style="margin-left:10px;margin-right:10px">
<p style="line-height:27px"> </p>
<p style="font-size:14px;margin-bottom:5px"><a href="http://blog.springsource.com/" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">网志</a></p>

<span style="text-transform:uppercase;font-size:30px;color:#666;font-weight:500;font-family:Arial,sans serif">SpringSource博客</span>


<div class="sidebar" id="rightbar">
<ul>
<li id="text-3" class="widget widget_text"><h2 class="widgettitle">s</h2>
<div class="textwidget"><div class="textwidget"><style type="text/css">
.left {width:140px;float:left;margin-left:-10px;}
.right {padding-left:150px;}
</style>
<div class="left">
<a href="http://blog.springsource.org/author/afitzgerald/">亚当·菲茨·杰拉德</a><br>
<a href="http://blog.springsource.org/author/stewarta/">艾伦·斯图尔特</a><br>
<a href="http://blog.springsource.org/author/aeisenberg/">安德鲁·艾森伯格</a><br>
<a href="http://blog.springsource.org/author/awilkinson/">安迪·威尔金森</a><br>
<a href="http://blog.springsource.org/author/bena/">本·亚历克斯</a><br>
<a href="http://blog.springsource.org/author/benh/">本·黑尔</a><br>
<a href="http://blog.springsource.org/author/cfrost/">克里斯·弗罗斯特</a><br>
<a href="http://blog.springsource.org/author/cdupuis/">克里斯蒂安·杜普依斯（Christian Dupuis）</a><br>
<a href="http://blog.springsource.org/author/cwalls/">克雷格·沃尔斯</a><br>
<a href="http://blog.springsource.org/author/dturanski/">大卫·图兰斯基（David Turanski）</a><br>
<a href="http://blog.springsource.org/author/gnormington/">格林·诺明顿</a><br>
<a href="http://blog.springsource.org/author/glaforge/">纪尧姆·拉福格（Guillaume Laforge）</a><br>
<a href="http://blog.springsource.org/author/hedelson/">海伦娜·埃德森（Helena Edelson）</a><br>
<a href="http://blog.springsource.org/author/jhickey/">珍妮弗·希基</a><br>
<a href="http://blog.springsource.org/author/jhann/">约翰·汉恩</a><br>
<a href="http://blog.springsource.org/author/jtravis/">乔恩·特拉维斯</a><br>
<a href="http://blog.springsource.org/author/juergenh/">于尔根·霍勒（Juergen Hoeller）</a><br>
<a href="http://blog.springsource.org/author/kdvolder/">克里斯·德·沃尔德</a><br>
<a href="http://blog.springsource.org/author/markf/">马克·费舍尔</a><br>
<a href="http://blog.springsource.org/author/mthomas/">马克·托马斯</a><br>
<a href="http://blog.springsource.org/author/misvy/">迈克尔·艾维（Michael Isvy）</a><br>
<a href="http://blog.springsource.org/author/ozhurakousky/">奥列格·朱拉库斯基（Oleg Zhurakousky）</a><br>
<a href="http://blog.springsource.org/author/chapmanp/">保罗·查普曼</a><br>
<a href="http://blog.springsource.org/author/peter-ledbrook/">彼得·莱德布鲁克</a><br>
<a href="http://blog.springsource.org/author/robh/">罗伯·哈罗普</a><br>
<a href="http://blog.springsource.org/author/rodj/">罗德·约翰逊</a><br>
<a href="http://blog.springsource.org/author/rclarkson/">罗伊·克拉克森</a><br>
<a href="http://blog.springsource.org/author/sschmidt/">斯蒂芬·施密特（Stefan Schmidt）</a><br>
</div>
<div class="right">
<a href="http://blog.springsource.org/author/adrianc/">阿德里安·科耶尔（Adrian Colyer）</a><br>
<a href="http://blog.springsource.org/author/arichardson/">亚历克西斯·理查森（Alexis Richardson）</a><br>
<a href="http://blog.springsource.org/author/aclement/">安迪·克莱门特</a><br>
<a href="http://blog.springsource.org/author/arjenp/">Arjen Poutsma</a><br>
<a href="http://blog.springsource.org/author/bcorrie/">本·科里</a><br>
<a href="http://blog.springsource.org/author/cbeams/">克里斯·比姆斯</a><br>
<a href="http://blog.springsource.org/author/crichardson/">克里斯·理查森</a><br>
<a href="http://blog.springsource.org/author/costinl/">Costin Leau</a><br>
<a href="http://blog.springsource.org/author/dsyer/">戴夫·瑟</a><br>
<a href="http://blog.springsource.org/author/grussell/">加里·罗素</a><br>
<a href="http://blog.springsource.org/author/grocher/">格雷姆·罗彻（Graeme Rocher）</a><br>
<a href="http://blog.springsource.org/author/ghillert/">冈纳·希尔特（Gunnar Hillert）</a><br>
<a href="http://blog.springsource.org/author/jtyrrell/">詹姆斯·泰瑞尔</a><br>
<a href="http://blog.springsource.org/author/jgrelle/">杰里米·格莱尔</a><br>
<a href="http://blog.springsource.org/author/jbrisbin/">乔恩·布里斯宾</a><br>
<a href="http://blog.springsource.org/author/jolong/">乔什·朗（Josh Long）</a><br>
<a href="http://blog.springsource.org/author/keithd/">基思·唐纳德</a><br>
<a href="http://blog.springsource.org/author/ltaylor/">卢克·泰勒</a><br>
<a href="http://blog.springsource.org/author/mpollack/">马克·波拉克</a><br>
<a href="http://blog.springsource.org/author/mlippert/">马丁·利珀特</a><br>
<a href="http://blog.springsource.org/author/mwiesner/">迈克·威斯纳</a><br>
<a href="http://blog.springsource.org/author/ogierke/">奥利弗·吉尔克（Oliver Gierke）</a><br>
<a href="http://blog.springsource.org/author/pcooperellis/">彼得·库珀·埃利斯</a><br>
<a href="http://blog.springsource.org/author/ramnivasl/">拉姆尼瓦斯·拉达德（Ramnivas Laddad）</a><br>
<a href="http://blog.springsource.org/author/rwinch/">罗伯·温奇</a><br>
<a href="http://blog.springsource.org/author/rstoyanchev/">罗森·斯托扬切夫（Rossen Stoyanchev）</a><br>
<a href="http://blog.springsource.org/author/andrewss/">斯科特·安德鲁斯</a><br>
<a href="http://blog.springsource.org/author/trisberg/">托马斯·里斯伯格</a>
</div>
<p> </p></div></div>
</li>
<li id="categories-227402801" class="widget widget_categories"><h2 class="widgettitle">分类目录</h2>
<ul>
<li class="cat-item cat-item-8"><a href="http://blog.springsource.org/category/spring/20/" title="查看所有在2.0下提交的帖子">2.0</a> （29）</li>
<li class="cat-item cat-item-22"><a href="http://blog.springsource.org/category/spring/25-21/" title="查看在2.5 / 2.1下提交的所有帖子">2.5 / 2.1</a> （18）</li>
<li class="cat-item cat-item-35"><a href="http://blog.springsource.org/category/spring/30/" title="有关Spring 3.0的新闻和信息">3.0</a> （38）</li>
<li class="cat-item cat-item-97"><a href="http://blog.springsource.org/category/spring/31/" title="有关Spring 3.1的新闻和信息">3.1</a> （18）</li>
<li class="cat-item cat-item-78"><a href="http://blog.springsource.org/category/amqp/" title="查看所有在AMQP下提交的帖子">AMQP</a> （7）</li>
<li class="cat-item cat-item-95"><a href="http://blog.springsource.org/category/android/" title="查看所有在Android下提交的帖子">安卓</a> （4）</li>
<li class="cat-item cat-item-5"><a href="http://blog.springsource.org/category/aop/" title="查看所有在AOP下提交的帖子">AOP</a> （20）</li>
<li class="cat-item cat-item-42"><a href="http://blog.springsource.org/category/apache-tomcat/" title="查看Apache Tomcat下提交的所有帖子">Apache Tomcat</a> （7）</li>
<li class="cat-item cat-item-118"><a href="http://blog.springsource.org/category/big-data/" title="查看大数据下的所有帖子">大数据</a> （7）</li>
<li class="cat-item cat-item-11"><a href="http://blog.springsource.org/category/books/" title="查看“书籍”下的所有帖子">书籍</a> （3）</li>
<li class="cat-item cat-item-19"><a href="http://blog.springsource.org/category/builds/" title="查看所有在“构建”下提交的帖子">构建</a> （16）</li>
<li class="cat-item cat-item-54"><a href="http://blog.springsource.org/category/bundlor/" title="查看所有在Bundlor下提交的帖子">班德尔</a> （1）</li>
<li class="cat-item cat-item-24"><a href="http://blog.springsource.org/category/business/" title="查看所有在“业务”下提交的帖子">商业</a> （28）</li>
<li class="cat-item cat-item-48"><a href="http://blog.springsource.org/category/cloud-computing/" title="云管理，监控和开发">云计算</a> （52）</li>
<li class="cat-item cat-item-61"><a href="http://blog.springsource.org/category/springsource/vmware-springsource/cloud-foundry/" title="查看在Cloud Foundry下提交的所有帖子">云铸造厂</a> （18）</li>
<li class="cat-item cat-item-13"><a href="http://blog.springsource.org/category/containers/" title="查看在“容器”下提交的所有帖子">容器</a> （12）</li>
<li class="cat-item cat-item-9"><a href="http://blog.springsource.org/category/data-access/" title="查看“数据访问”下提交的所有帖子">数据访问</a> （42）</li>
<li class="cat-item cat-item-27"><a href="http://blog.springsource.org/category/application-platform/" title="查看dm服务器下归档的所有帖子">dm服务器</a> （64）</li>
<li class="cat-item cat-item-68"><a href="http://blog.springsource.org/category/enterprise-integration/" title="查看所有在Enterprise Integration下提交的帖子">企业整合</a> （26）</li>
<li class="cat-item cat-item-73"><a href="http://blog.springsource.org/category/springsource/google-springsource/" title="查看所有在Google下提交的帖子">谷歌</a> （3）</li>
<li class="cat-item cat-item-93"><a href="http://blog.springsource.org/category/green-beans/" title="查看“青豆”下提交的所有帖子">青豆</a> （6）</li>
<li class="cat-item cat-item-34"><a href="http://blog.springsource.org/category/groovy-grails/" title="查看在Groovy / Grails下提交的所有帖子">Groovy / Grails</a> （54）</li>
<li class="cat-item cat-item-119"><a href="http://blog.springsource.org/category/hadoop/" title="查看Hadoop下的所有帖子">Hadoop</a> （3）</li>
<li class="cat-item cat-item-66"><a href="http://blog.springsource.org/category/management-tools/hyperic-hq/" title="查看在Hyperic HQ下提交的所有帖子">Hyperic总部</a> （6）</li>
<li class="cat-item cat-item-67"><a href="http://blog.springsource.org/category/management-tools/hyperic-iq/" title="查看在Hyperic IQ下提交的所有帖子">Hyperic智商</a> （1）</li>
<li class="cat-item cat-item-12"><a href="http://blog.springsource.org/category/ioc-container/" title="查看IOC容器下的所有帖子">国际奥委会集装箱</a> （32）</li>
<li class="cat-item cat-item-15"><a href="http://blog.springsource.org/category/java/" title="查看Java下的所有帖子">爪哇</a> （85）</li>
<li class="cat-item cat-item-7"><a href="http://blog.springsource.org/category/jms/" title="查看所有在JMS下提交的帖子">JMS</a> （6）</li>
<li class="cat-item cat-item-6"><a href="http://blog.springsource.org/category/jmx/" title="查看所有在JMX下提交的帖子">JMX</a> （4）</li>
<li class="cat-item cat-item-21"><a href="http://blog.springsource.org/category/jsf/" title="查看所有在JSF下提交的帖子">JSF</a> （2）</li>
<li class="cat-item cat-item-65"><a href="http://blog.springsource.org/category/management-tools/" title="查看管理工具下提交的所有帖子">管理工具</a> （1）</li>
<li class="cat-item cat-item-23"><a href="http://blog.springsource.org/category/open-source/" title="查看“开源”下提交的所有帖子">开源</a> （91）</li>
<li class="cat-item cat-item-17"><a href="http://blog.springsource.org/category/osgi/" title="OSGi相关内容">OSGi</a> （72）</li>
<li class="cat-item cat-item-63"><a href="http://blog.springsource.org/category/roo/" title="查看在Roo下提交的所有帖子">鲁</a> （17）</li>
<li class="cat-item cat-item-109"><a href="http://blog.springsource.org/category/scala/" title="查看所有在Scala下提交的帖子">斯卡拉</a> （2）</li>
<li class="cat-item cat-item-14"><a href="http://blog.springsource.org/category/security/" title="查看“安全性”下提交的所有帖子">安全</a> （25）</li>
<li class="cat-item cat-item-49"><a href="http://blog.springsource.org/category/slices/" title="查看在片下提交的所有帖子">切片</a> （1）</li>
<li class="cat-item cat-item-3"><a href="http://blog.springsource.org/category/spring/" title="查看春季下的所有帖子">春季</a> （394）</li>
<li class="cat-item cat-item-71"><a href="http://blog.springsource.org/category/spring-batch/" title="查看在Spring Batch下提交的所有帖子">春季批</a> （3）</li>
<li class="cat-item cat-item-104"><a href="http://blog.springsource.org/category/spring-data/" title="查看归类于Spring Data的所有帖子"> Spring Data </a> （15）</li>
<li class="cat-item cat-item-4"><a href="http://blog.springsource.org/category/spring-events/" title="查看春季活动下的所有帖子">春季活动</a> （23）</li>
<li class="cat-item cat-item-69"><a href="http://blog.springsource.org/category/spring-integration/" title="查看所有在Spring Integration下提交的帖子">春季整合</a> （19）</li>
<li class="cat-item cat-item-74"><a href="http://blog.springsource.org/category/spring-python/" title="查看在Spring Python下提交的所有帖子">春季Python</a> （4）</li>
<li class="cat-item cat-item-2"><a href="http://blog.springsource.org/category/springsource/" title="查看所有在SpringSource下提交的帖子">SpringSource</a> （54）</li>
<li class="cat-item cat-item-46"><a href="http://blog.springsource.org/category/tc-server/" title="查看所有在tc服务器下提交的帖子">tc服务器</a> （10）</li>
<li class="cat-item cat-item-16"><a href="http://blog.springsource.org/category/testing/" title="查看“测试”下提交的所有帖子">测试</a> （14）</li>
<li class="cat-item cat-item-41"><a href="http://blog.springsource.org/category/tools/" title="查看工具下的所有帖子">工具</a> （53）</li>
<li class="cat-item cat-item-26"><a href="http://blog.springsource.org/category/training-certification/" title="查看“培训/证书”下提交的所有帖子">培训/认证</a> （2）</li>
<li class="cat-item cat-item-72"><a href="http://blog.springsource.org/category/springsource/vmware-springsource/" title="查看所有在VMware下提交的帖子">VMware</a> （7）</li>
<li class="cat-item cat-item-25"><a href="http://blog.springsource.org/category/web/" title="查看所有在网站下提交的帖子">卷筒纸</a> （51）</li>
<li class="cat-item cat-item-20"><a href="http://blog.springsource.org/category/web-flow/" title="查看所有在Web Flow下提交的帖子">网络流</a> （9）</li>
<li class="cat-item cat-item-18"><a href="http://blog.springsource.org/category/web-services/" title="查看所有在Web服务下提交的帖子">网络服务</a> （7）</li>
</ul>
</li>
<li id="linkcat-29" class="widget widget_links"><h2 class="widgettitle">网站</h2>
<ul class="xoxo blogroll">
<li><a href="http://www.springsource.org/" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">春季框架</a></li>
<li><a href="https://mylearn.vmware.com/mgrReg/plan.cfm?plan=31719&ui=www_edu" target="_blank">春季培训</a></li>
</ul>
</li>
<li id="archives-3" class="widget widget_archive"><h2 class="widgettitle">档案</h2>
<ul>
<li><a href="http://blog.springsource.org/2013/08/" title="2013年8月">2013年8月</a></li>
<li><a href="http://blog.springsource.org/2013/07/" title="2013年7月">2013年7月</a></li>
<li><a href="http://blog.springsource.org/2013/06/" title="2013年六月">2013年六月</a></li>
<li><a href="http://blog.springsource.org/2013/05/" title="2013年5月">2013年5月</a></li>
<li><a href="http://blog.springsource.org/2013/04/" title="2013年4月">2013年4月</a></li>
<li><a href="http://blog.springsource.org/2013/03/" title="2013年3月">2013年3月</a></li>
<li><a href="http://blog.springsource.org/2013/02/" title="2013年2月">2013年2月</a></li>
<li><a href="http://blog.springsource.org/2013/01/" title="2013年1月">2013年1月</a></li>
<li><a href="http://blog.springsource.org/2012/12/" title="2012年12月">2012年12月</a></li>
<li><a href="http://blog.springsource.org/2012/11/" title="2012年11月">2012年11月</a></li>
<li><a href="http://blog.springsource.org/2012/10/" title="2012年10月">2012年10月</a></li>
<li><a href="http://blog.springsource.org/2012/09/" title="2012年9月">2012年9月</a></li>
<li><a href="http://blog.springsource.org/2012/08/" title="2012年8月">2012年8月</a></li>
<li><a href="http://blog.springsource.org/2012/07/" title="2012年7月">2012年7月</a></li>
<li><a href="http://blog.springsource.org/2012/06/" title="2012年6月">2012年6月</a></li>
<li><a href="http://blog.springsource.org/2012/05/" title="2012年5月">2012年5月</a></li>
<li><a href="http://blog.springsource.org/2012/04/" title="2012年4月">2012年4月</a></li>
<li><a href="http://blog.springsource.org/2012/03/" title="2012年3月">2012年3月</a></li>
<li><a href="http://blog.springsource.org/2012/02/" title="2012年2月">2012年2月</a></li>
<li><a href="http://blog.springsource.org/2012/01/" title="2012年1月">2012年1月</a></li>
<li><a href="http://blog.springsource.org/2011/12/" title="2011年12月">2011年12月</a></li>
<li><a href="http://blog.springsource.org/2011/11/" title="2011年11月">2011年11月</a></li>
<li><a href="http://blog.springsource.org/2011/10/" title="2011年10月">2011年10月</a></li>
<li><a href="http://blog.springsource.org/2011/09/" title="2011年9月">2011年9月</a></li>
<li><a href="http://blog.springsource.org/2011/08/" title="2011年8月">2011年8月</a></li>
<li><a href="http://blog.springsource.org/2011/07/" title="2011年7月">2011年7月</a></li>
<li><a href="http://blog.springsource.org/2011/06/" title="2011年6月">2011年6月</a></li>
<li><a href="http://blog.springsource.org/2011/05/" title="2011年5月">2011年5月</a></li>
<li><a href="http://blog.springsource.org/2011/04/" title="2011年4月">2011年4月</a></li>
<li><a href="http://blog.springsource.org/2011/03/" title="2011年3月">2011年3月</a></li>
<li><a href="http://blog.springsource.org/2011/02/" title="2011年2月">2011年2月</a></li>
<li><a href="http://blog.springsource.org/2011/01/" title="2011年1月">2011年1月</a></li>
<li><a href="http://blog.springsource.org/2010/12/" title="2010年12月">2010年12月</a></li>
<li><a href="http://blog.springsource.org/2010/11/" title="2010年11月">2010年11月</a></li>
<li><a href="http://blog.springsource.org/2010/10/" title="2010年10月">2010年10月</a></li>
<li><a href="http://blog.springsource.org/2010/09/" title="2010年9月">2010年9月</a></li>
<li><a href="http://blog.springsource.org/2010/08/" title="2010年8月">2010年8月</a></li>
<li><a href="http://blog.springsource.org/2010/07/" title="2010年7月">2010年7月</a></li>
<li><a href="http://blog.springsource.org/2010/06/" title="2010年6月">2010年6月</a></li>
<li><a href="http://blog.springsource.org/2010/05/" title="2010年5月">2010年5月</a></li>
<li><a href="http://blog.springsource.org/2010/04/" title="2010年4月">2010年4月</a></li>
<li><a href="http://blog.springsource.org/2010/03/" title="2010年3月">2010年3月</a></li>
<li><a href="http://blog.springsource.org/2010/02/" title="2010年2月">2010年2月</a></li>
<li><a href="http://blog.springsource.org/2010/01/" title="2010年1月">2010年1月</a></li>
<li><a href="http://blog.springsource.org/2009/12/" title="2009年12月">2009年12月</a></li>
<li><a href="http://blog.springsource.org/2009/11/" title="2009年11月">2009年11月</a></li>
<li><a href="http://blog.springsource.org/2009/10/" title="2009年10月">2009年10月</a></li>
<li><a href="http://blog.springsource.org/2009/09/" title="2009年9月">2009年9月</a></li>
<li><a href="http://blog.springsource.org/2009/08/" title="2009年8月">2009年8月</a></li>
<li><a href="http://blog.springsource.org/2009/07/" title="2009年7月">2009年7月</a></li>
<li><a href="http://blog.springsource.org/2009/06/" title="2009年6月">2009年6月</a></li>
<li><a href="http://blog.springsource.org/2009/05/" title="2009年5月">2009年5月</a></li>
<li><a href="http://blog.springsource.org/2009/04/" title="2009年4月">2009年4月</a></li>
<li><a href="http://blog.springsource.org/2009/03/" title="2009年3月">2009年3月</a></li>
<li><a href="http://blog.springsource.org/2009/02/" title="2009年2月">2009年2月</a></li>
<li><a href="http://blog.springsource.org/2009/01/" title="2009年1月">2009年1月</a></li>
<li><a href="http://blog.springsource.org/2008/12/" title="2008年12月">2008年12月</a></li>
<li><a href="http://blog.springsource.org/2008/11/" title="2008年11月">2008年11月</a></li>
<li><a href="http://blog.springsource.org/2008/10/" title="2008年10月">2008年10月</a></li>
<li><a href="http://blog.springsource.org/2008/09/" title="2008年9月">2008年9月</a></li>
<li><a href="http://blog.springsource.org/2008/08/" title="2008年8月">2008年8月</a></li>
<li><a href="http://blog.springsource.org/2008/07/" title="2008年7月">2008年7月</a></li>
<li><a href="http://blog.springsource.org/2008/06/" title="2008年6月">2008年6月</a></li>
<li><a href="http://blog.springsource.org/2008/05/" title="2008年5月">2008年5月</a></li>
<li><a href="http://blog.springsource.org/2008/04/" title="2008年4月">2008年4月</a></li>
<li><a href="http://blog.springsource.org/2008/03/" title="2008年3月">2008年3月</a></li>
<li><a href="http://blog.springsource.org/2008/02/" title="2008年2月">2008年2月</a></li>
<li><a href="http://blog.springsource.org/2008/01/" title="2008年1月">2008年1月</a></li>
<li><a href="http://blog.springsource.org/2007/12/" title="2007年12月">2007年12月</a></li>
<li><a href="http://blog.springsource.org/2007/11/" title="2007年11月">2007年11月</a></li>
<li><a href="http://blog.springsource.org/2007/10/" title="2007年10月">2007年10月</a></li>
<li><a href="http://blog.springsource.org/2007/09/" title="2007年9月">2007年9月</a></li>
<li><a href="http://blog.springsource.org/2007/08/" title="2007年8月">2007年8月</a></li>
<li><a href="http://blog.springsource.org/2007/07/" title="2007年7月">2007年7月</a></li>
<li><a href="http://blog.springsource.org/2007/06/" title="2007年6月">2007年6月</a></li>
<li><a href="http://blog.springsource.org/2007/05/" title="2007年5月">2007年5月</a></li>
<li><a href="http://blog.springsource.org/2007/04/" title="2007年4月">2007年4月</a></li>
<li><a href="http://blog.springsource.org/2007/03/" title="2007年3月">2007年3月</a></li>
<li><a href="http://blog.springsource.org/2007/02/" title="2007年2月">2007年2月</a></li>
<li><a href="http://blog.springsource.org/2007/01/" title="2007年1月">2007年1月</a></li>
<li><a href="http://blog.springsource.org/2006/12/" title="2006年12月">2006年12月</a></li>
<li><a href="http://blog.springsource.org/2006/11/" title="2006年11月">2006年11月</a></li>
<li><a href="http://blog.springsource.org/2006/10/" title="2006年10月">2006年10月</a></li>
<li><a href="http://blog.springsource.org/2006/09/" title="2006年9月">2006年9月</a></li>
<li><a href="http://blog.springsource.org/2006/08/" title="2006年8月">2006年8月</a></li>
<li><a href="http://blog.springsource.org/2006/07/" title="2006年7月">2006年7月</a></li>
<li><a href="http://blog.springsource.org/2006/05/" title="2006年5月">2006年5月</a></li>
<li><a href="http://blog.springsource.org/2006/04/" title="2006年4月">2006年4月</a></li>
<li><a href="http://blog.springsource.org/2006/03/" title="2006年3月">2006年3月</a></li>
<li><a href="http://blog.springsource.org/2006/02/" title="2006年2月">2006年2月</a></li>
<li><a href="http://blog.springsource.org/2004/08/" title="2004年8月">2004年8月</a></li>
</ul>
</li>
</ul>
<div class="clear"></div>
</div>
<div class="linkbar"></div>
<div id="lead" class="widecontent fullcontent">
<div class="post" id="post-13986">
<table><tbody><tr><td valign="top" width="90%"><h2 style="text-align:left"><a href="http://blog.springsource.org/2013/07/24/spring-framework-4-0-m2-websocket-messaging-architectures/" rel="bookmark" title="永久链接">Spring Framework 4.0 M2：WebSocket消息传递体系结构</a></h2></td>
<td valign="top">

</td>
</tr>
</tbody></table>
<p class="postmetadata"><small>发表于2013年7月24日，作者： <a href="http://blog.springsource.org/author/rstoyanchev/" title="Rossen Stoyanchev的帖子">Rossen Stoyanchev</a> ， <a href="http://blog.springsource.org/category/spring/" title="查看春季的所有帖子" rel="category tag">春季</a> ， <a href="http://blog.springsource.org/category/web/" title="查看网络中的所有帖子" rel="category tag">网络</a> 。</small></p>
<div class="entrytext">
<a href="http://blog.springsource.org/author/rstoyanchev/" title="Rossen Stoyanchev的帖子"><img src="WebSocketBlogPost_files/rstoyanchev.jpg" alt="罗森·斯托扬切夫（Rossen Stoyanchev）" title="罗森·斯托扬切夫（Rossen Stoyanchev）" class="author_image"></a><p><strong>总览</strong></p>
<p>如我<a href="http://blog.springsource.org/2013/05/22/spring-framework-4-0-m1-websocket-support">之前所写</a> ，WebSocket API只是WebSocket样式的消息传递应用程序的起点。仍然存在许多实际挑战。一名Tomcat邮件列表用户<a href="http://markmail.org/message/j2k2dtmbu4p2zgqd" onclick="javascript:urchinTracker('/outbound/markmail.org');">最近沉思</a> ：</p>
<blockquote><p>在我看来，websockets仍然不是真正的“生产就绪”，（我并不是在谈论Tomcat的实现本身，而是更笼统地说）……IE中的本机websockets功能仅在IE-10和该解决方案之后才可用。允许它在较低的IE版本中工作有点“困难”（例如，依赖通过Adobe FlashPlayer的转移）。（我们的大多数客户是大型公司，它们不会为了更新我们的浏览器，也不会在防火墙中打开特殊端口）。
</p></blockquote>
<p>Spring Framework 4.0的第一个里程碑为<a href="http://sockjs.org/" onclick="javascript:urchinTracker('/outbound/sockjs.org');">SockJS</a>提供了服务器端支持， <a href="http://sockjs.org/" onclick="javascript:urchinTracker('/outbound/sockjs.org');">SockJS</a>是最好，最全面的WebSocket浏览器后备选项。在不支持WebSocket的浏览器以及网络代理<a href="http://www.infoq.com/articles/Web-Sockets-Proxy-Servers" onclick="javascript:urchinTracker('/outbound/www.infoq.com');">阻止其使用的</a>情况下，您将需要后备选项。简而言之，SockJS使您能够立即构建WebSocket应用程序，并在必要时依赖透明的后备选项。</p>
<p>即使具有后备选项，仍然存在更大的挑战。套接字是一个非常低级的抽象，当今的大多数Web应用程序都不编程为套接字。这就是为什么WebSocket协议定义一个子协议机制的原因，该机制本质上允许并鼓励在WebSocket上使用更高级别的协议，就像我们在TCP上使用HTTP一样。</p>
<p>Spring Framework 4.0的第二个里程碑是可以通过WebSocket使用更高级别的消息传递协议。为了证明这一点，我们整理了一个示例应用程序。</p>
<p><strong>股票投资组合样本</strong></p>
<p><a href="https://github.com/rstoyanchev/spring-websocket-portfolio">Github上</a>的Stock Portfolio示例应用程序<a href="https://github.com/rstoyanchev/spring-websocket-portfolio">可</a>加载用户的投资组合头寸，允许买卖股票，消耗价格报价并显示头寸更新。这是一个相当简单的应用程序。但是，它可以处理基于浏览器的消息传递应用程序中可能出现的许多常见任务。</p>
<p><a href="http://blog.springsource.org/wp-content/uploads/2013/07/m2-stock-portfolio-application.png" rel="lightbox[13986]"><img src="WebSocketBlogPost_files/m2-stock-portfolio-application.png" alt="股票投资组合快照" title="股票投资组合快照" class="alignnone size-full wp-image-13995" height="280" width="575"></a></p>
<p>那么，我们如何将这样的应用程序组合在一起？在HTTP和REST中，我们习惯于依赖URL以及HTTP动词来表达需要完成的工作。在这里，我们有一个套接字和许多消息。您如何分辨发送给谁的消息以及该消息的含义？</p>
<p><a href="http://blog.springsource.org/wp-content/uploads/2013/07/m2-message-format.png" rel="lightbox[13986]"><img src="WebSocketBlogPost_files/m2-message-format.png" alt="浏览器和服务器交换消息，但是消息中包含什么？" title="浏览器和服务器交换消息，但是消息中有什么？" class="alignnone size-full wp-image-14029" height="212" width="457"></a></p>
<p>浏览器和服务器必须先同意一种通用的消息格式，然后才能表达这种语义。存在几种可以提供帮助的协议。我们选择<a href="https://stomp.github.io/stomp-specification-1.2.html#Overview" onclick="javascript:urchinTracker('/outbound/stomp.github.io');">STOMP</a>作为这一里程碑，是因为它具有简单性和<a href="https://stomp.github.io/implementations.html" onclick="javascript:urchinTracker('/outbound/stomp.github.io');">广泛的支持</a> 。</p>
<p><strong>简单/流式文本消息协议（STOMP）</strong></p>
<p><a href="https://stomp.github.io/stomp-specification-1.2.html#Overview" onclick="javascript:urchinTracker('/outbound/stomp.github.io');">STOMP</a>是创建时考虑到简单性的消息传递协议。它基于以HTTP为模型的框架。框架由命令，可选的标头和可选的主体组成。</p>
<p>例如，“股票投资组合”应用程序需要接收股票报价，因此客户发送<code>SUBSCRIBE</code>框架在哪里<code>destination</code>标头指示客户端要订阅的内容：</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_347899"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_347899_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_347899" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">SUBSCRIBE</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">id:sub-1</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">destination:/topic/price.stock.*</code></td></tr></tbody></table></div></div></div>
<p>当股票报价可用时，服务器将发送<code>MESSAGE</code>具有匹配的目的地和订阅ID以及内容类型标头和正文的框架：</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_956699"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_956699_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_956699" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">MESSAGE</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">subscription:sub-1</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">message-id:wm2si1tj-4</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">content-type: application/json</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">destination:/topic/stocks.PRICE.STOCK.NASDAQ.EMC</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">{\"ticker\":\"EMC\",\"price\":24.19}</code></td></tr></tbody></table></div></div></div>
<p>要在浏览器中完成所有这些操作，我们使用<a href="https://github.com/jmesnil/stomp-websocket/">stomp.js</a>和<a href="https://github.com/sockjs/sockjs-client" onclick="javascript:urchinTracker('/outbound/github.com');">SockJS客户端</a> ：</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_116908"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_116908_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_116908" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">socket =</code><code class="keyword">new</code> <code class="plain">SockJS(</code><code class="string">'/spring-websocket-portfolio/portfolio'</code><code class="plain">);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">client = Stomp.over(socket);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">var</code> <code class="plain">onConnect =</code><code class="keyword">function</code><code class="plain">() {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="plain">client.subscribe(</code><code class="string">"/topic/price.stock.*"</code><code class="plain">,</code><code class="keyword">function</code><code class="plain">(message) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">      </code><code class="comments">// process quote</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="plain">});</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">};</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">client.connect(</code><code class="string">'guest'</code><code class="plain">,</code><code class="string">'guest'</code><code class="plain">, onConnect);</code></td></tr></tbody></table></div></div></div>
<p>这已经是一个巨大的收获！我们有标准的消息格式和客户端支持。</p>
<p>现在我们可以将其移到服务器端。</p>
<p><strong>消息代理解决方案</strong></p>
<p>一个服务器端选项是一种纯粹的消息代理解决方案，其中，消息直接发送到传统的消息代理，例如RabbitMQ，ActiveMQ等。大多数（如果不是全部）代理都支持基于TCP的STOMP，但越来越多的他们也通过WebSocket支持STOMP，而RabbitMQ更进一步，还支持SockJS。我们的架构如下所示：</p>
<p><a href="http://blog.springsource.org/wp-content/uploads/2013/07/me-broker-solution.png" rel="lightbox[13986]"><img src="WebSocketBlogPost_files/me-broker-solution.png" alt="浏览器将STOMP消息发送到代理，应用程序通过AMQP或JMS连接到代理" title="浏览器将STOMP消息发送到代理，应用程序通过AMQP或JMS连接到代理" class="alignnone size-full wp-image-14030" height="213" width="568"></a></p>
<p>这是一个强大且可扩展的解决方案，但可以说不是最适合当前问题的解决方案。消息代理通常已在企业内部使用。直接在网络上公开它们并不理想。</p>
<p>如果我们从REST中学到了什么，那就是我们不想公开有关系统内部的详细信息，例如数据库或域模型。</p>
<p>此外，作为Java开发人员，您想要应用安全性，验证并添加应用程序逻辑。在消息代理解决方案中，应用程序服务器位于消息代理的后面，这与大多数Web应用程序开发人员所习惯的完全不同。</p>
<p>这就是为什么像<a href="http://socket.io/" onclick="javascript:urchinTracker('/outbound/socket.io');">socket.io</a>这样的库很受欢迎的原因。它很简单，并且针对Web应用程序的需求。另一方面，我们决不能忽略消息代理处理消息的功能，它们确实很擅长，并且消息传递是一个难题。我们需要两者中最好的。</p>
<p><strong>应用程序和消息代理解决方案</strong></p>
<p>另一种方法是使应用程序处理传入的消息，并充当Web客户端和消息代理之间的中介。来自客户端的消息可以通过应用程序流向代理，相反，来自代理的消息可以通过应用程序流回到客户端。这为应用程序提供了检查传入<a href="https://stomp.github.io/stomp-specification-1.2.html#Client_Frames" onclick="javascript:urchinTracker('/outbound/stomp.github.io');">消息类型</a>和“目标”标头并决定是处理消息还是将其传递给代理的机会。</p>
<p><a href="http://blog.springsource.org/wp-content/uploads/2013/07/m2-app-server-broker.png" rel="lightbox[13986]"><img src="WebSocketBlogPost_files/m2-app-server-broker.png" alt="浏览器将消息发送到应用程序，该应用程序又将消息发送到消息代理" title="浏览器将消息发送到应用程序，该应用程序又将消息发送到消息代理" class="alignnone size-full wp-image-14027" height="211" width="567"></a></p>
<p>这是我们选择的方法。为了更好地说明，这里是一些方案。<br>
</p>
<p>加载投资组合头寸</p>
<ul>
<li>客户要求投资组合头寸</li><li>应用程序通过加载数据并将数据返回给订阅来处理请求</li><li><em>消息代理不参与此交互</em>
</li></ul>
<p></p>
<p>订阅股票报价</p>
<ul>
<li>客户发送股票报价订阅请求</li><li>应用程序将消息传递给消息代理</li><li>消息代理将消息传播到所有订阅的客户端</li></ul>
<p></p>
<p>接收股票报价</p>
<ul>
<li>QuoteService将股票报价消息发送给消息经纪人</li><li>消息代理将消息传播到所有订阅的客户端</li></ul>
<p></p>
<p>执行交易</p>
<ul>
<li>客户发送交易请求</li><li>应用程序处理它，通过TradeService提交交易以执行</li><li><em>消息代理不参与此交互</em>
</li></ul>
<p></p>
<p>接收职位更新</p>
<ul>
<li>贸易服务将头寸更新消息发送到消息代理上的队列</li><li>消息经纪人将头寸更新发送给客户端</li><li><em>向特定用户发送消息将在下面进一步详细介绍</em>
</li></ul>
<p></p>
<p>严格来说，使用消息代理是可选的。我们提供了开箱即用的“简单”替代方法供您入门。但是，建议使用消息代理，以实现可伸缩性以及具有多个应用程序服务器的部署。</p>
<p><strong>代码段</strong></p>
<p>让我们看一些客户端和服务器端代码的示例。</p>
<p>这是<a href="https://github.com/rstoyanchev/spring-websocket-portfolio/blob/master/src/main/webapp/assets/js/portfolio.js">Portfolio.js</a>请求的投资组合职位：</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_195839"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_195839_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_195839" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">stompClient.subscribe(</code><code class="string">"/app/positions"</code><code class="plain">,</code><code class="keyword">function</code><code class="plain">(message) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="plain">self.portfolio().loadPositions(JSON.parse(message.body));</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">});</code></td></tr></tbody></table></div></div></div>
<p>在服务器端， <a href="https://github.com/rstoyanchev/spring-websocket-portfolio/blob/master/src/main/java/org/springframework/samples/portfolio/web/PortfolioController.java">PortfolioController</a>检测到请求并返回投资组合位置，这表明在Web应用程序中非常常见的请求-答复交互。由于我们使用Spring Security保护HTTP请求，包括导致WebSocket握手的HTTP请求，因此<code>principal</code>下面的方法参数取自在HttpServletRequest上设置的用户主体Spring Security。</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_970760"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_970760_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_970760" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="color1">@Controller</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">public</code> <code class="keyword">class</code> <code class="plain">PortfolioController {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="comments">// ...</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="color1">@SubscribeEvent</code><code class="plain">(</code><code class="string">"/app/positions"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="keyword">public</code> <code class="plain">List<PortfolioPosition> getPortfolios(Principal principal) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">    </code><code class="plain">String user = principal.getName();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">    </code><code class="plain">Portfolio portfolio =</code><code class="keyword">this</code><code class="plain">.portfolioService.findPortfolio(user);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">    </code><code class="keyword">return</code> <code class="plain">portfolio.getPositions();</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>这是<code>portfolio.js</code>发送交易请求：</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_126546"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_126546_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_126546" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">stompClient.send(</code><code class="string">"/app/trade"</code><code class="plain">, {}, JSON.stringify(trade));</code></td></tr></tbody></table></div></div></div>
<p>在服务器端<code>PortfolioController</code>发送交易执行：</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_26219"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_26219_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_26219" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="color1">@Controller</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">public</code> <code class="keyword">class</code> <code class="plain">PortfolioController {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="comments">// ...</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="color1">@MessageMapping</code><code class="plain">(value=</code><code class="string">"/app/trade"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="keyword">public</code> <code class="keyword">void</code> <code class="plain">executeTrade(Trade trade, Principal principal) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">    </code><code class="plain">trade.setUsername(principal.getName());</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">    </code><code class="keyword">this</code><code class="plain">.tradeService.executeTrade(trade);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p><code>PortfolioController</code>还可以通过向用户发送消息来处理意外的异常。</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_79272"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_79272_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_79272" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="color1">@Controller</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">public</code> <code class="keyword">class</code> <code class="plain">PortfolioController {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="comments">// ...</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="color1">@MessageExceptionHandler</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="color1">@ReplyToUser</code><code class="plain">(value=</code><code class="string">"/queue/errors"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="keyword">public</code> <code class="plain">String handleException(Throwable exception) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">    </code><code class="keyword">return</code> <code class="plain">exception.getMessage();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>从应用程序内部向订阅的客户端发送消息呢？这就是<code>QuoteService</code>发送报价：</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_575933"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_575933_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_575933" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="color1">@Service</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">public</code> <code class="keyword">class</code> <code class="plain">QuoteService {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="keyword">private</code> <code class="keyword">final</code> <code class="plain">MessageSendingOperations<String> messagingTemplate;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="color1">@Scheduled</code><code class="plain">(fixedDelay=</code><code class="value">1000</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="keyword">public</code> <code class="keyword">void</code> <code class="plain">sendQuotes() {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">    </code><code class="keyword">for</code> <code class="plain">(Quote quote :</code><code class="keyword">this</code><code class="plain">.quoteGenerator.generateQuotes()) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">      </code><code class="plain">String destination =</code><code class="string">"/topic/price.stock."</code> <code class="plain">+ quote.getTicker();</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">      </code><code class="keyword">this</code><code class="plain">.messagingTemplate.convertAndSend(destination, quote);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">    </code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>这就是<code>TradeService</code>执行交易后发送仓位更新：</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_143128"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_143128_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_143128" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="color1">@Service</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="keyword">public</code> <code class="keyword">class</code> <code class="plain">TradeService {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="comments">// ...</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="color1">@Scheduled</code><code class="plain">(fixedDelay=</code><code class="value">1500</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="keyword">public</code> <code class="keyword">void</code> <code class="plain">sendTradeNotifications() {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">    </code><code class="keyword">for</code> <code class="plain">(TradeResult tr :</code><code class="keyword">this</code><code class="plain">.tradeResults) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">      </code><code class="plain">String queue =</code><code class="string">"/queue/position-updates"</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">      </code><code class="keyword">this</code><code class="plain">.messagingTemplate.convertAndSendToUser(tr.user, queue, tr.position);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">    </code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="plain">}</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>万一您想知道...是的<code>PortfolioController</code>也可以包含Spring MVC方法（例如<code>@RequestMapping</code> ） <a href="https://jira.springsource.org/browse/SPR-9356?focusedCommentId=88191&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-88191">，此票证是</a>由以前构建在线游戏应用程序的开发人员建议的：</p>
<blockquote><p>是的，整合[消息]映射和spring mvc映射会很好。没有理由不能将它们统一。</p></blockquote>
<p>就像QuoteService和TradeService一样，Spring MVC控制器方法也可以发布消息。</p>
<p><strong>Spring应用程序的消息支持</strong></p>
<p>长期以来， <a href="http://www.springsource.org/spring-integration" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">Spring Integration</a>为知名的<a href="http://www.eaipatterns.com/" onclick="javascript:urchinTracker('/outbound/www.eaipatterns.com');">Enterprise Integration模式</a>以及轻量级消息传递提供了一流的抽象。在研究这个里程碑时，我们意识到后者正是我们所需要的基础。</p>
<p>因此，我很高兴地宣布，我们已经将一系列Spring Integration类型的内容移至Spring Framework中，转移到了一个新模块中，该模块可以称为<a href="https://github.com/SpringSource/spring-framework/tree/master/spring-messaging/src/main/java/org/springframework/messaging">spring-messaging</a> 。除了核心抽象，例如<code>Message</code> ， <code>MessageChannel</code> ， <code>MessageHandler</code>以及其他模块，新模块包含所有注释和类，以支持本文中描述的新功能。</p>
<p>考虑到这一点，我们现在可以查看Stock Portfolio应用程序的内部架构图：</p>
<p><a href="http://blog.springsource.org/wp-content/uploads/2013/07/m2-internal-architecture.png" rel="lightbox[13986]"><img src="WebSocketBlogPost_files/m2-internal-architecture.png" alt="带有消息代理的内部体系结构图" title="带有消息代理的内部体系结构图" class="alignnone size-full wp-image-14028" height="221" width="600"></a></p>
<p><code>StompWebSocketHandler</code>将传入的客户端消息放在“调度”消息通道上。该频道有3位订阅者。第一个委托给带注释的方法，第二个委托将消息中继到STOMP消息代理，而第三个委托通过将目的地转换为客户端订阅的唯一队列名称来处理单个用户的消息（更多详细信息）。</p>
<p>默认情况下，应用程序使用作为入门选项提供的“简单”消息代理运行。如样本<a href="https://github.com/rstoyanchev/spring-websocket-portfolio">README</a>中所述，您可以通过激活和取消激活概要文件来在“简单”消息代理和功能齐全的消息代理之间进行切换。</p>
<p><a href="http://blog.springsource.org/wp-content/uploads/2013/07/m2-simple-broker.png" rel="lightbox[13986]"><img src="WebSocketBlogPost_files/m2-simple-broker.png" alt="具有简单代理的内部体系结构图" title="具有简单代理的内部体系结构图" class="alignnone size-full wp-image-14048" height="240" width="500"></a></p>
<p>另一个可能的配置更改是从<a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Executor.html" onclick="javascript:urchinTracker('/outbound/docs.oracle.com');">Executor</a>切换到基于<a href="https://github.com/reactor/reactor">Reactor</a>的MessageChannel实现，以进行消息传递。最近发布了<a href="http://blog.springsource.org/2013/07/18/reactor-1-0-0-m1-a-foundation-for-asynchronous-fast-data-applications-on-the-jvm/">第一个里程碑</a>的Reactor项目也用于管理应用程序和消息代理之间的TCP连接。</p>
<p>您可以看到<a href="https://github.com/rstoyanchev/spring-websocket-portfolio/blob/master/src/main/java/org/springframework/samples/portfolio/config">完整的应用程序配置</a> ，其中还包括新的<a href="http://blog.springsource.org/2013/07/11/spring-security-java-config-preview-readability/">Spring Security Java配置</a> 。您可能还对<a href="http://blog.springsource.org/2013/07/18/javaconfig-support-in-the-spring-tool-suite/">改进的STS</a>对Java配置的<a href="http://blog.springsource.org/2013/07/18/javaconfig-support-in-the-spring-tool-suite/">支持</a>感兴趣。</p>
<p><strong>向单个用户发送消息</strong></p>
<p>很容易看到如何将消息广播到多个订阅的客户端，只需将消息发布到主题即可。很难看到如何向特定用户发送消息。例如，您可能捕获到异常并希望发送错误消息。或者您可能已收到交易确认，并希望将其发送给用户。</p>
<p>在传统的消息传递应用程序中，通常会创建一个临时队列，并在需要答复的任何消息上设置“答复”标题。这可以工作，但是在Web应用程序中感觉很麻烦。客户端必须记住在所有适用的消息上设置必要的标头，服务器应用程序可能需要跟踪并传递此标头。有时，此类信息可能根本不容易获得，例如在处理HTTP POST作为传递消息的替代方法时。</p>
<p>为了支持此要求，我们向每个连接的客户端发送一个唯一的队列后缀。然后可以添加后缀以创建唯一的队列名称。</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_669086"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_669086_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_669086" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">client.connect(</code><code class="string">'guest'</code><code class="plain">,</code><code class="string">'guest'</code><code class="plain">,</code><code class="keyword">function</code><code class="plain">(frame) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="keyword">var</code> <code class="plain">suffix = frame.headers[</code><code class="string">'queue-suffix'</code><code class="plain">];</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="plain">client.subscribe(</code><code class="string">"/queue/error"</code> <code class="plain">+ suffix,</code><code class="keyword">function</code><code class="plain">(msg) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">    </code><code class="comments">// handle error</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="plain">});</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="plain">client.subscribe(</code><code class="string">"/queue/position-updates"</code> <code class="plain">+ suffix,</code><code class="keyword">function</code><code class="plain">(msg) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">    </code><code class="comments">// handle position update</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="plain">});</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"> </td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">});</code></td></tr></tbody></table></div></div></div>
<p>然后在服务器端<code>@MessageExceptionHandler</code>方法（或任何消息处理方法）可以添加<code>@ReplyToUser</code>注释以将返回值作为消息发送。</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_466470"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_466470_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_466470" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="color1">@MessageExceptionHandler</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="color1">@ReplyToUser</code><code class="plain">(value=</code><code class="string">"/queue/errors"</code><code class="plain">)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">public</code> <code class="plain">String handleException(Throwable exception) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="comments">// ...</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>所有其他类，例如TradeService，都可以使用消息传递模板来实现相同目的。</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_849157"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_849157_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_849157" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">String user =</code><code class="string">"fabrice"</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="plain">String queue =</code><code class="string">"/queue/position-updates"</code><code class="plain">;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="keyword">this</code><code class="plain">.messagingTemplate.convertAndSendToUser(user, queue, position);</code></td></tr></tbody></table></div></div></div>
<p>在这两种情况下，我们内部（通过配置的<a href="https://github.com/SpringSource/spring-framework/blob/master/spring-messaging/src/main/java/org/springframework/messaging/simp/handler/UserQueueSuffixResolver.java">UserQueueSuffixResolver</a> ）都定位用户队列后缀，以重建正确的队列名称。目前，只有一种简单的解析程序实现。但是，添加一个支持相同功能的<a href="http://redis.io/" onclick="javascript:urchinTracker('/outbound/redis.io');">Redis</a>实现将很容易，无论用户是连接到该服务器还是另一个应用程序服务器。</p>
<p><strong>结论</strong></p>
<p>希望这对新功能很有用。我建议您<a href="https://github.com/rstoyanchev/spring-websocket-portfolio">检查示例</a>并考虑这对您编写或打算编写的应用程序意味着什么，而不是延长帖子的时间。在9月初我们努力争取发布候选版本时，这是获得反馈的最佳时机。</p>
<p>使用Spring Framework 4.0.0。M2将<a href="http://repo.springsource.org/libs-milestone" onclick="javascript:urchinTracker('/outbound/repo.springsource.org');">http://repo.springsource.org/libs-milestone</a>或<a href="http://repo.springsource.org/milestone" onclick="javascript:urchinTracker('/outbound/repo.springsource.org');">http://repo.springsource.org/milestone</a>存储库添加到您的配置中。前者包括临时依赖关系，如我们的<a href="https://github.com/SpringSource/spring-framework/wiki/SpringSource-repository-FAQ">存储库常见问题解答中所述</a> 。</p>
<p><strong>SpringOne 2GX 2013指日可待</strong></p>
<p>马上预订您<a href="http://www.springone2gx.com/conference/santa_clara/2013/09/home" onclick="javascript:urchinTracker('/outbound/www.springone2gx.com');">在圣克拉拉的SpringOne</a>的住所。这是发现第一手一切并提供直接反馈的最佳机会。预计今年将发布许多重要的新公告。查看最近的博客文章，了解我的意思，并且还有更多内容！</p>
<h2>类似帖子</h2>
<ul class="similar-posts">
<li><a href="http://blog.springsource.org/2010/06/14/understanding-amqp-the-protocol-used-by-rabbitmq/" rel="bookmark" title="2010年6月14日">了解AMQP，RabbitMQ使用的协议</a></li>
<li><a href="http://blog.springsource.org/2012/05/08/spring-mvc-3-2-preview-techniques-for-real-time-updates/" rel="bookmark" title="2012年5月8日">Spring MVC 3.2预览版：实时更新技术</a></li>
<li><a href="http://blog.springsource.org/2010/08/23/rabbitmq-plugin-for-grails-early-access/" rel="bookmark" title="2010年8月23日">用于Grails的RabbitMQ插件–抢先体验</a></li>
<li><a href="http://blog.springsource.org/2010/09/20/mixing-rabbitmq-with-spring-python/" rel="bookmark" title="2010年9月20日">将RabbitMQ与Spring Python混合</a></li>
<li><a href="http://blog.springsource.org/2012/05/13/spring-mvc-3-2-preview-adding-long-polling-to-an-existing-web-application/" rel="bookmark" title="2012年5月13日">Spring MVC 3.2预览版：向现有的Web应用程序添加长轮询</a></li>
</ul>
<p></p>
<div class="sociable">
<div class="sociable_tagline">
<strong>分享这个帖子</strong>
</div>
<ul>
<li class="sociablefirst"><a rel="nofollow" href="http://digg.com/submit?phase=2&url=http%3A%2F%2Fblog.springsource.org%2F2013%2F07%2F24%2Fspring-framework-4-0-m2-websocket-messaging-architectures%2F&title=Spring Framework 4.0 M2%3A WebSocket Messaging Architectures&bodytext=Overview%0D%0A%0D%0AAs I wrote previously%2C a WebSocket API is only the starting point for WebSocket-style messaging applications. Many practical challenges remain. As one Tomcat mailing list user mused recently%3A%0D%0A%0D%0Ait does seem to me that websockets is still" title="掘客" target="_blank"><img src="WebSocketBlogPost_files/services-sprite.gif" title="掘客" alt="掘客" class="sociable-hovers amtsqiowvtjvfgvvnbzi" style="width:16px;height:16px;background:transparent url(http://blog.springsource.org/wp-content/plugins/sociable/images/services-sprite.png) no-repeat;background-position:-235px -1px"></a></li>
<li><a rel="nofollow" href="http://sphinn.com/index.php?c=post&m=submit&link=http%3A%2F%2Fblog.springsource.org%2F2013%2F07%2F24%2Fspring-framework-4-0-m2-websocket-messaging-architectures%2F" title="斯宾" target="_blank"><img src="WebSocketBlogPost_files/services-sprite.gif" title="斯宾" alt="斯宾" class="sociable-hovers amtsqiowvtjvfgvvnbzi" style="width:16px;height:16px;background:transparent url(http://blog.springsource.org/wp-content/plugins/sociable/images/services-sprite.png) no-repeat;background-position:-199px -55px"></a></li>
<li><a rel="nofollow" href="http://delicious.com/post?url=http%3A%2F%2Fblog.springsource.org%2F2013%2F07%2F24%2Fspring-framework-4-0-m2-websocket-messaging-architectures%2F&title=Spring Framework 4.0 M2%3A WebSocket Messaging Architectures&notes=Overview%0D%0A%0D%0AAs I wrote previously%2C a WebSocket API is only the starting point for WebSocket-style messaging applications. Many practical challenges remain. As one Tomcat mailing list user mused recently%3A%0D%0A%0D%0Ait does seem to me that websockets is still" title="美味的" target="_blank"><img src="WebSocketBlogPost_files/services-sprite.gif" title="美味的" alt="美味的" class="sociable-hovers amtsqiowvtjvfgvvnbzi" style="width:16px;height:16px;background:transparent url(http://blog.springsource.org/wp-content/plugins/sociable/images/services-sprite.png) no-repeat;background-position:-199px -1px"></a></li>
<li><a rel="nofollow" href="https://www.facebook.com/share.php?u=http%3A%2F%2Fblog.springsource.org%2F2013%2F07%2F24%2Fspring-framework-4-0-m2-websocket-messaging-architectures%2F&t=Spring Framework 4.0 M2%3A WebSocket Messaging Architectures" title="脸书" target="_blank"><img src="WebSocketBlogPost_files/services-sprite.gif" title="脸书" alt="脸书" class="sociable-hovers amtsqiowvtjvfgvvnbzi" style="width:16px;height:16px;background:transparent url(http://blog.springsource.org/wp-content/plugins/sociable/images/services-sprite.png) no-repeat;background-position:-343px -1px"></a></li>
<li><a rel="nofollow" href="http://www.mixx.com/submit?page_url=http%3A%2F%2Fblog.springsource.org%2F2013%2F07%2F24%2Fspring-framework-4-0-m2-websocket-messaging-architectures%2F&title=Spring Framework 4.0 M2%3A WebSocket Messaging Architectures" title="混音" target="_blank"><img src="WebSocketBlogPost_files/services-sprite.gif" title="混音" alt="混音" class="sociable-hovers amtsqiowvtjvfgvvnbzi" style="width:16px;height:16px;background:transparent url(http://blog.springsource.org/wp-content/plugins/sociable/images/services-sprite.png) no-repeat;background-position:-91px -37px"></a></li>
<li><a rel="nofollow" href="https://www.google.com/bookmarks/mark?op=edit&bkmk=http%3A%2F%2Fblog.springsource.org%2F2013%2F07%2F24%2Fspring-framework-4-0-m2-websocket-messaging-architectures%2F&title=Spring Framework 4.0 M2%3A WebSocket Messaging Architectures&annotation=Overview%0D%0A%0D%0AAs I wrote previously%2C a WebSocket API is only the starting point for WebSocket-style messaging applications. Many practical challenges remain. As one Tomcat mailing list user mused recently%3A%0D%0A%0D%0Ait does seem to me that websockets is still" title="Google书签" target="_blank"><img src="WebSocketBlogPost_files/services-sprite.gif" title="Google书签" alt="Google书签" class="sociable-hovers amtsqiowvtjvfgvvnbzi" style="width:16px;height:16px;background:transparent url(http://blog.springsource.org/wp-content/plugins/sociable/images/services-sprite.png) no-repeat;background-position:-91px -19px"></a></li>
<li><a rel="nofollow" href="https://www.dzone.com/links/add.html?url=http%3A%2F%2Fblog.springsource.org%2F2013%2F07%2F24%2Fspring-framework-4-0-m2-websocket-messaging-architectures%2F&title=Spring Framework 4.0 M2%3A WebSocket Messaging Architectures" title="区域" target="_blank"><img src="WebSocketBlogPost_files/services-sprite.gif" title="区域" alt="区域" class="sociable-hovers amtsqiowvtjvfgvvnbzi" style="width:16px;height:16px;background:transparent url(http://blog.springsource.org/wp-content/plugins/sociable/images/services-sprite.png) no-repeat;background-position:-289px -1px"></a></li>
<li><a rel="nofollow" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fblog.springsource.org%2F2013%2F07%2F24%2Fspring-framework-4-0-m2-websocket-messaging-architectures%2F&title=Spring Framework 4.0 M2%3A WebSocket Messaging Architectures&source=SpringSource+Team+Blog+The+voice+of+SpringSource&summary=Overview%0D%0A%0D%0AAs I wrote previously%2C a WebSocket API is only the starting point for WebSocket-style messaging applications. Many practical challenges remain. As one Tomcat mailing list user mused recently%3A%0D%0A%0D%0Ait does seem to me that websockets is still" title="领英" target="_blank"><img src="WebSocketBlogPost_files/services-sprite.gif" title="领英" alt="领英" class="sociable-hovers amtsqiowvtjvfgvvnbzi" style="width:16px;height:16px;background:transparent url(http://blog.springsource.org/wp-content/plugins/sociable/images/services-sprite.png) no-repeat;background-position:-1px -37px"></a></li>
<li><a rel="nofollow" href="https://slashdot.org/bookmark.pl?title=Spring Framework 4.0 M2%3A WebSocket Messaging Architectures&url=http%3A%2F%2Fblog.springsource.org%2F2013%2F07%2F24%2Fspring-framework-4-0-m2-websocket-messaging-architectures%2F" title="Slashdot" target="_blank"><img src="WebSocketBlogPost_files/services-sprite.gif" title="Slashdot" alt="Slashdot" class="sociable-hovers amtsqiowvtjvfgvvnbzi" style="width:16px;height:16px;background:transparent url(http://blog.springsource.org/wp-content/plugins/sociable/images/services-sprite.png) no-repeat;background-position:-145px -55px"></a></li>
<li><a rel="nofollow" href="http://technorati.com/faves?add=http%3A%2F%2Fblog.springsource.org%2F2013%2F07%2F24%2Fspring-framework-4-0-m2-websocket-messaging-architectures%2F" title="Technorati" target="_blank"><img src="WebSocketBlogPost_files/services-sprite.gif" title="Technorati" alt="Technorati" class="sociable-hovers amtsqiowvtjvfgvvnbzi" style="width:16px;height:16px;background:transparent url(http://blog.springsource.org/wp-content/plugins/sociable/images/services-sprite.png) no-repeat;background-position:-271px -55px"></a></li>
<li class="sociablelast"><a rel="nofollow" href="https://twitter.com/home?status=Spring Framework 4.0 M2%3A WebSocket Messaging Architectures - http%3A%2F%2Fblog.springsource.org%2F2013%2F07%2F24%2Fspring-framework-4-0-m2-websocket-messaging-architectures%2F" title="推特" target="_blank"><img src="WebSocketBlogPost_files/services-sprite.gif" title="推特" alt="推特" class="sociable-hovers amtsqiowvtjvfgvvnbzi" style="width:16px;height:16px;background:transparent url(http://blog.springsource.org/wp-content/plugins/sociable/images/services-sprite.png) no-repeat;background-position:-343px -55px"></a></li>
</ul>
</div>
<div style="clear:both"> </div>
</div>
</div>
</div>
<div id="wrapper">

<div id="inner">
<div id="main" class="noprint submain">
<div id="inset" class="submain">
<h2>其他职位</h2>
<ul><li>2010年6月3日： <a href="http://blog.springsource.org/2010/03/06/behind-the-spring-security-namespace/">Spring Security命名空间的背后</a></li><li><a href="http://blog.springsource.org/2011/09/08/spring-social-1-0-what-a-year-makes/">2011年8月9日</a> ： <a href="http://blog.springsource.org/2011/09/08/spring-social-1-0-what-a-year-makes/">春季社交1.0：一年成就了什么</a></li><li>23/06/2007： <a href="http://blog.springsource.org/2007/06/23/the-power-of-batch/">批处理的力量</a></li><li>2010年3月11日： <a href="http://blog.springsource.org/2010/11/03/spring-python-1-2-0-rc1-is-released/">Spring Python 1.2.0。RC1发布了！</a></li><li>2007年<a href="http://blog.springsource.org/2007/02/11/weblogic-10-tech-preview-ships-builds-on-spring-framework/">11月2日</a> ： <a href="http://blog.springsource.org/2007/02/11/weblogic-10-tech-preview-ships-builds-on-spring-framework/">WebLogic 10技术预览版发布-在Spring Framework上构建</a></li></ul>
</div>
<div id="content" class="narrowcontents">
<h2 class="narrowheading narrowcorner">47个回复</h2> <div class="item" id="commentslist">
<ol class="commentlist" id="commentlist">
<li class="alt notlast" id="comment-352847">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://www.egovconcepts.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/www.egovconcepts.com');">阿巴斯</a></cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-352847">2013</a>年<a href="#comment-352847">7月25日下午12:24</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>实际上很棒的文章…我喜欢插图…</p>
</li>
<li class=" notlast" id="comment-353098">
<div class="commentinfo">
<h4 class="authorlink"><cite>彼得·费尔科</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-353098">2013</a>年<a href="#comment-353098">7月26日，下午2:11</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>哈罗，很棒的文章。我想问问：<br>-您是否计划在即将发布的版本中（也许是rc。）引入保证消息传递的功能？例如。断开连接，客户端无法发送消息，在重新连接阶段也是如此。解决方案是缓存。我认为这是最重要的功能之一。<br>-是否可能回退到服务器发送的事件？<br>-为什么不使用大气框架？我认为它可以解决相同的问题</p>
</li>
<li class="alt notlast" id="comment-353250">
<div class="commentinfo">
<h4 class="authorlink"><cite>websocket-amqp</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-353250">2013</a>年<a href="#comment-353250">7月27日上午3:30</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>-嗨，</p>
<p>我正在探索使用websockets将amqp消息发布到浏览器上。</p>
<p>非常感谢您的文章。我了解使用STOMP协议通过Websocket从客户端发送请求，然后发送给消息代理的部分。但是，我无法理解我们如何从消息代理接收消息，然后在服务器端推送时将其发送到整个应用程序。你能解释一下那部分吗？</p>
</li>
<li class=" notlast" id="comment-353752">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://www.yenimigeldi.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/www.yenimigeldi.com');">在线alışveriş</a></cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-353752">2013</a>年<a href="#comment-353752">7月29日上午2:41</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>不错的作品</p>
</li>
<li class="alt notlast commentauthor" id="comment-353809">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-353809">2013</a>年<a href="#comment-353809">7月29日上午7:55</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>嗨，彼得，</p>
<blockquote><p>您是否计划在即将发布的版本中（也许是rc。）引入保证消息传递的功能？例如。断开连接，客户端无法发送消息，在重新连接阶段也是如此。解决方案是缓存。我认为这是最重要的功能之一。</p></blockquote>
<p>STOMP协议提供了一些构造，例如消息接收，通知和通知以及事务。服务器实现也可以自由支持不同的消息传递模式。这是由功能齐全的消息代理支持的优点，该消息代理已经实现了这些功能并使它们可用。</p>
<blockquote><p>是否可能回退到服务器发送的事件</p></blockquote>
<p>是的，在sockjs-client页面上检查所有受支持的传输。</p>
<blockquote><p>为什么不使用大气框架？我认为它可以解决相同的问题</p></blockquote>
<p>一段时间以来，大气框架一直提供将实时功能构建到Web应用程序中的能力。就是说，我确实认为我们正在通过依赖已被广泛支持的消息格式的标准子协议，通过为后备选项使用SockJS（也得到广泛支持）以及使其易于与功能齐全的消息代理。</p>
</li>
<li class=" notlast" id="comment-353824">
<div class="commentinfo">
<h4 class="authorlink"><cite>彼得·费尔科</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-353824">2013</a>年<a href="#comment-353824">7月29日上午9:14</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>罗森（Thx rossen），<br>STOMP看起来真的很好（ack，transaction ..），但是我对高速缓存中的高级抽象感兴趣。如果您不想丢失广播的消息，则需要缓存。<br>特别是大气层框架提供了此内置缓存功能：<br>“大气层将始终在缓存中查找并确保在重新连接期间发生的所有消息都被发送回浏览器。BroadcasterCache API是可插入的，并且Atmosphere附带了现成的实现。”</p>
<p>为此，使用@BroadcasterCacheService足够注释方法。因此，程序员可能无法实现以下机制：为客户端生成一些UUID，将所有消息缓存在此UUID下的某个pub / sub中，如果未确认（例如，使用STOMP ack消息），则在客户端重新连接之后<br>发送未送达的邮件。</p>
<p>因此，我对您何时计划在不久的将来发布此“自动”缓存功能（例如，通过一些宣传提供该功能）感兴趣？我认为这可能是非常有用的功能。</p>
</li>
<li class="alt notlast commentauthor" id="comment-353842">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-353842">2013</a>年<a href="#comment-353842">7月29日上午11:26</a> </small>
</div>
<br>
<div style="clear:left"></div>
<blockquote><p>我正在探索使用websockets将amqp消息发布到浏览器上……我理解使用STOMP协议通过websocket从客户端发送请求，然后发送给消息代理的部分。但是，我不明白我们如何从消息代理接收消息，然后在服务器端推送时将其发送到整个应用程序。你能解释一下那部分吗？</p></blockquote>
<p>如果我理解正确，那么您有一个由AMQP客户端创建的AMQP消息，您想将此类消息传播到已连接的浏览器客户端吗？</p>
<p>显然，可以将AMQP消息直接发送给订阅了浏览器客户端的主题或队列。另请查看您的AMQP经纪人的单据文档。例如RabbitMQ支持订阅在STOMP适配器外部创建的队列。</p>
<p>另一个选择是使用来自应用程序的AMQP消息（例如，通过spring-amqp），然后广播到连接的浏览器客户端。在示例代码中，请参见QuoteService和TradeService两者均通过messagingTemplate广播消息。请注意，这些消息来自服务器而不是客户端。</p>
</li>
<li class=" notlast commentauthor" id="comment-353844">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-353844">2013</a>年<a href="#comment-353844">7月29日上午11:35</a> </small>
</div>
<br>
<div style="clear:left"></div>
<blockquote><p>STOMP看起来确实不错（ack，transaction ..），但是我对高速缓存中的高级抽象感兴趣。如果您不想丢失广播的消息，则需要缓存。</p></blockquote>
<p>如果没有其他选项，但是消息代理已经提供了此功能，则确实需要应用程序缓存。例如，请参阅<a href="https://www.rabbitmq.com/stomp.html" rel="nofollow" onclick="javascript:urchinTracker('/outbound/www.rabbitmq.com');">RabbitMQ脚踏插件</a>页面上有关持久主题订阅的部分。您所需要做的就是在订阅请求中添加“ id”标头和“ persistent = true”标头。</p>
</li>
<li class="alt notlast" id="comment-353909">
<div class="commentinfo">
<h4 class="authorlink"><cite>yis</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-353909">2013</a>年<a href="#comment-353909">7月29日，晚上7:02</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>好…</p>
</li>
<li class=" notlast" id="comment-355838">
<div class="commentinfo">
<h4 class="authorlink"><cite>Venkata Parvatam</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-355838">2013</a>年<a href="#comment-355838">8月6日在2:57</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>尼斯邮报罗森</p>
</li>
<li class="alt notlast" id="comment-356089">
<div class="commentinfo">
<h4 class="authorlink"><cite>Venkata Parvatam</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-356089">2013</a>年<a href="#comment-356089">8月7日上午12:09</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>嗨罗森</p>
<p>安全性如何？</p>
</li>
<li class=" notlast" id="comment-356200">
<div class="commentinfo">
<h4 class="authorlink"><cite>莎拉·安</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-356200">2013</a>年<a href="#comment-356200">8月7日上午8:42</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>罗森</p>
<p>您知道如何在Eclipse Kepler中运行Tomcat 8吗？</p>
<p>在Spring 4.0.0中使用websockets。M2和Tomcat直接绑定到仅在Tomcat 8中存在的类。当前在Eclipse中没有针对Tomcat 8的服务器适配器时，这使得调试变得很困难。</p>
<p>谢谢，</p>
<p>莎拉</p>
</li>
<li class="alt notlast commentauthor" id="comment-356210">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-356210">2013</a>年<a href="#comment-356210">8月7日上午9:17</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>关于安全性，该应用程序具有使用Spring Security实现的登录页面，因此只有经过身份验证的用户才能输入。但是，我们还有很多事情可以做，例如，避免因HTTP和WebSocket会话长度不同而引起的问题，通过MessageChannel的应用程序在应用程序内安全发送消息等。如果您有特定的要求，则最好听一听。在这里或最好在我们的JIRA中。</p>
</li>
<li class=" notlast commentauthor" id="comment-356212">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-356212">2013</a>年<a href="#comment-356212">8月7日上午9:22</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>不幸的是，尚不支持在Eclipse中与Tomcat 8一起运行。现在有一个alpha版本，希望我们很快会看到该支持。</p>
<p>也就是说，在Eclipse中使用Tomcat 8进行调试并不是很难。只需将bin / startup.sh中的最后一行更改为（请注意添加了“ jpda”）：</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_728975"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_728975_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_728975" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain">exec "$PRGDIR"/"$EXECUTABLE" jpda start "<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="82a6c2">[email protected]</a>"</code></td></tr></tbody></table></div></div></div>
<p>在Eclipse内，为localhost端口80创建一个远程调试配置，在启动Tomcat之后启动它，然后可以在源代码中放置断点。</p>
</li>
<li class="alt notlast" id="comment-358170">
<div class="commentinfo">
<h4 class="authorlink"><cite>托马斯</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-358170">2013</a>年<a href="#comment-358170">8月15日上午8:48</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>嗨，罗森，<br>我们在应用程序中使用Spring Security和oAuth。我们想使用“应用程序和消息代理”解决方案。目前可以在oAuth上使用此解决方案吗？</p>
<p>谢谢<br>托马斯</p>
</li>
<li class=" notlast commentauthor" id="comment-358217">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.org/" rel="external nofollow" class="url">Rob Winch</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-358217">2013</a>年<a href="#comment-358217">8月15日下午12:38</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>@Tomas –我不确定您的意思。OAuth仅设计用于HTTP协议，因此不支持处理WebSocket框架中嵌入的令牌。但是，在握手时，无论您如何进行身份验证（即用户名/密码，OAuth等），当前的HttpServletRequest.getUserPrincipal（）都将被传输到WebSocket会话。如果这样做没有帮助，请您详细说明“当前是否可以在OAuth中使用此解决方案”的含义？</p>
</li>
<li class="alt notlast" id="comment-358423">
<div class="commentinfo">
<h4 class="authorlink"><cite>托马斯</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-358423">2013</a>年<a href="#comment-358423">8月16日上午5:46</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>@Rob –我们正在使用Rest和SSO，我们只想在某些情况下使用ws。在您的示例中，我没有注意到使用STOMP库从客户端连接时，用户名和密码为空字符串。</p>
<p>我也尝试过针对ActiveMQ运行示例，并且我注意到它为SUBSCRIBE上的每个用户创建了错误队列和位置队列。有没有办法在取消订阅或连接超时后如何删除此类队列？对于具有大量用户的Web应用程序，我们不希望此类队列徘徊。</p>
<p>谢谢<br>托马斯</p>
</li>
<li class=" notlast commentauthor" id="comment-358930">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.org/" rel="external nofollow" class="url">Rob Winch</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-358930">2013</a>年<a href="#comment-358930">8月19日上午7:30</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>@Tomas –您是正确的，我们没有在WebSocket握手中进行身份验证。相反，我们依赖于现有的HTTP Principal并将其转移到WebSocket会话。我们从这种方法开始，因为我们相信大多数用户都希望在Web浏览器的上下文中同时使用HTTP和WebSocket。您是否认为需要通过WebSockets进行身份验证？我将注意到，我们尚未将安全解决方案视为完整的解决方案。特别是，我们仍未在WebSocket空间内展示授权。这是我们在将来的迭代中正在努力的事情。</p>
<p>关于您有关ActiveMQ的问题，Rossen目前正在调查此问题的答案。</p>
</li>
<li class="alt notlast commentauthor" id="comment-358941">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-358941">2013</a>年<a href="#comment-358941">8月19日上午8:42</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>@Thomas，正如Rob提到的，我们没有使用STOMP用户/ pwd，因为该用户已经通过HTTP进行了身份验证，并且已在WebSocket会话中填充。</p>
<p>关于第二个问题，有一个配置选项可以<a href="http://activemq.apache.org/delete-inactive-destinations.html" rel="nofollow" onclick="javascript:urchinTracker('/outbound/activemq.apache.org');">删除不活动的目标</a> 。你可以看到<a href="http://activemq.2283324.n4.nabble.com/How-can-I-remove-old-queues-without-a-java-client-td3600561.html" rel="nofollow" onclick="javascript:urchinTracker('/outbound/activemq.2283324.n4.nabble.com');">这个胎面</a>以及用于多一点背景。您需要确保所有消息都得到确认（并且队列为空）：</p>
<div class="syntaxhighlighter nogutter  " id="highlighter_109435"><div class="bar"><div class="toolbar"><a class="item viewSource" title="查看源" href="#viewSource" style="width:16px;height:16px">查看源</a><div class="item copyToClipboard"><embed id="highlighter_109435_clipboard" type="application/x-shockwave-flash" title="复制到剪贴板" src="WebSocketBlogPost_files/clipboard.swf" height="16" width="16" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_109435" menu="false"></div><a class="item printSource" title="打印" href="#printSource" style="width:16px;height:16px">打印</a> <a class="item about" title="？" href="#about" style="width:16px;height:16px">？</a></div></div><div class="lines no-wrap"><div class="line alt1"><table><tbody><tr><td class="content"><code class="plain"><code>var subsId = stompClient.subscribe("/queue/foo", function(message) {</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">    </code><code class="plain">// ...</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">    </code><code class="plain">stompClient.ack(message.headers['message-id'], subsId);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="plain">},</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="content"><code class="spaces">  </code><code class="plain">{ack: 'client'});</code></td></tr></tbody></table></div></div></div>
<p>还有一些<a href="http://activemq.apache.org/how-do-i-purge-a-queue.html" rel="nofollow" onclick="javascript:urchinTracker('/outbound/activemq.apache.org');">其他选项</a>可能合适或互补。</p>
</li>
<li class=" notlast" id="comment-359002">
<div class="commentinfo">
<h4 class="authorlink"><cite>彼得</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359002">2013</a>年<a href="#comment-359002">8月20日上午1:48</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>嗨，罗森，</p>
<p>我尝试了该示例，它在chrome和firefox上正常运行，但是在IE9上似乎不起作用（我使用'mvn jetty：run'运行服务器）。后备支持是否仍在进行中，还是我必须以某种方式启用它？</p>
<p>我还有第二个问题：我们需要将消息推送到特定的“会话”：因此，如果同一用户在同一浏览器中打开2个标签，则这些标签将收到不同的消息，尽管它们具有相同的JSESSIONID。这可能吗？</p>
<p>谢谢<br>彼得</p>
</li>
<li class="alt notlast" id="comment-359033">
<div class="commentinfo">
<h4 class="authorlink"><cite>托马斯</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359033">2013</a>年<a href="#comment-359033">8月20日上午6:31</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>你好<br>我已经开始针对RabbitMQ测试该示例（我们目前正在评估代理以及从服务器到浏览器的推送框架），并且我注意到每个登录用户都在创建与代理的新连接，而不仅仅是一个通道（还有一个从应用程序本身到主题的一种连接）。因此，对于3个已连接的用户，我们可以看到4个连接和4个通道已创建。用户数量更多的应用程序将无法为每个用户创建一个连接。他们将需要某种方式插入连接工厂并进行连接池化。</p>
<p>有什么方法可以在声明用户队列时指定自定义参数？<br>与ActiveMQ相同，我们要声明队列TTL，可以在声明队列时使用“ x-expires”参数来完成。另外，我们还想指定自定义键绑定，并将用户队列连接到与默认队列不同的交换。</p>
<p>我们的用例如下：<br>位于不同服务器上的其他服务将进行一些处理并发布消息以进行交换，即使未连接的用户也可以进行交换，应通知已连接的用户。已连接用户的消息将从交换发送到用户队列。未连接用户的消息将在交换中消失，因为将没有任何键绑定。队列的TTL较短，因此会很快被丢弃，并且不会消耗服务器资源。</p>
<p>那可能吗？</p>
<p>谢谢<br>托马斯</p>
<p>托马斯</p>
</li>
<li class=" notlast commentauthor" id="comment-359058">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359058">2013</a>年<a href="#comment-359058">8月20日，下午2:19</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>Pieter，我做<a href="https://github.com/rstoyanchev/spring-websocket-portfolio/commit/e2cf08b1605b9a06e56e5dc51ceac3efb95c32eb" rel="nofollow">了几个与IE相关的更新，</a>并在IE 8上进行了测试。您可以再试一次吗？</p>
<p>至于您的第二个问题，我们打算在@ReplyToUser中添加一个属性以是否回复所有会话。除此之外，如果从任何地方发送消息，问题是如何确定哪个浏览器选项卡会话是哪个？用户名是一个稳定的句柄，可以在整个过程中使用。也许消息可以到达用户的所有会话，然后每个选项卡都可以过滤其需要的内容，例如基于标题。我很高兴听到建议。</p>
</li>
<li class="alt notlast" id="comment-359071">
<div class="commentinfo">
<h4 class="authorlink"><cite>乔丹</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359071">2013</a>年<a href="#comment-359071">8月20日，下午5:08</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>由于这利用了HttpServletRequest主体，因此如何检测到用户会话超时并注销了？使用websockets似乎很难检测。使用内置的Tomcat会话管理器，我可以通过HttpSessionListener来获取它，但是一旦移出该会话管理器，它只有在查询会话中存储的任何内容时才能获取它。问题是websocket可以在HTTP会话中幸存下来，并且仍然可以通过它获取数据，因为它已经通过了过滤器，并且HTTP会话很难脱离实际的servlet（即另一个线程）。</p>
</li>
<li class=" notlast" id="comment-359109">
<div class="commentinfo">
<h4 class="authorlink"><cite>彼得</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359109">2013</a>年<a href="#comment-359109">8月21日，上午4:16</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>嗨，罗森，</p>
<p>感谢您的快速修复。我用IE9尝试过，并且可以正常工作。<br>我现在唯一的问题是2分钟后不再通信（不涉及代理）：所使用的协议是http流，并且2分钟后响应结束。随后是新的http请求（http流），该请求在20秒后结束。然后什么也没有发生。</p>
<p>在客户端进行过滤应该可以，但是如果传输大量消息，那么开销可能会很昂贵（尤其是如果我们需要回退到长轮询时）</p>
<p>可能的情况可能是：<br>客户端调用stompClient.connect（），这会在服务器端生成唯一的queueSuffix和对StompProtocolHandler.onConnect（user，queueSuffix）的调用。<br>通过扩展StompProtocolHandler，应用程序可以注册此会话并进行一些应用程序初始化（如有必要）。<br>然后将队列后缀返回给客户端。</p>
<p>客户端订阅queueName queueSuffix</p>
<p>用@ SubscribeEvent，@ UnsubscribeEvent，@ MessageMapping等注释的方法不仅应接收主体，而且还应接收queueSuffix。<br>使用@ReplyToUser（具有new属性），服务器可以响应用户或queueSuffix。或者，它可以将queueSuffix传递给工作线程，然后该工作线程调用MessageSendingOperations.converAndSendToQueueSuffix（queueSuffix，目标，消息）以响应“ queueSuffix”。</p>
<p>当客户端调用stompClient.disconnect（）或客户端被“杀死”时，将调用StompProtocolHandler.onDisConnect（user，queueSuffix），应用程序可以清理其会话。</p>
</li>
<li class="alt notlast" id="comment-359122">
<div class="commentinfo">
<h4 class="authorlink"><cite>大卫A</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359122">2013</a>年<a href="#comment-359122">8月21日上午6:43</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>Rossen，感谢您的精彩文章。<br>我对示例有疑问，我将其部署到了tomcat，但是当我登录时，Portfolio是空的并保持这种状态。<br>我会忘记简单的事情还是WAR部署是唯一需要的步骤？</p>
</li>
<li class=" notlast commentauthor" id="comment-359124">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359124">2013</a>年<a href="#comment-359124">8月21日上午6:49</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>托马斯</p>
<blockquote><p>对于3个已连接的用户，我们可以看到4个连接和4个通道已创建。用户数量更多的应用程序将无法为每个用户创建一个连接。他们将需要某种方式插入连接工厂并进行连接池化。
</p></blockquote>
<p>该协议没有明确提及连接共享，但是在ack / nack和begin / commit客户帧中，每个连接都只有一个客户端。它还会干扰特定于代理的目标语义，例如，由于（共享）连接保持连接状态而永远不会删除的临时/客户端队列。</p>
<p>连接的数量与使用Rabbit的stomp-web插件通过STOMP / SockJS从浏览器直接连接到Rabbit的连接数量没有什么不同。</p>
<p>顺便说一下，第四连接实际上是共享连接。它用于发送源自应用程序内部的消息（例如，股票报价，头寸更新等）。它不与任何客户端关联，并且从不用于订阅。</p>
<blockquote><p>有什么方法可以在声明用户队列时指定自定义参数？与ActiveMQ相同，我们要声明队列TTL，可以在声明队列时使用“ x-expires”参数来完成。另外，我们还想指定自定义键绑定，并将用户队列连接到与默认队列不同的交换。
</p></blockquote>
<p>浏览<a href="https://www.rabbitmq.com/stomp.html" rel="nofollow" onclick="javascript:urchinTracker('/outbound/www.rabbitmq.com');">Rabbit的STOMP页面</a> ，尤其是目的地部分。有几个受支持的目标前缀。您可以使用“ /exchange/amq.direct/position-updates”之类的目标（加上示例中所示的唯一queueSuffix），这将创建一个自动删除队列，并带有当前客户端会话的订阅。您也可以使用任何其他交换。</p>
<blockquote><p>我们的用例如下：<br>位于不同服务器上的其他服务将进行一些处理并发布消息以进行交换，即使未连接的用户也可以进行交换，应通知已连接的用户。已连接用户的消息将从交换发送到用户队列。未连接用户的消息将在交换中消失，因为将没有任何键绑定。队列的TTL较短，因此会很快被丢弃，并且不会消耗服务器资源。
</p></blockquote>
<p>这应该是可以实现的。您可以从应用程序的几乎任何部分向连接的用户发送消息（不仅仅是在响应传入消息时）。如果您查看TradeService或QuoteService，它们就是这样做的。您还可以从任何其他代码中想象到相同的结果，例如响应HTTP POST或某些外部事件。</p>
<p>感谢您的关注，随时发表评论！</p>
</li>
<li class="alt notlast commentauthor" id="comment-359127">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359127">2013</a>年<a href="#comment-359127">8月21日，上午7:11</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>乔丹</p>
<blockquote><p>问题是websocket可以在HTTP会话中幸存下来，并且仍然可以通过它获取数据，因为它已经通过了过滤器，并且HTTP会话很难脱离实际的servlet（即另一个线程）。
</p></blockquote>
<p>是的，这是我们正在考虑的问题，它是双向的，即，如果用户正在通过WebSocket进行交互，则整个应用程序（包括HTTP会话）应该识别出该问题并保持连接/身份验证。</p>
<p>WebSocket涉及的问题是何时使用户超时。例如，当股票报价自动推送给客户时，它会引起活动，但不会涉及用户。何时超时是部分针对特定应用的问题。交易者可能希望整天观看。在其他应用程序中，如果客户端没有执行任何操作，则可能需要超时。</p>
<p>HttpSession超时时，我们可能会提供关闭WebSocket会话的支持。随时在JIRA中创建票证。</p>
</li>
<li class=" notlast commentauthor" id="comment-359129">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359129">2013</a>年<a href="#comment-359129">8月21日上午7:38</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>彼得，</p>
<blockquote><p>我现在唯一的问题是2分钟后不再通信（不涉及代理）：所使用的协议是http流，并且2分钟后响应结束。随后是新的http请求（http流），该请求在20秒后结束。然后什么也没有发生。
</p></blockquote>
<p>找出结束的地方会很好。是否存在服务器端故障，例如任何客户端错误？增加org.springframework.web的日志记录，您可能希望降低报价的频率（请参见QuoteService @Scheduled），以避免产生过多的噪音。随时在JIRA中打开一张票。</p>
<blockquote><p>用@ SubscribeEvent，@ UnsubscribeEvent，@ MessageMapping等注释的方法不仅应接收主体，而且还应接收queueSuffix。
</p></blockquote>
<p>您可以将UserQueueSuffixResolver注入到控制器中，并由用户执行查找以获取队列后缀。但是，直接向用户发送消息的整个想法是，您不必跟踪会话ID或队列后缀，因为两者都可能随着用户掉线和/或重新连接而改变。</p>
<p>也许我们应该考虑使用的不仅是UserQueueSuffixResolver中的用户名，例如，用户名加上一些其他用户属性，这些属性可以形成唯一的查找键，但是要记住一个具体示例当然会有所帮助。也就是说，带有一些附加属性的带有“ / user /”前缀的URL将包括什么？例如“ / user / joe- {attr} / queue / foo”。</p>
</li>
<li class="alt notlast commentauthor" id="comment-359131">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359131">2013</a>年<a href="#comment-359131">8月21日上午8:02</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>大卫A</p>
<blockquote><p>我部署到了tomcat，但是当我登录时，Portfolio是空的，并且保持这种状态。我会忘记简单的事情还是WAR部署是唯一需要的步骤？
</p></blockquote>
<p>如果使用IE，我昨天又添加了一些解决方案。否则，尝试通过查看Tomcat日志来找出是否存在客户端错误（在IE中启用错误通知或以其他方式检查Chrome开发工具）或服务器端异常。确保您使用的是4.0.0。使用Tomcat 8.0的BUILD-SNAPSHOT。RC1（夜间快照也应起作用）。无非就是战争部署。您也可以尝试“ mvn jetty：run”。</p>
</li>
<li class=" notlast" id="comment-359151">
<div class="commentinfo">
<h4 class="authorlink"><cite>莎拉·安</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359151">2013</a>年<a href="#comment-359151">8月21日，下午12:49</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>在AbstractHttpSockJsSession中，有一个消息缓存阻止队列，其容量为100，这似乎是不可配置的。将来会有办法配置此限制吗？如果不是这样，我们如何在Xhr流媒体的周期性停机时间内处理从服务器到客户端的高流量？</p>
</li>
<li class="alt notlast commentauthor" id="comment-359152">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359152">2013</a>年<a href="#comment-359152">8月21日，下午1:07</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>莎拉·安（Sarah Ann），是的，应该配置好一点。我<a href="https://jira.springsource.org/browse/SPR-10844" rel="nofollow">在SPR-10844中添加了评论</a> 。如果您有任何建议或用例，请随时在票证上发表评论。谢谢。</p>
</li>
<li class=" notlast" id="comment-359162">
<div class="commentinfo">
<h4 class="authorlink"><cite>吉姆</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359162">2013</a>年<a href="#comment-359162">8月21日，下午4:04</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>您能解释一下如何通过应用程序将消息传播回客户端吗？<br>如果有人向代理发布消息，代理是将消息直接传递给订阅的客户端，还是将消息从代理流向Spring应用程序，然后应用程序将消息发送给客户端？<br>如果是这样，应用程序如何知道谁是订户？还可以跟踪订户吗？</p>
</li>
<li class="alt notlast" id="comment-359204">
<div class="commentinfo">
<h4 class="authorlink"><cite>彼得</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359204">2013</a>年<a href="#comment-359204">8月22日上午4:38</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>嗨，罗森，</p>
<p>对于IE9，创建了一个jira条目： <a href="https://jira.springsource.org/browse/SPR-10854" rel="nofollow">https</a> : <a href="https://jira.springsource.org/browse/SPR-10854" rel="nofollow">//jira.springsource.org/browse/SPR-10854</a></p>
<p>我认为标识重踏会话的属性是查找的不错选择。</p>
<p>我建议使用queueSuffix，因为StompProtocolHandler.handleConnect（）已经创建了queueSuffix，而SimpleUserQueueSuffixResolver对此进行了跟踪。</p>
</li>
<li class=" notlast commentauthor" id="comment-359223">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359223">2013</a>年<a href="#comment-359223">8月22日上午8:20</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>吉姆</p>
<blockquote><p>如果有人向代理发布消息，代理是将消息直接传递给订阅的客户端，还是将消息从代理流向Spring应用程序，然后应用程序将消息发送给客户端？
</p></blockquote>
<p>客户端已连接到Spring应用程序，它们没有与代理的直接连接。该应用程序继而建立与代理的连接，因此，在发布消息时，它可以（通过应用程序）向下流到所有订阅的客户端。</p>
<blockquote><p>如果是这样，应用程序如何知道谁是订户？还可以跟踪订户吗？
</p></blockquote>
<p>该应用程序可以拦截订阅和消息，但无需跟踪它们。那是经纪人的工作，并且经纪人知道所有订阅。</p>
</li>
<li class="alt notlast commentauthor" id="comment-359225">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359225">2013</a>年<a href="#comment-359225">8月22日上午8:33</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>彼得，</p>
<blockquote><p>我建议使用queueSuffix，因为StompProtocolHandler.handleConnect（）已经创建了queueSuffix，而SimpleUserQueueSuffixResolver对此进行了跟踪。
</p></blockquote>
<p>队列后缀从根本上说是一个瞬态值。如果客户端断开连接并重新连接，它将改变。理想情况下，您需要在应用程序的任何部分都可以知道的东西。例如，很容易想象使用HTTP POST处理方法向用户发送消息，但是它将如何知道哪个会话呢？它必须指的是众所周知的东西或可以查找的东西。例如，如果每个选项卡具有不同的聊天室，则它可以是聊天室的名称。</p>
</li>
<li class=" notlast" id="comment-359282">
<div class="commentinfo">
<h4 class="authorlink"><cite>彼得</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359282">2013</a>年<a href="#comment-359282">8月23日上午3:29</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>嗨，罗森，</p>
<p>我了解您的担忧。</p>
<p>但是也许我们可以使用选择器（用户定义的STOMP标头）将此功能带到应用程序级别。<br>该应用程序可以生成一个（唯一的）令牌，并且可以向每个发送和订阅添加一个自定义标头“选择器：令牌”。相应的服务器方法应有权访问这些自定义标头（或所有标头）。<br>spring框架基于选择器过滤掉消息，以消除不必要消息的开销。<br>框架还应该跟踪未完成订阅的那些自定义标头，以便将其传递给unsubscribe方法（或将未订阅与正确订阅链接的另一种方法）。因此，可以在取消订阅中释放在订阅期间分配的资源。</p>
<p>彼得</p>
</li>
<li class="alt notlast" id="comment-359592">
<div class="commentinfo">
<h4 class="authorlink"><cite>克里斯托夫·莱维斯克</cite> （ <cite>Christophe Levesque）</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359592">2013</a>年<a href="#comment-359592">8月26日下午4:02</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>感谢您的发布和示例应用程序！</p>
<p>我想在客户端和消息队列之间实现某种程度的安全性，但是不确定执行此操作的最佳方法是什么。我猜一种方法是让应用程序充当队列的某种代理。例如：</p>
<p>-客户发送/topic/price.stock的订阅。虚拟机<br>-应用程序收到SUBSCRIBE消息，解析目的地以找出目标股票，并根据一些自定义规则检查用户是否被允许订阅该主题（例如，仅当用户在其投资组合中拥有该股票时才允许）。<br>-如果检查确定，请为客户端订阅主题，否则将错误发送到错误队列</p>
<p>知道如何实现这种情况吗？</p>
</li>
<li class=" notlast" id="comment-359645">
<div class="commentinfo">
<h4 class="authorlink"><cite>托马斯</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359645">2013</a>年<a href="#comment-359645">8月27日上午4:20</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>除了Christophe所描述的内容之外，如果还可以对订阅消息进行修改/预处理，以便可以添加/删除/更改消息头，那将非常有用。</p>
<p>我们的用例是：<br>用户使用选择器“ accountId ='{externalValue}'”订阅主题。XYZ是编码值，因此实际值不会暴露给外界。XYZ需要解码为内部值，并替换标头，以便读取“ accountId ='{internalValue}'”。</p>
</li>
<li class="alt notlast commentauthor" id="comment-359681">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359681">2013</a>年<a href="#comment-359681">8月27日下午12:20</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>克里斯托弗，我认为ChannelInterceptor将是一个很好的选择，您可以<a href="https://github.com/SpringSource/spring-integration/blob/master/spring-integration-core/src/main/java/org/springframework/integration/channel/ChannelInterceptor.java" rel="nofollow">在SI中</a>看到<a href="https://github.com/SpringSource/spring-integration/blob/master/spring-integration-core/src/main/java/org/springframework/integration/channel/ChannelInterceptor.java" rel="nofollow">ChannelInterceptor</a> ，这可能是它的基础。然后，您可以拦截所有客户端消息发送到的通道。您介意在JIRA中创建请求吗？</p>
<p>Thomas，这样的拦截器也可以用于修改消息。</p>
</li>
<li class=" notlast" id="comment-359738">
<div class="commentinfo">
<h4 class="authorlink"><cite>托马斯</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359738">2013</a>年<a href="#comment-359738">8月28日上午3:02</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>@Rossen – ChannelInterceptor很有意义。<br>我已经解决了它，将子类StompBrokerRelayMessageHandler子类化，并覆盖handleMesage方法。</p>
<p>我也在调查使用@SubscribeEvent和@ReplyTo（从浏览器发布到其他目标，以便由Controller处理）的可能性。更改消息头并更改目标，以便稍后由Stomp处理程序处理），但所有本机头均丢失，并且messageType已从SUBSCRIBE更改为MESSAGE。</p>
</li>
<li class="alt notlast commentauthor" id="comment-359751">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-359751">2013</a>年<a href="#comment-359751">8月28日上午6:35</a> </small>
</div>
<br>
<div style="clear:left"></div>
<blockquote><p>我也在调查使用@SubscribeEvent和@ReplyTo（从浏览器发布到其他目标，以便由Controller处理）的可能性。更改消息头并更改目标，以便稍后由Stomp处理程序处理），但所有本机头均丢失，并且messageType已从SUBSCRIBE更改为MESSAGE。</p></blockquote>
<p>我认为这不太容易，因为STOMP客户端会记住目标并将其用于将接收到的消息与订阅功能进行匹配。因此，如果您在到达服务器的途中更改了目的地，则还需要在服务器的消息中将其更改回去。当然，这不是一条简单的路线。</p>
<p>通常，从服务器应用程序中，您只能发送MESSAGE帧，最终以一个或多个客户端为目标。另一方面，订阅必须来自客户端。</p>
</li>
<li class=" notlast" id="comment-360347">
<div class="commentinfo">
<h4 class="authorlink"><cite>马特</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-360347">2013</a>年<a href="#comment-360347">9月3日，上午3:52</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>嗨，罗森，<br>感谢提供这篇好文章！</p>
<p>您描述了使用简单消息代理，然后更改为使用外部代理，您只需“在stomp-broker-relay配置文件中注释并在DispatcherServletInitializer.java中注释掉simple-broker配置文件”</p>
<p>您不是要修改WebSocketConfig类，并用enableStompBrokerRelay替换enableSimpleBrokerRelay吗？</p>
<p>DispatcherServletInitializer.java类未提及中继。</p>
<p>另外，在master分支中，似乎已经设置了WebSocketConfig类，该类指向enableStompBrokerRelay…</p>
<p>完成上述更改后，我便可以使用它。</p>
</li>
<li class="alt notlast commentauthor" id="comment-360491">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-360491">2013</a>年<a href="#comment-360491">9月3日，上午11:55</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>嗨，马特，我最近确实引入了专用Java配置的使用，这大大简化了配置。我现在已经更新了自述文件以反映这一点。感谢您提醒我它需要更新。我还默认切换回使用简单代理。</p>
</li>
<li class=" notlast" id="comment-360818">
<div class="commentinfo">
<h4 class="authorlink"><cite>马特</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-360818">2013</a>年<a href="#comment-360818">9月4日上午5:01</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>您对最新的tomcat 8版本有任何麻烦吗？看起来8-RC1版本抛出了doUpgrade找不到方法异常。订阅SNAPSHOT可使websocket正常工作，但我看到间歇性的404错误。猜猜这是为最新和最伟大的东西付出的代价……</p>
</li>
<li class="alt notlast commentauthor" id="comment-360840">
<div class="commentinfo">
<h4 class="authorlink"><cite><a href="http://blog.springsource.com/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">Rossen Stoyanchev</a></cite> （博客作者）说：</h4>
<small class="commentmetadata">添加于<a href="#comment-360840">2013</a>年<a href="#comment-360840">9月4日上午6:16</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>是的，不幸的是8.0-RC1不再起作用。急切地等待本周的RC2（以及将Tomcat 8中的WebSocket支持反向移植到Tomcat 7）。</p>
<p>同时， <a href="https://repository.apache.org/content/repositories/snapshots/org/apache/tomcat/tomcat/8.0-SNAPSHOT/" rel="nofollow">可以下载快照</a>并且应该可以使用。这就是我经常使用的。如果您有关于404的任何详细信息，请随时在JIRA中打开票证。</p>
</li>
<li class=" notlast" id="comment-360865">
<div class="commentinfo">
<h4 class="authorlink"><cite>马特</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-360865">2013</a>年<a href="#comment-360865">9月4日上午7:43</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>令人兴奋！<br>实际上，我能够弄清楚-看起来最新的Tomcat版本对于使用“ /”作为上下文路径非常敏感。间歇地，它无法通过创建带有双斜杠的请求来找到匹配的请求映射：// something / something<br>通过将webapp上下文更改为空字符串“”，它可以工作。<br>当然，这只会影响根上下文中的网站，否则“ / my-web-app”仍将起作用。</p>
<p>注意：我仅在嵌入式模式下进行过测试！</p>
</li>
<li class="alt" id="comment-363838">
<div class="commentinfo">
<h4 class="authorlink"><cite>AbraãoIsvi</cite>说：</h4>
<small class="commentmetadata">添加于<a href="#comment-363838">2013</a>年<a href="#comment-363838">9月10日下午12:47</a> </small>
</div>
<br>
<div style="clear:left"></div>
<p>真好！</p>
</li>
</ol>
</div>
<h2 class="narrowheading">4个引用</h2>
<div class="item" id="pingslist" style="display:none">
<a class="java" href="javascript:void(0);">隐藏ping和引用</a>
<ol class="commentlist">
<li class="" id="comment-353649">
<h4><cite><a href="http://curations.thisismartin.com/2013/07/29/links-reads-for-2013-week-30/" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/curations.thisismartin.com');">2013年第30周的链接和阅读|马丁的每周策展</a></cite> ：</h4>
<small class="commentmetadata">添加于<a href="#comment-353649">2013</a>年<a href="#comment-353649">7月28日下午5:45</a> </small>
</li>
<li class="alt" id="comment-354875">
<h4><cite><a href="http://www.w3c.com.cn/spring-framework-4-0-m2-%e4%b8%ad%e7%9a%84-websocket-%e6%b6%88%e6%81%af%e6%9e%b6%e6%9e%84" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/www.w3c.com.cn');">Spring Framework 4.0 M2中的WebSocket消息架构-新浪App Engine-开发者第2227223个答案</a></cite> ：</h4>
<small class="commentmetadata">添加于<a href="#comment-354875">2013</a>年<a href="#comment-354875">8月2日，下午3:59</a> </small>
</li>
<li class="" id="comment-355054">
<h4><cite><a href="http://370ztech.info/1298.html" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/370ztech.info');">来自世界各地的新闻| blog.springsource.com发表于2013年8月3日</a></cite> ：</h4>
<small class="commentmetadata">添加于<a href="#comment-355054">2013</a>年<a href="#comment-355054">8月3日，上午6:19</a> </small>
</li>
<li class="alt" id="comment-355181">
<h4><cite><a href="http://www.importnew.com/5915.html" rel="external nofollow" class="url" onclick="javascript:urchinTracker('/outbound/www.importnew.com');">SPRING本周快讯（2013-07-30）-ImportNew</a></cite> ：</h4>
<small class="commentmetadata">添加于<a href="#comment-355181">2013</a>年<a href="#comment-355181">8月3日，下午6:54</a> </small>
</li>
</ol>
</div>
</div> </div>
</div>
<div class="clear"></div>
</div></div>
</div>
<style type="text/css">
#footer {
  margin-left: auto;
  margin-right: auto;
  width: 960px;
  height:404px;
  font-family:Arial, sans serif;
}
.footerth {border-bottom: none;color:#ccc;font-size:18px;font-weight:300;padding-bottom:15px;line-height:24px;text-shadow: 0 1px 0 #000}
.footerth a {color:#ccc;text-decoration:none;border-bottom: none;color:#ccc;font-size:18px;font-weight:300;padding-bottom:15px;line-height:24px;text-shadow: 0 1px 0 #000}
.footerth a:hover {text-decoration:underline;border-bottom: none;color:#ccc;font-size:18px;font-weight:300;padding-bottom:15px;line-height:24px;text-shadow: 0 1px 0 #000}
.footerlist {line-height:18px;color:#00bfff;font-size:14px;text-shadow: 0 1px 0 #000}
.footerlist a {color:#00bfff;text-decoration:none;text-shadow: 0 1px 0 #000}
.footerlist a:hover {text-decoration:underline;text-shadow: 0 1px 0 #000}
.copyright {font-size:11px;color:#ccc;line-height:38px;text-shadow: 0 1px 0 #000}
.copyright a {color:#00bfff;text-decoration:none;text-shadow: 0 1px 0 #000}
.copyright a:hover {text-decoration:underline;text-shadow: 0 1px 0 #000}

</style>
<div style="background-color:#252525">
<div id="footer">
<p> </p>
<p> </p>
<table>
<tbody><tr valign="top">
<th class="footerth" align="left"><a href="http://www.springsource.com/" target="_blank" style="color:#ccc">SpringSource</a></th>
<th class="footerth" align="left"><a href="http://www.springsource.org/features" style="color:#ccc" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">特征</a></th>
<th class="footerth" align="left"><a href="http://www.springsource.org/get-started" style="color:#ccc" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">开始使用</a></th>
<th class="footerth" align="left"><a href="http://www.springsource.org/get-involved" style="color:#ccc" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">参与其中</a></th>
<th class="footerth" align="left"><a href="http://www.springsource.org/projects" style="color:#ccc" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">专案</a></th>
</tr>
<tr>
<td valign="top" width="195px">
<span class="footerlist">
<a href="http://www.springsource.org/about" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">关于我们</a><br>
<a href="http://blog.springsource.com/" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">我们的博客</a><br>
<a href="http://www.springsource.com/customers" target="_blank">我们的顾客</a><br>
<a href="http://www.springsource.org/news-events" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">最新新闻和事件</a><br>
<a href="https://www.vmware.com/jobs" target="_blank">SpringSource职位</a>  <a href="https://www.vmware.com/jobs/" target="_blank"><img src="WebSocketBlogPost_files/ICO_PopUp-NewWindow.html"></a><br>
<a href="http://www.springsource.org/consulting" target="_blank">咨询服务</a><br>
<a href="http://www.springsource.com/contact" target="_blank">联系我们</a><br>
<a href="http://www.springsource.com/newsevents/newsletter-registration" target="_blank">订阅新闻通讯</a><br>
</span>
<p> </p>
<a href="http://www.springsource.com/newsevents/newsletter-registration" target="_blank">
<img src="WebSocketBlogPost_files/button_home_subscribe.html"></a>
</td>
<td valign="top" width="140px">
<span class="footerlist">
<a href="http://www.springsource.org/features/modern-web" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">现代网络</a><br>
<a href="http://www.springsource.org/features/data-access" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">资料存取</a><br>
<a href="http://www.springsource.org/features/integration" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">积分</a><br>
<a href="http://www.springsource.org/features/mobile" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">移动</a><br>
<a href="http://www.springsource.org/features/social" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">社会的</a><br>
<a href="http://www.springsource.org/features/security" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">安全</a><br>
<a href="http://www.springsource.org/features/cloud-ready" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">云端就绪</a><br>
</span>
</td>
<td valign="top" width="160px">
<span class="footerlist">
<a href="http://www.springsource.com/products/springsource-tool-suite-download" target="_blank">获取工具包（STS）</a> <br>
<a href="http://www.springsource.org/tutorials" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">讲解</a> <br>
<a href="http://www.springsource.org/samples" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">代码样例</a> <br>
<a href="http://www.springsource.org/documentation" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">文献资料</a> <br>
<a href="http://forum.springsource.org/" onclick="javascript:urchinTracker('/outbound/forum.springsource.org');">论坛</a> <br>
<a href="http://www.springsource.com/training" target="_blank">训练</a><br>
<a href="http://www.springsource.org/downloads" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">资料下载</a><br>
</span>
</td>
<td valign="top" width="156px">
<span class="footerlist">
<a href="http://forum.springsource.org/" onclick="javascript:urchinTracker('/outbound/forum.springsource.org');">讨论区</a><br>
<a href="http://jira.springframework.org/" target="_blank">问题追踪器</a><br>
<a href="https://github.com/SpringSource" target="_blank">源存储库</a>  <a href="https://github.com/SpringSource" target="_blank"><img src="WebSocketBlogPost_files/ICO_PopUp-NewWindow.html"></a><br>
</span>
</td>
<td valign="top" width="140px">
<span class="footerlist">
<a href="http://www.springsource.org/spring-amqp" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">春季AMQP</a><br>
<a href="http://www.springsource.org/spring-android" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">Android版Spring</a><br>
<a href="http://www.springsource.org/spring-batch" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">春季批</a><br>
<a href="http://www.springsource.org/spring-data" onclick="javascript:urchinTracker('/outbound/www.springsource.org');"> Spring Data </a><br>
<a href="http://www.springsource.org/spring-framework" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">春季框架</a><br>
<a href="http://www.springsource.org/spring-gemfire" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">春季宝石之火</a><br>
<a href="http://www.springsource.org/spring-integration" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">春季整合</a><br>
</span>
</td>
<td valign="top" width="140px">
<span class="footerlist">
<a href="http://www.springsource.org/spring-mobile" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">春季手机</a><br>

<a href="http://www.springsource.org/spring-roo" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">Spring Roo</a><br>
<a href="http://www.springsource.org/spring-security" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">春季安全</a><br>
<a href="http://www.springsource.org/spring-social" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">春季社交</a><br>
<a href="http://www.springsource.org/spring-web-flow" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">Spring Web Flow</a><br>
<a href="http://www.springsource.org/spring-web-services" onclick="javascript:urchinTracker('/outbound/www.springsource.org');"> Spring Web Services </a><br>
<a href="http://www.springsource.org/spring-xd" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">春季XD</a><br>
</span>
</td>
</tr>
</tbody></table>
<p> </p>
<div style="background-color:#1e1e1e;width:952">
<center>
<p class="copyright">
<a href="http://blog.springsource.com/wp-admin" style="color:#fff" onclick="javascript:urchinTracker('/outbound/blog.springsource.com');">©</a> <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">

var d = new Date();
document.write(d.getFullYear());

</script>2013 GoPivotal，Inc.保留所有权利。
<a href="http://gopivotal.com/terms-of-use" target="_blank">使用条款</a> ， <a href="http://www.gopivotal.com/privacy-policy" target="_blank">隐私权</a>和<a href="http://www.springsource.org/trademark_standards" onclick="javascript:urchinTracker('/outbound/www.springsource.org');">商标标准</a>
</p>
</center>
</div>
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('625-IUJ-009');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<p> </p>
</div>
</div>





<script type="text/javascript" src="WebSocketBlogPost_files/shCore.js"></script>
<script type="text/javascript" src="WebSocketBlogPost_files/shBrushPlain.js"></script>
<script type="text/javascript" src="WebSocketBlogPost_files/shBrushJScript.js"></script>
<script type="text/javascript" src="WebSocketBlogPost_files/shBrushJava.js"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://blog.springsource.org/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shCore.css?ver=2.1.364";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://blog.springsource.org/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/styles/shThemeDefault.css?ver=2.1.364";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.clipboardSwf = 'http://blog.springsource.org/wp-content/plugins/syntaxhighlighter/syntaxhighlighter2/scripts/clipboard.swf';
	SyntaxHighlighter.config.strings.expandSource = 'show source';
	SyntaxHighlighter.config.strings.viewSource = 'view source';
	SyntaxHighlighter.config.strings.copyToClipboard = 'copy to clipboard';
	SyntaxHighlighter.config.strings.copyToClipboardConfirmation = 'The code is in your clipboard now';
	SyntaxHighlighter.config.strings.print = 'print';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
	SyntaxHighlighter.defaults['pad-line-numbers'] = true;
	SyntaxHighlighter.defaults['wrap-lines'] = false;
	SyntaxHighlighter.all();
</script>
<script src="WebSocketBlogPost_files/e-201339.js" type="text/javascript"></script>
<script type="text/javascript">
st_go({blog:'18565077',v:'ext',post:'13986'});
var load_cmc = function(){linktracker_init(18565077,13986,2);};
if ( typeof addLoadEvent != 'undefined' ) addLoadEvent(load_cmc);
else load_cmc();
</script>

</body></html>