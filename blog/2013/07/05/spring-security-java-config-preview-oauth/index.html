<html dir="ltr" data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>Spring Security Java配置预览：OAuth</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>System.config({baseURL: "/b92013b"});</script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>System.import('app/main.js')</script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Spring Security Java Config Preview: OAuth">
<meta name="twitter:description" content="<p>This is the fourth post in my <a href=" http: ="" blog.springsource.org 2013 07 02="" spring-security-java-config-preview-introduction="" ="="></meta>five <a href=" 03 spring-security-java-config-preview-web-security "></head><body dir="ltr">part <a href="http://blog.springsource.org/2013/07/04/spring-security-java-config-preview-method-security/">blog</a> series that introduces Spring Security Java configuration. In this post, we will discuss how Spring Security Java configuration can be extended by walking through Spring Security OAuth Java configuration support.
<h3><a href="#proof-of-concept" class="anchor" name="proof-of-concept"></a>Proof of Concept</h3>
<p>While the Spring Security Java configuration works well for very basic configuration, it is just a proof of concept. We have not ensured that all the functionality available in the XML namespace is present within its Java configuration support. It was important to ensure that Spring Security’s Java configuration would work well with the Spring extensions. However, we did not want to wait until we implemented all the configuration functionality in the extensions before releasing Spring Security Java config. In the future, we plan to solidify the Spring Security OAuth Java configuration but for now it is more of a proof of concept than a complete solution.</p>
">
<meta name="twitter:creator" content="@rob_winch">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/30ed046efb35c67d4c055dab109b8933?s=200">

<meta property="og:title" content="Spring Security Java Config Preview: OAuth">
<meta property="og:image" content="https://gravatar.com/avatar/30ed046efb35c67d4c055dab109b8933?s=200">
<meta property="og:description" content="<p>This is the fourth post in my <a href=" http: ="" blog.springsource.org 2013 07 02="" spring-security-java-config-preview-introduction="" ="="></meta>five <a href=" 03 spring-security-java-config-preview-web-security ">part <a href="http://blog.springsource.org/2013/07/04/spring-security-java-config-preview-method-security/">blog</a> series that introduces Spring Security Java configuration. In this post, we will discuss how Spring Security Java configuration can be extended by walking through Spring Security OAuth Java configuration support.
<h3><a href="#proof-of-concept" class="anchor" name="proof-of-concept"></a>Proof of Concept</h3>
<p>While the Spring Security Java configuration works well for very basic configuration, it is just a proof of concept. We have not ensured that all the functionality available in the XML namespace is present within its Java configuration support. It was important to ensure that Spring Security’s Java configuration would work well with the Spring extensions. However, we did not want to wait until we implemented all the configuration functionality in the extensions before releasing Spring Security Java config. In the future, we plan to solidify the Spring Security OAuth Java configuration but for now it is more of a proof of concept than a complete solution.</p>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2013-07-05 13:13:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">// Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }</script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Security Java配置预览：OAuth</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/30ed046efb35c67d4c055dab109b8933?s=20&d=mm"> <a class="author" rel="author" href="/team/rwinch">罗伯·温奇</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2013-07-05 13:13:00.0">2013年7月5日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2013/07/05/spring-security-java-config-preview-oauth#disqus_thread" data-disqus-identifier="528">
</a></div>
</div>
</header>
<div class="blog--post"><p>这是我的<a href="http://blog.springsource.org/2013/07/02/spring-security-java-config-preview-introduction/">五个</a> <a href="http://blog.springsource.org/2013/07/03/spring-security-java-config-preview-web-security/">部分的</a> <a href="http://blog.springsource.org/2013/07/04/spring-security-java-config-preview-method-security/">博客</a>系列中的第四篇文章，介绍了Spring Security Java配置。在本文中，我们将讨论如何通过Spring Security OAuth Java配置支持扩展Spring Security Java配置。</p><h3><a href="#proof-of-concept" class="anchor" name="proof-of-concept"></a>概念验证</h3><p>虽然Spring Security Java配置对于非常基本的配置非常有效，但这只是概念上的证明。我们尚未确保XML命名空间中的所有可用功能都在其Java配置支持内。确保Spring Security的Java配置与Spring扩展一起使用非常重要。但是，我们不想等到在发布Spring Security Java配置之前在扩展中实现了所有配置功能。将来，我们计划巩固Spring Security OAuth Java配置，但就目前而言，它更多是概念验证，而不是完整的解决方案。</p><h3><a href="#hellooauth2serverconfiguration" class="anchor" name="hellooauth2serverconfiguration"></a> HelloOAuth2ServerConfiguration</h3><p>Spring Security的OAuth Java配置支持基本的OAuth 2服务器配置。最简单的形式如下：</p>
<pre><code class="prettyprint java"><br>@Configuration
@EnableWebSecurity
public class HelloOAuth2ServerConfiguration 
   extends OAuth2ServerConfigurerAdapter {
    private static final String RESOURCE_ID = "photos";

    
  @Autowired
  public void registerGlobal(AuthenticationManagerBuilder auth) throws Exception {
      auth
            .apply(new InMemoryClientDetailsServiceConfigurer())
                .withClient("my-client")
                    .resourceIds(RESOURCE_ID)
                    .authorizedGrantTypes("authorization_code","implicit")
                    .authorities("ROLE_USER")
                    .scopes("read","write")
                    .secret("secret");
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeUrls()
                .anyRequest().authenticated()
                .and()
            .apply(new OAuth2ServerConfigurer())
                .resourceId(RESOURCE_ID);
    }
}
</code></pre><p>通过此配置，我们现在能够处理OAuth请求。但是，它有一些局限性，在许多情况下都行不通：</p>
<ul>
<li>如果用户正在使用OAuth服务器批准请求，我们仍然需要一个处理“ / oauth / confirm_access”的控制器</li>
<li>除了OAuth客户端外，无法与用户进行身份验证，这意味着用户无法确认访问权限</li>
<li>授权映射为要进行身份验证，这充其量只是幼稚的授权实现</li>
</ul><h3><a href="#securityconfigurer" class="anchor" name="securityconfigurer"></a>安全配置器</h3><p>抛开这些问题，让我们看看正在发生的事情。OAuth2ServerConfigurer是SecurityConfigurer的实例。实施SecurityConfigurer时，建议扩展SecurityConfigurerAdapter，它是SecurityConfigurer的基本实现。</p><p>通过允许HttpSecurity接受SecurityConfigurer，我们可以添加扩展名（例如OAuth），以更复杂的方式更新HttpSecurity对象。实际上，诸如HttpSecurity.formLogin（）之类的方法也可以使用SecurityConfigurerAdapter实现来实现。区别在于它们是Spring Security核心模块的一部分，因此有一些便捷的方法可以为我们执行apply（SecurityConfigurerAdapter）。</p><p>我们不仅可以将SecurityConfigurer应用于HttpSecurity对象，还可以将SecurityConfigurer应用于AuthenticationManagerBuilder。InMemoryClientDetailsServiceConfigurer对此进行了说明。这意味着身份验证机制也可以轻松扩展。</p><p>这对您意味着什么？假设您有一个更复杂的安全性配置，并希望在整个公司中共享它。您可以允许工程师将配置复制粘贴到任何地方。另外，您可以创建自己的SecurityConfigurerAdapter实现，使开发人员可以专注于公司的自定义DSL。</p><h3><a href="#additional-oauth-samples" class="anchor" name="additional-oauth-samples"></a>其他OAuth样本</h3><p>我们提供的样本配置非常简单，但是没有说明在更实际的情况下该怎么做。在我们认为OAuth支持已得到进一步巩固之前，我们将不会在博客中发布这些内容。但是，如果您想尝试一下，还有其他示例可以帮助您入门。</p><p></p>
<ul>
<li>Spring Security JavaConfig的<a href="https://github.com/SpringSource/spring-security-javaconfig/blob/master/samples/oauth2-sparklr/src/main/java/org/springframework/security/oauth/examples/sparklr/config/OAuth2ServerConfig.java">sparklr应用程序</a></li>
<li><a href="https://github.com/joshlong/the-spring-rest-stack">Spring Rest Stack的</a> -oauth模块</li>
</ul><h3><a href="#feedback-please" class="anchor" name="feedback-please"></a>反馈请</h3><p>如果您遇到错误，有改进的想法等，请随时提出来！我们希望听到您的想法，因此我们可以确保在代码普遍可用之前就正确处理了。尽早尝试新功能是回馈社区的一种好方法。这也可以确保所需的功能可以按您认为的方式显示和运行。</p><p>请将任何问题或功能请求记录到“ Java Config”类别下的<a href="https://jira.springsource.org/browse/SEC">Spring Security JIRA</a> 。登录JIRA后，我们鼓励（但不要求）您在请求请求中提交更改。您可以在<a href="https://github.com/SpringSource/spring-security/blob/master/CONTRIBUTING.md">贡献者指南中</a>阅读更多有关如何执行此操作的信息。</p><p>如果您对如何做有疑问，请使用<a href="http://forum.springsource.org/forumdisplay.php?33-Security">Spring Security论坛</a>或<a href="https://stackoverflow.com/questions/tagged/spring-security">带有Spring-security标签的Stack Overflow</a> （我将对其进行密切监视）。如果您对此博客有特定的评论问题，请随时发表评论。使用适当的工具将有助于使每个人都更容易。</p><h3><a href="#conclusion" class="anchor" name="conclusion"></a>结论</h3><p>Spring Security Java配置使用OAuth支持作为概念证明，以确保可以进行扩展。随着时间的推移，OAuth支持将被巩固为XML配置的替代品。在<a href="http://blog.springsource.org/2013/07/11/spring-security-java-config-preview-readability/">上一篇文章中，</a>我讨论了Spring Security Java Configuration的可读性。</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">var disqus_shortname = 'spring-io';
      var disqus_identifier = 528;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));</script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });</script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>