<html dir="ltr" data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>介绍Spring Data JDBC</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>System.config({baseURL: "/b92013b"});</script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>System.import('app/main.js')</script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Introducing Spring Data JDBC">
<meta name="twitter:description" content="<div class=" paragrap="="> 
 </head><body dir="ltr"><p>With the upcoming Lovelace GA release, we’re going to ship a new Spring Data Module: <a href="https://projects.spring.io/spring-data-jdbc/">Spring Data JDBC</a>.</p> 

<div class="paragraph"> 
 <p>The idea behind Spring Data JDBC is to provide access to relational databases without submitting to the complexities of JPA. JPA offers such features as lazy loading, caching, and dirty tracking. While these are great if you need them, they can actually make thinking about JPA and its behavior harder than it has to be.</p> 
</div>
<div class="paragraph"> 
 <p>Lazy loading might trigger expensive statements when you don’t expect it or it might fail with an exception. Caching can get in your way when you actually want to compare two versions of an entity and being dirty makes it hard to find a single point where all persistence operations pass through.</p> 
</div>
">
<meta name="twitter:creator" content="@jensschauder">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/ba8820c248099c27b09232572871ca40?s=200">

<meta property="og:title" content="Introducing Spring Data JDBC">
<meta property="og:image" content="https://gravatar.com/avatar/ba8820c248099c27b09232572871ca40?s=200">
<meta property="og:description" content="<div class=" paragrap="="> 
 <p>With the upcoming Lovelace GA release, we’re going to ship a new Spring Data Module: <a href="https://projects.spring.io/spring-data-jdbc/">Spring Data JDBC</a>.</p> 

<div class="paragraph"> 
 <p>The idea behind Spring Data JDBC is to provide access to relational databases without submitting to the complexities of JPA. JPA offers such features as lazy loading, caching, and dirty tracking. While these are great if you need them, they can actually make thinking about JPA and its behavior harder than it has to be.</p> 
</div>
<div class="paragraph"> 
 <p>Lazy loading might trigger expensive statements when you don’t expect it or it might fail with an exception. Caching can get in your way when you actually want to compare two versions of an entity and being dirty makes it hard to find a single point where all persistence operations pass through.</p> 
</div>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2018-09-17 07:34:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">// Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }</script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">介绍Spring Data JDBC</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/ba8820c248099c27b09232572871ca40?s=20&d=mm"> <a class="author" rel="author" href="/team/schauder">延斯·肖德（Jens Schauder）</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2018-09-17 07:34:00.0">九月17，2018</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2018/09/17/introducing-spring-data-jdbc#disqus_thread" data-disqus-identifier="3396">
</a></div>
</div>
</header>
<div class="blog--post"><div class="paragraph">
<p>随着即将发布的Lovelace GA发布，我们将发布一个新的Spring Data Module： <a href="https://projects.spring.io/spring-data-jdbc/">Spring Data JDBC</a> 。</p>
</div>
<div class="paragraph">
<p>Spring Data JDBC背后的思想是提供对关系数据库的访问，而不必考虑JPA的复杂性。 JPA提供了诸如延迟加载，缓存和脏跟踪等功能。如果您需要这些功能，虽然它们很棒，但实际上，它们会使思考JPA及其行为的难度比必须的困难。</p>
</div>
<div class="paragraph">
<p>当您不期望延迟加载时，延迟加载可能会触发昂贵的语句，否则可能会因异常而失败。当您实际上想比较一个实体的两个版本时，缓存可能会妨碍您的工作，而肮脏使您很难找到所有持久性操作都经过的单个点。</p>
</div>
<div class="paragraph">
<p>Spring Data JDBC旨在简化模型。不会有缓存，脏跟踪或延迟加载。而是仅在您调用存储库方法时才发出SQL语句。该方法返回的对象在该方法返回之前已完全加载。没有“会话”，也没有实体的代理。所有这些应该使Spring Data JDBC的推理更加容易。</p>
</div>
<div class="paragraph">
<p>当然，这种更简单的方法会导致约束，这些约束将在以后的文章中介绍。此外，它是第一个版本，因此我们有很多功能想要并计划实现，但是我们不得不推迟以尽早获得一些功能。</p>
</div>
<div class="sect1">
<h2 id="let-s-take-a-look-at-a-simple-example"><a class="anchor" href="#let-s-take-a-look-at-a-simple-example"></a>让我们看一个简单的例子。</h2>
<div class="sectionbody">
<div class="paragraph">
<p>首先，我们需要一个实体：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">class Customer {
    @Id
    Long id;
    String firstName;
    LocalDate dob;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，您不需要getter或setter。如果您愿意，可以完全使用它们。确实，唯一的要求是该实体必须具有一个以<code>Id</code>annotation的属性（即<code>@org.springframework.data.annotation.Id</code> ，而不是<code>javax.persistence</code>之一）。</p>
</div>
<div class="paragraph">
<p>接下来，我们需要声明一个存储库。最简单的方法是扩展<code>CrudRepository</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">interface CustomerRepository extends CrudRepository<Customer, Long> {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>最后，我们需要配置<code>ApplicationContext</code>以启用存储库的创建：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Configuration
@EnableJdbcRepositories <b class="conum">(1)</b>
public class CustomerConfig extends JdbcConfiguration { <b class="conum">(2)</b>

    @Bean
    NamedParameterJdbcOperations operations() { <b class="conum">(3)</b>
        return new NamedParameterJdbcTemplate(dataSource());
    }

    @Bean
    PlatformTransactionManager transactionManager() { <b class="conum">(4)</b>
        return new DataSourceTransactionManager(dataSource());
	}

    @Bean
    DataSource dataSource(){ <b class="conum">(5)</b>
        return new EmbeddedDatabaseBuilder()
                .generateUniqueName(true)
                .setType(EmbeddedDatabaseType.HSQL)
                .addScript("create-customer-schema.sql")
                .build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>让我们逐步进行配置。</p>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>EnableJdbcRepositories</code>启用存储库的创建。由于它需要存在一些bean，因此我们需要其余的配置。</p>
</li>
<li>
<p>扩展<code>JdbcConfiguration</code>将一些默认bean添加到<code>ApplicationContext</code> 。您可以覆盖其方法以自定义Spring Data JDBC的某些行为。现在，我们使用默认实现。</p>
</li>
<li>
<p>真正重要的部分是<code>NamedParameterJdbcOperations</code> ，它在内部用于向数据库提交SQL语句。</p>
</li>
<li>
<p>严格来说，交易经理是没有必要的。但是您将在不支持跨越单个语句的事务的情况下工作，而没有人希望这样做，对吗？</p>
</li>
<li>
<p>Spring Data JDBC并不直接使用<code>DataSource</code> ，但是，由于<code>TransactionManager</code>和<code>NamedParameterJdbcOperations</code>需要它，因此将其注册为Bean是确保两者都使用相同实例的简便方法。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>这就是您开始使用它的全部。现在让我们在测试中玩一下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@RunWith(SpringRunner.class)
@Transactional
@ContextConfiguration(classes = CustomerConfig.class)
public class CustomerRepositoryTest {

    @Autowired CustomerRepository customerRepo;

    @Test
    public void createSimpleCustomer() {

        Customer customer = new Customer();
        customer.dob = LocalDate.of(1904, 5, 14);
        customer.firstName = "Albert";

        Customer saved = customerRepo.save(customer);

        assertThat(saved.id).isNotNull();

        saved.firstName = "Hans Albert";

        customerRepo.save(saved);

        Optional<Customer> reloaded = customerRepo.findById(saved.id);

        assertThat(reloaded).isNotEmpty();

        assertThat(reloaded.get().firstName).isEqualTo("Hans Albert");
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="code-query-code-annotation"><a class="anchor" href="#code-query-code-annotation"></a> <code>@Query</code>annotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>仅仅来自<code>CrudRepository</code>的基本CRUD方法可能不会使您<code>CrudRepository</code> 。我们决定推迟查询派生，该流行功能是Spring Data从方法名称派生要使用的查询的流行功能，并将其推迟到更高版本。在此之前，您可以使用简单的<code>@Query</code>annotation在存储库方法上指定查询：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Query("select id, first_name, dob from customer where upper(first_name) like '%' || upper(:name) || '%' ")
List<Customer> findByName(@Param("name") String name);</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，如果使用<code>-parameters</code>标志进行编译，则不需要<code>@Param</code>annotation。</p>
</div>
<div class="paragraph">
<p>如果要执行update或delete语句，可以在方法中添加<code>@Modifying</code>annotation。</p>
</div>
<div class="paragraph">
<p>让我们创建另一个测试以尝试新方法。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Test
public void findByName() {

    Customer customer = new Customer();
    customer.dob = LocalDate.of(1904, 5, 14);
    customer.firstName = "Albert";

    Customer saved = customerRepo.save(customer);

    assertThat(saved.id).isNotNull();

    customer.id= null; <b class="conum">(1)</b>
    customer.firstName = "Bertram";

    customerRepo.save(customer);

    customer.id= null;
    customer.firstName = "Beth";

    customerRepo.save(customer);

    assertThat(customerRepo.findByName("bert")).hasSize(2); <b class="conum">(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>由于Java对象与其对应的行之间的连接只是其<code>Id</code>及其类型，因此将<code>Id</code>设置为<code>null</code>并再次保存将在数据库中创建另一行。</p>
</li>
<li>
<p>我们正在执行不区分大小写的搜索（例如），因此，我们找到“ Albert”和“ Bertram”，但找不到“ Beth”。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="closing-notes"><a class="anchor" href="#closing-notes"></a>结束语</h2>
<div class="sectionbody">
<div class="paragraph">
<p>还有更多关于Spring Data JDBC的知识。继续阅读<a href="https://spring.io/blog/2018/09/24/spring-data-jdbc-references-and-aggregates">Spring Data JDBC参考和聚合</a></p>
</div>
<div class="paragraph">
<p>或者，您可以<a href="https://github.com/spring-projects/spring-data-examples/tree/master/jdbc">查看示例</a> ， <a href="https://docs.spring.io/spring-data/jdbc/docs/current/reference/html/">文档</a> ，当然还有<a href="https://github.com/spring-projects/spring-data-jdbc">源代码</a> 。如有疑问， <a href="https://stackoverflow.com/questions/tagged/spring-data-jdbc">请在StackOverflow上</a>提问。并且，如果您发现错误或想要请求功能， <a href="https://jira.spring.io/projects/DATAJDBC">请创建一个问题</a> 。</p>
</div>
</div>
</div></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">var disqus_shortname = 'spring-io';
      var disqus_identifier = 3396;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));</script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });</script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>