<html dir="ltr" data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>Spring Cloud Function 2.0和Azure函数</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>System.config({baseURL: "/b92013b"});</script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>System.import('app/main.js')</script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Spring Cloud Function 2.0 and Azure Functions">
<meta name="twitter:description" content="<div class=" paragrap="="> 
 </head><body dir="ltr"><p><a href="https://github.com/spring-cloud/spring-cloud-function">Spring Cloud Function</a> has had support for Microsoft <a href="https://azure.microsoft.com/en-gb/services/functions">Azure Functions</a> since version 1.0, but in the latest 2.0 releases (still in milestone phase) we decided to change the programming model a bit. This article describes what the changes mean for users, and provides a bit of background behind the shift. We in the Spring team had a lot of fun working on this and collaborating with the folks at Microsoft to get the best blend of the two technologies for our users.</p> 

<h1 id="azure-functions-for-java" class="sect0"><a class="anchor" href="#azure-functions-for-java"></a>Azure Functions for Java</h1>
<div class="paragraph"> 
 <p>Microsoft has had Java support in Azure Functions for a while, and it enables developers to easily write and deploy Java code that connects in a serverless way to a wide range of platform services (events, databases, storage, HTTP gateways, etc.) in Azure. It comes with an annotation-based programming model that puts the function implementations in Java methods. So you write a method and annotation it with <code>@FunctionName</code>, and it becomes an Azure Function. There is a rich set of tools based on a Maven plugin (currently) that drives the Azure command line and can be used to build a function, run and debug it locally and deploy it to the cloud. There is a <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-first-java-maven">Quickstart Guide</a> on the Azure website which will help you get all the pre-requisites installed and working, and there is more detailed documentation about how Azure Functions works in the <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-reference-java">Developer’s Guide</a>.</p> 
</div>
">
<meta name="twitter:creator" content="@david_syer">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=200">

<meta property="og:title" content="Spring Cloud Function 2.0 and Azure Functions">
<meta property="og:image" content="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=200">
<meta property="og:description" content="<div class=" paragrap="="> 
 <p><a href="https://github.com/spring-cloud/spring-cloud-function">Spring Cloud Function</a> has had support for Microsoft <a href="https://azure.microsoft.com/en-gb/services/functions">Azure Functions</a> since version 1.0, but in the latest 2.0 releases (still in milestone phase) we decided to change the programming model a bit. This article describes what the changes mean for users, and provides a bit of background behind the shift. We in the Spring team had a lot of fun working on this and collaborating with the folks at Microsoft to get the best blend of the two technologies for our users.</p> 

<h1 id="azure-functions-for-java" class="sect0"><a class="anchor" href="#azure-functions-for-java"></a>Azure Functions for Java</h1>
<div class="paragraph"> 
 <p>Microsoft has had Java support in Azure Functions for a while, and it enables developers to easily write and deploy Java code that connects in a serverless way to a wide range of platform services (events, databases, storage, HTTP gateways, etc.) in Azure. It comes with an annotation-based programming model that puts the function implementations in Java methods. So you write a method and annotation it with <code>@FunctionName</code>, and it becomes an Azure Function. There is a rich set of tools based on a Maven plugin (currently) that drives the Azure command line and can be used to build a function, run and debug it locally and deploy it to the cloud. There is a <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-first-java-maven">Quickstart Guide</a> on the Azure website which will help you get all the pre-requisites installed and working, and there is more detailed documentation about how Azure Functions works in the <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-reference-java">Developer’s Guide</a>.</p> 
</div>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2018-09-25 15:33:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">// Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }</script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Cloud Function 2.0和Azure函数</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=20&d=mm"> <a class="author" rel="author" href="/team/dsyer">戴夫·瑟</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2018-09-25 15:33:00.0">九月25，2018</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2018/09/25/spring-cloud-function-2-0-and-azure-functions#disqus_thread" data-disqus-identifier="3416">
</a></div>
</div>
</header>
<div class="blog--post"><div class="paragraph">
<p><a href="https://github.com/spring-cloud/spring-cloud-function">Spring Cloud Function</a>从1.0版开始就支持Microsoft <a href="https://azure.microsoft.com/en-gb/services/functions">Azure Functions</a> ，但是在最新的2.0版本中（仍处于里程碑阶段），我们决定对编程模型进行一些更改。本文介绍了这些更改对用户而言意味着什么，并提供了此转变的背景知识。 Spring团队中的工作很有趣，并且与Microsoft的人员合作，为用户提供了两种技术的最佳结合。</p>
</div>
<h1 id="azure-functions-for-java" class="sect0"><a class="anchor" href="#azure-functions-for-java"></a> Java的Azure函数</h1>
<div class="paragraph">
<p>微软已经在Azure Functions中支持Java了一段时间，它使开发人员可以轻松地编写和部署Java代码，这些Java代码以无服务器的方式连接到Windows中的各种平台服务（事件，数据库，存储，HTTP网关等）。 Azure。它带有基于注释的编程模型，该模型将函数实现放入Java方法中。因此，您编写了一个方法并使用<code>@FunctionName</code>对其进行注释，该方法将成为Azure函数。目前有很多基于Maven插件的工具，这些工具可驱动Azure命令行，并可用于构建功能，在本地运行和调试并将其部署到云中。Azure网站上有一个<a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-first-java-maven">快速入门指南</a> ，可以帮助您安装和运行所有必备组件，并且《 <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-reference-java">开发人员指南》中</a>有关于Azure功能如何工作的更详细的文档。</p>
</div>
<div class="paragraph">
<p>注释还将功能方法参数和返回类型与部署时使用的服务联系在一起。例如，如果要在部署时绑定到HTTP网关，请使用<code>@HttpTrigger</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@FunctionName("uppercase")
public Bar execute(
    @HttpTrigger(name = "req", methods = { HttpMethod.GET, HttpMethod.POST },
        authLevel = AuthorizationLevel.ANONYMOUS) Foo foo,
    ExecutionContext context) {
  return new Bar(foo.getValue());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，我们接受传入的HTTP POST请求，Azure将其主体绑定到类型为<code>Foo</code>的POJO。我们将<code>Foo</code>转换为<code>Bar</code>然后将其返回到HTTP响应中的调用方。</p>
</div>
<div class="paragraph">
<p>HTTP触发器是Azure Functions中最受欢迎的前5种集成，但基于事件的触发器和基于存储或基于数据库的触发器则更为流行。完整列表可在“ <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings">触发器和绑定”</a>文档中找到-有一个表，您可以在其中单击特定的绑定或触发器，并带您到参考页，在该页上有所有语言（包括Java）的代码示例。</p>
</div>
<div class="paragraph">
<p>这是另一个使用Azure Event Hub作为输入并使用Cosmos DB作为输出的示例。这个例子<a href="https://github.com/dsyer/azure-docs">在github中</a> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@FunctionName("uppercase")
public Bar execute(
  @EventHubTrigger(name = "data", eventHubName = "events",
        connection = "TRANSACTIONS_EVENT_HUB_CONNECTION_STRING")
    Foo data,
    @CosmosDBOutput(name = "document", databaseName = "inventory",
        collectionName = "messages",
        connectionStringSetting = "PRODUCT_ITEMS_DOCUMENTDB_CONNECTION_STRING",
        createIfNotExists = true)
    OutputBinding<Bar> document,
    final ExecutionContext context) {
  return document.setValue(new Bar(foo.getValue()));
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">注意</div>
</td>
<td class="content">如果传入的JSON无法转换为函数输入类型（在这种情况下为<code>Foo</code> ），您将看到Azure失败，并出现令人困惑的<code>no such method</code>错误。如果看到可以将<code>@FunctionName</code>方法更改为<code>String</code>输入并查看数据，以确保该数据可绑定到所需的输入类型。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>annotation通过对功能部署中配置的环境变量的间接传输来携带连接凭证信息。通过Azure Functions Maven插件在生成<code>pom.xml</code>进行所有配置。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml"><plugin>
  <groupId>com.microsoft.azure</groupId>
  <artifactId>azure-functions-maven-plugin</artifactId>
  <configuration>
    <resourceGroup>${functionResourceGroup}</resourceGroup>
    <appName>${functionAppName}</appName>
    <region>${functionAppRegion}</region>
    <appSettings>
            <property>
              <name>FUNCTIONS_EXTENSION_VERSION</name>
              <value>beta</value>
            </property>
            <property>
              <name>TRANSACTIONS_EVENT_HUB_CONNECTION_STRING</name>
            <value>${TRANSACTIONS_EVENT_HUB_CONNECTION_STRING}</value>
            </property>
            <property>
              <name>PRODUCT_ITEMS_DOCUMENTDB_CONNECTION_STRING</name>
              <value>${PRODUCT_ITEMS_DOCUMENTDB_CONNECTION_STRING}</value>
            </property>
            <property>
              <name>MSDEPLOY_RENAME_LOCKED_FILES</name>
              <value>1</value>
            </property>
    </appSettings>
  </configuration>
  <executions>
    <execution>
            <id>package-functions</id>
            <goals>
              <goal>package</goal>
            </goals>
    </execution>
  </executions>
</plugin></code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，环境变量名称将插件配置链接到函数绑定声明。例如， <code>@EventHubTrigger</code>具有一个<code>connection</code>属性，该属性将在运行时从<code>TRANSACTIONS_EVENT_HUB_CONNECTION_STRING</code>环境变量填充。插件使用具有相同名称的本地环境变量（请注意<code>${}</code>占位符）来远程配置它，开发人员或CI进程负责在运行时进行设置。</p>
</div>
<div class="paragraph">
<p>您自己的个人连接字符串是机密，可以在<a href="https://portal.azure.com">Azure仪表板中</a>找到-单击相关资源时，通常会有一个“ <code>Connection Strings</code>链接（或类似链接），您可以将其复制并粘贴到本地进程中（例如，在您在本地运行，但不签到源代码管理。例如，您可以使用如下所示的<code>setup-env.sh</code>脚本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>export PRODUCT_ITEMS_DOCUMENTDB_CONNECTION_STRING="AccountEndpoint=https://..."
export TRANSACTIONS_EVENT_HUB_CONNECTION_STRING="Endpoint=sb://..."</code></pre>
</div>
</div>
<div class="paragraph">
<p>并在终端会话开始时提供一次。</p>
</div>
<div class="paragraph">
<p>该示例的<code>pom.xml</code>中还有其他一些插件声明。它们都很重要，但基本上都是样板-您应该能够复制它们并在所有Azure Function应用程序中重复使用相同的配置。</p>
</div>
<h1 id="spring-cloud-function" class="sect0"><a class="anchor" href="#spring-cloud-function"></a>弹簧云功能</h1>
<div class="paragraph">
<p>当应用程序开发人员声明类型为<code>java.util.Function</code></p><code>java.util.Function</code></div><code>java.util.Function</code></div><code>java.util.Function</code></div><code>java.util.Function</code></article><code>java.util.Function</code></div><code>java.util.Function</code></div><code>java.util.Function</code></div><code>java.util.Function</code></div><code>java.util.Function</code></body></html>