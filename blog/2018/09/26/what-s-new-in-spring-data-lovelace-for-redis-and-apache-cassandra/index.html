<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>What&#39;s new in Spring Data Lovelace for Redis and Apache Cassandra?</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="What&#39;s new in Spring Data Lovelace for Redis and Apache Cassandra?" />
<meta name="twitter:description" content="&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;This blog post explains the new and noteworthy in &lt;a href=&quot;https://github.com/spring-projects/spring-data-commons/wiki/Release-Train-Lovelace&quot;&gt;Spring Data Lovelace&lt;/a&gt; for &lt;a href=&quot;https://spring.io/blog/2018/09/26/what-s-new-in-spring-data-lovelace-for-redis-and-apache-cassandra#cassandra&quot;&gt;Apache Cassandra&lt;/a&gt; and &lt;a href=&quot;https://spring.io/blog/2018/09/26/what-s-new-in-spring-data-lovelace-for-redis-and-apache-cassandra#redis&quot;&gt;Redis&lt;/a&gt;. Make sure to also check out the blog post on &lt;a href=&quot;https://spring.io/blog/2018/09/27/what-s-new-in-spring-data-lovelace-for-mongodb&quot;&gt;What’s new in Spring Data Lovelace for MongoDB?&lt;/a&gt;.&lt;/p&gt; 
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;With Spring Data Lovelace just released in its generally available version last week, it’s time to have a brief walk through the new feature’s we have added. The release train is pretty packed with features.&lt;/p&gt; 
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;In this blog post, I’ll be covering &lt;a href=&quot;https://spring.io/blog/2018/09/26/what-s-new-in-spring-data-lovelace-for-redis-and-apache-cassandra#cassandra&quot;&gt;Apache Cassandra&lt;/a&gt; and &lt;a href=&quot;https://spring.io/blog/2018/09/26/what-s-new-in-spring-data-lovelace-for-redis-and-apache-cassandra#redis&quot;&gt;Redis&lt;/a&gt;.&lt;/p&gt; 
&lt;/div&gt;
&lt;h1 id=&quot;cassandra&quot; class=&quot;sect0&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#cassandra&quot;&gt;&lt;/a&gt;Spring Data for Apache Cassandra&lt;/h1&gt;
&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;With this release, we refined data access with Cassandra-specific types, introduced support for lifecycle events, improved the programming experience for both Java and Kotlin usage and included various other refinements. Let us take a look at how this release can help improve your data access to Cassandra.&lt;/p&gt; 
&lt;/div&gt;
" />
<meta name="twitter:creator" content="@mp911de" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/6494a9d91e9ffef9adc8253257f1b35e?s=200" />

<meta property="og:title" content="What&#39;s new in Spring Data Lovelace for Redis and Apache Cassandra?" />
<meta property="og:image" content="https://gravatar.com/avatar/6494a9d91e9ffef9adc8253257f1b35e?s=200" />
<meta property="og:description" content="&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;This blog post explains the new and noteworthy in &lt;a href=&quot;https://github.com/spring-projects/spring-data-commons/wiki/Release-Train-Lovelace&quot;&gt;Spring Data Lovelace&lt;/a&gt; for &lt;a href=&quot;https://spring.io/blog/2018/09/26/what-s-new-in-spring-data-lovelace-for-redis-and-apache-cassandra#cassandra&quot;&gt;Apache Cassandra&lt;/a&gt; and &lt;a href=&quot;https://spring.io/blog/2018/09/26/what-s-new-in-spring-data-lovelace-for-redis-and-apache-cassandra#redis&quot;&gt;Redis&lt;/a&gt;. Make sure to also check out the blog post on &lt;a href=&quot;https://spring.io/blog/2018/09/27/what-s-new-in-spring-data-lovelace-for-mongodb&quot;&gt;What’s new in Spring Data Lovelace for MongoDB?&lt;/a&gt;.&lt;/p&gt; 
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;With Spring Data Lovelace just released in its generally available version last week, it’s time to have a brief walk through the new feature’s we have added. The release train is pretty packed with features.&lt;/p&gt; 
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;In this blog post, I’ll be covering &lt;a href=&quot;https://spring.io/blog/2018/09/26/what-s-new-in-spring-data-lovelace-for-redis-and-apache-cassandra#cassandra&quot;&gt;Apache Cassandra&lt;/a&gt; and &lt;a href=&quot;https://spring.io/blog/2018/09/26/what-s-new-in-spring-data-lovelace-for-redis-and-apache-cassandra#redis&quot;&gt;Redis&lt;/a&gt;.&lt;/p&gt; 
&lt;/div&gt;
&lt;h1 id=&quot;cassandra&quot; class=&quot;sect0&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#cassandra&quot;&gt;&lt;/a&gt;Spring Data for Apache Cassandra&lt;/h1&gt;
&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;With this release, we refined data access with Cassandra-specific types, introduced support for lifecycle events, improved the programming experience for both Java and Kotlin usage and included various other refinements. Let us take a look at how this release can help improve your data access to Cassandra.&lt;/p&gt; 
&lt;/div&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2018-09-26 12:28:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">What&#39;s new in Spring Data Lovelace for Redis and Apache Cassandra?</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/6494a9d91e9ffef9adc8253257f1b35e?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/mp911de">Mark Paluch</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2018-09-26 12:28:00.0">September 26, 2018</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="3408" href="/blog/2018/09/26/what-s-new-in-spring-data-lovelace-for-redis-and-apache-cassandra#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><div class="paragraph">
<p>This blog post explains the new and noteworthy in <a href="https://github.com/spring-projects/spring-data-commons/wiki/Release-Train-Lovelace">Spring Data Lovelace</a> for <a href="https://spring.io/blog/2018/09/26/what-s-new-in-spring-data-lovelace-for-redis-and-apache-cassandra#cassandra">Apache Cassandra</a> and <a href="https://spring.io/blog/2018/09/26/what-s-new-in-spring-data-lovelace-for-redis-and-apache-cassandra#redis">Redis</a>.
Make sure to also check out the blog post on <a href="https://spring.io/blog/2018/09/27/what-s-new-in-spring-data-lovelace-for-mongodb">What&#8217;s new in Spring Data Lovelace for MongoDB?</a>.</p>
</div>
<div class="paragraph">
<p>With Spring Data Lovelace just released in its generally available version last week, it&#8217;s time to have a brief walk through the new feature&#8217;s we have added.
The release train is pretty packed with features.</p>
</div>
<div class="paragraph">
<p>In this blog post, I&#8217;ll be covering <a href="https://spring.io/blog/2018/09/26/what-s-new-in-spring-data-lovelace-for-redis-and-apache-cassandra#cassandra">Apache Cassandra</a> and <a href="https://spring.io/blog/2018/09/26/what-s-new-in-spring-data-lovelace-for-redis-and-apache-cassandra#redis">Redis</a>.</p>
</div>
<h1 id="cassandra" class="sect0"><a class="anchor" href="#cassandra"></a>Spring Data for Apache Cassandra</h1>
<div class="paragraph">
<p>With this release, we refined data access with Cassandra-specific types, introduced support for lifecycle events, improved the programming experience for both Java and Kotlin usage and included various other refinements. Let us take a look at how this release can help improve your data access to Cassandra.</p>
</div>
<div class="sect1">
<h2 id="map-and-tuple-refinements"><a class="anchor" href="#map-and-tuple-refinements"></a>Map and Tuple Refinements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Map and Tuple data types are specific types in Cassandra that allow storing multiple values within a single column. Previously, we supported both types in their raw form in mapped entities, which means that you could use only maps with primitive keys and values. For tuples, you could only use <code>TupleValue</code>, the raw Cassandra driver type, without further mapping or even schema support.</p>
</div>
<div class="paragraph">
<p>With this release, we added mapping and conversion support for Map- and Tuple-typed properties. Maps can now contain non-primitive keys and values, and the conversion layer applies potentially registered converters.</p>
</div>
<div class="paragraph">
<p>Consider the following types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@UserDefinedType
class Manufacturer {

  String name;

  // getters/setters omitted
}

@Table
class Supplier {

  Map&lt;Manufacturer, List&lt;String&gt;&gt; acceptedCurrencies;

  // getters/setters omitted
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Manufacturer</code> is a mapped user-defined type that is used by the map as a key. Values are represented as <code>List</code> of strings. We can now refactor the code to use a proper <code>Currency</code> type (such as <code>java.util.Currency</code>) within the list. To do so, we provide converters between <code>String</code> and <code>Currency</code> and register these through <code>CassandraCustomConversions</code>. The following example shows how to do so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">enum StringToCurrencyConverter implements Converter&lt;String, Currency&gt; {
  INSTANCE;

  @Override
  public Currency convert(String source) {
    return Currency.getInstance(source);
  }
}

enum CurrencyToStringConverter implements Converter&lt;Currency, String&gt; {

  INSTANCE;

  @Override
  public String convert(Currency source) {
    return source.getCurrencyCode();
  }
}

@Configuration
class MyCassandraConfiguration {

  public CassandraCustomConversions cassandraCustomConversions() {
    return new CassandraCustomConversions(
      Arrays.asList(StringToCurrencyConverter.INSTANCE, CurrencyToStringConverter.INSTANCE));
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After registering the converters, we can go forward and use <code>Currency</code> within the <code>Supplier</code> type to work with value objects instead of primitives, as the following example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Table
class Supplier {

  Map&lt;Manufacturer, List&lt;Currency&gt;&gt; acceptedCurrencies;

  // getters/setters omitted
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tuples were not really usable with previous versions of Spring Data for Apache Cassandra. Using tuples required direct <code>Row</code> interaction and <code>TupleType</code> retrieval to create appropriate tuple values. Therefore, we decided to provide mapped tuple types, as the following example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Table
class Supplier {

  List&lt;Dependance&gt; dependances;

  // getters/setters omitted
}

@Tuple
class Dependance {

  @Element(0) String address;
  @Element(1) String city;
  @Element(2) Currency currency;

  // getters/setters omitted
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mapped tuples are annotated with <code>@Tuple</code>, and the individual components of a tuple refer (by using <code>@Element(…)</code>) to their ordinal index within the tuple. The converter inspects loaded tuples and maps these onto regular Java classes that are part of your domain model. You no longer need to interact with <code>TupleType</code> and <code>TupleValue</code> directly – although you still can – but you can represent tuple values in a type-safe approach. Mapped tuples benefit from the various mapping-features of the converter and can refer to types that have a custom converter registered.</p>
</div>
<div class="paragraph">
<p>Support for maps and tuples also includes schema generation to rapidly set up a schema by deriving the type from your domain model.</p>
</div>
<div class="paragraph">
<p>See our <a href="https://github.com/spring-projects/spring-data-examples/tree/be17e153049342e7bc7f3d63f93cc221da72dfab/cassandra/example/src/main/java/example/springdata/cassandra/convert">examples for mapped tuples</a> for further details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lifecycle-events"><a class="anchor" href="#lifecycle-events"></a>Lifecycle Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Cassandra mapping framework now includes several <code>org.springframework.context.ApplicationEvent</code> events that your application can respond to by registering special beans in the <code>ApplicationContext</code>. To intercept an object before it goes through the conversion process (which turns your domain object into a <code>Statement</code>), you can register a subclass of <code>AbstractCassandraEventListener</code> that overrides the <code>onBeforeSave</code> method. When the event is dispatched, your listener is called and passed the domain object before it goes into the converter. The following example shows how to use <code>onBeforeSave</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class BeforeConvertListener extends AbstractCassandraEventListener&lt;Person&gt; {
  @Override
  public void onBeforeSave(BeforeSaveEvent&lt;Person&gt; event) {
    // does some auditing manipulation, set timestamps, whatever
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Declaring these beans in your Spring ApplicationContext causes them to be invoked whenever the event is dispatched.</p>
</div>
<div class="paragraph">
<p>The following callback methods are present in <code>AbstractCassandraEventListener</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>onBeforeSave</code>: Called in <code>CassandraTemplate</code> <code>save</code> operations <strong>before</strong> inserting or saving the row in the database.</p>
</li>
<li>
<p><code>onAfterSave</code>: Called in <code>CassandraTemplate</code> <code>save</code> operations <strong>after</strong> inserting or saving the row in the database.</p>
</li>
<li>
<p><code>onBeforeDelete</code>: Called in <code>CassandraTemplate</code> <code>delete</code> operations <strong>before</strong> deleting the row in the database.</p>
</li>
<li>
<p><code>onAfterDelete</code>: Called in <code>CassandraTemplate</code> <code>delete</code> operation <strong>after</strong> deleting the row in the database.</p>
</li>
<li>
<p><code>onAfterLoad</code>: Called in <code>CassandraTemplate</code> <code>select</code> and <code>selectOne</code> methods <strong>after</strong> the row has been retrieved from the database.</p>
</li>
<li>
<p><code>onAfterConvert</code>: Called in <code>CassandraTemplate</code> <code>select</code> and <code>selectOne</code> methods <strong>after</strong> the row that has been retrieved from the database was converted to a POJO.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lifecycle events are only emitted for root level types. Complex types used as properties within an entity root are not subject to event publication.</p>
</div>
<div class="paragraph">
<p>See our <a href="https://github.com/spring-projects/spring-data-examples/blob/be17e153049342e7bc7f3d63f93cc221da72dfab/cassandra/example/src/test/java/example/springdata/cassandra/events/LifecycleEventsTests.java">examples for Lifecycle Events</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kotlin-extensions"><a class="anchor" href="#kotlin-extensions"></a>Kotlin Extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Data exposes methods that accept a target type to either query for or to project results values onto. Kotlin represents classes with its own type (<code>KClass</code>), which can be an obstacle when attempting to obtain a Java Class type.</p>
</div>
<div class="paragraph">
<p>Spring Data for Apache Cassandra ships with extensions that add overloads for methods that accept a type parameter by either using generics or accepting KClass directly, as the following example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">operations.getTableName&lt;Person&gt;()

operations.getTableName(Person::class)

operations.find&lt;Person&gt;().as&lt;Contact&gt;
  .matching(query(where("firstname").isEqualTo("luke"))).all();</code></pre>
</div>
</div>
<div class="paragraph">
<p>See our <a href="https://github.com/spring-projects/spring-data-examples/tree/boot-next/cassandra/kotlin">Cassandra Kotlin usage</a> examples for further details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fluent-template-api"><a class="anchor" href="#fluent-template-api"></a>Fluent Template API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>CassandraOperations</code> interface is one of the central components when it comes to more low-level interaction with Apache Cassandra. It offers a wide range of methods that cover needs from batching and result streaming to CRUD operations. You can find multiple overloads for each method. Most of them cover optional or alternative parts of the API, such as query by CQL, <code>Statement</code>, or query by <code>Query</code>.</p>
</div>
<div class="paragraph">
<p><code>FluentCassandraOperations</code> provides a more narrow interface for the common methods of <code>CassandraOperations</code> and provides a more readable, fluent API. The entry points (<code>insert(…)</code>, <code>query(…)</code>, <code>update(…)</code>, and others) follow a natural naming schema based on the operation to be run. Moving on from the entry point, the API is designed to offer only context-dependent methods that lead to a terminating method that invokes the actual <code>Cassandra</code> counterpart.</p>
</div>
<div class="paragraph">
<p>Consider a query example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">List&lt;Person&gt; all = operations.query(Person.class)
  .inTable("people")
  .all();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This query queries the <code>people</code> table for all rows and maps the result onto the <code>Person</code> type. Omitting <code>inTable(…)</code> derives the table name from the entity type.</p>
</div>
<div class="paragraph">
<p>The next example uses projections and a query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">List&lt;Contact&gt; all = operations.query(Person.class)
  .as(Contact.class)
  .matching(query(where("firstname").is("luke")))
  .all();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This query uses the table onto which the <code>Person</code> type is mapped and projects results (DTO or interface projection) on to <code>Contact</code>. The query itself is mapped by using field names from the <code>Person</code> type.
You can switch between retrieving a single entity and retrieving multiple objects as a <code>List</code> or a <code>Stream</code> through the terminating methods: <code>first()</code>, <code>one()</code>, <code>all()</code>, or <code>stream()</code>.</p>
</div>
<div class="paragraph">
<p>The fluent API is type-safe, and intermediate objects are immutable. You can prepare base parts of your query and continue with a more specific execution, as the following example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">TerminatingSelect&lt;Contact&gt; select = operations.query(Person.class)
  .as(Contact.class)
  .matching(query(where("firstname").is("luke")))

Contact contact = select.first();
long count = select.count();</code></pre>
</div>
</div>
<div class="paragraph">
<p>See our <a href="https://github.com/spring-projects/spring-data-examples/tree/be17e153049342e7bc7f3d63f93cc221da72dfab/cassandra/kotlin">Kotlin example</a> for further details.</p>
</div>
<div class="paragraph">
<p>Several other enhancements have found their way into the Spring Data for Apache Cassandra module so make sure to check out the <a href="https://docs.spring.io/spring-data/cassandra/docs/2.1.0.RELEASE/reference/html/#new-features.2-1-0">new features</a> section in the reference documentation to learn more about reactive slice queries and exists/count projections.</p>
</div>
</div>
</div>
<h1 id="redis" class="sect0"><a class="anchor" href="#redis"></a>Spring Data Redis</h1>
<div class="paragraph">
<p>This release of Spring Data Redis ships with improvements across various themes that did not fit into the 2.0 release. Most of them smooth out the rough edges around Redis cluster usage. The core themes are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connection improvements</p>
</li>
<li>
<p>Refinements for Redis Cluster usage</p>
</li>
<li>
<p>Various improvements in the framework</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="connection-improvements"><a class="anchor" href="#connection-improvements"></a>Connection Improvements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Redis supports various modes of operations: Standalone, Standalone with Replication, Redis Sentinel with or without Replication, Redis Cluster. We have covered Standalone, Redis Sentinel and Redis Cluster modes. The missing pieces so far have been reads from replicas. This release introduces support for Replica reads across the variety of Redis operation modes. The following example shows how to use this new feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">LettuceClientConfiguration clientConfiguration = LettuceClientConfiguration.builder()
  .readFrom(ReadFrom.NEAREST)
  .build();

RedisSentinelConfiguration endpoint = new RedisSentinelConfiguration()
  .master("my-master")
  .sentinel("sentinel-host1", 26379)
  .sentinel("sentinel-host2", 26379);

LettuceConnectionFactory factory = new LettuceConnectionFactory(endpoint, clientConfiguration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specifying <code>ReadFrom</code> lets you select a particular node type when issuing read-only commands, such as <code>GET</code> or <code>SMEMBERS</code>. You can either use one of Lettuce&#8217;s pre-defined settings or create a new <code>ReadFrom</code> strategy. <code>ReadFrom</code> is considered in all setups where replicas are available: Redis Sentinel, Redis Cluster, and static Master/Replica setups, such as AWS ElastiCache, which brings us to the next improvement.</p>
</div>
<div class="paragraph">
<p>You can use AWS ElastiCache or any other static Master/Replica setup (that is, using Redis with one or more dedicated replicas) with Spring Data Redis and Lettuce to read from replica nodes. In previous releases, you were able to use the master node only. Take a look at the following configuration code snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">LettuceClientConfiguration clientConfiguration = LettuceClientConfiguration.builder().readFrom(ReadFrom.NEAREST).build();

RedisStaticMasterSlaveConfiguration endpoint = new RedisStaticMasterSlaveConfiguration("my-master-host", 6379)
  .node("my-replica-host1", 6379)
  .node("my-replica-host2", 6379);

LettuceConnectionFactory factory = new LettuceConnectionFactory(endpoint, clientConfiguration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this cod, we configure <code>LettuceConnectionFactory</code> to use multiple nodes without actually specifying the roles. Lettuce itself determines the role of the individual hosts and uses the nodes according to their roles.</p>
</div>
<div class="paragraph">
<p>The last refinement in this category is the use of local connections through Unix domain sockets. A Unix domain socket or IPC (inter-process communication) socket is a data communications endpoint for exchanging data between processes that run on the same host operating system. As with named pipes, Unix domain sockets support the transmission of a reliable stream of bytes that compares to TCP. Because Unix domain socket communication happens within the kernel only, communication bypasses networking and generally features an improved performance profile.</p>
</div>
<div class="paragraph">
<p>To use Unix domain sockets, you need to use Lettuce and add native extensions for Netty (either <code>netty-transport-native-epoll</code> when running on Linux or <code>netty-transport-native-kqueue</code> when running on MacOS). The following example configures communication with Redis through a socket:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">RedisSocketConfiguration endpoint = new RedisSocketConfiguration("/var/run/redis");

LettuceConnectionFactory factory = new LettuceConnectionFactory(endpoint);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="redis-cluster-refinements"><a class="anchor" href="#redis-cluster-refinements"></a>Redis Cluster Refinements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This release ships with refinements in connection handling for Redis Cluster connections that use the Lettuce driver. Previous versions did not share the underlying Lettuce connection to Redis Cluster, which manifested in performance degradations as new connections always established a new cluster connection. This behavior causes an impact when issuing multiple commands as, each command basically uses a new <code>RedisConnection</code>.</p>
</div>
<div class="paragraph">
<p>By default, native connection sharing is now enabled for Redis Cluster connections. Other usage patterns (such as Redis Standalone) have already been using connection sharing in previous versions. The following example shows how to create a <code>LettuceConnectionFactory</code> with a shared native connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">RedisClusterConfiguration clusterConfiguration = new RedisClusterConfiguration(…);

LettuceConnectionFactory factory = new LettuceConnectionFactory(clusterConfiguration);
factory.setShareNativeConnection(true);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some operations, such as blocking operations, require dedicated connections to not impact other processes that would operate on the same native connection. You can enable pooling for Redis Cluster connections to buffer connection creation if your application heavily relies on blocking Redis commands. Enabling pooling is a client-configuration aspect. With pooling enabled, <code>LettuceConnectionFactory</code> applies pooling to the configured Redis usage scheme. You can use <code>LettucePoolingClientConfiguration</code> as entry-point to enable pooling, as the following example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">LettucePoolingClientConfiguration clientConfiguration = LettucePoolingClientConfiguration.builder().poolConfig(…).build();
RedisClusterConfiguration clusterConfiguration = new RedisClusterConfiguration(…);

LettuceConnectionFactory factory = new LettuceConnectionFactory(clusterConfiguration, clientConfiguration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the introduction of <code>ReadFrom</code> settings and streamlined Cluster connection handling, we can now support Cluster-wide keyspace scanning by using the <code>SCAN</code> command. Behind the scenes, the driver maintains a stateful cursor that lets you iterate over all master/replica nodes that hold keys in a Cluster. Using the connection&#8217;s <code>scan(…)</code> method gives you the same experience as if it was used on a Redis Standalone setup, as the following example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Cursor&lt;byte[]&gt; scan = clusterConnection.keyCommands()
  .scan(ScanOptions.scanOptions().match("foo*").build());
scan.forEachRemaining(key -&gt; …);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keyspace scanning also provides a reactive variant for all Redis operation modes. Calling <code>scan(…)</code> on the reactive Redis Template API returns a <code>Flux</code> of keys. The resulting <code>Flux</code> is backpressure-aware and translates demand into <code>SCAN</code> invocations if there is sufficient demand to scan the whole keyspace. It stops scanning if the demand is satisfied. The following example constructs such a <code>Flux</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Flux&lt;String&gt; scan = redisTemplate.scan(ScanOptions.scanOptions().match("something*").build());</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="redis-repository-improvements"><a class="anchor" href="#redis-repository-improvements"></a>Redis Repository Improvements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This release ships with Query by Example support for Redis repositories. Query by Example is a user-friendly querying technique with a simple interface. It allows dynamic query creation and does not require you to write queries that contain field names. The nature of Query by Example does not require a query language, as the actual query derives from the <code>Example</code> object. You can now define an <code>Example</code> to query for indexed values that are stored in Redis hashes. Redis repositories can implement the <code>QueryByExampleExecutor</code> fragment to inherit Query by Example methods. Take a look at the following snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">interface PersonRepository extends CrudRepository&lt;Person, String&gt;, QueryByExampleExecutor&lt;Person&gt; {
}

PersonRepository repository = …;

Person eddard = new Person("eddard", "stark");
Person tyrion = new Person("tyrion", "lannister");
Person robb = new Person("robb", "stark");
Person jon = new Person("jon", "snow");
Person arya = new Person("arya", "stark");

repository.saveAll(Arrays.asList(eddard, tyrion, robb, jon, arya));

List&lt;Person&gt; result = repository.findAll(Example.of(new Person(null, "stark")));</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code inserts a bunch of <code>Person</code> objects. The <code>Example</code> object defines a probe, with only the last name set. The Query engine creates a query that includes only non-null fields (by default) querying for objects whose <code>lastname</code> is <code>stark</code>.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://github.com/spring-projects/spring-data-examples/blob/be17e153049342e7bc7f3d63f93cc221da72dfab/redis/repositories/src/test/java/example/springdata/redis/repositories/PersonRepositoryTests.java#L156">Query-by-Example sample</a> for further details.</p>
</div>
<div class="paragraph">
<p>Redis repositories now support type aliasing that you can use by annotating your domain classes with <code>@TypeAlias</code>. By default, type hints in Redis use the fully-qualified class name. You can apply aliasing to customize type names and to reduce Redis memory usage.</p>
</div>
<div class="paragraph">
<p>The following example persists an instance of a <code>Person</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.acme;

@TypeAlias("person")
class Person {
  // …
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code causes the type hint (<code>person</code>) to be used instead of <code>com.acme.Person</code>. The corresponding commands that are used to store the entity in Redis are as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">HMSET "person:19315449-cda2-4f5c-b696-9cb8018fa1f9" "_class" "person" "id" "19315449-cda2-4f5c-b696-9cb8018fa1f9"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Several other enhancements have found their way into the Redis module so make sure to check out the <a href="https://docs.spring.io/spring-data/redis/docs/2.1.0.RELEASE/reference/html/#new-in-2.1.0">new features</a> section in the reference documentation to learn more about keyspace scanning, reactive Pub/Sub, and new commands.</p>
</div>
</div>
</div></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 3408;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>