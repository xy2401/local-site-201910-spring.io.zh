<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Sneak peek at Reactor-Core 3.2 with Milestone 1</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Sneak peek at Reactor-Core 3.2 with Milestone 1" />
<meta name="twitter:description" content="&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;Greetings Reactive Spring community!&lt;/p&gt; 
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;While the team is still working heavily on the 3.1 line, we also wanted to give the community a chance to get a sneak peek at whatâ€™s coming for the future 3.2 line.&lt;/p&gt; 
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;In particular, the big goodie slated for 3.2.0.RELEASE is the addition of what weâ€™ve been calling &quot;error mode&quot;, &quot;continue mode&quot; or lately more officially &quot;error strategy&quot;.&lt;/p&gt; 
&lt;/div&gt;
&lt;h1 id=&quot;the-idea&quot; class=&quot;sect0&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#the-idea&quot;&gt;&lt;/a&gt;The idea&lt;/h1&gt;
&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;It is simple, really: what if exceptions in user code that get executed within operators could be recovered from, allowing the sequence to &lt;em&gt;continue&lt;/em&gt;?&lt;/p&gt; 
&lt;/div&gt;
" />
<meta name="twitter:creator" content="@simonbasle" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/056097e00486bcdf172708607f194b1e?s=200" />

<meta property="og:title" content="Sneak peek at Reactor-Core 3.2 with Milestone 1" />
<meta property="og:image" content="https://gravatar.com/avatar/056097e00486bcdf172708607f194b1e?s=200" />
<meta property="og:description" content="&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;Greetings Reactive Spring community!&lt;/p&gt; 
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;While the team is still working heavily on the 3.1 line, we also wanted to give the community a chance to get a sneak peek at whatâ€™s coming for the future 3.2 line.&lt;/p&gt; 
&lt;/div&gt;
&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;In particular, the big goodie slated for 3.2.0.RELEASE is the addition of what weâ€™ve been calling &quot;error mode&quot;, &quot;continue mode&quot; or lately more officially &quot;error strategy&quot;.&lt;/p&gt; 
&lt;/div&gt;
&lt;h1 id=&quot;the-idea&quot; class=&quot;sect0&quot;&gt;&lt;a class=&quot;anchor&quot; href=&quot;#the-idea&quot;&gt;&lt;/a&gt;The idea&lt;/h1&gt;
&lt;div class=&quot;paragraph&quot;&gt; 
 &lt;p&gt;It is simple, really: what if exceptions in user code that get executed within operators could be recovered from, allowing the sequence to &lt;em&gt;continue&lt;/em&gt;?&lt;/p&gt; 
&lt;/div&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2018-01-16 17:00:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category content--title">
<div>Engineering</div>
</div>
<div class="blog-category active content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Sneak peek at Reactor-Core 3.2 with Milestone 1</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon releases"></div>
<a class="category">Releases</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/056097e00486bcdf172708607f194b1e?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/simonbasle">Simon BaslÃ©</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2018-01-16 17:00:00.0">January 16, 2018</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="3137" href="/blog/2018/01/16/sneak-peek-at-reactor-core-3-2-with-milestone-1#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><div class="paragraph">
<p>Greetings Reactive Spring community!</p>
</div>
<div class="paragraph">
<p>While the team is still working heavily on the 3.1 line, we also wanted to give
the community a chance to get a sneak peek at what&#8217;s coming for the future 3.2
line.</p>
</div>
<div class="paragraph">
<p>In particular, the big goodie slated for 3.2.0.RELEASE is the addition of what
we&#8217;ve been calling "error mode", "continue mode" or lately more officially
"error strategy".</p>
</div>
<h1 id="the-idea" class="sect0"><a class="anchor" href="#the-idea"></a>The idea</h1>
<div class="paragraph">
<p>It is simple, really: what if exceptions in user code that get executed within
operators could be recovered from, allowing the sequence to <em>continue</em>?</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take an example, and imagine you have the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public Flux&lt;Integer&gt; divide100By(Flux&lt;Integer&gt; dividers) {
  return dividers.map(div -&gt; 100 / div);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the <code>dividers</code> source emits <code>0</code> at some point, the resulting <code>Flux</code>
would immediately terminate with an <code>onError</code> signal of an <code>ArithmeticException</code>.</p>
</div>
<div class="paragraph">
<p>If the source happens to be, say, <code>Flux.range(0, 10)</code>, there&#8217;s still 9 perfectly
valid values that could have been mapped.</p>
</div>
<div class="paragraph">
<p>How could you make it so that such a transient exception (and only that exception)
gets ignored, and give a chance to further valid values to get processed?</p>
</div>
<h1 id="the-current-workaround" class="sect0"><a class="anchor" href="#the-current-workaround"></a>The current workaround</h1>
<div class="paragraph">
<p>In Reactor 3.1, there&#8217;s a workaround that you can apply by using <code>flatMap</code> to
create an inner sequence for each element, in turn applying error-recovery
operators to these granular sequences:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public Flux&lt;Integer&gt; divide100By(Flux&lt;Integer&gt; dividers) {
  return dividers.flatMap(div -&gt; <b class="conum">(1)</b>
      Mono.just(100 / div) <b class="conum">(2)</b>
          .doOnError(e -&gt; { <b class="conum">(3)</b>
              if (e instanceof ArithmeticException) process(e); <b class="conum">(4)</b>
          })
          .onErrorResume(ArithmeticException.class, e -&gt; Mono.empty()) <b class="conum">(5)</b>
      );
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Instead of <code>map</code> we use <code>flatMap</code>, generating a small inner <code>Mono</code> for each value</p>
</li>
<li>
<p>That <code>Mono</code> is basically the old <code>map</code> operation&#8230;&#8203;</p>
</li>
<li>
<p>&#8230;&#8203;with error recovery added.</p>
</li>
<li>
<p>First we make sure to process (eg. log) <code>ArithmeticException</code> (and only these) before "recovery"</p>
</li>
<li>
<p>Then we use <code>onErrorResume</code> with a <code>Mono.empty()</code> to effectively ignore the exception in the resulting sequence</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This works, but it is a bit of a pain to write (although <code>compose</code> and <code>transform</code>
could help mutualize that sort of code). But also, we moved from a single <code>map</code>
operator to a <code>flatMap</code> with several inner operators.</p>
</div>
<div class="paragraph">
<p><code>flatMap</code> has more overhead than a <code>map</code>, due to the need to coordinate multiple
sources. Even though things like operator fusion diminish that cost, it is still
there.</p>
</div>
<div class="sect1">
<h2 id="introducing-error-strategy"><a class="anchor" href="#introducing-error-strategy"></a>Introducing Error Strategy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The difficulty if we want to further reduce the overhead of such a processing is
that we now have to work at the level of each operator&#8217;s implementation.</p>
</div>
<div class="paragraph">
<p>Each operator in a chain must somehow be made aware that exceptions should be caught
but not propagated through <code>onError</code>, but rather processed differently. This is
quite a big change, and it is transverse!</p>
</div>
<div class="paragraph">
<p>Note how this conceptually sound like a <code>filter</code>, but for errors. Like a <code>filter</code>
this implies that an operator that continues processing its source after one of
its <code>onNext</code> threw an exception should also request at least one more element
from its source.</p>
</div>
<div class="paragraph">
<p>Even though it can be isolated to a special execution path, this is still a
complex core implementation change to operators.</p>
</div>
<div class="paragraph">
<p>And then there&#8217;s the question of the API: it would be really tedious to put in
place as a constructor parameter, or an additional overload in <code>Flux</code> with an
"error recovery" boolean&#8230;&#8203; Do we really need to double the number of methods in
the <code>Flux</code> API to support that feature?</p>
</div>
<div class="paragraph">
<p>Fortunately not: since 3.1 we have the <code>Context</code>, which is a good mean of
propagating such information to every (Reactor) operator in a chain.</p>
</div>
<div class="paragraph">
<p>So that&#8217;s the road we took for the error strategy feature:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>support is only added to <strong>specific operators</strong> (<code>map</code>, <code>filter</code>, <code>flatMap</code>,
<code>handle</code> to name a few&#8230;&#8203;). These have a special javadoc tag to document that
fact.</p>
</li>
<li>
<p>the feature is activated for a given <code>Flux</code> by putting a special key in its
<code>Context</code></p>
</li>
<li>
<p>each supported operator has a special path in its <code>onNext</code> implementation that
checks for that key and, if found, will change its way of handling errors.</p>
</li>
<li>
<p>the feature is exposed to the user via the <code>errorStrategyContinue()</code> API</p>
</li>
<li>
<p>it can be a little more granular: one can filter which exceptions can be
recovered from, and also set a custom handler for such recovered exceptions.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
One thing to keep in mind is that, since this is activated via the
<code>Context</code>, the feature follows the same propagation rules as <code>Context</code>. For
instance, it will activate on inner sequences in a <code>flatMap</code>. If that is not
desirable, use <code>errorStrategyStop()</code> inside the flatMap to go back to default
behavior (this won&#8217;t escape the scope of the flatMap). <strong>It also propagates
backwards, activating on the operators that precede <code>errorStrategyXXX</code></strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is what our previous example becomes with error strategy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public Flux&lt;Integer&gt; divide100By(Flux&lt;Integer&gt; dividers) {
  return dividers.map(div -&gt; 100 / div) <b class="conum">(1)</b>
      .errorStrategyContinue(ArithmeticException.class, <b class="conum">(2)</b>
          (error, value) -&gt; process(error)); <b class="conum">(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Back to a simple <code>map</code></p>
</li>
<li>
<p>We only recover from <code>ArithmeticException</code></p>
</li>
<li>
<p>We pass such exceptions to our in-house handler (note we also have access to the original value that caused the exception, if any)</p>
</li>
</ol>
</div>
</div>
</div>
<h1 id="testing-it-out-with-milestone-1" class="sect0"><a class="anchor" href="#testing-it-out-with-milestone-1"></a>Testing it out with Milestone 1</h1>
<div class="paragraph">
<p>We just released a <code>3.2.0.M1</code> milestone<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup>
that mainly contains the error strategy feature, and we&#8217;d like you to test it ðŸ™‡</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This is such a transverse change that even if you don&#8217;t plan on using it, it
would be valuable to run your tests with the artifact, to validate that if you
don&#8217;t explicitly use <code>errorStrategyContinue()</code>, you shouldn&#8217;t see any change in
behavior (as the feature is contained within specific execution path).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>In order to get the milestone</strong> add the
<a href="https://repo.spring.io/milestone/io/projectreactor/reactor-core/3.2.0.M1/"><code>repo.spring.io/milestone</code></a>
repository to your Maven or Gradle build configuration and fetch the <code>reactor-core</code>
<code>3.2.0.M1</code> artifact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.projectreactor&lt;/groupId&gt;
  &lt;artifactId&gt;reactor-core&lt;/artifactId&gt;
  &lt;version&gt;3.2.0.M1&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For that feature&#8217;s API in particular, nothing is set in stone yet. So please let us know if you have any feedback by opening an <a href="https://github.com/reactor/reactor-core/issues/new">issue on GitHub</a>
or come and discuss the feature on <a href="https://gitter.im/reactor/reactor">Gitter</a>.</p>
</div>
<div class="paragraph">
<p><strong>In the meantime, happy coding!</strong></p>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. PS: This milestone was released early, while 3.1.3.RELEASE was still under development, so please note that it doesn&#8217;t contain all the fixes in 3.1.3 and subsequent 3.1.x releases.
</div>
</div></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 3137;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>