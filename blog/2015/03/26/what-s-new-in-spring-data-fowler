<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>What&#39;s new in Spring Data Fowler?</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="What&#39;s new in Spring Data Fowler?" />
<meta name="twitter:description" content="&lt;p&gt;The GA release of Spring Data release train Fowler marks the finishing line of 6 month of development. It’s time to give you an impression of the content of this release and a brief overview about individual features. The major themes of the Fowler release train were performance improvements and enhanced Java 8 support that are mainly reflected in the Spring Data JPA and MongoDB modules but a lot of other ones have seen significant improvements, too.&lt;/p&gt;
&lt;p&gt;The easiest way to upgrade to the Spring Data Fowler release train is by using Spring Boot and configuring the &lt;code&gt;spring-data-releasetrain.version&lt;/code&gt; property to &lt;code&gt;Fowler-RELEASE&lt;/code&gt;. If you’re not using Spring Boot yet, add the &lt;a href=&quot;http://search.maven.org/#artifactdetails%7Corg.springframework.data%7Cspring-data-releasetrain%7CFowler-RELEASE%7Cpom&quot;&gt;Spring Data BOM&lt;/a&gt; to your &lt;code&gt;&amp;lt;dependencyManagement /&amp;gt;&lt;/code&gt; section of your Maven POM.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@thomasdarimont" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/014bb231d48031c2974e4f723cc381b2?s=200" />

<meta property="og:title" content="What&#39;s new in Spring Data Fowler?" />
<meta property="og:image" content="https://gravatar.com/avatar/014bb231d48031c2974e4f723cc381b2?s=200" />
<meta property="og:description" content="&lt;p&gt;The GA release of Spring Data release train Fowler marks the finishing line of 6 month of development. It’s time to give you an impression of the content of this release and a brief overview about individual features. The major themes of the Fowler release train were performance improvements and enhanced Java 8 support that are mainly reflected in the Spring Data JPA and MongoDB modules but a lot of other ones have seen significant improvements, too.&lt;/p&gt;
&lt;p&gt;The easiest way to upgrade to the Spring Data Fowler release train is by using Spring Boot and configuring the &lt;code&gt;spring-data-releasetrain.version&lt;/code&gt; property to &lt;code&gt;Fowler-RELEASE&lt;/code&gt;. If you’re not using Spring Boot yet, add the &lt;a href=&quot;http://search.maven.org/#artifactdetails%7Corg.springframework.data%7Cspring-data-releasetrain%7CFowler-RELEASE%7Cpom&quot;&gt;Spring Data BOM&lt;/a&gt; to your &lt;code&gt;&amp;lt;dependencyManagement /&amp;gt;&lt;/code&gt; section of your Maven POM.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2015-03-26 13:53:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">What&#39;s new in Spring Data Fowler?</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/014bb231d48031c2974e4f723cc381b2?s=20&amp;d=mm" />
<span class="author">Thomas Darimont</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2015-03-26 13:53:00.0">March 26, 2015</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="2043" href="/blog/2015/03/26/what-s-new-in-spring-data-fowler#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>The GA release of Spring Data release train Fowler marks the finishing line of 6 month of development. It&rsquo;s time to give you an impression of the content of this release and a brief overview about individual features. The major themes of the Fowler release train were performance improvements and enhanced Java 8 support that are mainly reflected in the Spring Data JPA and MongoDB modules but a lot of other ones have seen significant improvements, too.</p><p>The easiest way to upgrade to the Spring Data Fowler release train is by using Spring Boot and configuring the <code>spring-data-releasetrain.version</code> property to <code>Fowler-RELEASE</code>. If you&rsquo;re not using Spring Boot yet, add the <a href="https://search.maven.org/#artifactdetails%7Corg.springframework.data%7Cspring-data-releasetrain%7CFowler-RELEASE%7Cpom">Spring Data BOM</a> to your <code>&lt;dependencyManagement /&gt;</code> section of your Maven POM.</p><h2><a href="#general-themes" class="anchor" name="general-themes"></a>General themes</h2><h3><a href="#java-8-streams-in-repository-methods" class="anchor" name="java-8-streams-in-repository-methods"></a>Java 8 streams in repository methods</h3><p>One of Java 8&rsquo;s great new features is the <code>Stream</code> API, which allows Java developers to define a pipeline of operations to be executed on a stream of objects but only the final operation actually triggering the consumption of elements from the <code>Stream</code>.</p><p>In the context of data access providing the result of a query execution as <code>Stream</code> is an extremely useful use case as it prevents the caller of the query method from blocking until all items were read. Not even mentioning the more efficient memory usage here.</p><p>With the Fowler release we introduce support for Java 8 Streams as return types of finder methods in repositories. In both the MongoDB and the JPA module you can now go ahead and declare finder methods like this:</p>
<pre><code class="prettyprint java">interface CustomerRepository extends Repository&lt;Customer, Long&gt; {

  Stream&lt;Customer&gt; findByLastname(String lastname);
}
</code></pre><p>Calling this method will execute the query backing the repository method and immediately return once the first result is available. To achieve this with JPA, we use persistence provider specific API as JPA itself only provides means to obtain query results as <code>List</code>s. Repository clients can now go ahead and use the result of the method call in a try-with-resources block. This will make sure the resources held open to be able to traverse the stream will be closed eventually:</p>
<pre><code class="prettyprint java">try (Stream&lt;Customer&gt; customers = repository.findByLastname(&quot;Matthews&quot;)) {
  customers.filter(…).map(…).collect(…);
}
</code></pre><h3><a href="#jsr-310-and-threeten-backport-support" class="anchor" name="jsr-310-and-threeten-backport-support"></a>JSR-310 and ThreeTen Backport support</h3><p>To easily persist <em>non-time-zoned</em> JSR-310 types - the date/time API newly introduced in JDK 8 - from within domain objects we added converters for the relevant types in the MongoDB and JPA module. For developers not able to upgrade to Java 8 yet, we added a similar set of converters for the <a href="https://github.com/ThreeTen/threetenbp">ThreeTen Backport project</a> so that you can start using the types in your code even if you&rsquo;re still on Java 7. A switch to Java 8 will be a simple switch in the package names going forward.</p><p>In the MongoDB module, the corresponding <code>Converter</code> implementations are available automatically. For JPA you can simply register either <code>Jsr310JpaConverters</code> or <code>ThreeTenBackPortJpaConverters</code> with your persistence provider. If you&rsquo;re using a <code>LocalContainerEntityManagerFactoryBean</code> to set up your JPA environment in Spring simply add <code>org.springframework.data.jpa.convert.threeten</code> or <code>….threetenbp</code> to the packages to scan. With Spring Boot, it&rsquo;s just a matter of adding the aforementioned classes to the <code>@EntityScan</code> declaration:</p>
<pre><code class="prettyprint java">@EntityScan(
  basePackageClasses = { Application.class, Jsr310JpaConverters.class }
)
@SpringBootApplication
class Application { … }
</code></pre><p>This setup will make sure that both your application package and the Spring Data JPA one for the JSR-310 converters will be scanned and handed to the persistence provider. Find a complete example for that in our <a href="https://github.com/spring-projects/spring-data-examples/tree/master/jpa/java8">Spring Data Examples repository</a>. Note, that due to the fact that the converter simply converts the JSR-310 types to legacy <code>Date</code> instances, <em>only non-time-zoned</em> (e.g. <code>LocalDateTime</code> etc.) are supported.</p><h2><a href="#mongodb" class="anchor" name="mongodb"></a>MongoDB</h2><h3><a href="#3-0-server-and-driver-support" class="anchor" name="3-0-server-and-driver-support"></a>3.0 server and driver support</h3><p>Spring Data Fowler ships support for the latest and greatest MongoDB 3.0 server generation. While that generation can already be used with the MongoDB Java driver in version 2.13.0 we also made sure Spring Data MongoDB will work flawlessly with the upcoming 3.0 version of the Java driver. Thus, developers are free to choose which version they&rsquo;re going to work with or rather when they would like to upgrade to the new driver. For general information on compatibility between driver and server versions be sure to check out the <a href="http://docs.mongodb.org/ecosystem/drivers/java/">MongoDB documentation</a> Be aware though that subsequent development will clearly focus on the 3.0 line of both the server and the driver.</p><p>In general we encourage everyone to favour <code>MongoClient</code> over <code>Mongo</code> within JavaConfig or use the newly introduced XML elements for <code>&lt;mongo:mongo-client /&gt;</code> and <code>&lt;mongo:client-options /&gt;</code>. For more information please refer to the <a href="https://docs.spring.io/spring-data/mongodb/docs/1.7.0.RELEASE/reference/html/#mongo.mongo-3">reference documentation</a>.</p><h3><a href="#geojson-support" class="anchor" name="geojson-support"></a>GeoJSON support</h3><p>It’s been awhile since MongoDB had introduced <a href="http://geosjon.org">GeoJSON</a> as format for dealing with geo structures. These data structures operate on an earth like sphere and therefore cannot be used along with a 2D index. Having said that, the usage is pretty much straight forward since we provide dedicated types to support GeoJSON. Those can be used in both your domain types as well as query parameters.</p>
<pre><code class="prettyprint java">@Document
class Store {

  @Id String id;

  /**
   * The location is stored in GeoJSON format:
   * { &quot;type&quot; : &quot;Point&quot;, &quot;coordinates&quot; : [ x, y ] }
   */
  GeoJsonPoint location;
}

interface StoreRepository extends CrudRepository&lt;Store, String&gt; {

  List&lt;Store&gt; findByLocationWithin(Polygon polygon);
}

repo.findByLocationWithin(
  new GeoJsonPolygon(
    new Point(-73.992514, 40.758934),
    new Point(-73.961138, 40.760348),
    new Point(-73.991658, 40.730006),
    new Point(-73.992514, 40.758934)));
</code></pre><p>This creates the following query to be executed in MongoDB:</p>
<pre><code class="prettyprint json">{
  &quot;location&quot;: {
    &quot;$geoWithin&quot;: {
      &quot;$geometry&quot;: {
        &quot;type&quot;: &quot;Polygon&quot;,
        &quot;coordinates&quot;: [[
           [-73.992514,40.758934],
           [-73.961138,40.760348],
           [-73.991658,40.730006],
           [-73.992514,40.758934]
        ]]
      }
    }
  }
}
</code></pre><p>Note that the <code>StoreRepository.findByLocationWithin(…)</code> still takes a <code>Polygon</code>. Using <code>GeoJsonPolygon</code> with <code>findByLocationWithin(…)</code> will create the query using the <code>$geometry</code> operator alongside the GeoJSON representation. More Details on usage and restrictions can be found in the <a href="http://docs.mongodb.org/manual/core/2dsphere/#geospatial-indexes-store-geojson/">MongoDB manual</a>.</p><h3><a href="#execution-of-mongodb-stored-scripts" class="anchor" name="execution-of-mongodb-stored-scripts"></a>Execution of MongoDB stored scripts</h3><p>MongoDB allows to execute JavaScript functions on the server by either directly sending the raw source script or calling one previously stored. We expose this functionality through the newly introduced <code>ScriptOperations</code> interface which can be obtained from <code>MongoOperations</code>.</p>
<pre><code class="prettyprint java">ScriptOperations ops = mongoOperations.scriptOps();
ExecutableMongoScript script = new ExecutableMongoScript(&quot;function(x) { return x; }&quot;);
Object r1 = ops.execute(script, &quot;Direct function execution.&quot;)

ops.register(new NamedMongoScript(&quot;echo&quot;, script));
Object r2 = ops.call(&quot;echo&quot;, &quot;Call stored function.&quot;);
</code></pre><p>The server-side script support will be enhanced in follow-up releases where we will add return type conversion, annotations for calling procedures from repository methods as well as support for the <code>$where</code> operator.</p><h3><a href="#performance-improvements-in-object-to-store-conversion" class="anchor" name="performance-improvements-in-object-to-store-conversion"></a>Performance improvements in object-to-store conversion</h3><p>The object-to-store mapping subsystem has undergone a significant overhaul in terms of performance improvements. We profiled the Commons and store modules, introduced some caching here and there and could actually gain quite an impressive increase of operations per second compared to the Evans release train (although most of the improvements were ported back to the service releases of Evans, too).</p><p><img src="https://gist.githubusercontent.com/olivergierke/1d4239b59c57e05760c3/raw/fowler-bar-chart-read-write.png" alt="Performance improvements in Spring Data Fowler" /></p><p>As you can see, we more than doubled the number of operations per second for read access and are a close to that in write operations, too.</p><p>When reading a lot of objects from the data store, a significant amount of time is spent creating the object instances via reflection. With the Fowler release train we introduce a new default <code>EntityInstantiator</code> that solves that bottleneck by creating a factory class for the domain object at runtime using ASM. This factory class calls the constructor of the domain class directly, which is significantly faster than doing so by reflection. If you&rsquo;re interested in the nifty details, <a href="https://github.com/spring-projects/spring-data-commons/blob/1.10.0.RELEASE/src/main/java/org/springframework/data/convert/BytecodeGeneratingEntityInstantiator.java#L54">here</a>&rsquo;s the class that does the trick for us.</p><h2><a href="#redis" class="anchor" name="redis"></a>Redis</h2><h3><a href="#hyperloglog" class="anchor" name="hyperloglog"></a>HyperLogLog</h3><p>Redis <a href="http://redis.io/commands#hyperloglog">HyperLogLog commands</a> provide an efficient solution to counting unique things without the need to remember elements already encountered. This applies for instance to counting unique page visits by IP.</p>
<pre><code class="prettyprint java">HyperLogLogOperations hll = redisTemplate.opsForHyperLogLog();

hll.add(today(), &quot;8.8.8.8&quot;, &quot;8.8.4.4&quot;);
hll.size(today()); // Unique page visits today = 2

hll.add(today(), &quot;198.153.192.40&quot;, &quot;8.8.8.8&quot;);
hll.size(today()); // Unique page visits today = 3
hll.size(today(), yesterday()); // Unique page visits today and yesterday
</code></pre><h2><a href="#gemfire" class="anchor" name="gemfire"></a>Gemfire</h2><p>By far, the most significant change to the GemFire module is full support for GemFire 8. GemFire 8 introduced <a href="http://gemfire80.docs.pivotal.io/8.0.0/userguide/index.html#relnotes/release_notes.html#topic_5mbwjl">several new changes</a> since 7.0.2 including a new <a href="http://gemfire80.docs.pivotal.io/8.0.0/userguide/index.html#relnotes/release_notes.html#topic_5mbwjl__section_zk2_p35_v4">cluster-based configuration service</a>.</p><p>With that service enabled, developers can record their actions and schema-like changes in Gfsh as they perform actions, like adding regions, creating indexes, configuring disk stores, etc. When a developer spins up a new GemFire peer in the cluster, the member will automatically pick up its configuration from the new cluster-based configuration service, hosted in a locator.</p><p>While Spring Data GemFire&rsquo;s <a href="https://docs.spring.io/spring-data-gemfire/docs/current/reference/html/#bootstrap">XML-namespace-based configuration</a> remains a popular choice, especially during development with highly iterative, short feedback cycles, Spring Data GemFire adds support for the new <a href="https://docs.spring.io/spring-data-gemfire/docs/1.6.0.RC1/reference/html/#bootstrap:cache:cluster-configuration">cluster-based configuration</a>, which behaves similarly to Spring Data Gemfire&rsquo;s support for GemFire&rsquo;s <a href="https://docs.spring.io/spring-data-gemfire/docs/1.6.0.RC1/reference/html/#bootstrap:cache">native `cache.xml</a> format.</p><p>To enable cluster-based configuration in Spring-configured GemFire node, a developer only needs to set the <code>use-cluster-configuration</code> attribute on the <code>&lt;gfe:cache /&gt;</code> element, like this:</p>
<pre><code class="prettyprint xml">&lt;gfe:cache id=&quot;gemfireCache&quot; use-cluster-configuration=&quot;true&quot; … /&gt;
</code></pre><p>Spring Data GemFire will first request and apply the cluster-wide configuration before applying the XML namespace-specific configuration. You can think of the XML configuration meta-data as augmenting the cluster config sent by the cluster configuration service.</p><p>For more information on GemFire&rsquo;s new cluster configuration service, see the <a href="http://gemfire80.docs.pivotal.io/8.0.0/userguide/index.html#deploying/gfsh/gfsh_persist.html">GemFire user guide</a> and <a href="https://jira.spring.io/browse/SGF-226">SGF-226</a> for more details.</p><h2><a href="#spring-data-rest" class="anchor" name="spring-data-rest"></a>Spring Data REST</h2><p>Spring Data REST has seen a wide range of improvements in the Fowler release, too. One of the most notable improvements is more entity metadata inspected and used to populate response headers. For example, stores supporting optimistic locking through an <code>@Version</code> annotation will now get the entity version used as <code>ETag</code> header, so that clients can leverage them to trigger conditional <code>GET</code> requests.</p><p>Quite related, entities that use Spring Data auditing support will automatically get their last modification date be propagated into the <code>LastModified</code> header of the response of item resources:</p>
<pre><code class="prettyprint java">class Customer {

  @Version Long version;
  @LastModifiedDate LocalDate lastModifiedDate;
}
</code></pre>
<pre><code class="prettyprint">curl -v http://…/customers/1

Etag: 1
Last-Modified: Tue, 24 Mar 2015 12:34:56 GMT
</code></pre><h3><a href="#json-schema" class="anchor" name="json-schema"></a>JSON Schema</h3><p>The Fowler release of Spring Data REST also ships with revamped support for JSON Schema. By default, the schema is pointed to by the representation descriptor in the ALPS document exposed for a domain type. In the <a href="https://github.com/spring-projects/spring-data-examples/tree/master/rest/starbucks">Starbucks example</a> you can see the link rendered like this:</p>
<pre><code class="prettyprint">curl http://…/alps/stores

{
  &quot;version&quot;: &quot;1.0&quot;,
  &quot;descriptors&quot;: [ {
    &quot;id&quot;: &quot;store-representation&quot;,
    &quot;href&quot;: &quot;http://localhost:8080/stores/schema&quot;,
    &quot;descriptors&quot;: [ … ]
  }],
  …
}
</code></pre><p>Following the link will reveal the JSON Schema document for a store:</p>
<pre><code class="prettyprint">{
  &quot;title&quot;: &quot;example.stores.Store&quot;,
  &quot;properties&quot;: {
    &quot;address&quot;: {
      &quot;$ref&quot;: &quot;#/descriptors/address&quot;
    },
    &quot;name&quot;: {
      &quot;type&quot;: &quot;string&quot;
    }
  },
  &quot;descriptors&quot;: {
    &quot;address&quot;: {
      &quot;type&quot;: &quot;object&quot;,
      &quot;properties&quot;: {
        &quot;zip&quot;: {
          &quot;type&quot;: &quot;string&quot;
        },
        &quot;city&quot;: {
          &quot;type&quot;: &quot;string&quot;
        },
        &quot;street&quot;: {
          &quot;type&quot;: &quot;string&quot;
        },
        &quot;location&quot;: {
          &quot;$ref&quot;: &quot;#/descriptors/point&quot;
        }
      }
    },
    &quot;point&quot;: {
      &quot;type&quot;: &quot;object&quot;,
      &quot;properties&quot;: {
        &quot;x&quot;: {
          &quot;type&quot;: &quot;number&quot;
        },
        &quot;y&quot;: {
          &quot;type&quot;: &quot;number&quot;
        }
      }
    }
  },
  &quot;type&quot;: &quot;object&quot;,
  &quot;$schema&quot;: &quot;http://json-schema.org/draft-04/schema#&quot;
}
</code></pre><p>Note how we derive basic traits of the schema from the domain type and its Jackson mappings. Required properties can be determined by using <code>@JsonProperty(required = true)</code>, date/time types are correctly discovered and advertised. You can register a custom JSON Schema format or pattern on <code>RepositoryRestConfiguration.metadataConfiguration()</code>:</p>
<pre><code class="prettyprint java">@Configuration
static class SampleConfiguration extends RepositoryRestMvcConfiguration {

  @Override
  protected void configureRepositoryRestConfiguration(
    RepositoryRestConfiguration config) {
    config.metadataConfiguration().
      registerJsonSchemaFormat(JsonSchemaFormat.EMAIL, EmailAddress.class);
  }
}
</code></pre><p>Assuming <code>EmailAddress</code> is a value object that you have tweaked Jackson into rendering as plain <code>String</code>, this configuration will cause all properties of type <code>EmailAddress</code> to appear with the <code>format</code>set to <code>email</code> in the JSON schema document.</p><h2><a href="#solr" class="anchor" name="solr"></a>Solr</h2><h3><a href="#document-score-improvements" class="anchor" name="document-score-improvements"></a>Document score improvements</h3><p>The Fowler release added support for realtime-get allowing to read uncommitted changes from the index. <code>getById</code> is available on <code>SolrTemplate</code>. Also noteworthy is the addition of <code>@Score</code> which was inspired by <code>@TextScore</code> available for Spring Data MongoDB. The annotation allows retrieving document score and will implicitly add required parameters so that one no longer has to explicitly add <code>@Query(fields={&quot;*&quot;, &quot;score&quot;}</code> when retrieving document query match score.</p><h2><a href="#miscellaneous" class="anchor" name="miscellaneous"></a>Miscellaneous</h2><h3><a href="#elevating-projections" class="anchor" name="elevating-projections"></a>Elevating projections</h3><p>Spring Data REST shipped a feature called projections with the Evans release train. In Fowler we moved the infrastructure backing that into Spring Data Commons and tweaked it a bit, so that other projects can use it without further dependencies. The very heart of the feature is a <code>ProjectionFactory</code> that allows you to create object instances for interfaces that are backed some other object, e.g. a <code>Map</code>.</p>
<pre><code class="prettyprint java">interface Customer {

  String getFirstname();

  String getLastname();

  @Value(&quot;#{target.firstname + &#39; &#39; + target.lastname}&quot;)
  String getFullName();
}
</code></pre><p>This interface can now be turned into an object using a <code>ProjectionFactory</code>:</p>
<pre><code class="prettyprint java">Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
map.put(&quot;firstname&quot;, &quot;Dave&quot;);
map.put(&quot;lastname&quot;, &quot;Matthews&quot;);

ProjectionFactory factory = new SpelAwareProjectionFactory();
Customer customer = factory.createProjection(Customer.class, map)

assertThat(customer.getFirstname(), is(&quot;Dave&quot;));
assertThat(customer.getLastname(), is(&quot;Matthews&quot;));
assertThat(customer.getFullName(), is(&quot;Dave Matthews&quot;));
</code></pre><p>As you can see, we chose a <code>Map</code> to back the created projection instance. Under the hood a JDK proxy is created equipped with method interceptors that - in case of a <code>Map</code> backing the proxy - delegating calls to accessors to property lookups within the <code>Map</code>. Methods annotated with <code>@Value</code> will get the annotated SpEL expression evaluated. In case you configure a <code>BeanFactory</code> on the <code>SpelAwareProjectionFactory</code> you can even refer to Spring beans from within these expressions and thus trigger more complex calculations.</p><p>In case the backing lookup does not return a value assignable to the return type declared, a standard <code>ConversionService</code> is used for simple conversions followed by a recursive projection step.</p><p>For an example of how to use projections within a Spring MVC controller, see <a href="https://stackoverflow.com/a/29386907/18122">this answer on StackOverflow</a>.</p><h3><a href="#projections-in-spring-mvc" class="anchor" name="projections-in-spring-mvc"></a>Projections in Spring MVC</h3><p>The projection mechanism can now be used by Spring MVC controller implementations to create form backing objects solely using interfaces. Using <code>@EnableSpringDataWebSupport</code> in your Spring configuration (automatically activated in Boot) a <code>ProxyingHandlerMethodArgumentResolver</code> is resolved that will automatically create a proxy instance for the interface and bind the according request parameters to it:</p>
<pre><code class="prettyprint java">interface Form {

  @NotBlank String getName();
  @NotBlank String getText();
}

@Controller
@RequestMapping(value = &quot;/guestbook&quot;)
class GuestbookController {

  @RequestMapping(method = RequestMethod.GET)
  String guestbook(Form form, Model model) { … }

  @RequestMapping(method = RequestMethod.POST)
  String guestbook(@Valid Form form, Errors errors, Model model) { … }
}
</code></pre><p>See how the interface is used in the method accepting a <code>GET</code> request to provide an empty form-backing object to the view about to be rendered. The method receiving the <code>POST</code> request uses the <code>Form</code> to indicate it wants to get form data bound to the proxy instance and validation applied.</p><h2><a href="#summary" class="anchor" name="summary"></a>Summary</h2><p>Despite the length of the post, we barely scratched the surface of all the new features Spring Data Fowler ships. You might want to explore the <a href="https://github.com/spring-projects/spring-data-commons/wiki/Release-Train-Fowler">release train wiki</a> for further gems, and traverse the links to the tickets and related commits in turn as they contain test cases that usually demonstrate a the individual features nicely.</p><p>Also, the already mentioned <a href="https://github.com/spring-projects/spring-data-examples">Spring Data examples repository</a> has a lot of stuff to play with and explore.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 2043;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>