<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>Activiti和Spring Boot入门</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Getting started with Activiti and Spring Boot">
<meta name="twitter:description" >
<meta name="twitter:creator" content="@starbuxman"><meta name="twitter:image:src" content="https://gravatar.com/avatar/fb22593caf24e4bb4c98d467cdd247e6?s=200"><meta property="og:title" content="Getting started with Activiti and Spring Boot"><meta property="og:image" content="https://gravatar.com/avatar/fb22593caf24e4bb4c98d467cdd247e6?s=200"><meta property="og:description" >
<meta content="article" property="og:type"><meta property="og:article:published_time" content="2015-03-08 23:15:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Activiti和Spring Boot入门</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/fb22593caf24e4bb4c98d467cdd247e6?s=20&amp;d=mm"> <a class="author" rel="author" href="/team/jlong">乔什·朗（Josh Long）</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2015-03-08 23:15:00.0">2015年3月8日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2015/03/08/getting-started-with-activiti-and-spring-boot#disqus_thread" data-disqus-identifier="2010">
</a></div>
</div>
</header>
<div class="blog--post"><blockquote><p>这篇文章是Activiti联合创始人兼社区<a href="https://twitter.com/jbarrez">成员Joram Barrez（@jbarrez）</a>在Alfresco工作的来宾帖子。谢谢乔拉姆！我希望看到更多这些社区来宾的帖子，因此-和往常一样-不要犹豫，向<a href="https://twitter.com/starbuxman">我（@starbuxman）征求</a>意见和贡献！ -乔什</p>
</blockquote>
<hr><h2><a href="#introduction" class="anchor" name="introduction"></a>介绍</h2><p>Activiti是Apache许可的业务流程管理（BPM）引擎。这样的引擎的核心目标是获取由人工任务和服务调用组成的流程定义，并按一定顺序执行，同时公开各种API以启动，管理和查询有关该定义的流程实例的数据。与许多竞争对手相反，Activiti轻巧且易于与任何Java技术或项目集成。所有这些，它可以在任何规模上运行-从几十到数千甚至数百万个流程执行。</p><p><img src="https://raw.githubusercontent.com/joshlong/meh/master/activiti/activiti-logo.png"></p><p>Activiti的源代码可以在<a href="https://github.com/Activiti/Activiti">Github</a>上找到。该项目由<a href="http://www.alfresco.com">Alfresco</a>创立并赞助，但得到了来自全球和各行业的贡献。</p><p>通常将过程定义可视化为流程图状图。近年来，BPMN 2.0标准（OMG标准，如UML）已成为这些图表的实际“语言”。该标准定义了技术上和商业上如何解释图表上的某个形状以及如何将其存储为不太时髦的XML文件。但是幸运的是，大多数工具为您隐藏了这个形状。这是一个标准，您可以使用许多兼容的工具来设计（甚至运行）BPMN流程。就是说，如果您要问我，没有比Activiti更好的选择了！</p><h2><a href="#spring-boot-integration" class="anchor" name="spring-boot-integration"></a> Spring Boot集成</h2><p>Activiti和Spring在一起玩的很好。Spring Boot中的基于约定的约定方法可以很好地与Activiti的流程引擎一起设置和使用。开箱即用，您只需要一个数据库，因为流程执行的时间范围从几秒钟到几年不等。显然，作为流程定义的内在部分，就是使用各种技术在各种系统之间来回调用和使用数据。添加所需的依赖项以及将各种（样板式）逻辑与Spring Boot集成在一起的简单性确实使这个孩子玩得开心。</p><p>在微服务方法中使用Spring Boot和Activiti也很有意义。Spring Boot使您可以轻松地立即启动生产就绪型服务并运行-在分布式微服务架构中-Activiti流程可以将各种微服务粘合在一起，同时还可以编入人工工作流程（任务和表单）以实现特定目标。</p><p>Activiti中的Spring Boot集成是由Spring专家<a href="https://twitter.com/starbuxman">Josh Long</a>创建的。我和Josh <a href="https://www.youtube.com/watch?v=0PV_8Lew3vg">在几个月前进行了一次网络研讨会</a> ，应该可以使您深入了解Spring Boot的Activiti集成的基础知识。<a href="http://activiti.org/userguide/index.html#springSpringBoot">Spring Boot上</a>的<a href="http://activiti.org/userguide/index.html#springSpringBoot">Activiti用户指南部分</a>也是获取更多信息的理想起点。</p><h2><a href="#getting-started" class="anchor" name="getting-started"></a>入门</h2><p>该示例的代码可以<a href="https://github.com/jbarrez/spring-boot-with-activiti-example">在我的Github存储库中找到</a> 。</p><p>我们将在此处实现的过程是开发人员的招聘过程。当然已经简化了（因为它需要适合此网页），但是您应该了解核心概念。如下图：</p><p><img src="https://raw.githubusercontent.com/joshlong/meh/master/activiti/hire-process.png"> </p><p>如引言中所述，由于BPMN 2.0标准，此处的所有形状都有非常具体的解释。但是，即使不了解BPMN，该过程也很容易理解：</p>
<ul>
<li>当过程开始时，求职者的简历存储在外部系统中。</li>
<li>然后，该过程将一直等到进行电话采访为止。这是由用户完成的（请参见角落里人的小图标）。</li>
<li>如果电话采访还不够，那么会发送一封礼貌的拒绝电子邮件。否则，应同时进行技术面试和财务谈判。</li>
<li>请注意，申请人可以随时取消。在图中显示为大矩形边界上的事件。当事件发生时，内部的所有内容都将被杀死，并且进程将停止。</li>
<li>如果一切顺利，则会发送一封欢迎电子邮件。</li>
</ul><p>这是<a href="https://github.com/jbarrez/spring-boot-with-activiti-example/blob/master/src/main/resources/processes/Developer_Hiring.bpmn20.xml">此过程</a>的<a href="https://github.com/jbarrez/spring-boot-with-activiti-example/blob/master/src/main/resources/processes/Developer_Hiring.bpmn20.xml">BPMN</a></p><p>让我们创建一个新的Maven项目，并添加获取Spring Boot，Activiti和数据库所需的依赖项。我们将使用内存数据库来简化事情。</p>
<pre><code class="prettyprint xml">&lt;dependency&gt;
    &lt;groupId&gt;org.activiti&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-basic&lt;/artifactId&gt;
    &lt;version&gt;${activiti.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.h2database&lt;/groupId&gt;
    &lt;artifactId&gt;h2&lt;/artifactId&gt;
    &lt;version&gt;1.4.185&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>因此，创建第一个Spring Boot + Activiti应用程序只需要两个依赖项：</p>
<pre><code class="prettyprint java">@SpringBootApplication
public class MyApp {

    public static void main(String[] args) {
        SpringApplication.run(MyApp.class, args);
    } 
}
</code></pre><p>您已经可以运行此应用程序，它将无法执行任何功能，但已经在幕后进行了</p>
<ul>
<li>创建一个内存中的H2数据库</li>
<li>使用该数据库创建Activiti流程引擎</li>
<li>将所有Activiti服务公开为Spring Beans</li>
<li>在这里和那里配置提示，例如Activiti异步作业执行程序，邮件服务器等。</li>
</ul><p>让我们开始运行。将BPMN 2.0流程定义放到<code>src/main/resources/processes</code>文件夹中。此处放置的所有进程将自动部署（即解析并使其可执行）到Activiti引擎。让我们保持简单的开始，并创建一个<code>CommanLineRunner</code> ，它将在应用程序启动时执行：</p>
<pre><code class="prettyprint java">@Bean
CommandLineRunner init( final RepositoryService repositoryService,
                              final RuntimeService runtimeService,
                              final TaskService taskService) {

    return new CommandLineRunner() {

        public void run(String... strings) throws Exception {
            Map&lt;String, Object&gt; variables = new HashMap&lt;String, Object&gt;();
            variables.put(&quot;applicantName&quot;, &quot;John Doe&quot;);
            variables.put(&quot;email&quot;, &quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7f15101711511b101a3f1e1c0b1609160b16511c1012">[email&#160;protected]</a>&quot;);
            variables.put(&quot;phoneNumber&quot;, &quot;123456789&quot;);
            runtimeService.startProcessInstanceByKey(&quot;hireProcess&quot;, variables);
        }
    };
}
</code></pre><p>因此，这里发生的是，我们创建了运行该流程所需的所有变量的映射，并在启动流程时将其传递。如果您检查流程定义，您会看到我们在许多地方使用<code>${variableName}</code>引用了这些变量（例如任务描述）。</p><p>该过程的第一步是一个自动步骤（请参阅小齿轮图标），该步骤使用使用Spring Bean的表达式实现：</p><p><img src="https://raw.githubusercontent.com/joshlong/meh/master/activiti/servicetask.png"> </p><p>这是用</p>
<pre><code class="prettyprint">activiti:expression=&quot;${resumeService.storeResume()}&quot;
</code></pre><p>当然，我们需要那个bean否则进程将无法启动。因此，让我们创建它：</p>
<pre><code class="prettyprint">@Component
public class ResumeService {

    public void storeResume() {
        System.out.println(&quot;Storing resume ...&quot;);
    }

}
</code></pre><p>现在运行应用程序时，您会看到Bean被调用：</p>
<pre><code class="prettyprint">  .   ____          _            __ _ _
 /\\ / ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | &#39;_ | &#39;_| | &#39;_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  &#39;  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v1.2.0.RELEASE)

2015-02-16 11:55:11.129  INFO 304 --- [           main] MyApp                                    : Starting MyApp on The-Activiti-Machine.local with PID 304 ...
Storing resume ...
2015-02-16 11:55:13.662  INFO 304 --- [           main] MyApp                                    : Started MyApp in 2.788 seconds (JVM running for 3.067)
</code></pre><p>就是这样！祝贺您在Spring Boot中使用Activiti运行您的第一个流程实例！</p><p>让我们加点儿趣味，然后将以下依赖项添加到我们的pom.xml中：</p>
<pre><code class="prettyprint xml">&lt;dependency&gt;
    &lt;groupId&gt;org.activiti&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-rest-api&lt;/artifactId&gt;
    &lt;version&gt;${activiti.version}}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>将它放在类路径上确实很有趣：它采用Activiti REST API（用Spring MVC编写），并将其完全暴露在您的应用程序中。<a href="http://activiti.org/userguide/index.html#_rest_api">Activiti用户指南中完整记录了Activiti</a>的REST API。</p><p>REST API受基本身份验证保护，默认情况下不会有任何用户。如下所示，将管理员用户添加到系统（将其添加到MyApp类）。当然，不要在生产系统中执行此操作，您将需要将身份验证与LDAP或其他内容挂钩。</p>
<pre><code class="prettyprint java">@Bean
InitializingBean usersAndGroupsInitializer(final IdentityService identityService) {

    return new InitializingBean() {
        public void afterPropertiesSet() throws Exception {

            Group group = identityService.newGroup(&quot;user&quot;);
            group.setName(&quot;users&quot;);
            group.setType(&quot;security-role&quot;);
            identityService.saveGroup(group);

            User admin = identityService.newUser(&quot;admin&quot;);
            admin.setPassword(&quot;admin&quot;);
            identityService.saveUser(admin);

        }
    };
}
</code></pre><p>启动应用程序。现在，我们可以像在CommandLineRunner中一样启动流程实例，但是现在使用REST：</p>
<pre><code class="prettyprint sh">curl -u admin:admin -H &quot;Content-Type: application/json&quot; -d &#39;{&quot;processDefinitionKey&quot;:&quot;hireProcess&quot;, &quot;variables&quot;: [ {&quot;name&quot;:&quot;applicantName&quot;, &quot;value&quot;:&quot;John Doe&quot;}, {&quot;name&quot;:&quot;email&quot;, &quot;value&quot;:&quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="bed4d1d6d090dad1dbfedfd2d8ccdbcdddd190ddd1d3">[email&#160;protected]</a>&quot;}, {&quot;name&quot;:&quot;phoneNumber&quot;, &quot;value&quot;:&quot;1234567&quot;} ]}&#39; http://localhost:8080/runtime/process-instances
</code></pre><p>这将向我们返回流程实例的json表示形式：</p>
<pre><code class="prettyprint sh">{
     &quot;tenantId&quot;: &quot;&quot;,
     &quot;url&quot;: &quot;http://localhost:8080/runtime/process-instances/5&quot;,
     &quot;activityId&quot;: &quot;sid-42BAE58A-8FFB-4B02-AAED-E0D8EA5A7E39&quot;,
     &quot;id&quot;: &quot;5&quot;,
     &quot;processDefinitionUrl&quot;: &quot;http://localhost:8080/repository/process-definitions/hireProcess:1:4&quot;,
     &quot;suspended&quot;: false,
     &quot;completed&quot;: false,
     &quot;ended&quot;: false,
     &quot;businessKey&quot;: null,
     &quot;variables&quot;: [],
     &quot;processDefinitionId&quot;: &quot;hireProcess:1:4&quot;
}
</code></pre><p>我只想停一会儿，这太酷了。只需添加一个依赖项，即可将整个Activiti REST API嵌入到您的应用程序中！</p><p>让我们变得更酷，并添加以下依赖项</p>
<pre><code class="prettyprint">&lt;dependency&gt;
    &lt;groupId&gt;org.activiti&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
    &lt;version&gt;${activiti.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>这将为Activiti添加一个Spring Boot执行器端点。如果我们重新启动应用程序，并点击<code>http://localhost:8080/activiti/</code> ，我们将获得一些有关进程的基本统计信息。凭空想象，在实时系统中，您将部署和执行更多的流程定义，您将看到它的用处。</p><p>相同的执行器也注册为JMX Bean，以显示类似信息。</p>
<pre><code class="prettyprint json">{
    completedTaskCountToday: 0,
    deployedProcessDefinitions: [
       &quot;hireProcess (v1)&quot;
    ],
    processDefinitionCount: 1,
   cachedProcessDefinitionCount: 1,
   runningProcessInstanceCount: {
       hireProcess (v1): 0
    },
    completedTaskCount: 0,
    completedActivities: 0,
    completedProcessInstanceCount: {
        hireProcess (v1): 0
    },
    openTaskCount: 0
}
</code></pre><p>为了完成我们的编码，让我们为我们的聘用过程创建一个专用的REST端点，例如，它可以被javascript Web应用程序使用（不在本文的讨论范围内）。因此，最有可能的是，我们将为申请人提供一张表格，以填写我们在上面以编程方式传递的详细信息。同时，让我们将申请人信息存储为JPA实体。在这种情况下，数据将不再存储在Activiti中，而是存储在单独的表中，并在需要时由Activiti引用。</p><p>您可能现在已经猜到了，通过添加依赖项来启用JPA支持：</p>
<pre><code class="prettyprint xml">&lt;dependency&gt;
    &lt;groupId&gt;org.activiti&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-jpa&lt;/artifactId&gt;
    &lt;version&gt;${activiti.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>并将实体添加到MyApp类：</p>
<pre><code class="prettyprint java"><br />@Entity
class Applicant {

    @Id
    @GeneratedValue
    private Long id;

    private String name;

    private String email;

    private String phoneNumber;

    // Getters and setters

</code></pre><p>我们还将需要此实体的存储库（将此存储在单独的文件或MyApp中）。不需要任何方法，Spring的Repository魔术将生成我们需要的方法。</p>
<pre><code class="prettyprint java">public interface ApplicantRepository extends JpaRepository&lt;Applicant, Long&gt; {
  // .. 
}
</code></pre><p>现在我们可以创建专用的REST端点：</p>
<pre><code class="prettyprint java "><br />@RestController
public class MyRestController {

    @Autowired
    private RuntimeService runtimeService;

    @Autowired
    private ApplicantRepository applicantRepository;

    @RequestMapping(value=&quot;/start-hire-process&quot;, method= RequestMethod.POST, produces= MediaType.APPLICATION_JSON_VALUE)
    public void startHireProcess(@RequestBody Map&lt;String, String&gt; data) {

        Applicant applicant = new Applicant(data.get(&quot;name&quot;), data.get(&quot;email&quot;), data.get(&quot;phoneNumber&quot;));
        applicantRepository.save(applicant);

        Map&lt;String, Object&gt; variables = new HashMap&lt;String, Object&gt;();
        variables.put(&quot;applicant&quot;, applicant);
        runtimeService.startProcessInstanceByKey(&quot;hireProcessWithJpa&quot;, variables);
    } 
}
</code></pre><p>请注意，我们现在使用的是一个略有不同的过程，称为“ hireProcessWithJpa”，其中进行了一些调整以应对数据现在位于JPA实体中的事实。因此，例如，我们不能再使用$ {applicantName}，但现在必须使用$ {applicant.name}。</p><p>让我们重新启动应用程序并启动一个新的流程实例：</p>
<pre><code class="prettyprint sh">curl -u admin:admin -H &quot;Content-Type: application/json&quot; -d &#39;{&quot;name&quot;:&quot;John Doe&quot;, &quot;email&quot;: &quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="fd97929593d3999298bd9c919b8f988e9e92d39e9290">[email&#160;protected]</a>&quot;, &quot;phoneNumber&quot;:&quot;123456789&quot;}&#39; http://localhost:8080/start-hire-process
</code></pre><p>现在，我们可以完成我们的过程。您也可以为此创建一个自定义终结点，以不同的形式公开不同的任务查询……但是，我将让您自己想象一下，并使用默认的Activiti REST端点进行操作。</p><p>让我们看一下流程实例当前处于哪个任务（您可以在此处传递更详细的参数，例如'processInstanceId'以获得更好的过滤）：</p>
<pre><code class="prettyprint sh">curl -u admin:admin -H &quot;Content-Type: application/json&quot; http://localhost:8080/runtime/tasks
</code></pre><p>哪个返回</p>
<pre><code class="prettyprint json">{
     &quot;order&quot;: &quot;asc&quot;,
     &quot;size&quot;: 1,
     &quot;sort&quot;: &quot;id&quot;,
     &quot;total&quot;: 1,
     &quot;data&quot;: [{
          &quot;id&quot;: &quot;14&quot;,
          &quot;processInstanceId&quot;: &quot;8&quot;,
          &quot;createTime&quot;: &quot;2015-02-16T13:11:26.078+01:00&quot;,
          &quot;description&quot;: &quot;Conduct a telephone interview with John Doe. Phone number = 123456789&quot;,
          &quot;name&quot;: &quot;Telephone interview&quot;
          ...
     }],
     &quot;start&quot;: 0
}
</code></pre><p>因此，我们的过程现在在<code>Telephone interview</code> 。在实际的应用程序中，将有一个任务列表和一个表单可以填写以完成此任务。让我们完成此任务（我们必须设置<code>telephoneInterviewOutcome</code>变量，因为专用网关使用它来路由执行）：</p>
<pre><code class="prettyprint sh">curl -u admin:admin -H &quot;Content-Type: application/json&quot; -d &#39;{&quot;action&quot; : &quot;complete&quot;, &quot;variables&quot;: [ {&quot;name&quot;:&quot;telephoneInterviewOutcome&quot;, &quot;value&quot;:true} ]}&#39; http://localhost:8080/runtime/tasks/14
</code></pre><p>当我们现在再次获得任务时，流程实例将在子流程（大矩形）中并行移动到两个任务：</p>
<pre><code class="prettyprint json">{
     &quot;order&quot;: &quot;asc&quot;,
     &quot;size&quot;: 2,
     &quot;sort&quot;: &quot;id&quot;,
     &quot;total&quot;: 2,
     &quot;data&quot;: [
          {
              ...
               &quot;name&quot;: &quot;Tech interview&quot;
          },
          {
              ...
               &quot;name&quot;: &quot;Financial negotiation&quot;
          }
     ],
     &quot;start&quot;: 0
}
</code></pre><p>现在，我们可以以类似的方式继续其余的过程，但是我将留给您一起尝试。</p><h2><a href="#testing" class="anchor" name="testing"></a>测试中</h2><p>使用Activiti创建业务流程的优势之一就是所有内容都只是Java。因此，可以使用单元测试将流程作为常规Java代码进行测试。Spring Boot使编写这样的测试变得轻而易举。</p><p>这是“快乐路径”的单元测试的样子（省略<code>@Autowired</code>字段并测试电子邮件服务器设置）。该代码还显示了使用Activiti API来查询给定组和流程实例的任务。</p>
<pre><code class="prettyprint java">@RunWith(SpringJUnit4ClassRunner.class)
@SpringApplicationConfiguration(classes = {MyApp.class})
@WebAppConfiguration
@IntegrationTest
public class HireProcessTest {

    @Test
    public void testHappyPath() {

        // Create test applicant
        Applicant applicant = new Applicant(&quot;John Doe&quot;, &quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="355f5a5d5b755456415c435c415c1b5a4752">[email&#160;protected]</a>&quot;, &quot;12344&quot;);
        applicantRepository.save(applicant);

        // Start process instance
        Map&lt;String, Object&gt; variables = new HashMap&lt;String, Object&gt;();
        variables.put(&quot;applicant&quot;, applicant);
        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(&quot;hireProcessWithJpa&quot;, variables);

        // First, the &#39;phone interview&#39; should be active
        Task task = taskService.createTaskQuery()
                .processInstanceId(processInstance.getId())
                .taskCandidateGroup(&quot;dev-managers&quot;)
                .singleResult();
        Assert.assertEquals(&quot;Telephone interview&quot;, task.getName());

        // Completing the phone interview with success should trigger two new tasks
        Map&lt;String, Object&gt; taskVariables = new HashMap&lt;String, Object&gt;();
        taskVariables.put(&quot;telephoneInterviewOutcome&quot;, true);
        taskService.complete(task.getId(), taskVariables);

        List&lt;Task&gt; tasks = taskService.createTaskQuery()
                .processInstanceId(processInstance.getId())
                .orderByTaskName().asc()
                .list();
        Assert.assertEquals(2, tasks.size());
        Assert.assertEquals(&quot;Financial negotiation&quot;, tasks.get(0).getName());
        Assert.assertEquals(&quot;Tech interview&quot;, tasks.get(1).getName());

        // Completing both should wrap up the subprocess, send out the &#39;welcome mail&#39; and end the process instance
        taskVariables = new HashMap&lt;String, Object&gt;();
        taskVariables.put(&quot;techOk&quot;, true);
        taskService.complete(tasks.get(0).getId(), taskVariables);

        taskVariables = new HashMap&lt;String, Object&gt;();
        taskVariables.put(&quot;financialOk&quot;, true);
        taskService.complete(tasks.get(1).getId(), taskVariables);

        // Verify email
        Assert.assertEquals(1, wiser.getMessages().size());

        // Verify process completed
        Assert.assertEquals(1, historyService.createHistoricProcessInstanceQuery().finished().count());

    }
</code></pre><h2><a href="#next-steps" class="anchor" name="next-steps"></a>下一步</h2>
<ul>
<li>我们还没有涉及Activiti的任何工具。除了引擎之外，还有很多其他功能，例如用于设计流程的Eclipse插件，云中的免费Web <a href="https://activiti.alfresco.com">编辑器</a> （还包括您可以从<a href="http://activiti.org/"><code>Activiti's</code>网站</a>获得的<code>.zip</code>下载中），该Web应用程序展示了许多功能，引擎， …</li>
<li>当前版本的Activiti（版本5.17.0）已与Spring Boot 1.1.6集成。但是，当前的主版本与1.2.1兼容。</li>
<li>使用Spring Boot 1.2.0给我们带来了一些甜蜜的东西，例如通过JTA支持XA事务。这意味着您可以使用JMS，JPA和Activiti逻辑轻松地在同一事务中连接流程！ ..这将我们带到了下一个……</li>
<li>在此示例中，我们主要关注于人机交互（几乎没有涉及）。但是围绕协调系统，您也可以做很多事情。Spring Boot集成还具有Spring Integration支持，您可以利用它以一种非常简洁的方式做到这一点！</li>
<li>当然，有关BPMN 2.0标准的更多内容。<a href="http://activiti.org/userguide/index.html#bpmnConstructs">在Activiti文档中</a>阅读有关它的更多信息。</li>
</ul></div>
</div>
<section id="disqus_thread"></section>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 2010;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>