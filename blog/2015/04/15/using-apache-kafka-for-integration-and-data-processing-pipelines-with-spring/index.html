<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title> Using Apache Kafka for Integration and Data Processing Pipelines with Spring</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content=" Using Apache Kafka for Integration and Data Processing Pipelines with Spring" />
<meta name="twitter:description" content="&lt;p&gt;Applications generated more and more data than ever before and a huge part of the challenge - before it can even be analyzed - is accommodating the load in the first place. &lt;a href=&quot;http://kafka.apache.org&quot;&gt;Apache’s Kafka&lt;/a&gt; meets this challenge. It was originally designed by LinkedIn and subsequently open-sourced in 2011. The project aims to provide a unified, high-throughput, low-latency platform for handling real-time data feeds. The design is heavily influenced by transaction logs. It is a messaging system, similar to traditional messaging systems like RabbitMQ, ActiveMQ, MQSeries, but it’s ideal for log aggregation, persistent messaging, fast (_hundreds_ of megabytes per second!) reads and writes, and can accommodate numerous clients. Naturally, this makes it &lt;em&gt;perfect&lt;/em&gt; for cloud-scale architectures!&lt;/p&gt;
" />
<meta name="twitter:creator" content="@starbuxman" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/fb22593caf24e4bb4c98d467cdd247e6?s=200" />

<meta property="og:title" content=" Using Apache Kafka for Integration and Data Processing Pipelines with Spring" />
<meta property="og:image" content="https://gravatar.com/avatar/fb22593caf24e4bb4c98d467cdd247e6?s=200" />
<meta property="og:description" content="&lt;p&gt;Applications generated more and more data than ever before and a huge part of the challenge - before it can even be analyzed - is accommodating the load in the first place. &lt;a href=&quot;http://kafka.apache.org&quot;&gt;Apache’s Kafka&lt;/a&gt; meets this challenge. It was originally designed by LinkedIn and subsequently open-sourced in 2011. The project aims to provide a unified, high-throughput, low-latency platform for handling real-time data feeds. The design is heavily influenced by transaction logs. It is a messaging system, similar to traditional messaging systems like RabbitMQ, ActiveMQ, MQSeries, but it’s ideal for log aggregation, persistent messaging, fast (_hundreds_ of megabytes per second!) reads and writes, and can accommodate numerous clients. Naturally, this makes it &lt;em&gt;perfect&lt;/em&gt; for cloud-scale architectures!&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2015-04-15 00:46:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title"> Using Apache Kafka for Integration and Data Processing Pipelines with Spring</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/fb22593caf24e4bb4c98d467cdd247e6?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/jlong">Josh Long</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2015-04-15 00:46:00.0">April 15, 2015</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="2080" href="/blog/2015/04/15/using-apache-kafka-for-integration-and-data-processing-pipelines-with-spring#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>Applications generated more and more data than ever before and a huge part of the challenge - before it can even be analyzed - is accommodating the load in the first place. <a href="https://kafka.apache.org">Apache&rsquo;s Kafka</a> meets this challenge. It was originally designed by LinkedIn and subsequently open-sourced in 2011. The project aims to provide a unified, high-throughput, low-latency platform for handling real-time data feeds. The design is heavily influenced by transaction logs. It is a messaging system, similar to traditional messaging systems like RabbitMQ, ActiveMQ, MQSeries, but it&rsquo;s ideal for log aggregation, persistent messaging, fast (_hundreds_ of megabytes per second!) reads and writes, and can accommodate numerous clients. Naturally, this makes it <em>perfect</em> for cloud-scale architectures!</p>
<p>Kafka <a href="https://cwiki.apache.org/confluence/display/KAFKA/Powered+By">powers many large production systems</a>. LinkedIn uses it for activity data and operational metrics to power the LinkedIn news feed, and LinkedIn Today, as well as offline analytics going into Hadoop. Twitter uses it as part of their stream-processing infrastructure. Kafka powers online-to-online and online-to-offline messaging at Foursquare. It is used to integrate Foursquare monitoring and production systems with Hadoop-based offline infrastructures. Square uses Kafka as a bus to move all system events through Square&rsquo;s various data centers. This includes metrics, logs, custom events, and so on. On the consumer side, it outputs into Splunk, Graphite, or Esper-like real-time alerting. Netflix uses it for 300-600BN messages per day. It&rsquo;s also used by Airbnb, Mozilla, Goldman Sachs, Tumblr, Yahoo, PayPal, Coursera, Urban Airship, Hotels.com, and a seemingly endless list of other big-web stars. Clearly, it&rsquo;s earning its keep in some powerful systems!</p><h2><a href="#installing-apache-kafka" class="anchor" name="installing-apache-kafka"></a>Installing Apache Kafka</h2>
<p>There are many different ways to get Apache Kafka installed. If you&rsquo;re on OSX, and you&rsquo;re using Homebrew, it can be as simple as <code>brew install kafka</code>. You can also <a href="https://kafka.apache.org/downloads.html">download the latest distribution from Apache</a>. I downloaded <code>kafka_2.10-0.8.2.1.tgz</code>, unzipped it, and then within you&rsquo;ll find there&rsquo;s a distribution of <a href="https://zookeeper.apache.org/">Apache Zookeeper</a> as well as Kafka, so nothing else is required. I installed Apache Kafka in my <code>$HOME</code> directory, under another directory, <code>bin</code>, then I created an environment variable, <code>KAFKA_HOME</code>, that points to <code>$HOME/bin/kafka</code>.</p>
<p>Start Apache Zookeeper first, specifying where the configuration properties file it requires is:</p>
<pre><code class="prettyprint">$KAFKA_HOME/bin/zookeeper-server-start.sh  $KAFKA_HOME/config/zookeeper.properties

</code></pre>
<p>The Apache Kafka distribution comes with default configuration files for both Zookeeper and Kafka, which makes getting started easy. You will in more advanced use cases need to customize these files.</p>
<p>Then start Apache Kafka. It too requires a configuration file, like this:</p>
<pre><code class="prettyprint">$KAFKA_HOME/bin/kafka-server-start.sh  $KAFKA_HOME/config/server.properties
</code></pre>
<p>The <code>server.properties</code> file contains, among other things, default values for where to connect to Apache Zookeeper (<code>zookeeper.connect</code>), how much data should be sent across sockets, how many partitions there are by default, and the broker ID (<code>broker.id</code> - which must be unique across a cluster).</p>
<p>There are other scripts in the same directory that can be used to send and receive dummy data, very handy in establishing that everything&rsquo;s up and running!</p>
<p>Now that Apache Kafka is up and running, let&rsquo;s look at working with Apache Kafka from our application.</p><h2><a href="#some-high-level-concepts" class="anchor" name="some-high-level-concepts"></a>Some High Level Concepts..</h2>
<p>A Kafka <em>broker</em> cluster consists of one or more servers where each may have one or more broker processes running. Apache Kafka is designed to be highly available; there are no <em>master</em> nodes. All nodes are interchangeable. Data is replicated from one node to another to ensure that it is still available in the event of a failure.</p>
<p>In Kafka, a <em>topic</em> is a category, similar to a JMS destination or both an AMQP exchange and queue. Topics are partitioned, and the choice of which of a topic&rsquo;s partition a message should be sent to is made by the message producer. Each message in the partition is assigned a unique sequenced ID, its <em>offset</em>. More partitions allow greater parallelism for consumption, but this will also result in more files across the brokers.</p>
<p><em>Producers</em> send messages to Apache Kafka broker topics and specify the partition to use for every message they produce. Message production may be synchronous or asynchronous. Producers also specify what sort of replication guarantees they want.</p>
<p><em>Consumers</em> listen for messages on topics and process the feed of published messages. As you&rsquo;d expect if you&rsquo;ve used other messaging systems, this is usually (and usefully!) asynchronous.</p>
<p>Like <a href="https://spring.io/projects/spring-xd">Spring XD</a> and numerous other distributed system, Apache Kafka uses Apache Zookeeper to coordinate cluster information. Apache Zookeeper provides a shared hierarchical namespace (called <em>znodes</em>) that nodes can share to understand cluster topology and availability (yet another reason that <a href="https://github.com/spring-cloud/spring-cloud-zookeeper">Spring Cloud</a> has forthcoming support for it..).</p>
<p>Zookeeper is very present in your interactions with Apache Kafka. Apache Kafka has, for example, two different APIs for acting as a consumer. The higher level API is simpler to get started with and it handles all the nuances of handling partitioning and so on. It will need a reference to a Zookeeper instance to keep the coordination state. </p>
<p>Let&rsquo;s turn now turn to using Apache Kafka with Spring.</p><h2><a href="#using-apache-kafka-with-spring-integration" class="anchor" name="using-apache-kafka-with-spring-integration"></a>Using Apache Kafka with Spring Integration</h2>
<p>The recently released <a href="https://spring.io/blog/2015/03/26/spring-integration-kafka-support-1-1-ga-is-available">Spring Integration for Apache Kafka 1.1</a> is very powerful, and provides inbound adapters for working with both the lower level Apache Kafka API as well as the higher level API.</p>
<p>The adapter, currently, is XML-configuration first, though work is already underway on a Spring Integration Java configuration DSL for the adapter and milestones are available. We&rsquo;ll look at both here, now.</p>
<p>To make all these examples work, I added the <a href="https://repo.spring.io/simple/libs-milestone-local">libs-milestone-local Maven repository</a> and used the following dependencies:</p>
<ul>
<li>org.apache.kafka:kafka_2.10:0.8.1.1</li>
<li>org.springframework.boot:spring-boot-starter-integration:1.2.3.RELEASE</li>
<li>org.springframework.boot:spring-boot-starter:1.2.3.RELEASE</li>
<li>org.springframework.integration:spring-integration-kafka:1.1.1.RELEASE</li>
<li>org.springframework.integration:spring-integration-java-dsl:1.1.0.M1</li>
</ul><h3><a href="#using-the-spring-integration-apache-kafka-with-the-spring-integration-xml-dsl" class="anchor" name="using-the-spring-integration-apache-kafka-with-the-spring-integration-xml-dsl"></a>Using the Spring Integration Apache Kafka with the Spring Integration XML DSL</h3>
<p>First, let&rsquo;s look at how to use the Spring Integration outbound adapter to send <code>Message&lt;T&gt;</code> instances from a Spring Integration flow to an external Apache Kafka instance. The example is fairly straightforward: a Spring Integration <code>channel</code> named <code>inputToKafka</code> acts as a conduit that forwards <code>Message&lt;T&gt;</code> messages to the outbound adapter, <code>kafkaOutboundChannelAdapter</code>. The adapter itself can take its configuration from the defaults specified in the <code>kafka:producer-context</code> element or it from the adapter-local configuration overrides. There may be one or many configurations in a given <code>kafka:producer-context</code> element.</p>
<pre><code class="prettyprint xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:int=&quot;http://www.springframework.org/schema/integration&quot;
       xmlns:int-kafka=&quot;http://www.springframework.org/schema/integration/kafka&quot;
       xmlns:task=&quot;http://www.springframework.org/schema/task&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/integration/kafka http://www.springframework.org/schema/integration/kafka/spring-integration-kafka.xsd
		http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task.xsd&quot;&gt;

    &lt;int:channel id=&quot;inputToKafka&quot;&gt;
        &lt;int:queue/&gt;
    &lt;/int:channel&gt;

    &lt;int-kafka:outbound-channel-adapter
            id=&quot;kafkaOutboundChannelAdapter&quot;
            kafka-producer-context-ref=&quot;kafkaProducerContext&quot;
            channel=&quot;inputToKafka&quot;&gt;
        &lt;int:poller fixed-delay=&quot;1000&quot; time-unit=&quot;MILLISECONDS&quot; receive-timeout=&quot;0&quot; task-executor=&quot;taskExecutor&quot;/&gt;
    &lt;/int-kafka:outbound-channel-adapter&gt;

    &lt;task:executor id=&quot;taskExecutor&quot; pool-size=&quot;5&quot; keep-alive=&quot;120&quot; queue-capacity=&quot;500&quot;/&gt;

    &lt;int-kafka:producer-context id=&quot;kafkaProducerContext&quot;&gt;
        &lt;int-kafka:producer-configurations&gt;
            &lt;int-kafka:producer-configuration broker-list=&quot;localhost:9092&quot;
                                              topic=&quot;event-stream&quot;
                                              compression-codec=&quot;default&quot;/&gt;
        &lt;/int-kafka:producer-configurations&gt;
    &lt;/int-kafka:producer-context&gt;

&lt;/beans&gt;
</code></pre>
<p>Here&rsquo;s the Java code from a Spring Boot application to trigger message sends using the outbound adapter by sending messages into the incoming <code>inputToKafka</code> <code>MessageChannel</code>.</p>
<pre><code class="prettyprint java">package xml;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.DependsOn;
import org.springframework.context.annotation.ImportResource;
import org.springframework.integration.config.EnableIntegration;
import org.springframework.messaging.MessageChannel;
import org.springframework.messaging.support.GenericMessage;

@SpringBootApplication
@EnableIntegration
@ImportResource(&quot;/xml/outbound-kafka-integration.xml&quot;)
public class DemoApplication {

    private Log log = LogFactory.getLog(getClass());

    @Bean
    @DependsOn(&quot;kafkaOutboundChannelAdapter&quot;)
    CommandLineRunner kickOff(@Qualifier(&quot;inputToKafka&quot;) MessageChannel in) {
        return args -&gt; {
            for (int i = 0; i &lt; 1000; i++) {
                in.send(new GenericMessage&lt;&gt;(&quot;#&quot; + i));
                log.info(&quot;sending message #&quot; + i);
            }
        };
    }

    public static void main(String args[]) {
        SpringApplication.run(DemoApplication.class, args);
    }
}

</code></pre><h3><a href="#using-the-new-apache-kafka-spring-integration-java-configuration-dsl" class="anchor" name="using-the-new-apache-kafka-spring-integration-java-configuration-dsl"></a>Using the New Apache Kafka Spring Integration Java Configuration DSL</h3>
<p>Shortly after the Spring Integration 1.1 release, Spring Integration rockstar <a href="https://spring.io/team/artembilan">Artem Bilan</a> got to work <a href="https://repo.spring.io/simple/libs-milestone-local/org/springframework/integration/spring-integration-java-dsl/1.1.0.M1/">on adding a Spring Integration Java Configuration DSL analog</a> and the result is a thing of beauty! It&rsquo;s not yet GA (you need to add the <code>libs-milestone</code> repository for now), but I encourage you to try it out and kick the tires. It&rsquo;s working well for me and the Spring Integration team are always keen on getting early feedback whenever possible! Here&rsquo;s an example that demonstrates both sending messages and consuming them from two different <code>IntegrationFlow</code>s. The producer is similar to the example XML above.</p>
<p>New in this example is the polling consumer. It is batch-centric, and will pull down all the messages it sees at a fixed interval. In our code, the message received will be a map that contains as its keys the topic and as its value another map with the partition ID and the batch (in this case, of 10 records), of records read. There is a <code>MessageListenerContainer</code>-based alternative that processes messages as they come. </p>
<pre><code class="prettyprint java">package jc;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.DependsOn;
import org.springframework.integration.IntegrationMessageHeaderAccessor;
import org.springframework.integration.config.EnableIntegration;
import org.springframework.integration.dsl.IntegrationFlow;
import org.springframework.integration.dsl.IntegrationFlows;
import org.springframework.integration.dsl.SourcePollingChannelAdapterSpec;
import org.springframework.integration.dsl.kafka.Kafka;
import org.springframework.integration.dsl.kafka.KafkaHighLevelConsumerMessageSourceSpec;
import org.springframework.integration.dsl.kafka.KafkaProducerMessageHandlerSpec;
import org.springframework.integration.dsl.support.Consumer;
import org.springframework.integration.kafka.support.ZookeeperConnect;
import org.springframework.messaging.MessageChannel;
import org.springframework.messaging.support.GenericMessage;
import org.springframework.stereotype.Component;

import java.util.List;
import java.util.Map;

/**
 * Demonstrates using the Spring Integration Apache Kafka Java Configuration DSL.
 * Thanks to Spring Integration ninja &lt;a href=&quot;http://spring.io/team/artembilan&quot;&gt;Artem Bilan&lt;/a&gt;
 * for getting the Java Configuration DSL working so quickly!
 *
 * @author Josh Long
 */
@EnableIntegration
@SpringBootApplication
public class DemoApplication {

  public static final String TEST_TOPIC_ID = &quot;event-stream&quot;;

  @Component
  public static class KafkaConfig {

    @Value(&quot;${kafka.topic:&quot; + TEST_TOPIC_ID + &quot;}&quot;)
    private String topic;

    @Value(&quot;${kafka.address:localhost:9092}&quot;)
    private String brokerAddress;

    @Value(&quot;${zookeeper.address:localhost:2181}&quot;)
    private String zookeeperAddress;

    KafkaConfig() {
    }

    public KafkaConfig(String t, String b, String zk) {
        this.topic = t;
        this.brokerAddress = b;
        this.zookeeperAddress = zk;
    }

    public String getTopic() {
        return topic;
    }

    public String getBrokerAddress() {
        return brokerAddress;
    }

    public String getZookeeperAddress() {
        return zookeeperAddress;
    }
  }

  @Configuration
  public static class ProducerConfiguration {

    @Autowired
    private KafkaConfig kafkaConfig;

    private static final String OUTBOUND_ID = &quot;outbound&quot;;

    private Log log = LogFactory.getLog(getClass());

    @Bean
    @DependsOn(OUTBOUND_ID)
    CommandLineRunner kickOff( 
           @Qualifier(OUTBOUND_ID + &quot;.input&quot;) MessageChannel in) {
        return args -&gt; {
            for (int i = 0; i &lt; 1000; i++) {
                in.send(new GenericMessage&lt;&gt;(&quot;#&quot; + i));
                log.info(&quot;sending message #&quot; + i);
            }
        };
    }

    @Bean(name = OUTBOUND_ID)
    IntegrationFlow producer() {

      log.info(&quot;starting producer flow..&quot;);
      return flowDefinition -&gt; {

        Consumer&lt;KafkaProducerMessageHandlerSpec.ProducerMetadataSpec&gt; spec =
          (KafkaProducerMessageHandlerSpec.ProducerMetadataSpec metadata)-&gt;
            metadata.async(true)
              .batchNumMessages(10)
              .valueClassType(String.class)
              .&lt;String&gt;valueEncoder(String::getBytes);

        KafkaProducerMessageHandlerSpec messageHandlerSpec =
          Kafka.outboundChannelAdapter(
               props -&gt; props.put(&quot;queue.buffering.max.ms&quot;, &quot;15000&quot;))
            .messageKey(m -&gt; m.getHeaders().get(IntegrationMessageHeaderAccessor.SEQUENCE_NUMBER))
            .addProducer(this.kafkaConfig.getTopic(), 
                this.kafkaConfig.getBrokerAddress(), spec);
        flowDefinition
            .handle(messageHandlerSpec);
      };
    }
  }

  @Configuration
  public static class ConsumerConfiguration {

    @Autowired
    private KafkaConfig kafkaConfig;

    private Log log = LogFactory.getLog(getClass());

    @Bean
    IntegrationFlow consumer() {

      log.info(&quot;starting consumer..&quot;);

      KafkaHighLevelConsumerMessageSourceSpec messageSourceSpec = Kafka.inboundChannelAdapter(
          new ZookeeperConnect(this.kafkaConfig.getZookeeperAddress()))
            .consumerProperties(props -&gt;
                props.put(&quot;auto.offset.reset&quot;, &quot;smallest&quot;)
                     .put(&quot;auto.commit.interval.ms&quot;, &quot;100&quot;))
            .addConsumer(&quot;myGroup&quot;, metadata -&gt; metadata.consumerTimeout(100)
              .topicStreamMap(m -&gt; m.put(this.kafkaConfig.getTopic(), 1))
              .maxMessages(10)
              .valueDecoder(String::new));

      Consumer&lt;SourcePollingChannelAdapterSpec&gt; endpointConfigurer = e -&gt; e.poller(p -&gt; p.fixedDelay(100));

      return IntegrationFlows
        .from(messageSourceSpec, endpointConfigurer)
        .&lt;Map&lt;String, List&lt;String&gt;&gt;&gt;handle((payload, headers) -&gt; {
            payload.entrySet().forEach(e -&gt; log.info(e.getKey() + &#39;=&#39; + e.getValue()));
            return null;
        })
        .get();
    }
  }

  public static void main(String[] args) {
      SpringApplication.run(DemoApplication.class, args);
  }
}

</code></pre>
<p>The example makes heavy use of Java 8 lambdas. </p>
<p>The producer spends a bit of time establishing how many messages will be sent in a single send operation, how keys and values are encoded (Kafka only knows about <code>byte[]</code> arrays, after all) and whether messages should be sent synchronously or asynchronously. In the next line, we configure the outbound adapter itself and then define an <code>IntegrationFlow</code> such that all messages get sent out via the Kafka outbound adapter. </p>
<p>The consumer spends a bit of time establishing which Zookeeper instance to connect to, how many messages to receive (10) in a batch, etc. Once the message batches are recieved, they&rsquo;re handed to the <code>handle</code> method where I&rsquo;ve passed in a lambda that&rsquo;ll enumerate the payload&rsquo;s body and print it out. Nothing fancy. </p><h2><a href="#using-apache-kafka-with-spring-xd" class="anchor" name="using-apache-kafka-with-spring-xd"></a>Using Apache Kafka with Spring XD</h2>
<p>Apache Kafka is a message bus and it can be very powerful when used as an integration bus. However, it really comes into its own because it&rsquo;s fast enough and scalable enough that it can be used to route big-data through processing pipelines. And if you&rsquo;re doing data processing, you really want <a href="https://projects.spring.io/spring-xd/">Spring XD</a>! Spring XD makes it dead simple to use Apache Kafka (as the support is built on the Apache Kafka Spring Integration adapter!) in complex stream-processing pipelines. Apache Kafka is exposed as a Spring XD <em>source</em> - where data comes from - and a sink - where data goes to.</p>
<img src="https://projects.spring.io/spring-xd/img/spring-xd-unified-platform-for-big-data.png" />
<p>Spring XD exposes a super convenient DSL for creating <code>bash</code>-like pipes-and-filter flows. Spring XD is a centralized runtime that manages, scales, and monitors data processing jobs. It builds on top of Spring Integration, Spring Batch, Spring Data and Spring for Hadoop to be a one-stop data-processing shop. Spring XD Jobs read data from <em>sources</em>, run them through processing components that may count, filter, enrich or transform the data, and then write them to sinks.</p>
<p>Spring Integration and Spring XD ninja <a href="https://twitter.com/mariusbogoevici">Marius Bogoevici</a>, who did a lot of the recent work in the Spring Integration and Spring XD implementation of Apache Kafka, put together a really nice example demonstrating <a href="https://github.com/spring-projects/spring-xd-samples/tree/master/kafka-source">how to get a full working Spring XD and Kafka flow working</a>. The <code>README</code> walks you through getting Apache Kafka, Spring XD and the requisite topics all setup. The essence, however, is when you use the Spring XD shell and the shell DSL to compose a stream. Spring XD components are named components that are pre-configured but have lots of parameters that you can override with <code>--..</code> arguments via the XD shell and DSL. (That DSL, by the way, is written by the amazing <a href="https://spring.io/team/aclement">Andy Clement</a> of Spring Expression language fame!) Here&rsquo;s an example that configures a stream to read data from an Apache Kafka source and then write the message a component called <code>log</code>, which is a sink. <code>log</code>, in this case, could be syslogd, Splunk, HDFS, etc.</p>
<pre><code class="prettyprint bash">xd&gt; stream create kafka-source-test --definition &quot;kafka --zkconnect=localhost:2181 --topic=event-stream | log&quot; --deploy

</code></pre>
<p>And that&rsquo;s it! Naturally, this is just a tase of Spring XD, but hopefully you&rsquo;ll agree the possibilities are tantalizing.</p><h2><a href="#deploying-a-kafka-server-with-lattice-and-docker" class="anchor" name="deploying-a-kafka-server-with-lattice-and-docker"></a>Deploying a Kafka Server with Lattice and Docker</h2>
<p>It&rsquo;s easy to get an example Kafka installation all setup using <a href="http://lattice.cf">Lattice</a>, a distributed runtime that supports, among other container formats, the very popular Docker image format. <a href="https://github.com/spotify/docker-kafka">There&rsquo;s a Docker image provided by Spotify that sets up a collocated Zookeeper and Kafka image</a>. You can easily deploy this to a Lattice cluster, as follows:</p>
<pre><code class="prettyprint bash">ltc create --run-as-root m-kafka spotify/kafka
</code></pre>
<p>From there, you can easily scale the Apache Kafka instances and even more easily still consume Apache Kafka from your cloud-based services. </p><h2><a href="#next-steps" class="anchor" name="next-steps"></a>Next Steps</h2>
<p>You can find the code <a href="https://github.com/joshlong/spring-and-kafka">for this blog on my GitHub account</a>.</p>
<p>We&rsquo;ve only scratched the surface! </p>
<p>If you want to learn more (and why wouldn&rsquo;t you?), then be sure to check out Marius Bogoevici and Dr. Mark Pollack&rsquo;s upcoming <a href="https://spring.io/blog/2015/03/17/webinar-reactive-data-pipelines-with-spring-xd-and-kafka">webinar on Reactive data-pipelines using Spring XD and Apache Kafka</a> where they&rsquo;ll demonstrate how easy it can be to use RxJava, Spring XD and Apache Kafka!</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 2080;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>