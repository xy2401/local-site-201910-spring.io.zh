<html dir="ltr" data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>React.js和Spring Data REST：第3部分-条件操作</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>System.config({baseURL: "/b92013b"});</script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>System.import('app/main.js')</script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="React.js and Spring Data REST: Part 3 - Conditional Operations">
<meta name="twitter:description" content="<div id=" preambl="="> 
 </head><body dir="ltr"><div class="sectionbody"> 
  <div class="admonitionblock note"> 
   <table> 
    <tbody> 
     <tr> 
      <td class="icon"> <i class="fa icon-note" title="注意"></i> </td> 
      <td class="content">To see updates to this code, visit our <a href="https://spring.io/guides/tutorials/react-and-spring-data-rest/">React.js and Spring Data REST tutorial</a>.</td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <div class="paragraph"> 
   <p>In the <a href="https://spring.io/blog/2015/09/15/react-js-and-spring-data-rest-part-2-hypermedia">previous session</a>, you found out how to turn on Spring Data REST’s hypermedia controls, have the UI navigate by paging, and dynamically resize based on changing the page size. You added the ability to create and delete employees and have the pages adjust. But no solution is complete with taking into consideration updates made by other users on the same bit of data you are currently editing.</p> 
  </div> 
  <div class="paragraph"> 
   <p>Feel free to <a href="https://github.com/gregturn/react-and-spring-data-rest/tree/master/conditional">grab the code</a> from this repository and follow along. This session is based on the previous session’s app with extra things added.</p> 
  </div> 
 </div> 

">
<meta name="twitter:creator" content="@gregturn">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/43e9a9d63f7f4f9891c9fcd592b89cfa?s=200">

<meta property="og:title" content="React.js and Spring Data REST: Part 3 - Conditional Operations">
<meta property="og:image" content="https://gravatar.com/avatar/43e9a9d63f7f4f9891c9fcd592b89cfa?s=200">
<meta property="og:description" content="<div id=" preambl="="> 
 <div class="sectionbody"> 
  <div class="admonitionblock note"> 
   <table> 
    <tbody> 
     <tr> 
      <td class="icon"> <i class="fa icon-note" title="注意"></i> </td> 
      <td class="content">To see updates to this code, visit our <a href="https://spring.io/guides/tutorials/react-and-spring-data-rest/">React.js and Spring Data REST tutorial</a>.</td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <div class="paragraph"> 
   <p>In the <a href="https://spring.io/blog/2015/09/15/react-js-and-spring-data-rest-part-2-hypermedia">previous session</a>, you found out how to turn on Spring Data REST’s hypermedia controls, have the UI navigate by paging, and dynamically resize based on changing the page size. You added the ability to create and delete employees and have the pages adjust. But no solution is complete with taking into consideration updates made by other users on the same bit of data you are currently editing.</p> 
  </div> 
  <div class="paragraph"> 
   <p>Feel free to <a href="https://github.com/gregturn/react-and-spring-data-rest/tree/master/conditional">grab the code</a> from this repository and follow along. This session is based on the previous session’s app with extra things added.</p> 
  </div> 
 </div> 

">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2015-09-29 12:00:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">// Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }</script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">React.js和Spring Data REST：第3部分-条件操作</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/43e9a9d63f7f4f9891c9fcd592b89cfa?s=20&d=mm"> <a class="author" rel="author" href="/team/gturnquist">格雷格·特恩奎斯特</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2015-09-29 12:00:00.0">2015年9月29日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2015/09/29/react-js-and-spring-data-rest-part-3-conditional-operations#disqus_thread" data-disqus-identifier="2243">
</a></div>
</div>
</header>
<div class="blog--post"><div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="注意"></i> </td>
<td class="content">要查看此代码的更新，请访问我们的<a href="https://spring.io/guides/tutorials/react-and-spring-data-rest/">React.js和Spring Data REST教程</a> 。</td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph">
<p>在<a href="https://spring.io/blog/2015/09/15/react-js-and-spring-data-rest-part-2-hypermedia">上一课中</a> ，您了解了如何打开Spring Data REST的超媒体控件，如何使UI通过分页导航以及如何根据更改页面大小来动态调整大小。您添加了创建和删除员工以及调整页面的功能。但是，要考虑到其他用户对您当前正在编辑的相同数据进行的更新，还没有一个完整的解决方案。</p>
</div>
<div class="paragraph">
<p>随时从该存储库中<a href="https://github.com/gregturn/react-and-spring-data-rest/tree/master/conditional">获取代码</a>并继续。该会话基于上一会话的应用程序，并添加了其他内容。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_to_put_or_not_to_put_that_is_the_question">要PUT还是不PUT，这就是问题</h2>
<div class="sectionbody">
<div class="paragraph">
<p>当您获取资源时，如果其他人对其进行更新，则可能会过时。为了解决这个问题，Spring Data REST集成了两种技术：资源版本控制和ETag。</p>
</div>
<div class="paragraph">
<p>通过在后端对资源进行版本控制并在前端使用ETag，可以有意地将更改放入PUT。换句话说，您可以检测资源是否已更改，并防止PUT（或PATCH）踩到别人的更新。让我们来看看。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_versioning_rest_resources">REST资源版本控制</h2>
<div class="sectionbody">
<div class="paragraph">
<p>要支持资源的版本控制，请为需要这种保护类型的域对象定义一个版本属性。</p>
</div>
<div class="listingblock">
<div class="title">src / main / java / com / greglturnquist / payroll / Employee.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Data
@Entity
public class Employee {

	private @Id @GeneratedValue Long id;
	private String firstName;
	private String lastName;
	private String description;

	private @Version @JsonIgnore Long version;

	private Employee() {}

	public Employee(String firstName, String lastName, String description) {
		this.firstName = firstName;
		this.lastName = lastName;
		this.description = description;
	}
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>版本</strong>字段使用<code>javax.persistence.Version</code></p><code>javax.persistence.Version</code></li><code>javax.persistence.Version</code></ul><code>javax.persistence.Version</code></div><code>javax.persistence.Version</code></div><code>javax.persistence.Version</code></div><code>javax.persistence.Version</code></div><code>javax.persistence.Version</code></div></article><code>javax.persistence.Version</code></div><code>javax.persistence.Version</code></div><code>javax.persistence.Version</code></div><code>javax.persistence.Version</code></div><code>javax.persistence.Version</code></body></html>