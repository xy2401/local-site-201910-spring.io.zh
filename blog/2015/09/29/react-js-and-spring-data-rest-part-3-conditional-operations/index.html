<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>React.js and Spring Data REST: Part 3 - Conditional Operations</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="React.js and Spring Data REST: Part 3 - Conditional Operations" />
<meta name="twitter:description" content="&lt;div id=&quot;preamble&quot;&gt; 
 &lt;div class=&quot;sectionbody&quot;&gt; 
  &lt;div class=&quot;admonitionblock note&quot;&gt; 
   &lt;table&gt; 
    &lt;tbody&gt; 
     &lt;tr&gt; 
      &lt;td class=&quot;icon&quot;&gt; &lt;i class=&quot;fa icon-note&quot; title=&quot;Note&quot;&gt;&lt;/i&gt; &lt;/td&gt; 
      &lt;td class=&quot;content&quot;&gt;To see updates to this code, visit our &lt;a href=&quot;https://spring.io/guides/tutorials/react-and-spring-data-rest/&quot;&gt;React.js and Spring Data REST tutorial&lt;/a&gt;.&lt;/td&gt; 
     &lt;/tr&gt; 
    &lt;/tbody&gt; 
   &lt;/table&gt; 
  &lt;/div&gt; 
  &lt;div class=&quot;paragraph&quot;&gt; 
   &lt;p&gt;In the &lt;a href=&quot;https://spring.io/blog/2015/09/15/react-js-and-spring-data-rest-part-2-hypermedia&quot;&gt;previous session&lt;/a&gt;, you found out how to turn on Spring Data REST’s hypermedia controls, have the UI navigate by paging, and dynamically resize based on changing the page size. You added the ability to create and delete employees and have the pages adjust. But no solution is complete with taking into consideration updates made by other users on the same bit of data you are currently editing.&lt;/p&gt; 
  &lt;/div&gt; 
  &lt;div class=&quot;paragraph&quot;&gt; 
   &lt;p&gt;Feel free to &lt;a href=&quot;https://github.com/gregturn/react-and-spring-data-rest/tree/master/conditional&quot;&gt;grab the code&lt;/a&gt; from this repository and follow along. This session is based on the previous session’s app with extra things added.&lt;/p&gt; 
  &lt;/div&gt; 
 &lt;/div&gt; 
&lt;/div&gt;
" />
<meta name="twitter:creator" content="@gregturn" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/43e9a9d63f7f4f9891c9fcd592b89cfa?s=200" />

<meta property="og:title" content="React.js and Spring Data REST: Part 3 - Conditional Operations" />
<meta property="og:image" content="https://gravatar.com/avatar/43e9a9d63f7f4f9891c9fcd592b89cfa?s=200" />
<meta property="og:description" content="&lt;div id=&quot;preamble&quot;&gt; 
 &lt;div class=&quot;sectionbody&quot;&gt; 
  &lt;div class=&quot;admonitionblock note&quot;&gt; 
   &lt;table&gt; 
    &lt;tbody&gt; 
     &lt;tr&gt; 
      &lt;td class=&quot;icon&quot;&gt; &lt;i class=&quot;fa icon-note&quot; title=&quot;Note&quot;&gt;&lt;/i&gt; &lt;/td&gt; 
      &lt;td class=&quot;content&quot;&gt;To see updates to this code, visit our &lt;a href=&quot;https://spring.io/guides/tutorials/react-and-spring-data-rest/&quot;&gt;React.js and Spring Data REST tutorial&lt;/a&gt;.&lt;/td&gt; 
     &lt;/tr&gt; 
    &lt;/tbody&gt; 
   &lt;/table&gt; 
  &lt;/div&gt; 
  &lt;div class=&quot;paragraph&quot;&gt; 
   &lt;p&gt;In the &lt;a href=&quot;https://spring.io/blog/2015/09/15/react-js-and-spring-data-rest-part-2-hypermedia&quot;&gt;previous session&lt;/a&gt;, you found out how to turn on Spring Data REST’s hypermedia controls, have the UI navigate by paging, and dynamically resize based on changing the page size. You added the ability to create and delete employees and have the pages adjust. But no solution is complete with taking into consideration updates made by other users on the same bit of data you are currently editing.&lt;/p&gt; 
  &lt;/div&gt; 
  &lt;div class=&quot;paragraph&quot;&gt; 
   &lt;p&gt;Feel free to &lt;a href=&quot;https://github.com/gregturn/react-and-spring-data-rest/tree/master/conditional&quot;&gt;grab the code&lt;/a&gt; from this repository and follow along. This session is based on the previous session’s app with extra things added.&lt;/p&gt; 
  &lt;/div&gt; 
 &lt;/div&gt; 
&lt;/div&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2015-09-29 12:00:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">React.js and Spring Data REST: Part 3 - Conditional Operations</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/43e9a9d63f7f4f9891c9fcd592b89cfa?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/gturnquist">Greg Turnquist</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2015-09-29 12:00:00.0">September 29, 2015</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="2243" href="/blog/2015/09/29/react-js-and-spring-data-rest-part-3-conditional-operations#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tbody>
<tr>
<td class="icon"> <i class="fa icon-note" title="Note"></i> </td>
<td class="content">To see updates to this code, visit our <a href="https://spring.io/guides/tutorials/react-and-spring-data-rest/">React.js and Spring Data REST tutorial</a>.</td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph">
<p>In the <a href="https://spring.io/blog/2015/09/15/react-js-and-spring-data-rest-part-2-hypermedia">previous session</a>, you found out how to turn on Spring Data REST&#8217;s hypermedia controls, have the UI navigate by paging, and dynamically resize based on changing the page size. You added the ability to create and delete employees and have the pages adjust. But no solution is complete with taking into consideration updates made by other users on the same bit of data you are currently editing.</p>
</div>
<div class="paragraph">
<p>Feel free to <a href="https://github.com/gregturn/react-and-spring-data-rest/tree/master/conditional">grab the code</a> from this repository and follow along. This session is based on the previous session&#8217;s app with extra things added.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_to_put_or_not_to_put_that_is_the_question">To PUT or not to PUT, that is the question</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you fetch a resource, there is risk is that it might go stale if someone else updates it. To deal with this, Spring Data REST integrates two technologies: versioning of resources and ETags.</p>
</div>
<div class="paragraph">
<p>By versioning resources on the backend and using ETags in the frontend, it is possible to conditially PUT a change. In other words, you can detect if a resource has changed and prevent a PUT (or a PATCH) from stomping on someone else&#8217;s update. Let&#8217;s check it out.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_versioning_rest_resources">Versioning REST resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To support versioning of resources, define a version attribute for your domain objects that need this type of protection.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/com/greglturnquist/payroll/Employee.java</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Data
@Entity
public class Employee {

	private @Id @GeneratedValue Long id;
	private String firstName;
	private String lastName;
	private String description;

	private @Version @JsonIgnore Long version;

	private Employee() {}

	public Employee(String firstName, String lastName, String description) {
		this.firstName = firstName;
		this.lastName = lastName;
		this.description = description;
	}
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>version</strong> field is annoated with <code>javax.persistence.Version</code>. It causes a value to be automatically stored and updated everytime a row is inserted and updated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When fetching an individual resource (not a collection resource), Spring Data REST will automatically add an <a href="https://tools.ietf.org/html/rfc7232#section-2.3">ETag response header</a> with the value of this field.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fetching_individual_resources_and_their_headers">Fetching individual resources and their headers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the <a href="https://spring.io/blog/2015/09/15/react-js-and-spring-data-rest-part-2-hypermedia">previous session</a> you used the collection resource to gather data and populate the UI&#8217;s HTML table. With Spring Data REST, the <strong>_embedded</strong> data set is considered a preview of data. While useful for glancing at data, to get headers like ETags, you need to fetch each resource individually.</p>
</div>
<div class="paragraph">
<p>In this version, <code>loadFromServer</code> is updated to fetch the collection and then use the URIs to retrieve each individual resource.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/static/app.jsx - Fetching each resource</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">loadFromServer: function (pageSize) {
    follow(client, root, [
        {rel: 'employees', params: {size: pageSize}}]
    ).then(employeeCollection =&gt; {
        return client({
            method: 'GET',
            path: employeeCollection.entity._links.profile.href,
            headers: {'Accept': 'application/schema+json'}
        }).then(schema =&gt; {
            this.schema = schema.entity;
            this.links = employeeCollection.entity._links;
            return employeeCollection;
        });
    }).then(employeeCollection =&gt; {
        return employeeCollection.entity._embedded.employees.map(employee =&gt;
                client({
                    method: 'GET',
                    path: employee._links.self.href
                })
        );
    }).then(employeePromises =&gt; {
        return when.all(employeePromises);
    }).done(employees =&gt; {
        this.setState({
            employees: employees,
            attributes: Object.keys(this.schema.properties),
            pageSize: pageSize,
            links: this.links
        });
    });
},</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
The <code>follow()</code> function goes to the <strong>employees</strong> collection resource.
</li>
<li>
The <code>then(employeeCollection &#8658; &#8230;&#8203;)</code> clause creates a call to fetch JSON Schema data. This has a sub-then clause to store the metadata and navigational links in the <code>&lt;App/&gt;</code> component.
<div class="ulist">
<ul>
<li>
Notice that this embedded promise returns the employeeCollection. That way, the collection can be passed onto the next call while letting you grab the metadata along the way.
</li>
</ul>
</div>
</li>
<li>
The second <code>then(employeeCollection &#8658; &#8230;&#8203;)</code> clause converts the collection of employees into an array of GET promises to fetch each individual resource. <strong>This is what you need to fetch an ETag header for each employee.</strong>
</li>
<li>
The <code>then(employeePromises &#8658; &#8230;&#8203;)</code> clause takes the array of GET promises and merges them into a single promise with <code>when.all()</code>, resolved when all the GET promises are resolved.
</li>
<li>
<code>loadFromServer</code> wraps up with <code>done(employees &#8658; &#8230;&#8203;)</code> where the UI state is updated using this amalgamation of data.
</li>
</ol>
</div>
<div class="paragraph">
<p>This chain is implemented in other places as well. For example, <code>onNavigate()</code>, which is used to jump to different pages, has been updated to fetch individual resources. Since it&#8217;s mostly the same as what&#8217;s shown above, it&#8217;s been left out of this session.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_updating_existing_resources">Updating existing resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this session, you are adding an <code>UpdateDialog</code> React component to edit existing employee records.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/static/app.jsx - UpdateDialog component</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var UpdateDialog = React.createClass({

    handleSubmit: function (e) {
        e.preventDefault();
        var updatedEmployee = {};
        this.props.attributes.forEach(attribute =&gt; {
            updatedEmployee[attribute] = React.findDOMNode(this.refs[attribute]).value.trim();
        });
        this.props.onUpdate(this.props.employee, updatedEmployee);
        window.location = "#";
    },

    render: function () {
        var inputs = this.props.attributes.map(attribute =&gt;
                &lt;p key={this.props.employee.entity[attribute]}&gt;
                    &lt;input type="text" placeholder={attribute}
                           defaultValue={this.props.employee.entity[attribute]}
                           ref={attribute} className="field" /&gt;
                &lt;/p&gt;
        );

        var dialogId = "updateEmployee-" + this.props.employee.entity._links.self.href;

        return (
            &lt;div key={this.props.employee.entity._links.self.href}&gt;
                &lt;a href={"#" + dialogId}&gt;Update&lt;/a&gt;
                &lt;div id={dialogId} className="modalDialog"&gt;
                    &lt;div&gt;
                        &lt;a href="#" title="Close" className="close"&gt;X&lt;/a&gt;

                        &lt;h2&gt;Update an employee&lt;/h2&gt;

                        &lt;form&gt;
                            {inputs}
                            &lt;button onClick={this.handleSubmit}&gt;Update&lt;/button&gt;
                        &lt;/form&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        )
    }

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>This new component has both a <code>handleSubmit()</code> function as well as the expected <code>render()</code> function, similar to the <code>&lt;CreateDialog /&gt;</code> component.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s dig into these functions in reverse order, and first look at the <code>render()</code> function.</p>
</div>
<div class="sect2">
<h3 id="_rendering">Rendering</h3>
<div class="paragraph">
<p>This component uses the same CSS/HTML tactics to show and hide the dialog as the <code>&lt;CreateDialog /&gt;</code> from the previous session.</p>
</div>
<div class="paragraph">
<p>It converts the array of JSON Schema attributes into an array of HTML inputs, wrapped in paragraph elements for styling. This is also the same as the <code>&lt;CreateDialog /&gt;</code> with one difference: the fields are loaded with <strong>this.props.employee</strong>. In the CreateDialog component, the fields are empty.</p>
</div>
<div class="paragraph">
<p>The <strong>id</strong> field is built differently. There is only one CreateDialog link on the entire UI, but a separate UpdateDialog link for every row displayed. Hence, the <strong>id</strong> field is based on the <strong>self</strong> link&#8217;s URI. This is used in both the &lt;div&gt; element&#8217;s React <strong>key</strong> as well as the HTML anchor tag and the hidden pop-up.</p>
</div>
</div>
<div class="sect2">
<h3 id="_handling_user_input">Handling user input</h3>
<div class="paragraph">
<p>The submit button is linked to the component&#8217;s <code>handleSubmit()</code> function. This handily uses <code>React.findDOMNode()</code> to extract the details of the pop-up using <a href="https://facebook.github.io/react/docs/more-about-refs.html">React refs</a>.</p>
</div>
<div class="paragraph">
<p>After the input values are extracted and loaded into the <code>updatedEmployee</code> object, the top-level <code>onUpdate()</code> method is invoked. This continues React&#8217;s style of one-way binding where the functions to call are pushed from upper level components into the lower level ones. This way, state is still managed at the top.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conditional_put">Conditional PUT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So you&#8217;ve gone to all this effort to embed versioning in the data model. Spring Data REST has served up that value as an ETag response header. Here is where you get to put it to good use!</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/static/app.jsx - onUpdate function</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">onUpdate: function (employee, updatedEmployee) {
    client({
        method: 'PUT',
        path: employee.entity._links.self.href,
        entity: updatedEmployee,
        headers: {
            'Content-Type': 'application/json',
            'If-Match': employee.headers.Etag
        }
    }).done(response =&gt; {
        this.loadFromServer(this.state.pageSize);
    }, response =&gt; {
        if (response.status.code === 412) {
            alert('DENIED: Unable to update ' +
                employee.entity._links.self.href + '. Your copy is stale.');
        }
    });
},</code></pre>
</div>
</div>
<div class="paragraph">
<p>PUT with an <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.24">If-Match request header</a> causes Spring Data REST to check the value against the current version. If the incoming <strong>If-Match</strong> value doesn&#8217;t match the data store&#8217;s version value, Spring Data REST will fail with an <strong>HTTP 412 Precondition Failed</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The spec for <a href="https://promisesaplus.com/">Promises/A+</a> actually defines their API as <code>then(successFunction, errorFunction)</code>. So far, you&#8217;ve only seen it used with success functions. In the code fragment above, there are two functions. The success function invokes <code>loadFromServer</code> while the error function displays a browser alert about the stale data.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_putting_it_all_together">Putting it all together</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With your <code>UpdateDialog</code> React component defined and nicely linked to the top-level <code>onUpdate</code> function, the last step is to wire it into the existing layout of components.</p>
</div>
<div class="paragraph">
<p>The <code>CreateDialog</code> created in the previous session was put at the top of the <code>EmployeeList</code> because there is only one instance. However, <code>UpdateDialog</code> is tied directly to specific employees. So you can see it plugged in below in the <code>Employee</code> React component:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/static/app.jsx - Employee with UpdateDialog</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var Employee = React.createClass({
    handleDelete: function () {
        this.props.onDelete(this.props.employee);
    },
    render: function () {
        return (
            &lt;tr&gt;
                &lt;td&gt;{this.props.employee.entity.firstName}&lt;/td&gt;
                &lt;td&gt;{this.props.employee.entity.lastName}&lt;/td&gt;
                &lt;td&gt;{this.props.employee.entity.description}&lt;/td&gt;
                &lt;td&gt;
                    &lt;UpdateDialog employee={this.props.employee}
                                  attributes={this.props.attributes}
                                  onUpdate={this.props.onUpdate}/&gt;
                &lt;/td&gt;
                &lt;td&gt;
                    &lt;button onClick={this.handleDelete}&gt;Delete&lt;/button&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        )
    }
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this session, you switch from using the collection resource to individual resources. The fields for an employee record are now found at <code>this.props.employee.entity</code>. It gives us access to <code>this.props.employee.headers</code> where we can find ETags.</p>
</div>
<div class="paragraph">
<p>There are other headers supported by Spring Data REST (like <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.29">Last-Modified</a>) which aren&#8217;t part of this series. So structuring your data this way is handy.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The structure of <code>.entity</code> and <code>.headers</code> is only pertinent when using <a href="https://github.com/cujojs/rest">rest.js</a> as the REST library of choice. If you use a different library, you will have to adapt as necessary.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_seeing_things_in_action">Seeing things in action</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
Start up the app (<code>./mvnw spring-boot:run</code>).
</li>
<li>
Open up a tab and navigate to <a href="http://localhost:8080" class="bare">http://localhost:8080</a>.
<div class="imageblock">
<div class="content">
<img src="https://github.com/gregturn/react-and-spring-data-rest/raw/master/conditional/images/conditional-1.png" alt="conditional 1">
</div>
</div>
</li>
<li>
Pull up the edit dialog for Frodo.
</li>
<li>
Open another tab in your browser and pull up the same record.
</li>
<li>
Make a change to the record in the first tab.
</li>
<li>
Try to make a change in the second tab.
<div class="imageblock">
<div class="content">
<img src="https://github.com/gregturn/react-and-spring-data-rest/raw/master/conditional/images/conditional-2.png" alt="conditional 2">
</div>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="https://github.com/gregturn/react-and-spring-data-rest/raw/master/conditional/images/conditional-3.png" alt="conditional 3">
</div>
</div>
<div class="paragraph">
<p>With these mods, you have increased data integrity by avoiding collisions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_review">Review</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this session:</p>
</div>
<div class="ulist">
<ul>
<li>
You configured your domain model with an <code>@Version</code> field for JPA-based optimistic locking.
</li>
<li>
You adjusted the frontend to fetch individual resources.
</li>
<li>
You plugged the ETag header from an individual resource into an <strong>If-Match</strong> request header to make PUTs conditional.
</li>
<li>
You coded a new UpdateDialog for each employee shown on the list.
</li>
</ul>
</div>
<div class="paragraph">
<p>With this plugged in, it&#8217;s easy to avoid colliding with other users, or simply overwriting their edits.</p>
</div>
<div class="paragraph">
<p>Issues?</p>
</div>
<div class="paragraph">
<p>It&#8217;s certainly nice to know when you&#8217;re editing a bad record. But is it best to wait until you click "Submit" to find out?</p>
</div>
<div class="paragraph">
<p>The logic to fetch resources is very similar in both <code>loadFromServer</code> and <code>onNavigate</code>. Do you see ways to avoid duplicate code?</p>
</div>
<div class="paragraph">
<p>You put the JSON Schema metadata to good use in building up the <code>CreateDialog</code> and the <code>UpdateDialog</code> inputs. Do you see other places to use the metadata to makes things more generic? Imagine you wanted to add five more fields to <code>Employee.java</code>. What would it take to update the UI?</p>
</div>
</div>
</div></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 2243;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
 <li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>