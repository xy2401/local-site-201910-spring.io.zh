<html  data-code-prettify="" data-mobile-support="" data-search=""><head></head><body >﻿
<title>Spring和Angular JS：安全的单页应用程序</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>System.config({baseURL: "/b92013b"});</script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>System.import('app/main.js')</script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Spring and Angular JS: A Secure Single Page Application">
<meta name="twitter:description" content="<blockquote>
 <p>Note: the source code and test for this blog continue to evolve, but the changes to the text are not being maintained here. Please see <a href=" https: ="" spring.io guides="" tutorials="" spring-security-and-angular-js="" ="=">the tutorial version for the most up to date content. 

<p>In this article we show some nice features of Spring Security, Spring Boot and Angular JS working together to provide a pleasant and secure user experience. It should be accessible to beginners with Spring and Angular JS, but there also is plenty of detail that will be of use to experts in either. This is actually the first in a series of articles on Spring Security and Angular JS, with new features exposed in each one successively. We’ll improve on the application in the <a href=" blog 2015 01 12 the-login-page-angular-js-and-spring-security-part-ii">second and subsequent installments, but the main changes after this are architectural rather than functional.<p></p>
">
<meta name="twitter:creator" content="@david_syer">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=200">

<meta property="og:title" content="Spring and Angular JS: A Secure Single Page Application">
<meta property="og:image" content="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=200">
<meta property="og:description" content="<blockquote>
 <p>Note: the source code and test for this blog continue to evolve, but the changes to the text are not being maintained here. Please see <a href=" https: ="" spring.io guides="" tutorials="" spring-security-and-angular-js="" ="=">the tutorial version for the most up to date content. 

<p>In this article we show some nice features of Spring Security, Spring Boot and Angular JS working together to provide a pleasant and secure user experience. It should be accessible to beginners with Spring and Angular JS, but there also is plenty of detail that will be of use to experts in either. This is actually the first in a series of articles on Spring Security and Angular JS, with new features exposed in each one successively. We’ll improve on the application in the <a href=" blog 2015 01 12 the-login-page-angular-js-and-spring-security-part-ii">second and subsequent installments, but the main changes after this are architectural rather than functional.<p></p>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2015-01-12 12:20:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">// Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }</script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring和Angular JS：安全的单页应用程序</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=20&d=mm"> <a class="author" rel="author" href="/team/dsyer">戴夫·瑟</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2015-01-12 12:20:00.0">2015年1月12日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2015/01/12/spring-and-angular-js-a-secure-single-page-application#disqus_thread" data-disqus-identifier="1903">
</a></div>
</div>
</header>
<div class="blog--post"><blockquote><p>注意：此博客的源代码和测试在不断发展，但此处未保留对文本的更改。请参阅<a href="https://spring.io/guides/tutorials/spring-security-and-angular-js/">教程版本</a>以获取最新内容。</p>
</blockquote><p>在本文中，我们展示了Spring Security，Spring Boot和Angular JS的一些不错的功能，它们共同提供了愉快而安全的用户体验。Spring和Angular JS的初学者应该可以使用它，但是在这两种方法中的专家都将使用很多细节。实际上，这是有关Spring Security和Angular JS的系列文章中的第一篇，每一篇文章陆续介绍了新功能。我们将在<a href="https://spring.io/blog/2015/01/12/the-login-page-angular-js-and-spring-security-part-ii">第二期</a>及以后的文章中对应用程序进行改进，但是此后的主要更改是体系结构而不是功能。</p><h2><a href="#spring-and-the-single-page-application" class="anchor" name="spring-and-the-single-page-application"></a> Spring和单页应用程序</h2><p>HTML5，丰富的基于浏览器的功能和“单页应用程序”对于现代开发人员来说是非常有价值的工具，但是任何有意义的交互都将涉及后端服务器，以及静态内容（HTML，CSS和JavaScript）需要一个后端服务器。后端服务器可以扮演许多角色中的任何一个或全部：提供静态内容，有时（但最近不多）提供动态HTML，验证用户身份，保护对受保护资源的访问，以及（最后但并非最不重要的）交互作用在浏览器中通过HTTP和JSON（有时称为REST API）。</p><p>Spring一直是构建后端功能的流行技术（尤其是在企业中），并且随着<a href="https://projects.spring.io/spring-boot">Spring Boot</a>的出现，从未如此简单。让我们看一下如何使用Spring Boot，Angular JS和Twitter Bootstrap从零开始构建新的单页应用程序。没有特别的理由选择特定的堆栈，但是它非常流行，尤其是在企业Java商店中的核心Spring用户群体中，因此这是一个值得的起点。</p><h2><a href="#create-a-new-project" class="anchor" name="create-a-new-project"></a>创建一个新项目</h2><p>我们将逐步详细地创建此应用程序，以便对Spring和Angular不完全满意的任何人都可以了解正在发生的事情。如果您喜欢这种情况，可以<a href="#how-does-it-work">跳到</a>应用程序运行<a href="#how-does-it-work">的末尾</a> ，然后查看它们如何组合在一起。创建新项目有多种选择：</p>
<ul>
<li><a href="#using-curl">在命令行上使用curl</a></li>
<li><a href="#using-spring-boot-cli">使用Spring Boot CLI</a></li>
<li><a href="#using-the-initializr-website">使用Spring Initializr网站</a></li>
<li><a href="#using-spring-tool-suite">使用Spring Tool Suite</a></li>
</ul><p>我们将要构建的完整项目的源代码在<a href="https://github.com/dsyer/spring-security-angular/tree/master/basic">此处的Github中</a> ，因此您可以克隆项目并直接从那里进行工作。然后跳到<a href="#add-a-home-page">下一部分</a> 。</p><p><span id="using-curl"></span></p><h3><a href="#using-curl" class="anchor" name="using-curl"></a>使用卷曲</h3><p>创建新项目开始的最简单方法是通过<a href="https://start.spring.io">Spring Boot Initializr</a> 。例如在类似UN * X的系统上使用curl：</p>
<pre><code class="prettyprint">$ mkdir ui &amp;&amp; cd ui
$ curl https://start.spring.io/starter.tgz -d style=web \
-d style=security -d name=ui | tar -xzvf - 
</code></pre><p>然后，您可以将该项目（默认情况下是普通的Maven Java项目）导入到您喜欢的IDE中，或者仅在命令行上使用文件和“ mvn”。然后跳到<a href="#add-a-home-page">下一部分</a> 。</p><p><span id="using-spring-boot-cli"></span></p><h3><a href="#using-spring-boot-cli" class="anchor" name="using-spring-boot-cli"></a>使用Spring Boot CLI</h3><p>您可以使用<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#getting-started-installing-the-cli">Spring Boot CLI</a>创建相同的项目，如下所示：</p>
<pre><code class="prettyprint">$ spring init --dependencies web,security ui/ &amp;&amp; cd ui
</code></pre><p>然后跳到<a href="#add-a-home-page">下一部分</a> 。</p><p><span id="using-the-initializr-website"></span></p><h3><a href="#using-the-initializr-website" class="anchor" name="using-the-initializr-website"></a>使用Initializr网站</h3><p>如果愿意，还可以从<a href="https://start.spring.io">Spring Boot Initializr</a>直接获取与.zip文件相同的代码。只需在浏览器中打开它，然后选择“ Web”和“ Security”依赖项，然后单击“ Generate Project”即可。.zip文件在根目录中包含一个标准的Maven或Gradle项目，因此您可能要在解压缩之前创建一个空目录。然后跳到<a href="#add-a-home-page">下一部分</a> 。</p><p><span id="using-spring-tool-suite"></span></p><h3><a href="#using-spring-tool-suite" class="anchor" name="using-spring-tool-suite"></a>使用Spring Tool Suite</h3><p>在<a href="https://spring.io/tools/sts">Spring Tool Suite</a> （一组Eclipse插件）中，您还可以使用以下向导创建和导入项目： <code>File->New->Spring Starter Project</code> 。然后跳到<a href="#add-a-home-page">下一部分</a> 。</p><p><span id="add-a-home-page"></span></p><h2><a href="#add-a-home-page" class="anchor" name="add-a-home-page"></a>添加主页</h2><p>单页应用程序的核心是静态的“ index.html”，因此让我们继续创建一个（在“ src / main / resources / static”或“ src / main / resources / public”中）：</p>
<pre><code class="prettyprint html">&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Hello AngularJS&lt;/title&gt;
&lt;link href=&quot;css/angular-bootstrap.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;style type=&quot;text/css&quot;&gt;
[ng\:cloak], [ng-cloak], .ng-cloak {
  display: none !important;
}
&lt;/style&gt;
&lt;/head&gt;

&lt;body ng-app=&quot;hello&quot;&gt;
  &lt;div class=&quot;container&quot;&gt;
    &lt;h1&gt;Greeting&lt;/h1&gt;
    &lt;div ng-controller=&quot;home&quot; ng-cloak class=&quot;ng-cloak&quot;&gt;
      &lt;p&gt;The ID is {{greeting.id}}&lt;/p&gt;
      &lt;p&gt;The content is {{greeting.content}}&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;script src=&quot;js/angular-bootstrap.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;js/hello.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>它很短很甜，因为它只是要说“ Hello World”。</p><h3><a href="#features-of-the-home-page" class="anchor" name="features-of-the-home-page"></a>主页功能</h3><p>主要功能包括：</p>
<ul>
<li><p>一些CSS导入<code><head></code> ，一个占位符，代表一个尚不存在的文件，但以提示方式命名（“ angular-bootstrap.css”），一个内嵌样式表定义<a href="https://docs.angularjs.org/api/ng/directive/ngCloak">“ ng-cloak”</a>类。</p></li>
<li><p>“ ng-cloak”类应用于内容<code><div></code>因此，动态内容将被隐藏，直到Angular JS有机会处理它为止（这可以防止在初始页面加载期间出现“闪烁”）。</p></li>
<li><p>的<code><body></code>被标记为<code>ng-app="hello"</code>这意味着我们需要定义一个JavaScript模块，Angular将其识别为名为“ hello”的应用程序。</p></li>
<li><p>所有CSS类（“ ng-cloak”除外）都来自<a href="https://getbootstrap.com/">Twitter Bootstrap</a> 。一旦我们设置了正确的样式表，它们将使外观看起来更漂亮。</p></li>
<li><p>问候语中的内容使用把手标记，例如<code>{{greeting.content}}</code>稍后将由Angular填写（根据“ <code>ng-controller</code>周围的指令<code><div></code> ）。</p></li>
<li><p>Angular JS（和Twitter Bootstrap）包含在<code><body></code>以便浏览器可以在处理所有HTML之前对其进行处理。</p></li>
<li><p>我们还包括一个单独的“ hello.js”，在这里我们将定义应用程序的行为。</p></li>
</ul><p>我们将在一分钟内创建脚本和样式表资产，但是现在我们可以忽略它们不存在的事实。</p><h3><a href="#running-the-application" class="anchor" name="running-the-application"></a>运行应用程序</h3><p>添加主页文件后，您的应用程序将可以在浏览器中加载（即使它并没有做很多事情）。在命令行上，您可以执行此操作</p>
<pre><code class="prettyprint">$ mvn spring-boot:run
</code></pre><p>并转到位于<a href="http://localhost:8080">http：// localhost：8080</a>的浏览器。加载主页时，您应该会看到一个浏览器对话框，询问用户名和密码（用户名是“ user”，密码会在启动时在控制台日志中打印出来）。实际上还没有任何内容，因此一旦成功进行身份验证，您应该获得一个带有“问候”标题的空白页。</p>
<blockquote><p>提示：如果您不希望在控制台日志中抓取密码，只需将其添加到“ application.properties”（在“ src / main / resources”中）： <code>security.user.password=password</code> （然后选择您自己的密码）。我们在示例代码中使用“ application.yml”进行了此操作。</p>
</blockquote><p>在IDE中，只需运行<code>main()</code>应用程序类中的方法（只有一个类，它被称为<code>UiApplication</code>如果您使用了上面的“ curl”命令）。</p><p>要打包并作为独立的JAR运行，您可以执行以下操作：</p>
<pre><code class="prettyprint">$ mvn package
$ java -jar target/*.jar
</code></pre><h2><a href="#front-end-assets" class="anchor" name="front-end-assets"></a>前端资产</h2><p>关于Angular和其他前端技术的入门级教程通常只包含直接从互联网获得的图书馆资产（例如<a href="https://docs.angularjs.org/misc/downloading">Angular JS网站</a>本身建议从<a href="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.0/angular.min.js">Google CDN</a>下载）。相反，我们将通过串联来自此类库的多个文件来生成“ angular-bootstrap.js”资产。这并不是使应用程序正常工作所必需的，但对于生产应用程序<em>来说，</em>最佳做法是合并脚本以避免浏览器与服务器（或内容交付网络）之间发生混乱。由于我们无需修改或自定义CSS样式表，因此也无需生成“ angular-bootstrap.css”，我们也可以使用Google CDN的静态资产。但是，在实际的应用程序中，我们几乎肯定会想要修改样式表，并且我们不想手动编辑CSS源代码，因此我们将使用更高级别的工具（例如<a href="http://lesscss.org/">Less</a>或<a href="http://sass-lang.com/">Sass</a> ），因此我们将使用也是。</p><p>有许多不同的方法可以执行此操作，但是出于本文的目的，我们将使用<a href="https://alexo.github.io/wro4j/">wro4j</a> ，它是用于预处理和打包前端资产的基于Java的工具链。可以用作JIT（及时） <code>Filter</code>在任何Servlet应用程序中，它还对Maven和Eclipse等构建工具提供了良好的支持，这就是我们将如何使用它的方式。因此，我们将构建静态资源文件并将其捆绑在应用程序JAR中。</p>
<blockquote><p>撇开：Wro4j可能不是硬核前端开发人员的首选工具-他们可能会使用带有<a href="https://bower.io/">Bower</a>和/或<a href="https://gruntjs.com/">grunt</a>的基于节点的工具链。这些绝对是出色的工具，并且在Internet上进行了详细介绍，因此，如果您愿意，请随时使用它们。如果您只是将这些工具链的输出放在“ src / main / resources / static”中，那么它将全部起作用。我觉得wro4j很舒服，因为我不是一个硬核的前端开发人员，而且我知道如何使用基于Java的工具。</p>
</blockquote><p>为了在构建时创建静态资源，我们向Maven添加了一些魔力<code>pom.xml</code> （它很冗长，但是很简单，因此可以将其提取到Maven的父pom中，或者提取到Gradle的共享任务或插件中）：</p>
<pre><code class="prettyprint xml">&lt;build&gt;
  &lt;resources&gt;
    &lt;resource&gt;
      &lt;directory&gt;${project.basedir}/src/main/resources&lt;/directory&gt;
    &lt;/resource&gt;
    &lt;resource&gt;
      &lt;directory&gt;${project.build.directory}/generated-resources&lt;/directory&gt;
    &lt;/resource&gt;
  &lt;/resources&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
    &lt;/plugin&gt;
    &lt;plugin&gt;
      &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
      &lt;executions&gt;
        &lt;execution&gt;
          &lt;!-- Serves *only* to filter the wro.xml so it can get an absolute 
            path for the project --&gt;
          &lt;id&gt;copy-resources&lt;/id&gt;
          &lt;phase&gt;validate&lt;/phase&gt;
          &lt;goals&gt;
            &lt;goal&gt;copy-resources&lt;/goal&gt;
          &lt;/goals&gt;
          &lt;configuration&gt;
            &lt;outputDirectory&gt;${basedir}/target/wro&lt;/outputDirectory&gt;
            &lt;resources&gt;
              &lt;resource&gt;
                &lt;directory&gt;src/main/wro&lt;/directory&gt;
                &lt;filtering&gt;true&lt;/filtering&gt;
              &lt;/resource&gt;
            &lt;/resources&gt;
          &lt;/configuration&gt;
        &lt;/execution&gt;
      &lt;/executions&gt;
    &lt;/plugin&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;ro.isdc.wro4j&lt;/groupId&gt;
      &lt;artifactId&gt;wro4j-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;1.7.6&lt;/version&gt;
      &lt;executions&gt;
        &lt;execution&gt;
          &lt;phase&gt;generate-resources&lt;/phase&gt;
          &lt;goals&gt;
            &lt;goal&gt;run&lt;/goal&gt;
          &lt;/goals&gt;
        &lt;/execution&gt;
      &lt;/executions&gt;
      &lt;configuration&gt;
        &lt;wroManagerFactory&gt;ro.isdc.wro.maven.plugin.manager.factory.ConfigurableWroManagerFactory&lt;/wroManagerFactory&gt;
        &lt;cssDestinationFolder&gt;${project.build.directory}/generated-resources/static/css&lt;/cssDestinationFolder&gt;
        &lt;jsDestinationFolder&gt;${project.build.directory}/generated-resources/static/js&lt;/jsDestinationFolder&gt;
        &lt;wroFile&gt;${project.build.directory}/wro/wro.xml&lt;/wroFile&gt;
        &lt;extraConfigFile&gt;${basedir}/src/main/wro/wro.properties&lt;/extraConfigFile&gt;
        &lt;contextFolder&gt;${basedir}/src/main/wro&lt;/contextFolder&gt;
      &lt;/configuration&gt;
      &lt;dependencies&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;org.webjars&lt;/groupId&gt;
          &lt;artifactId&gt;jquery&lt;/artifactId&gt;
          &lt;version&gt;2.1.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;org.webjars&lt;/groupId&gt;
          &lt;artifactId&gt;angularjs&lt;/artifactId&gt;
          &lt;version&gt;1.3.8&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;org.webjars&lt;/groupId&gt;
          &lt;artifactId&gt;bootstrap&lt;/artifactId&gt;
          &lt;version&gt;3.2.0&lt;/version&gt;
        &lt;/dependency&gt;
      &lt;/dependencies&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;
</code></pre><p>您可以将该逐字记录复制到您的POM中，或者如果您从<a href="https://github.com/dsyer/spring-security-angular/tree/master/basic/pom.xml#L43">Github中</a>的<a href="https://github.com/dsyer/spring-security-angular/tree/master/basic/pom.xml#L43">源</a>进行跟踪，则可以对其进行扫描。要点如下：</p>
<ul>
<li><p>我们包括一些webjars库作为依赖项（用于CSS和样式的jquery和bootstrap，以及用于业务逻辑的Angular JS）。这些jar文件中的某些静态资源将包含在我们生成的“ angular-bootstrap。*”文件中，但是jar本身不需要与应用程序打包在一起。</p></li>
<li><p>Twitter Bootstrap对jQuery有依赖性，因此我们也将其包括在内。不使用Bootstrap的Angular JS应用程序将不需要此功能，因为Angular具有自己需要的jQuery版本的功能。</p></li>
<li><p>生成的资源将进入“目标/生成资源”中，因为这是在<code><resources/></code>部分，它们将打包在项目的输出JAR中，并在IDE的类路径中可用（只要我们使用的是Maven工具，例如Eclipse中的m2e）。</p></li>
<li><p>wro4j-maven-plugin具有一些Eclipse集成功能，您可以从Eclipse Marketplace中安装它（如果您是第一次，请稍后再试-不需要完成该应用程序）。如果这样做，那么Eclipse将监视源文件并在输出更改时重新生成输出。如果您在调试模式下运行，则更改将立即在浏览器中重新加载。</p></li>
<li><p>Wro4j是由XML配置文件控制的，该文件不了解您的构建类路径，而仅了解绝对文件路径，因此我们必须创建一个绝对文件位置并将其插入<code>wro.xml</code> 。为此，我们使用Maven资源过滤，这就是为什么要有一个明确的“ maven-resources-plugin”声明的原因。</p></li>
</ul><p>这就是我们需要对POM进行的所有更改。剩下的就是添加wro4j构建文件，我们指定的文件将位于“ src / main / wro”中。</p><h3><a href="#wro4j-source-files" class="anchor" name="wro4j-source-files"></a> Wro4j源文件</h3><p>如果您<a href="https://github.com/dsyer/spring-security-angular/tree/master/basic/src/main/wro">在Github中</a>查看<a href="https://github.com/dsyer/spring-security-angular/tree/master/basic/src/main/wro">源代码，</a>您将看到只有3个文件（其中一个是空的，准备以后进行自定义）：</p>
<ul>
<li><p><code>wro.properties</code>是wro4j中预处理和渲染引擎的配置文件。您可以使用它来打开和关闭工具链的各个部分。在这种情况下，我们使用它从<a href="http://lesscss.org/">Less</a>编译CSS并最小化JavaScript，最终将我们需要的所有库的源合并到两个文件中。</p>
<pre><code class="prettyprint">preProcessors=lessCssImport
postProcessors=less4j,jsMin
</code></pre></li>
<li><p><code>wro.xml</code>声明一个称为“ angular-bootstrap”的资源的单个“组”，这最终是所生成的静态资源的基本名称。它包括对<code><css></code>和<code><js></code>我们添加的webjar中的元素以及本地源文件中的元素<code>main.less</code> 。</p>
<pre><code class="prettyprint">&lt;groups xmlns=&quot;http://www.isdc.ro/wro&quot;&gt;
  &lt;group name=&quot;angular-bootstrap&quot;&gt;
  &lt;css&gt;webjar:bootstrap/3.2.0/less/bootstrap.less&lt;/css&gt;   
    &lt;css&gt;file:${project.basedir}/src/main/wro/main.less&lt;/css&gt;
    &lt;js&gt;webjar:jquery/2.1.1/jquery.min.js&lt;/js&gt;
    &lt;js&gt;webjar:bootstrap/3.2.0/bootstrap.js&lt;/js&gt;
    &lt;js&gt;webjar:angularjs/1.3.8/angular.min.js&lt;/js&gt;
  &lt;/group&gt;
&lt;/groups&gt;
</code></pre></li>
<li><p><code>main.less</code>为空，但可用于自定义外观，更改Twitter Bootstrap中的默认设置。例如，将颜色从默认的蓝色更改为浅粉红色，您可以添加一行： <code>@brand-primary: #de8579;</code> 。</p></li>
</ul><p>将这些文件复制到您的项目中并运行“ mvn package”，您应该会在JAR文件中看到“ bootstrap-angular。*”资源。如果现在运行该应用程序，应该会看到CSS生效，但是仍然缺少业务逻辑和导航。</p><h2><a href="#create-the-angular-application" class="anchor" name="create-the-angular-application"></a>创建Angular应用程序</h2><p>让我们创建一个“ hello”应用程序（在“ src / main / resources / static / js / hello.js”中） <code><script/></code>在“ index.html”的底部找到了正确的位置）。</p><p>一个最小的Angular JS应用程序如下所示：</p>
<pre><code class="prettyprint javascript">angular.module(&#39;hello&#39;, [])
  .controller(&#39;home&#39;, function($scope) {
    $scope.greeting = {id: &#39;xxx&#39;, content: &#39;Hello World!&#39;}
})
</code></pre><p>该应用程序的名称为“ hello”，它具有一个空（且冗余）的“ config”和一个名为“ home”的空“控制器”。当我们加载“ index.html”时，将调用“ home”控制器，因为我们已经装饰了内容<code><div></code>与<code>ng-controller="home"</code> 。</p><p>注意，我们注入了魔法<code>$scope</code>到控制器函数中（Angular <a href="https://docs.angularjs.org/tutorial">通过命名约定进行依赖注入</a> ，并识别函数参数的名称）。的<code>$scope</code>然后在函数内部使用来设置此控制器负责的UI元素的内容和行为。</p><p>如果您在“ src / main / resources / static / js”下添加了该文件，则您的应用现在应该安全且可以运行，并且会显示“ Hello World！”。的<code>greeting</code>由Angular在HTML中使用车把占位符呈现， <code>{{greeting.id}}</code>和<code>{{greeting.content}}</code> 。</p><p><span id="dynamic-content"></span></p><h2><a href="#adding-dynamic-content" class="anchor" name="adding-dynamic-content"></a>添加动态内容</h2><p>到目前为止，我们已经有了一个带有硬编码的问候语的应用程序。这对于了解事物如何组合很有用，但实际上我们希望内容来自后端服务器，因此让我们创建一个HTTP端点，可以用来获取问候。在您的<a href="https://github.com/dsyer/spring-security-angular/blob/master/basic/src/main/java/demo/UiApplication.java">应用程序类</a> （在“ src / main / java / demo”中）中，添加<code>@RestController</code>注释并定义一个新的<code>@RequestMapping</code> ：</p>
<pre><code class="prettyprint java">@SpringBootApplication
@RestController
public class UiApplication {

  @RequestMapping(&quot;/resource&quot;)
  public Map&lt;String,Object&gt; home() {
    Map&lt;String,Object&gt; model = new HashMap&lt;String,Object&gt;();
    model.put(&quot;id&quot;, UUID.randomUUID().toString());
    model.put(&quot;content&quot;, &quot;Hello World&quot;);
    return model;
  }

  public static void main(String[] args) {
    SpringApplication.run(UiApplication.class, args);
  }

}
</code></pre>
<blockquote><p>注意：根据创建新项目的方式，可能不会调用它<code>UiApplication</code> ，并且可能有<code>@EnableAutoConfiguration @ComponentScan @Configuration</code>代替<code>@SpringBootApplication</code> 。</p>
</blockquote><p>运行该应用程序并尝试卷曲“ / resource”端点，默认情况下您会发现它是安全的：</p>
<pre><code class="prettyprint">$ curl localhost:8080/resource
{&quot;timestamp&quot;:1420442772928,&quot;status&quot;:401,&quot;error&quot;:&quot;Unauthorized&quot;,&quot;message&quot;:&quot;Full authentication is required to access this resource&quot;,&quot;path&quot;:&quot;/resource&quot;}
</code></pre><h3><a href="#loading-a-dynamic-resource-from-angular" class="anchor" name="loading-a-dynamic-resource-from-angular"></a>从Angular加载动态资源</h3><p>因此，让我们在浏览器中获取该消息。修改“ home”控制器以使用XHR加载受保护的资源：</p>
<pre><code class="prettyprint javascript">angular.module(&#39;hello&#39;, [])
  .controller(&#39;home&#39;, function($scope, $http) {
  $http.get(&#39;/resource/&#39;).success(function(data) {
    $scope.greeting = data;
  })
});
</code></pre><p>我们注入了<a href="https://docs.angularjs.org/api/ng/service/$http"><code>$http</code>服务</a> ，它是Angular提供的一项核心功能，并用于获取我们的资源。成功时，Angular将JSON从响应主体传递回回调函数。</p><p>再次运行该应用程序（或只是在浏览器中重新加载主页），您将看到带有唯一ID的动态消息。因此，即使资源受到保护并且您不能直接卷曲它，浏览器仍能够访问内容。我们有不到一百行代码的安全单页应用程序！</p>
<blockquote><p>注意：更改静态资源后，可能需要强制浏览器重新加载静态资源。在Chrome（以及带有插件的Firefox）中，您可以使用“开发人员工具”（F12），这可能就足够了。或者，您可能必须使用CTRL + F5。</p>
</blockquote><p><span id="how-does-it-work"></span></p><h2><a href="#how-does-it-work" class="anchor" name="how-does-it-work"></a>它是如何工作的？</h2><p>如果您使用某些开发人员工具，则可以在浏览器中看到浏览器与后端之间的交互（通常F12会打开它，默认情况下在Chrome中运行，并且需要Firefox中的插件）。总结如下：</p>
<table>
<thead>
<tr>
<th>动词</th>
<th>路径</th>
<th>状态</th>
<th>响应</th>
</tr>
</thead>
<tbody>
<tr>
<td>得到</td>
<td>/</td>
<td>401</td>
<td>浏览器提示进行身份验证</td>
</tr>
<tr>
<td>得到</td>
<td>/</td>
<td>200</td>
<td>index.html</td>
</tr>
<tr>
<td>得到</td>
<td>/css/angular-bootstrap.css</td>
<td>200</td>
<td>Twitter引导CSS</td>
</tr>
<tr>
<td>得到</td>
<td>/js/angular-bootstrap.js</td>
<td>200</td>
<td>Bootstrap和Angular JS</td>
</tr>
<tr>
<td>得到</td>
<td>/js/hello.js</td>
<td>200</td>
<td>应用逻辑</td>
</tr>
<tr>
<td>得到</td>
<td>/资源</td>
<td>200</td>
<td>JSON问候</td>
</tr>
</tbody>
</table><p>您可能不会看到401，因为浏览器将主页加载视为单个交互，并且可能会看到2个“ /资源”请求，因为存在<a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a>协商。</p><p>仔细查看请求，您将看到所有请求都有一个“ Authorization”标头，如下所示：</p>
<pre><code class="prettyprint">Authorization: Basic dXNlcjpwYXNzd29yZA==
</code></pre><p>浏览器会随每个请求发送用户名和密码（因此请记住在生产环境中仅使用HTTPS）。没有关于“ Angular”的内容，因此它可以与您的JavaScript框架或非框架选择一起使用。</p><h3><a href="#what-rsquo-s-wrong-with-that" class="anchor" name="what-rsquo-s-wrong-with-that"></a>怎么了</h3><p>从表面上看，我们似乎做得很好，简洁，易于实施，所有数据都由一个秘密密码保护，并且如果我们更改前端或后端技术，它仍然可以工作。但是有一些问题。</p>
<ul>
<li><p>基本身份验证仅限于用户名和密码身份验证。</p></li>
<li><p>身份验证用户界面无处不在，但难看（浏览器对话框）。</p></li>
<li><p>没有<a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">跨站请求伪造</a> （CSRF）的保护。</p></li>
</ul><p>CSRF并不是我们的应用程序真正存在的问题，因为它只需要获取后端资源（即服务器中的任何状态都不会更改）。一旦您的应用程序中包含POST，PUT或DELETE，就无法通过任何合理的现代措施来保护它了。</p><p>在<a href="https://spring.io/blog/2015/01/12/the-login-page-angular-js-and-spring-security-part-ii">本系列</a>的<a href="https://spring.io/blog/2015/01/12/the-login-page-angular-js-and-spring-security-part-ii">下一篇文章中，</a>我们将扩展应用程序以使用基于表单的身份验证，它比HTTP Basic灵活得多。一旦有了表单，我们将需要CSRF保护，并且Spring Security和Angular都具有一些很好的即用型功能来帮助完成此任务。剧透：我们将需要使用<code>HttpSession</code> 。</p>
<blockquote><p>谢谢：我要感谢所有帮助我开发本系列文章的人，尤其是<a href="https://spring.io/team/rwinch">Rob Winch</a>和<a href="https://twitter.com/thspaeth">Thorsten Spaeth</a>对文章和源代码的认真评论，并教了我一些我不知道的技巧我以为我最熟悉。</p>
</blockquote></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">var disqus_shortname = 'spring-io';
      var disqus_identifier = 1903;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));</script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });</script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>