<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Better application events in Spring Framework 4.2</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Better application events in Spring Framework 4.2" />
<meta name="twitter:description" content="&lt;p&gt;Application events are available since the &lt;em&gt;very&lt;/em&gt; beginning of the Spring framework as a mean for loosely coupled components to exchange information. One of the most well known usage of application events is the following:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;prettyprint java&quot;&gt;@Component
public class MyListener 
        implements ApplicationListener&amp;lt;ContextRefreshedEvent&amp;gt; {
  
    public void onApplicationEvent(ContextRefreshedEvent event) {
        ...
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This allows &lt;code&gt;MyListener&lt;/code&gt; to be notified when the context has &lt;em&gt;refreshed&lt;/em&gt; and one can use that to run arbitrary code when the application context has fully started.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@snicoll" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/33d0963a20138828608f3f61927545b8?s=200" />

<meta property="og:title" content="Better application events in Spring Framework 4.2" />
<meta property="og:image" content="https://gravatar.com/avatar/33d0963a20138828608f3f61927545b8?s=200" />
<meta property="og:description" content="&lt;p&gt;Application events are available since the &lt;em&gt;very&lt;/em&gt; beginning of the Spring framework as a mean for loosely coupled components to exchange information. One of the most well known usage of application events is the following:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;prettyprint java&quot;&gt;@Component
public class MyListener 
        implements ApplicationListener&amp;lt;ContextRefreshedEvent&amp;gt; {
  
    public void onApplicationEvent(ContextRefreshedEvent event) {
        ...
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This allows &lt;code&gt;MyListener&lt;/code&gt; to be notified when the context has &lt;em&gt;refreshed&lt;/em&gt; and one can use that to run arbitrary code when the application context has fully started.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2015-02-11 14:29:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Better application events in Spring Framework 4.2</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/33d0963a20138828608f3f61927545b8?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/snicoll">St√©phane Nicoll</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2015-02-11 14:29:00.0">February 11, 2015</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="1965" href="/blog/2015/02/11/better-application-events-in-spring-framework-4-2#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>Application events are available since the <em>very</em> beginning of the Spring framework as a mean for loosely coupled components to exchange information. One of the most well known usage of application events is the following:</p>
<pre><code class="prettyprint java">@Component
public class MyListener 
        implements ApplicationListener&lt;ContextRefreshedEvent&gt; {
  
    public void onApplicationEvent(ContextRefreshedEvent event) {
        ...
    }
}
</code></pre><p>This allows <code>MyListener</code> to be notified when the context has <em>refreshed</em> and one can use that to run arbitrary code when the application context has fully started.</p><p>In Spring Framework 4.2 we have revisited the event infrastructure in three main areas that I am going to explain in this post.</p><h2><a href="#generics-support" class="anchor" name="generics-support"></a>Generics support</h2><p>It is now possible to define your <code>ApplicationListener</code> implementation with nested generics information in the event type, something like:</p>
<pre><code class="prettyprint java">public class MyListener 
        implements ApplicationListener&lt;MyEvent&lt;Order&gt;&gt; { ... }
</code></pre><p>When dispatching an event, the signature of your listener is used to determine if it matches said incoming event.</p>
<blockquote><p>Due to type erasure you need to publish an event that resolves the generics parameter you would filter on, something like <code>MyOrderEvent extends MyEvent&lt;Order&gt;</code>. There might be other workarounds and we are happy to revisit the signature matching algorithm if the community thinks it worthwhile.</p>
</blockquote><h2><a href="#annotation-driven-event-listener" class="anchor" name="annotation-driven-event-listener"></a>Annotation-driven event listener</h2><p>The biggest new feature is the support of annotation-driven event listeners, similar to our recent work on <a href="https://spring.io/blog/2014/04/30/spring-4-1-s-upcoming-jms-improvements">JMS and AMQP endpoints</a> in Spring Framework 4.1. In a nutshell, it is now possible to simply annotate a method of a managed-bean with <code>@EventListener</code> to automatically register an <code>ApplicationListener</code> matching the signature of the method. Our example above can be rewritten as follows:</p>
<pre><code class="prettyprint java">@Component
public class MyListener {
  
    @EventListener
    public void handleContextRefresh(ContextRefreshedEvent event) {
        ...
    }
}
</code></pre><p><code>@EventListener</code> is a core annotation that is handled transparently in a similar fashion as <code>@Autowired</code> and others: no extra configuration is necessary with java config and the existing <code>&lt;context:annotation-driven/&gt;</code> element enables full support for it.</p><p>The method signature defines the event type that you&rsquo;re interested in. It is also possible to define a SpEL expression that should match in order to handle the event. For instance, consider the following event:</p>
<pre><code class="prettyprint java">public class OrderCreatedEvent implements CreationEvent&lt;Order&gt; { ... }

    private boolean awesome;
   
    public boolean isAwesome() { return this.awesome; }
    ....
}
</code></pre><p>The following example showcases an event listener that will only be invoked for an <em>awesome</em> <code>CreationEvent</code> of <code>Order</code> (i.e. if the <code>awesome</code> flag is <code>true</code>):</p>
<pre><code class="prettyprint java">@Component
public class MyComponent {
  
  @EventListener(condition = &quot;#creationEvent.awesome&quot;)
  public void handleOrderCreatedEvent(CreationEvent&lt;Order&gt; creationEvent) {
    ... 
  }

}
</code></pre>
<blockquote><p>As you can see from the sample above, method arguments are exposed via their names if such information can be discovered. The condition expression also exposes a &ldquo;root&rdquo; variable with the <em>raw</em> <code>ApplicationEvent</code> (<code>#root.event</code>) and the actual method arguments (<code>#root.args</code>).</p>
</blockquote><h2><a href="#publishing-events" class="anchor" name="publishing-events"></a>Publishing events</h2><p>You can define a non-<code>void</code> return type for any method annotated with <code>@EventListener</code>. If you return a non <code>null</code> value as the result of the processing of a particular event, we&rsquo;ll send that result as a new event for you.</p><p>You may have noticed that our <code>OrderCreatedEvent</code> does not extend from <code>ApplicationEvent</code>; we felt it was about time to give you the flexibility to publish any arbitrary event and not force you to extend from <code>ApplicationEvent</code>. The <code>ApplicationEventPublisher</code> interface has been extended to allow you to publish any object; when said object isn&rsquo;t an <code>ApplicationEvent</code>, we wrap it in a <code>PayloadApplicationEvent</code> for you. Remember this if you want to listen to such arbitrary event using a regular <code>ApplicationListener</code> implementation.</p><p>The following sample shows how you can use <code>ApplicationEventPublisher</code> to send an <code>OrderCreatedEvent</code>:</p>
<pre><code class="prettyprint java">@Component
public class MyComponent {

    private final ApplicationEventPublisher publisher;
    
    @Autowired
    public MyComponent(ApplicationEventPublisher publisher) { ... }
    
    public void createOrder(Order order) {
        // ....
        this.publisher.publishEvent(new OrderCreatedEvent(order)); 
    }

}
</code></pre><h2><a href="#transaction-bound-events" class="anchor" name="transaction-bound-events"></a>Transaction bound events</h2><p>Another popular improvement is the ability to bind the listener of an event to a phase of the transaction. The typical example is to handle the event when the transaction has completed successfully: this allows events to be used with more flexibility when the outcome of the current transaction actually matters to the listener.</p><p>Spring Framework is currently structured in such a way that the context is not aware of the transaction support and we obviously didn&rsquo;t want to deviate from that very sane principle so we built an open infrastructure to allow additional components to be registered and influence the way event listeners are created.</p><p>The transaction module implements an <code>EventListenerFactory</code> that looks for the new <code>@TransactionalEventListener</code> annotation. When this one is present, an extended event listener that is aware of the transaction is registered instead of the default.</p><p>Let&rsquo;s reuse our example above and rewrite it in such a way that the order creation event will only be processed when the transaction in which the producer is running has completed successfully:</p>
<pre><code class="prettyprint java">@Component
public class MyComponent {
  
  @TransactionalEventListener(condition = &quot;#creationEvent.awesome&quot;)
  public void handleOrderCreatedEvent(CreationEvent&lt;Order&gt; creationEvent) { 
    ...
  }

}
</code></pre><p>Not much to see, right? <code>@TransactionalEventListener</code> <em>is</em> a regular <code>@EventListener</code> and also exposes a <code>TransactionPhase</code>, the default being <code>AFTER_COMMIT</code>. You can also hook other phases of the transaction (<code>BEFORE_COMMIT</code>, <code>AFTER_ROLLBACK</code> and <code>AFTER_COMPLETION</code> that is just an alias for <code>AFTER_COMMIT</code> and <code>AFTER_ROLLBACK</code>).</p><p>By default, if no transaction is running the event isn&rsquo;t sent at all as we can&rsquo;t obviously honor the requested phase, but there is a <code>fallbackExecution</code> attribute in <code>@TransactionalEventListener</code> that tells Spring to invoke the listener immediately if there is no transaction.</p><h2><a href="#try-it-out" class="anchor" name="try-it-out"></a>Try it out!</h2><p>If you want to give this a try before the first milestone release of 4.2, grab a nightly SNAPSHOT build via our <a href="https://repo.spring.io/snapshot/">snapshot repository</a>. You can also create a sample project using <a href="https://start.spring.io">start.spring.io</a> using the latest Spring Boot snapshot build, or if you&rsquo;re super lazy you can copy/paste this in your shell:</p>
<pre><code class="prettyprint">$ curl https://start.spring.io/starter.tgz -d artifactId=events-demo \
    -d baseDir=events-demo -d bootVersion=1.2.2.BUILD-SNAPSHOT | tar -xzvf -
</code></pre><p>And update the project to use Spring Framework <code>4.2.0.BUILD-SNAPSHOT</code></p>
<pre><code class="prettyprint xml">&lt;properties&gt;
  ...
  &lt;spring.version&gt;4.2.0.BUILD-SNAPSHOT&lt;/spring.version&gt;
&lt;/properties&gt;
</code></pre><p>As always, we welcome community feedback, please try these features and let us know if you run into any issue.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 1965;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>