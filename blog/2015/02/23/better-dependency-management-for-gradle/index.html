<html dir="ltr" data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>更好的Gradle依赖管理</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>System.config({baseURL: "/b92013b"});</script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>System.import('app/main.js')</script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Better dependency management for Gradle">
<meta name="twitter:description" content="<p>Maven’s <a href=" http:="" ="" maven.apache.org="" guides="" introduction="" introduction-to-dependency-mechanism.htm="="></head><body dir="ltr">dependency management includes the concept of a bill-of-materials (bom). A bom is a special kind of pom that is used to control the versions of a project’s dependencies and provides a central place to define and update those versions.
<p>A number of Spring projects including Spring Framework, Spring Cloud, Spring Boot, and the Spring IO Platform provide boms to make things easier for Maven users. Unfortunately, things haven’t been quite so easy if you’re using Gradle.</p>
<h2><a href="#dependency-management-in-gradle" class="anchor" name="dependency-management-in-gradle"></a>Dependency management in Gradle</h2>
">
<meta name="twitter:creator" content="@ankinson">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/8d143bf6d465cb98f8196cf4311256d0?s=200">

<meta property="og:title" content="Better dependency management for Gradle">
<meta property="og:image" content="https://gravatar.com/avatar/8d143bf6d465cb98f8196cf4311256d0?s=200">
<meta property="og:description" content="<p>Maven’s <a href=" http:="" ="" maven.apache.org="" guides="" introduction="" introduction-to-dependency-mechanism.htm="=">dependency management includes the concept of a bill-of-materials (bom). A bom is a special kind of pom that is used to control the versions of a project’s dependencies and provides a central place to define and update those versions.
<p>A number of Spring projects including Spring Framework, Spring Cloud, Spring Boot, and the Spring IO Platform provide boms to make things easier for Maven users. Unfortunately, things haven’t been quite so easy if you’re using Gradle.</p>
<h2><a href="#dependency-management-in-gradle" class="anchor" name="dependency-management-in-gradle"></a>Dependency management in Gradle</h2>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2015-02-23 13:44:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">// Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }</script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">更好的Gradle依赖管理</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/8d143bf6d465cb98f8196cf4311256d0?s=20&d=mm"> <a class="author" rel="author" href="/team/awilkinson">安迪·威尔金森</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2015-02-23 13:44:00.0">2015年2月23日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2015/02/23/better-dependency-management-for-gradle#disqus_thread" data-disqus-identifier="1982">
</a></div>
</div>
</header>
<div class="blog--post"><p>Maven的<a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html">依赖管理</a>包括物料清单（BOM）的概念。Bom是一种特殊的pom，用于控制项目依赖项的版本，并为定义和更新这些版本提供了中心位置。</p><p>许多Spring项目（包括Spring Framework，Spring Cloud，Spring Boot和Spring IO Platform）都提供了Bom，使Maven用户的工作变得更加轻松。不幸的是，如果您使用Gradle，事情就不会那么容易了。</p><h2><a href="#dependency-management-in-gradle" class="anchor" name="dependency-management-in-gradle"></a> Gradle中的依赖管理</h2><p><a href="https://gradle.org/docs/current/userguide/dependency_management.html">Gradle的依赖项管理</a>使用<a href="https://gradle.org/docs/current/dsl/org.gradle.api.artifacts.ResolutionStrategy.html"><code>ResolutionStrategy</code></a>来控制项目的依赖项版本。这提供了强大的功能和灵活性，但没有提供一种方法来重用已经在Maven Bom中声明的依赖管理。因此，您必须手动执行此操作。根据bom的不同，这很容易等同于<code>build.gradle</code>脚本中的数十行附加<code>build.gradle</code>仅用于重用一些现有配置。</p><h2><a href="#reusing-a-bom-in-gradle" class="anchor" name="reusing-a-bom-in-gradle"></a>在Gradle中重用宝</h2><p>Gradle的主要优势之一是可以轻松扩展它并通过使用插件自定义其行为。我们利用了这一点，并<a href="https://plugins.gradle.org/plugin/io.spring.dependency-management">为Gradle</a>编写了一个<a href="https://plugins.gradle.org/plugin/io.spring.dependency-management">依赖管理插件</a> 。它与Gradle 1.x和2.x兼容。这个插件允许您使用Maven Bom来控制构建的依赖关系。第一步是应用插件：</p>
<pre><code class="prettyprint groovy">buildscript {
  repositories {
    jcenter()
  }
  dependencies {
    classpath "io.spring.gradle:dependency-management-plugin:0.5.1.RELEASE"
  }
}

apply plugin: "io.spring.dependency-management"
</code></pre><p>应用插件后，您可以使用它导入Maven Bom：</p>
<pre><code class="prettyprint groovy">dependencyManagement {
  imports {
    mavenBom 'io.spring.platform:platform-bom:1.1.1.RELEASE'
  }
}
</code></pre><p>使用此配置后，您可以声明对Bom中任何内容的依赖性，而无需指定版本：</p>
<pre><code class="prettyprint groovy">dependencies {
    compile 'org.springframework:spring-core'
}
</code></pre><p>导入的Bom将控制依赖项的版本。如果它们在bom中列出，它还将控制其传递依赖项的版本。</p><h2><a href="#exclusions-in-gradle" class="anchor" name="exclusions-in-gradle"></a> Gradle中的排除项</h2><p>Gradle可以从Maven存储库中检索依赖关系，并且它使用Maven pom文件中的元数据来执行此操作。但是，它没有遵循Maven的规则，而是对元数据应用了自己微妙的语义。可能导致问题的一个领域是传递依赖的排除。最好用一个简单的例子来说明。</p><p>想象一个模块，该模块依赖于两个Spring Framework模块，即<code>spring-core</code>和<code>spring-beans</code> ，并且使用SLF4J而不是Commons Logging。pom中的依赖关系如下所示：</p>
<pre><code class="prettyprint xml"><dependency>
  <groupId>org.springframework</groupId>
  <artifactId>spring-core</artifactId>
  <version>4.1.4.RELEASE</version>
  <exclusions>
    <exclusion>
      <groupId>commons-logging</groupId>
      <artifactId>commons-logging</artifactId>
    </exclusion>
  </exclusions>
</dependency>
<dependency>
  <groupId>org.springframework</groupId>
  <artifactId>spring-beans</artifactId>
  <version>4.1.4.RELEASE</version>
</dependency>
<dependency>
  <groupId>org.slf4j</groupId>
  <artifactId>jcl-over-slf4j</artifactId>
  <version>1.7.10</version>
</dependency>
</code></pre><p>如果Maven构建依赖于此模块，则其依赖关系树如下所示：</p>
<pre><code class="prettyprint">\- com.example:my-library:jar:0.0.1-SNAPSHOT:compile
   +- org.springframework:spring-core:jar:4.1.4.RELEASE:compile
   +- org.springframework:spring-beans:jar:4.1.4.RELEASE:compile
   \- org.slf4j:jcl-over-slf4j:jar:1.7.10:compile
      \- org.slf4j:slf4j-api:jar:1.7.10:compile
</code></pre><p>没有将<code>commons-logging</code>列出为依赖于<code>spring-core</code>的唯一模块，该模块已被排除在外。</p><p>等效的Gradle构建的依赖关系树如下所示：</p>
<pre><code class="prettyprint">\--- com.example:my-library:0.0.1-SNAPSHOT
     +--- org.springframework:spring-core:4.1.4.RELEASE
     |    \--- commons-logging:commons-logging:1.2
     +--- org.springframework:spring-beans:4.1.4.RELEASE
     |    \--- org.springframework:spring-core:4.1.4.RELEASE (*)
     \--- org.slf4j:jcl-over-slf4j:1.7.10
          \--- org.slf4j:slf4j-api:1.7.10
</code></pre><p>尽管排除了例外，但这次仍列出了<code>commons-logging</code> 。这可能会带来问题，因为它会使类路径受到本不应存在的依赖项的污染。您可以通过在Gradle构建中手动配置所需的排除项来解决此问题，但是首先您必须知道排除项应该是什么，然后必须经历繁琐且容易出错的配置它们的过程。</p><h2><a href="#honoring-a-pom-rsquo-s-exclusions" class="anchor" name="honoring-a-pom-rsquo-s-exclusions"></a>遵守pom的排除规则</h2><p>依赖项管理插件更改了Gradle对pom排除项的处理，以使其行为与在Maven中相同。将插件应用于示例项目后，它不再引入<code>commons-logging</code> ：</p>
<pre><code class="prettyprint">\--- com.example:my-library:0.0.1-SNAPSHOT
     +--- org.springframework:spring-core:4.1.4.RELEASE
     +--- org.springframework:spring-beans:4.1.4.RELEASE
     |    \--- org.springframework:spring-core:4.1.4.RELEASE
     \--- org.slf4j:jcl-over-slf4j:1.7.10
          \--- org.slf4j:slf4j-api:1.7.10
</code></pre><h2><a href="#using-the-plugin-with-spring-boot" class="anchor" name="using-the-plugin-with-spring-boot"></a>在Spring Boot中使用插件</h2><p>这个插件和Spring Boot的Gradle插件之间有一些相似之处。例如，Spring Boot插件还<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#build-tool-plugins-gradle-dependencies-without-versions">允许在没有版本的情况下声明依赖项</a> ，但是它不会影响可传递的依赖项，也不会遵守Maven排除条款。</p><p>在即将发布的Spring Boot 1.3中，我们<a href="https://github.com/spring-projects/spring-boot/issues/2133">删除了Boot自己的依赖管理，并开始使用依赖管理插件</a> 。对于使用Spring Boot早期版本的用户，这两个插件将愉快地共存，并且您可以配置依赖项管理插件以使用Spring Boot的启动程序bom：</p>
<pre><code class="prettyprint groovy">buildscript {
  repositories {
    jcenter()
  }
  dependencies {
    classpath "io.spring.gradle:dependency-management-plugin:0.5.1.RELEASE"
    classpath "org.springframework.boot:spring-boot-gradle-plugin:1.2.3.RELEASE"
  }
}

apply plugin: "io.spring.dependency-management"
apply plugin: "spring-boot"

repositories {
  jcenter()
}

dependencyManagement {
  imports {
    mavenBom 'org.springframework.boot:spring-boot-starter-parent:1.2.1.RELEASE'
  }
}

dependencies {
  compile "org.springframework.boot:spring-boot-starter-web"
}
</code></pre><h2><a href="#learning-more" class="anchor" name="learning-more"></a>了解更多</h2><p>除了上述功能之外，该插件还支持使用Bom的属性（覆盖它们并在您的Gradle构建中使用它们），自动在Gradle生成的pom文件中包括依赖项管理元数据，等等。请查看<a href="https://github.com/spring-gradle-plugins/dependency-management-plugin/blob/master/README.md">自述文件</a>以了解更多详细信息。</p><p>该插件是Apache许可的，位于<a href="https://github.com/spring-gradle-plugins/dependency-management-plugin">GitHub上</a> 。GitHub也用于<a href="https://github.com/spring-gradle-plugins/dependency-management-plugin/issues">问题跟踪</a> 。始终欢迎提供功能建议，拉取请求和错误报告。</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">var disqus_shortname = 'spring-io';
      var disqus_identifier = 1982;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));</script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
 <div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });</script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>