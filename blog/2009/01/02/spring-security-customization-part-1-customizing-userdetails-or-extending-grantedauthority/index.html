<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Spring Security customization (Part 1 - Customizing UserDetails  or extending GrantedAuthority)</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Spring Security customization (Part 1 - Customizing UserDetails  or extending GrantedAuthority)" />
<meta name="twitter:description" content="&lt;p&gt;This is the first part of what I hope will become a multipart series of small posts showing practical examples around Spring Security customization. The requirements for these customizations are not imaginary and all came from the field…&lt;/p&gt;
&lt;p&gt;Assume you have the following requirement. You have a list of roles where each role contains&amp;nbsp; list of business functions applicable to this role (see below):&lt;/p&gt;
&lt;p&gt;ROLE_ADMIN&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BF_QUOTE_CREATE&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BF_POLICY_CREATE&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BF_POLICY_DELETE&lt;/p&gt;
&lt;p&gt;ROLE_AGENT&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BF_QUOTE_CREATE&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BF_POLICY_CREATE&lt;/p&gt;
" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=200" />

<meta property="og:title" content="Spring Security customization (Part 1 - Customizing UserDetails  or extending GrantedAuthority)" />
<meta property="og:image" content="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=200" />
<meta property="og:description" content="&lt;p&gt;This is the first part of what I hope will become a multipart series of small posts showing practical examples around Spring Security customization. The requirements for these customizations are not imaginary and all came from the field…&lt;/p&gt;
&lt;p&gt;Assume you have the following requirement. You have a list of roles where each role contains&amp;nbsp; list of business functions applicable to this role (see below):&lt;/p&gt;
&lt;p&gt;ROLE_ADMIN&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BF_QUOTE_CREATE&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BF_POLICY_CREATE&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BF_POLICY_DELETE&lt;/p&gt;
&lt;p&gt;ROLE_AGENT&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BF_QUOTE_CREATE&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BF_POLICY_CREATE&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2009-01-02 17:52:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Security customization (Part 1 - Customizing UserDetails or extending GrantedAuthority)</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=20&amp;d=mm" />
<span class="author">Oleg Zhurakousky</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2009-01-02 17:52:00.0">January 02, 2009</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="197" href="/blog/2009/01/02/spring-security-customization-part-1-customizing-userdetails-or-extending-grantedauthority#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>This is the first part of what I hope will become a multipart series of small posts showing practical examples around Spring Security customization. The requirements for these customizations are not imaginary and all came from the field&hellip;</p><p>Assume you have the following requirement. You have a list of roles where each role contains  list of business functions applicable to this role (see below):</p><p>ROLE_ADMIN<br />&nbsp;&nbsp;&nbsp;&nbsp;BF_QUOTE_CREATE<br />&nbsp;&nbsp;&nbsp;&nbsp;BF_POLICY_CREATE<br />&nbsp;&nbsp;&nbsp;&nbsp;BF_POLICY_DELETE</p><p>ROLE_AGENT<br />&nbsp;&nbsp;&nbsp;&nbsp;BF_QUOTE_CREATE<br />&nbsp;&nbsp;&nbsp;&nbsp;BF_POLICY_CREATE</p><p>ROLE_USER<br />&nbsp;&nbsp;&nbsp;&nbsp;BF_QUOTE_CREATE</p><p>The trick is to be able to make authorization decisions based on either.</p><p><strong>For example: </strong><br /><em>User who has a role ROLE_ADMIN should be given access to any resource protected by this role. </em><br /><code><br />&lt;sec:authorize ifAllGranted=&ldquo;ROLE_ADMIN&rdquo;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;a href=&ldquo;<a href="https://www.google.com" &gt;Google&lt; a&gt">http://www.google.com"&gt;Google&lt;/a&gt</a>;<br />&lt;/sec:authorize&gt;<br /></code><br />or<br /><code><br />@Secured(&rdquo;ROLE_ADMIN&quot;)<br />public void foo()<br />&nbsp;&nbsp;&nbsp;&nbsp;&hellip;<br />}<br /></code></p><p>The same user should be given access to any resource protected by the corresponding business function.<br /><code><br />&lt;sec:authorize ifAllGranted=&ldquo;BF_POLICY_DELETE&rdquo;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;a href=&ldquo;<a href="https://www.google.com" &gt;Google&lt; a&gt">http://www.google.com"&gt;Google&lt;/a&gt</a>;<br />&lt;/sec:authorize&gt;<br /></code><br />or<br /><code><br />@Secured(&rdquo;BF_POLICY_DELETE&quot;)<br />public void foo()<br />&nbsp;&nbsp;&nbsp;&nbsp;&hellip;<br />}<br /></code></p><p>There are actually several ways for handling this requirement. One of them would be to create a <a href="http://static.springsource.org/spring-security/site/apidocs/org/springframework/security/userdetails/hierarchicalroles/RoleHierarchy.html">RoleHierarchy</a> and use <a href="http://static.springsource.org/spring-security/site/apidocs/org/springframework/security/vote/RoleHierarchyVoter.html">RoleHierarchyVoter</a> to traverse hierarchy of roles. The downside of this approach is that in the current implementation of Spring Security 2.0.4, taglibs (security: authorize &hellip; ) do not go through <em>AccessDecisionManager</em> to make a decision, thus no <em>Voters</em> are playing any role while making decisions about protecting HTML elements. However given the amazing flexibility and customization power of Spring Security, accomplishing this requirement is still quite simple.<br />One of the biggest benefits of Spring Security is customizations around how <em>Principal</em> (UserDetails object) is created. When <em>UserDetails</em> object is created it is populated with the list of <em>GrantedAuthorities</em>. This list is later inspected to match against <em>GrantedAuthority</em> protecting a resource.<br />One of the customization we can do is to customize the list of <em>GrantedAuthorities</em> during the creation of <em>UserDetails</em> object.</p><p>In the supplied example there are two property files (for simplification I am using property files, however you can easily modify it to use DB or LDAP).<br />One file <em>users.properties</em> maps user to <em>roles</em><br /><code><br />oleg=powder,ROLE_ADMIN<br /></code><br />while the other one <em>role-to-bf.properties</em> maps roles to the list of <em>business functions</em><br /><code><br />ROLE_ADMIN=BF_QUOTE_CREATE,BF_POLICY_CREATE,BF_POLICY_DELETE<br /></code><br />Our goal is to create a <em>UserDetails</em> object which contains a list of <em>GrantedAuthorities</em> representing both <em>roles</em> and <em>business functions.</em><br />For example: for the user <strong>oleg</strong> the list of <em>GrantedAuthorities</em> should be:<br /><code><br />ROLE_ADMIN,BF_QUOTE_CREATE,BF_POLICY_CREATE,BF_POLICY_DELETE<br /></code><br />So all we need is define a custom implementation of <a href="http://static.springsource.org/spring-security/site/apidocs/org/springframework/security/userdetails/UserDetailsService.html">UserDetailsService</a> where by using both property files (could be DB or LDAP in real life) we will create custom list of <em>GrantedAuthorities</em> and then inject them into the final <em>UserDetails</em> object. This is quite simple and we can reuse the existing implementation of <em>GrantedAuthority</em> interface such as <a href="http://static.springsource.org/spring-security/site/apidocs/org/springframework/security/GrantedAuthorityImpl.html">GrantedAuthorityImpl</a>. However, we also want to make sure that we can trace (for debugging or any other purpose) the <strong>parent</strong> <em>GrantedAuthority</em> for each GrantedAuthority that represents a business function.<br />In order to accomplish both of these goals we will extend <em>GrantedAuthorityImpl</em> by defining a <strong>BusinessFunctionGrantedAuthority</strong> class which simply contains a list of all parent <em>GrantedAuthority</em> objects which define such <em>business function</em>.<br /><code><br />public class BusinessFunctionGrantedAuthority extends GrantedAuthorityImpl {<br />&nbsp;&nbsp;&nbsp;&nbsp;private List&lt;GrantedAuthority&gt; parentAuthorities;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&hellip;<br />}<br /></code></p><p>Then we will create a custom implementation of UserDetailsService and implement <em>loadUserByName(..)</em> method where we will perform the following:<br><br><br /><em>1. Create UserAttribute object  based on contents of users.properties file. UserAttribute will contain the list of GrantedAuthorities representing roles.<br><br />2. Iterate through the list of role-GratedAuthorities and for each role-GrantedAuthority create a BusinessFunctionGrantedAuthority and add it to the overall list of already created GrantedAuthorities<br><br />&nbsp;&nbsp;&nbsp;&nbsp;2.1 Add parent GrantedAuthority to each BusinessFunctionGrantedAuthority<br><br />3. Create final UserDetails object which contains the full list of GrantedAuthorities.<br></em></p><p>Then define your <em>AuthenticationProvider</em> in you Spring Security configuration:</p><p><a href="http://blog.springsource.com/wp-content/uploads/2009/01/picture-6.png"><img src="http://blog.springsource.com/wp-content/uploads/2009/01/picture-6.png" alt="" title="picture-6" width="500" height="126" class="alignnone size-full wp-image-905" /></a></p><p>NOTE: we are injecting AuthenticationProvider with custom UserDetailsService implemented by ComplexAuthorityUserDetailsService class.(see sample code for more details)<br><br />Secure your resources, deploy and access application: <em><a href="http://localhost:8080/spring-security-sample-grantedAuthority/index.jsp">http://localhost:8080/spring-security-sample-grantedAuthority/index.jsp</a></em><br><br />After Logging on you should see the list of <em>GrantedAuthorities</em> being displayed along with other properties of the <em>Principal</em>:</p><p><a href="http://blog.springsource.com/wp-content/uploads/2009/01/picture-5.png"><img src="http://blog.springsource.com/wp-content/uploads/2009/01/picture-5.png" alt="" title="picture-5" width="500" height="253" class="alignnone size-full wp-image-901" /></a></p><p>You can clearly see that <em>GrantedAuthority</em> representing <em>business function</em> also shows the list of parent <em>GratedAuthorities</em> defining such <em>business function</em>.<br />Inspect <em>index.jsp</em> and observe how <em>security:authorize</em> tag is using both <em>roles</em> and <em>business functions</em> to protect HTML elements<br />That is all. You can clearly see how with few minor customizations you can easily extend and customize the structure of the Principal and apply declarative protection based on custom GrantedAuthorities without polluting your business code with custom security code.</p><p>Sample code could be downloaded here: <a href="http://blog.springsource.com/wp-content/uploads/2009/01/spring-security-sample-grantedauthority.zip">spring-security-sample-grantedauthority</a></p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 197;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>