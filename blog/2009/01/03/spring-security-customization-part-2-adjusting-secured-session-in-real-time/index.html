<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Spring Security customization (Part 2 - Adjusting secured session in real time)</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Spring Security customization (Part 2 - Adjusting secured session in real time)" />
<meta name="twitter:description" content="&lt;p&gt;Imagine you are in the secured session (you are logged on and are authorized to access a particular resource), but your security infrastructure team has updated your rights and privileges. Perhaps you were given more rights and privileges or perhaps your rights were completely revoked… The problem is that your secured session is registered in session registry and until you log-off/log-on the Principal which represents you in this secured session will not be recreated. And what if the situation is even more dramatic (after all we are talking security here)… You are a disgruntled employe and your immediate management found out about your “wrong doings”, but it takes your company 5 meetings and 10 approval forms to get something done, and until that happens you are free to cause even more harm???&lt;/p&gt;
" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=200" />

<meta property="og:title" content="Spring Security customization (Part 2 - Adjusting secured session in real time)" />
<meta property="og:image" content="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=200" />
<meta property="og:description" content="&lt;p&gt;Imagine you are in the secured session (you are logged on and are authorized to access a particular resource), but your security infrastructure team has updated your rights and privileges. Perhaps you were given more rights and privileges or perhaps your rights were completely revoked… The problem is that your secured session is registered in session registry and until you log-off/log-on the Principal which represents you in this secured session will not be recreated. And what if the situation is even more dramatic (after all we are talking security here)… You are a disgruntled employe and your immediate management found out about your “wrong doings”, but it takes your company 5 meetings and 10 approval forms to get something done, and until that happens you are free to cause even more harm???&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2009-01-03 04:37:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Security customization (Part 2 - Adjusting secured session in real time)</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/50af47c68e5c7282005f2a8983f443f5?s=20&amp;d=mm" />
<span class="author">Oleg Zhurakousky</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2009-01-03 04:37:00.0">January 03, 2009</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="198" href="/blog/2009/01/03/spring-security-customization-part-2-adjusting-secured-session-in-real-time#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>Imagine you are in the secured session (you are logged on and are authorized to access a particular resource), but your security infrastructure team has updated your rights and privileges. Perhaps you were given more rights and privileges or perhaps your rights were completely revoked&hellip; The problem is that your secured session is registered in session registry and until you log-off/log-on the Principal which represents you in this secured session will not be recreated. And what if the situation is even more dramatic (after all we are talking security here)&hellip; You are a disgruntled employe and your immediate management found out about your &ldquo;wrong doings&rdquo;, but it takes your company 5 meetings and 10 approval forms to get something done, and until that happens you are free to cause even more harm???</p><p>Obviously there are many business scenarios that could prompt for adjustment of user&rsquo;s privileges while such user is in session. And again in Spring Security there are obviously more then one way of accomplishing this. One way would be kicking people out of the system by using the session registry (which is actually intended for concurrent session control). Building a GUI or JMX enabling this, one can &ldquo;expire&rdquo; a user from the list of registered sessions. The next request they make will be rejected and the session will be invalidated, forcing the process of Authentication.<br />However to make it more interesting and also to demonstrate yet another way of accomplishing the similar goal let&rsquo;s change scenario slightly and say that we don&rsquo;t want to completely invalidate user&rsquo;s secured session, but simply want to temporarily suspend it.</p><p>Now, the word <em>suspend</em> in the context of security could mean a lot of different things. It could mean a temporary suspension or it could mean a total revocation of rights. I&rsquo;ll leave it up to you to define the meaning of this word in whatever context&hellip; What I would rather do is to show you how secured session could be adjusted in real time using Spring Security components such as <em>AccessDecisionVoter</em> and <em>AccessDesisionManager</em>. Also in the following example we will adjust the current secured session by temporarily suspending user&rsquo;s rights without invalidating his/hers session.</p><p>To accomplish this we need to follow these steps.</p><p><em>1. In Spring Security configuration define AccessDecisionManager<br />&nbsp;&nbsp;&nbsp;&nbsp;1.1 Define basic voters such as RoleVoter and AuthenticatedVoter<br />2. Define and implement AccessDecisionVoter. This voter must maintain a list of users whose rights were revoked and must vote ACCESS_DENIED each time a user performs a secured operation.<br />3. Add this voter to the stack of voters already registered with AccessDecisionManager.</em></p><p>Also, to be able to interact with this voter during the course of the application runtime let&rsquo;s also JMX enable this voter by dynamically exporting it as JMX bean using Spring JMX.</p><p>That is pretty much it.</p><p>So, first we need to define <em>AccessDecisionManager</em> (ADM). Since we are using Spring Security name space (whenever we can) configuration elements such as <strong>&ldquo;security:http&rdquo;</strong>, Spring Security will register default <em>AccessDecisionManager</em> for us, which happens to be <a href="http://static.springsource.org/spring-security/site/apidocs/org/springframework/security/vote/AffirmativeBased.html">AffirmativeBased</a> ADM. That is not good for us since we are trying to be a bit more conservative here. So, what we are going to do is define <a href="http://static.springsource.org/spring-security/site/apidocs/org/springframework/security/vote/UnanimousBased.html">UnanimousBased</a> ADM and override default ADM of <strong>&ldquo;security:http&rdquo; </strong>element using <em>access-decision-manager-ref</em> attribute pointing to <em>UninimousBased</em> ADM (see below)</p><p><code><br />&lt;!&ndash; Define custom Voter &ndash;&gt;<br />&lt;bean id=&ldquo;suspendVoter&rdquo; class=&ldquo;org.springframework.security.sample.SuspendRealTimeVoter&rdquo;/&gt;</code></p><p><code><br />&lt;!&ndash; Define AccessDesisionManager as UnanimousBased &ndash;&gt;<br />&lt;bean id=&ldquo;accessDecisionManager&rdquo; class=&ldquo;org.springframework.security.vote.UnanimousBased&rdquo;&gt;<br />&nbsp;&nbsp;&lt;property name=&ldquo;decisionVoters&rdquo;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;list&gt;<br /><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ref bean=&ldquo;suspendVoter&rdquo; /&gt;</strong><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;bean class=&ldquo;org.springframework.security.vote.RoleVoter&rdquo; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;bean class=&ldquo;org.springframework.security.vote.AuthenticatedVoter&rdquo; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/list&gt;<br />&nbsp;&nbsp;&lt;/property&gt;<br />&lt;/bean&gt;</code></p><p>We are also going to put our custom voter first in the order of voter&rsquo;s stack, knowing that in the Unanimous based decision making process the first NO means <em>no further evaluation should be performed</em>. Realizing that other voting decisions could be time consuming or performance intensive, registering custom voter first in voter stack will ensure that such voting operations are only performed if privileges are not suspended.</p><p><code>&lt;!&ndash; Define http security configuration &ndash;&gt;<br />&lt;security:http <strong>access-decision-manager-ref=&ldquo;accessDecisionManager&rdquo;</strong> &hellip; . .&gt;<br />&hellip; .<br />&lt;/security:http&gt;<br /></code></p><p>The only thing left to do is JMX enable &ldquo;suspendVoter&rdquo;. This is easily done using <a href="http://static.springframework.org/spring/docs/2.5.x/reference/jmx.html">Spring JMX </a>.<br /><code><br />&lt;!&ndash; JMX enable custom Voter &ndash;&gt;<br />&lt;bean class=&ldquo;org.springframework.jmx.export.MBeanExporter&rdquo;&gt;<br />&nbsp;&nbsp;&lt;property name=&ldquo;beans&rdquo;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;map&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;entry <strong>key=&ldquo;org.springframework.security:name=SuspendRealTimeVoter&rdquo; value-ref=&ldquo;suspendVoter&rdquo;</strong> /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/map&gt;<br />&nbsp;&nbsp;&lt;/property&gt;<br />&lt;/bean&gt;</code></p><p>Now <strong>&ldquo;suspendVoter&rdquo;</strong> will be exported into JMX server under name <strong>org.springframework.security:name=SuspendRealTimeVoter</strong></p><p>From the code perspective the only custom component we need to implement is <strong>SuspendRealTimeVoter</strong> class. In it, we will maintain a Set of users whose rights have been temporarily revoked. Inside of <em>vote(..) </em>method our logic is rather simple. If user is in the list, vote ACCESS_DENIED otherwise vote ACCESS_GRANTED.</p><p><code><br />public int vote(Authentication authentication, Object object,<br />ConfigAttributeDefinition config) {<br />&nbsp;&nbsp;&nbsp;&nbsp;String userName = authentication.getName();<br />&nbsp;&nbsp;&nbsp;&nbsp;return revokedUsers.contains(userName) ? ACCESS_DENIED : ACCESS_GRANTED;<br />}<br /></code></p><p>There you&rsquo;ll also see <em>suspend(String userName)</em> and <em>grant(String userName)</em> methods via which we will test this functionality.</p><p>NOTE: To interact with our voter via JMX we will be using JConsole tool provided by your JDK (1.5+) and therefore need to JMX enable our application server. For this example I am using Tomcat, so if you are using Tomcat add the following VM argument to its startup script</p><p><code><br />-Dcom.sun.management.jmxremote<br /></code></p><p>Start the server, deploy the application and access its URL: <em><a href="http://localhost:8080/spring-security-sample-suspendUser">http://localhost:8080/spring-security-sample-suspendUser</a></em></p><p>After successful log on click on <em>refresh</em> few times to see that your session is alive and doing well. Then navigate to the <em>bin</em> directory of your JDK, open command prompt and type <em>jconsole</em> (see below)</p><p><a href="http://blog.springsource.com/wp-content/uploads/2009/01/picture-7.png"><img src="http://blog.springsource.com/wp-content/uploads/2009/01/picture-7.png" alt="" title="picture-7" width="275" height="91" class="alignnone size-medium wp-image-911" /></a></p><p>When JConsole opens up click on MBeans tab. Navigate the tree and access SuspendRealTimeVoter.</p><p><a href="http://blog.springsource.com/wp-content/uploads/2009/01/picture-8.png"><img src="http://blog.springsource.com/wp-content/uploads/2009/01/picture-8.png" alt="" title="picture-8" width="500" height="381" class="alignnone size-full wp-image-912" /></a></p><p>You will see that <em>suspend(..)</em> and <em>grant(..)</em> methods are available under <em>Operations</em> tab. Suspend the rights of the user you are logged on as and refresh HTML page you are on. You will be presented with denied.html page. Un-suspend the user by calling <em>grant(..)</em> method for that user and you are back in business.<br />Now if it does take 5 meetings and 10 approval forms you can temporarily revoke the rights of the user giving your managers enough time to make such decisions.</p><p><strong>Conclusion</strong></p><p>This was just one example demonstrating how secured session could be temporarily suspended using Voters. But I hope you can clearly see how the same approach could be used to accomplish other goals. Such goals could be re-authenticate user automatically or simply update the list of his/hers GrantedAuorities and so on.</p><p>Sample source code for this article could be downloaded from here: <a href='http://blog.springsource.com/wp-content/uploads/2009/01/spring-security-sample-suspenduser.zip'>spring-security-sample-suspenduser</a></p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 198;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>