<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>在10分钟内完成Spring Integration</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Spring Integration in 10 minutes">
<meta name="twitter:description" >
<meta name="twitter:creator" content="@m_f_">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/443e6ec0242c3f54001dae34374780e2?s=200">

<meta property="og:title" content="Spring Integration in 10 minutes">
<meta property="og:image" content="https://gravatar.com/avatar/443e6ec0242c3f54001dae34374780e2?s=200">
<meta property="og:description" >
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2009-02-13 16:15:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">在10分钟内完成Spring Integration</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/443e6ec0242c3f54001dae34374780e2?s=20&d=mm"> <a class="author" rel="author" href="/team/mfisher">马克·费舍尔</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2009-02-13 16:15:00.0">2009年2月13日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2009/02/13/spring-integration-in-10-minutes#disqus_thread" data-disqus-identifier="201">
</a></div>
</div>
</header>
<div class="blog--post"><p>Spring Integration 1.0 GA版本是在两个月前在SpringOne Americas上<a href="http://www.springsource.org/node/843" target="_blank">宣布的</a> ，从那以后，我就一直在写一个新的，最新的“入门”博客文章。好吧，年初总是很忙，所以我的目标是提供一个包含10个步骤的实际示例。每一步大约需要一分钟...除非您停止思考;）。因此，事不宜迟，我们开始了！</p>
<h2>步骤1：下载Spring Integration发行版</h2><p>您可以在此处获取最新版本（在我撰写本文时为1.0.1）：<br><a href="http://www.springsource.com/download/community?project=Spring Integration" target="_blank"></a> <a href="http://www.springsource.com/download/community?project=Spring Integration">http://www.springsource.com/download/community?project=Spring%20Integration</a></p><p>下载完成后，解压缩文件。您将看到一个'dist'目录，其中包含构成Spring Integration项目的JAR。您还将看到一个包含依赖项的“ lib”目录。</p>
<h2>步骤2：建立专案</h2><p>我将使用Eclipse作为示例，但是您当然可以在另一个IDE中执行此操作。您也可以使用Maven或Ivy，但是这里的示例非常简单，仅创建目录并添加JAR就足够了。</p><p>创建一个新的“ Java项目”（在“包资源管理器”视图中，右键单击，然后单击“新建-> Java项目”），然后在其中创建一个“ lib”目录。然后，将以下JAR从Spring Integration的“ dist”和“ lib”目录复制到项目的“ lib”中。<br><strong>来自dist：</strong><br></p><ul><br> <li>org.springframework.integration-1.0.1。RELEASE.jar</li><br> <li>org.springframework.integration-file-1.0.1。RELEASE.jar</li><br></ul><br><strong>来自库：</strong><br><ul><br> <li>com.springsource.org.aopalliance-1.0.0.jar</li><br> <li>com.springsource.org.apache.commons.logging-1.1.1.jar</li><br> <li>org.springframework.aop-2.5.6。罐头</li><br> <li>org.springframework.beans-2.5.6。罐头</li><br> <li>org.springframework.context-2.5.6。罐头</li><br> <li>org.springframework.core-2.5.6。罐头</li><br> <li>org.springframework.transaction-2.5.6。罐头</li><br></ul><p></p><p>在Eclipse中刷新“ lib”目录（按F5键），然后将这些JAR添加到构建路径中（选择JAR，右键单击，然后选择“ Build Path-> Add to Build Path”）。最后，在“ src”目录中创建一个“博客”包。</p>
<h2>步骤3：开始Spring配置</h2><p>如果您使用的是<a href="http://springide.org/blog/" target="_blank">Spring IDE</a>或<a href="http://www.springsource.com/products/suite/sts" target="_blank">SpringSource Tool Suite</a> ，则可以添加Spring项目性质，然后右键单击“ blog”包以创建一个新的bean定义文件。否则，只需创建以下内容并将其命名为“ config.xml”：</p>
<pre><code class="prettyprint xml"><br />&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:si=&quot;http://www.springframework.org/schema/integration&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/integration
           http://www.springframework.org/schema/integration/spring-integration-1.0.xsd&quot;&gt;

&lt;/beans&gt;
</code></pre><p>现在，我们将添加一个元素。这定义了一个消息通道，该消息通道由Java内存队列支持，并且一次最多可容纳10条消息：</p>
<pre><code class="prettyprint xml"><br />&lt;si:channel id=&quot;channel&quot;&gt;
    &lt;si:queue capacity=&quot;10&quot;/&gt;
&lt;/si:channel&gt;
</code></pre>
<h2>步骤4：定义Bootstrap Java类</h2><p>Spring Integration组件仅嵌入在任何Spring ApplicationContext中。因此，我们要做的就是基于此配置文件创建一个。如果在Web应用程序中运行，则可以使用Spring的ContextLoaderListener进行引导，或者如果您在<a href="http://www.springsource.com/products/suite/dmserver" target="_blank">dm Server中</a>运行，它也将为您处理。对于这个简单的示例，我们将在名为Bootstrap的类中创建一个<em>main（）</em>方法（在“ blog”包中）：</p>
<pre><code class="prettyprint java"><br />public class Bootstrap {

    public static void main(String[] args) {
        new ClassPathXmlApplicationContext(&quot;blog/config.xml&quot;);
    }

}
</code></pre><p>（在任何时候，要在Eclipse中快速解决导入问题，您都可以在Mac上使用Ctrl + Shift + O…或Command + Shift + O来“组织导入”）。</p>
<h2>步骤5：发送和接收Spring Integration消息</h2><p>现在，我们可以从上下文访问通道并发送消息。由于我们还没有任何订户（接下来的几个步骤），我们也将从同一频道接收。这将证明所有配置均正确。修改<em>main（）</em>方法，使其如下所示：</p>
<pre><code class="prettyprint java"><br />public static void main(String[] args) {
    ApplicationContext context = new ClassPathXmlApplicationContext(&quot;blog/config.xml&quot;);
    PollableChannel channel = (PollableChannel) context.getBean(&quot;channel&quot;);
    channel.send(new StringMessage(&quot;Spring Integration rocks&quot;));
    Message&lt;?&gt; reply = channel.receive();
    System.out.println(&quot;received: &quot; + reply);
}
</code></pre><p>运行该命令时，应该会看到Message的<em>toString（）</em>方法的结果打印到控制台上。</p>
<h2>步骤6：创建服务</h2><p>Spring Integration旨在成为非侵入性的。这意味着我们现在将逐步修改示例，以便您<strong>没有</strong>与框架直接绑定的代码。但是，我们要做的第一件事是添加一个POJO服务，该服务将成为我们消息的订阅者。此示例将简单地将String转换为大写并添加一些感叹号：</p>
<pre><code class="prettyprint java"><br />public class Shouter {

    public String shout(String s) {
        return s.toUpperCase().concat(&quot;!!!&quot;);
    }

}
</code></pre>
<h2>步骤7：将服务添加到Spring配置</h2><p>该服务可以作为常规bean添加：</p>
<pre><code class="prettyprint xml"><br />&lt;bean id=&quot;shouter&quot; class=&quot;blog.Shouter&quot;/&gt;
</code></pre><p>接下来，我们将添加一个“服务激活器”以将Service bean连接到输入和输出通道。我们需要将现有的“通道”重命名为“输出”，然后为输入添加一个简单的非缓冲通道。整个配置应如下所示：</p>
<pre><code class="prettyprint xml"><br />&lt;si:channel id=&quot;input&quot;/&gt;

&lt;si:channel id=&quot;output&quot;&gt;
    &lt;si:queue capacity=&quot;10&quot;/&gt;
&lt;/si:channel&gt;

&lt;si:service-activator input-channel=&quot;input&quot;
                      output-channel=&quot;output&quot;
                      ref=&quot;shouter&quot;
                      method=&quot;shout&quot;/&gt;

&lt;bean id=&quot;shouter&quot; class=&quot;blog.Shouter&quot;/&gt;
</code></pre>
<h2>步骤8：通过发送消息来调用服务</h2><p>修改<em>main（）</em>方法以将消息发送到输入通道并从输出通道接收。请注意，我们也在修改依赖关系查找，并且将通道<em>强制转换</em>为不同的类型（“输入”通道是非缓冲的，因此它不是类似于输出的<em>PollableChannel</em> ）：</p>
<pre><code class="prettyprint java"><br />public static void main(String[] args) {
    ApplicationContext context = new ClassPathXmlApplicationContext(&quot;blog/config.xml&quot;);
    MessageChannel input = (MessageChannel) context.getBean(&quot;input&quot;);
    PollableChannel output = (PollableChannel) context.getBean(&quot;output&quot;);
    input.send(new StringMessage(&quot;Spring Integration rocks&quot;));
    Message&lt;?&gt; reply = output.receive();
    System.out.println(&quot;received: &quot; + reply);
}
</code></pre>
<h2>步骤9：将输出发送到文件</h2><p>无需在<em>main（）</em>方法中轮询输出，我们可以通过添加通道适配器将结果直接发送到File。首先，您可以从输出通道中删除队列子元素，因为不需要轮询：</p>
<pre><code class="prettyprint xml"><br />&lt;si:channel id=&quot;output&quot;/&gt;
</code></pre><p>添加通道适配器。您可以指定任何现有目录，并且在Windows上应包括驱动器号（例如，“C：/ tmp”）：</p>
<pre><code class="prettyprint xml"><br />&lt;file:outbound-channel-adapter channel=&quot;output&quot; directory=&quot;/tmp&quot;/&gt;
</code></pre><p>接下来，您可以将Bootstrap的<em>main（）</em>方法更新为仅发送：</p>
<pre><code class="prettyprint java"><br />public static void main(String[] args) {
    ApplicationContext context = new ClassPathXmlApplicationContext(&quot;blog/config.xml&quot;);
    MessageChannel input = (MessageChannel) context.getBean(&quot;input&quot;);
    input.send(new StringMessage(&quot;Spring Integration rocks&quot;));
}
</code></pre><p>您还需要将“文件”命名空间添加到XSD配置中。顶级“ beans”元素应如下所示：</p>
<pre><code class="prettyprint xml"><br />&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:si=&quot;http://www.springframework.org/schema/integration&quot;
       xmlns:file=&quot;http://www.springframework.org/schema/integration/file&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/integration
            http://www.springframework.org/schema/integration/spring-integration-1.0.xsd
            http://www.springframework.org/schema/integration/file
            http://www.springframework.org/schema/integration/file/spring-integration-file-1.0.xsd&quot;&gt;
</code></pre><p>运行该示例，您应该在扩展名为“ .msg”的文件中看到输出（您可以添加文件名生成器策略，但这不在本文讨论范围之内）。</p>
<h2>步骤10：创建网关接口</h2><p>最后一步将实现完全非侵入性的目标。与其将消息发送到消息通道，不如将消息作为参数发送到简单接口，将更加干净。在“博客”包中创建以下接口：</p>
<pre><code class="prettyprint java"><br />public interface Gateway {

    void send(String s);

}
</code></pre><p>然后，将以下元素添加到您的配置中：</p>
<pre><code class="prettyprint xml"><br />&lt;si:gateway id=&quot;gateway&quot; service-interface=&quot;blog.Gateway&quot; default-request-channel=&quot;input&quot;/&gt;
</code></pre><p>最后，在main方法而不是通道中使用Gateway。现在，您只需传递一个字符串即可：</p>
<pre><code class="prettyprint java"><br />public static void main(String[] args) {
    ApplicationContext context = new ClassPathXmlApplicationContext(&quot;blog/config.xml&quot;);
    Gateway gateway = (Gateway) context.getBean(&quot;gateway&quot;);
    gateway.send(&quot;Spring Integration rocks&quot;);
}
</code></pre>
<h2>结论</h2><p>希望这对Spring Integration提供了不错的介绍。最重要的一点是，您可以轻松创建使用非侵入式Spring编程模型的专用集成层。当您开始添加多个端点时，实际值显而易见。然后，您可能需要添加过滤器，变压器和路由器。</p><p>Spring Integration提供的功能远远超出此示例演示的内容。要了解更多信息，请查看“ org.springframework.integration.samples”模块中的各个项目（源可在发行版的“ src”目录中找到）并通读《 <a href="http://static.springframework.org/spring-integration/reference/htmlsingle/spring-integration-reference.html" target="_blank">参考文档》</a> 。当然，您可以在Spring Integration <a href="http://www.springsource.org/spring-integration" target="_blank">Home Page</a>上找到更多信息。</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 201;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>