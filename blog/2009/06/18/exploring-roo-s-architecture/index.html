<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Exploring Roo&#39;s Architecture</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Exploring Roo&#39;s Architecture" />
<meta name="twitter:description" content="&lt;p&gt;Last month we discovered how easy it is to &lt;a href=&quot;http://blog.springsource.com/2009/05/27/roo-part-2/&quot;&gt;build a fully-fledged enterprise application&lt;/a&gt; in just a few minutes using &lt;a href=&quot;http://www.springsource.org/roo&quot;&gt;Spring Roo&lt;/a&gt; - our new productivity tool for Java developers. While many Java developers have &lt;a href=&quot;http://twitter.com/kalayl/statuses/2197250433&quot;&gt;already&lt;/a&gt; &lt;a href=&quot;http://twitter.com/jayjwagner/statuses/2198297867&quot;&gt;started&lt;/a&gt; &lt;a href=&quot;http://twitter.com/alexcuesta/statuses/2193076123&quot;&gt;evaluating&lt;/a&gt; &lt;a href=&quot;http://twitter.com/mingjin/statuses/2188877538&quot;&gt;Roo&lt;/a&gt; &lt;a href=&quot;http://twitter.com/royvanrijn/statuses/2180948379&quot;&gt;to&lt;/a&gt; &lt;a href=&quot;http://twitter.com/kellerds/statuses/2062301262&quot;&gt;help&lt;/a&gt; &lt;a href=&quot;http://twitter.com/jungho_kim/statuses/2155503471&quot;&gt;save&lt;/a&gt; &lt;a href=&quot;http://twitter.com/techcast/statuses/2131191020&quot;&gt;time&lt;/a&gt; &lt;a href=&quot;http://twitter.com/diversit/statuses/2079233314&quot;&gt;on&lt;/a&gt; &lt;a href=&quot;http://twitter.com/desmax74/statuses/2073967984&quot;&gt;their&lt;/a&gt; &lt;a href=&quot;http://twitter.com/jcatron/statuses/2065733225&quot;&gt;projects&lt;/a&gt;, I’ve received a lot of questions from people curious about how Roo actually works. In this blog entry I will explore Roo’s architecture in depth, including its goals, alternatives prototyped, design rationale and implementation details. By the end you’ll have a good understanding of what makes Roo tick and why its approach works well for Java projects.&lt;/p&gt;
" />

<meta property="og:title" content="Exploring Roo&#39;s Architecture" />
<meta property="og:description" content="&lt;p&gt;Last month we discovered how easy it is to &lt;a href=&quot;http://blog.springsource.com/2009/05/27/roo-part-2/&quot;&gt;build a fully-fledged enterprise application&lt;/a&gt; in just a few minutes using &lt;a href=&quot;http://www.springsource.org/roo&quot;&gt;Spring Roo&lt;/a&gt; - our new productivity tool for Java developers. While many Java developers have &lt;a href=&quot;http://twitter.com/kalayl/statuses/2197250433&quot;&gt;already&lt;/a&gt; &lt;a href=&quot;http://twitter.com/jayjwagner/statuses/2198297867&quot;&gt;started&lt;/a&gt; &lt;a href=&quot;http://twitter.com/alexcuesta/statuses/2193076123&quot;&gt;evaluating&lt;/a&gt; &lt;a href=&quot;http://twitter.com/mingjin/statuses/2188877538&quot;&gt;Roo&lt;/a&gt; &lt;a href=&quot;http://twitter.com/royvanrijn/statuses/2180948379&quot;&gt;to&lt;/a&gt; &lt;a href=&quot;http://twitter.com/kellerds/statuses/2062301262&quot;&gt;help&lt;/a&gt; &lt;a href=&quot;http://twitter.com/jungho_kim/statuses/2155503471&quot;&gt;save&lt;/a&gt; &lt;a href=&quot;http://twitter.com/techcast/statuses/2131191020&quot;&gt;time&lt;/a&gt; &lt;a href=&quot;http://twitter.com/diversit/statuses/2079233314&quot;&gt;on&lt;/a&gt; &lt;a href=&quot;http://twitter.com/desmax74/statuses/2073967984&quot;&gt;their&lt;/a&gt; &lt;a href=&quot;http://twitter.com/jcatron/statuses/2065733225&quot;&gt;projects&lt;/a&gt;, I’ve received a lot of questions from people curious about how Roo actually works. In this blog entry I will explore Roo’s architecture in depth, including its goals, alternatives prototyped, design rationale and implementation details. By the end you’ll have a good understanding of what makes Roo tick and why its approach works well for Java projects.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2009-06-18 13:29:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Exploring Roo&#39;s Architecture</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="null?s=20&amp;d=mm" />
<span class="author">Ben Alex</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2009-06-18 13:29:00.0">June 18, 2009</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="245" href="/blog/2009/06/18/exploring-roo-s-architecture#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>Last month we discovered how easy it is to <a href="http://blog.springsource.com/2009/05/27/roo-part-2/">build a fully-fledged enterprise application</a> in just a few minutes using <a href="http://www.springsource.org/roo">Spring Roo</a> - our new productivity tool for Java developers. While many Java developers have <a href="https://twitter.com/kalayl/statuses/2197250433">already</a> <a href="https://twitter.com/jayjwagner/statuses/2198297867">started</a> <a href="https://twitter.com/alexcuesta/statuses/2193076123">evaluating</a> <a href="https://twitter.com/mingjin/statuses/2188877538">Roo</a> <a href="https://twitter.com/royvanrijn/statuses/2180948379">to</a> <a href="https://twitter.com/kellerds/statuses/2062301262">help</a> <a href="https://twitter.com/jungho_kim/statuses/2155503471">save</a> <a href="https://twitter.com/techcast/statuses/2131191020">time</a> <a href="https://twitter.com/diversit/statuses/2079233314">on</a> <a href="https://twitter.com/desmax74/statuses/2073967984">their</a> <a href="https://twitter.com/jcatron/statuses/2065733225">projects</a>, I&rsquo;ve received a lot of questions from people curious about how Roo actually works. In this blog entry I will explore Roo&rsquo;s architecture in depth, including its goals, alternatives prototyped, design rationale and implementation details. By the end you&rsquo;ll have a good understanding of what makes Roo tick and why its approach works well for Java projects.</p>
<h2>New Roo and STS Releases</h2><p>Before I get into the detail of Roo&rsquo;s architecture, I should briefly mention we have today released <a href="http://www.springsource.com/download/community?project=Spring%20Roo">Spring Roo 1.0.0.M2</a>. Featuring <a href="http://jira.springsource.org/secure/ReleaseNote.jspa?projectId=10340&styleName=Html&version=11227">dozens of bug fixes and minor enhancements</a>, this new release also includes:</p>
<ul>
<li>A very nice unit test mocking capability (written by Rod Johnson)</li>
<li>Java and SQL reserved word detection (so no longer will you accidentally call a field something like "from")</li>
<li>The ability to specify the particular Java version you'd like to use (of particular importance to Apple users)</li>
<li>Extra <a href="http://www.springsource.org/webflow">Spring Web Flow</a> configuration (so you now have a proper flow to play with)</li>
<li>Automatic exposure of dynamic finders to the web tier</li>
<li>Improved support for Windows users and those with non-English default locales</li>
</ul><p>We&rsquo;ve also released <a href="http://www.springsource.com/products/sts">SpringSource Tool Suite</a> (STS) 2.1.0.M2 since my <a href="http://blog.springsource.com/2009/05/27/roo-part-2/">last blog</a> entry. The Roo support in STS continues to improve, and you can now even configure STS to point to a separately-downloaded Roo installation. This is great news for the increasing number of people writing their own Roo add-ons or simply wanting to use the latest Roo releases with STS. Other nice Roo features in STS include CTRL + R &ldquo;Roo command&rdquo; dispatch, an inbuilt Roo shell, extra Roo commands to execute integration tests or deployments (including to a cloud environment!) and more. I thoroughly recommend downloading STS 2.1.0.M2 if you haven&rsquo;t already done so.</p>
<h2>Roo Core versus Roo Add-Ons</h2><p>At its heart, Roo offers a core set of services that permit &ldquo;add-os&rdquo; to be used. These core services include a shell, file system manager, file system monitor, file undo capability, classpath abstraction, Abstract Syntax Tree (AST) parsing and binding, project build system interface, metadata model, process management, bootstrap and utility services. While we&rsquo;ll indirectly explore some of these core services later on, the vast majority of functionality that end users are interested in come from add-ons. Without any add-ons, Roo is just an elaborate console.</p><p>When you download Roo, we ship the core services plus a series of common add-ons. All of the add-ons can be identified via the &ldquo;addon&rdquo; keyword appearing in their JAR name. Every add-on that ships with Roo is optional and end users are free to enhance existing add-ons or create new ones. Indeed we very much welcome the community to develop and share add-ons they find useful.</p><p>Given there is a design separation between Roo&rsquo;s core services and the add-ons a user may wish to use, the focus of our energy for Roo 1.0.0 is on ensuring mainstream web applications can be easily and productively developed. In subsequent versions of Roo we will ship an increasingly richer array of add-ons that help users build other classes of application.</p><p>One area I&rsquo;ve been asked frequently about is Roo&rsquo;s use of <a href="https://maven.apache.org/">Maven</a>. As noted in my <a href="http://blog.springsource.com/2009/05/27/roo-part-2/">last blog</a> entry, the projects that Roo 1.0.0 creates use Maven. Because this Maven usage is implemented via an add-on, it is easy to add support for other project build systems as well. Indeed we&rsquo;ve had many requests for <a href="https://ant.apache.org/">Ant</a>/<a href="https://ant.apache.org/ivy/">Ivy</a> support, and there is already a feature request in Jira (<a href="http://jira.springsource.org/browse/ROO-91">ROO-91</a>) for this.</p><p>On a similar note, Roo also currently ships <a href="https://en.wikipedia.org/wiki/Java_Persistence_API">JPA</a> and <a href="http://java.sun.com/products/jsp/">JSP</a> add-ons. Both of these are pragmatic choices we made to support typical web application development in Roo 1.0.0. There is no technical reason at all preventing the development of <a href="http://java.sun.com/javase/technologies/database/">JDBC</a>, <a href="http://java.sun.com/jdo/">JDO</a>, <a href="http://java.sun.com/javaee/javaserverfaces/">JSF</a>, <a href="https://velocity.apache.org/">Velocity</a> and <a href="http://freemarker.org/">FreeMarker</a> add-ons, and we hope to see such add-ons over time.</p><p>Because this blog entry is focused on Roo&rsquo;s architecture, I&rsquo;ll conclude discussion of individual add-ons at this point. You can read my <a href="http://blog.springsource.com/2009/05/27/roo-part-2/">last blog</a> entry if you&rsquo;d like to learn more about how the current Roo 1.0.0 add-ons can be used to build applications. For now, let&rsquo;s dig a little deeper into how Roo actually works.</p>
<h2>Roo's Design Goals</h2><p>Whenever reviewing any technology, it is important to consider the design goals and objectives that influenced its architectural choices. I explored some of these goals in my <a href="http://blog.springsource.com/2009/05/01/roo-part-1/">original Roo blog entry</a>, but let&rsquo;s revisit the topic here in a little more detail.</p><p>Most importantly, we wanted Roo to be a productivity solution for Java developers. There are many developers who prefer to (or need to) work in Java, and Java remains the most <a href="http://www.tiobe.com/index.php/content/paperinfo/tpci/index.html">widely used programming language on the planet</a>. Providing a first-class productivity tool to this very large group of developers represents Roo&rsquo;s most fundamental goal.</p><p>Second, we wanted to ensure we eliminated barriers to adopting Roo. There is no point having a great productivity tool if people aren&rsquo;t comfortable (or simply aren&rsquo;t allowed) to use it. Specifically, that meant having no <a href="https://en.wikipedia.org/wiki/Vendor_lock-in#Lock-in_in_electronics_and_computers">lock-in</a> (ie easy removal of Roo), no runtime portion (and potential approval hurdles in many organizations), no unnatural development techniques, no IDE dependencies, no licensing costs, no strange dependencies to make it work, no steep learning curve, and no compromises to speed, performance or flexibility.</p><p>Third, we wanted to deliver a solution that built on the many strengths of Java. These include extremely good runtime performance, availability of standards (like <a href="https://en.wikipedia.org/wiki/Java_Persistence_API">JPA</a>, <a href="https://jcp.org/en/jsr/detail?id=303">Bean Validation</a>, <a href="https://en.wikipedia.org/wiki/Representational_State_Transfer">REST</a>, <a href="http://java.sun.com/products/servlet">Servlet API</a> etc), fantastic IDE support (like debuggers, code assist, refactoring etc), established technologies, type safety, and a massive pool of existing developer knowledge, skills and experience (not only in Java itself but also the de facto Java building blocks like Spring, JSP, Hibernate etc).</p>
<h2>Alternatives to Roo's Architecture</h2><p>With the above requirements in mind, in 2008 I prototyped a number of different techniques including <a href="https://jcp.org/en/jsr/detail?id=269">JSR 269</a> (the Pluggable Annotation Processing API in Java 6), build-time source code generation, IDE plugins, bytecode generation at development time, bytecode generation at runtime and advanced reflective approaches such as extensions to Spring Framework AOP. I didn&rsquo;t prototype other JVM languages because the principal motivation underpinning Roo was a tool to enable Java programming.</p><p>In one way or another each approach I prototyped had issues that ruled it out. Every approach needed a special runtime, special IDE plugin or suboptimal build step (or a combination thereof). Most also permanently locked the user into the approach, with removal unduly difficult and therefore creating a barrier to adoption that would stop many Java developers from enjoying the productivity gains on offer. Many approaches also relied on reflective techniques at runtime that would be slow and confusing to debug, and most offered little to no IDE integration. I also particularly preferred providing a lightweight, command-line tool, as I strongly believed this would deliver better a usability experience than a GUI. These are the reasons why we didn&rsquo;t use the approaches listed above.</p>
<h2>Roo Architecture Summary</h2><p>After considerable prototyping we arrived at the Roo architecture, the key elements of which are:</p>
<ul>
<li>A tab-completing, context-aware, hint-providing command line shell that can be loaded and exited by the user at any time and supports concurrent use with text editors and IDEs</li>
<li>Use of @Roo* annotations which have <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/annotation/RetentionPolicy.html#SOURCE">source-level retention</a> only (not runtime retention)</li>
<li><a href="https://www.eclipse.org/aspectj/">AspectJ</a> <a href="https://www.eclipse.org/aspectj/doc/released/progguide/language-interType.html">inter-type declarations</a> (ITDs, also known as "introductions" or "mixins") for automatically maintained Java members (we'll discuss ITDs in depth below)</li>
<li>A <a href="https://en.wikipedia.org/wiki/Metadata">metadata</a> model to facilitate easy development of custom Roo add-ons (we'll also discuss the metadata model below)</li>
<li>Full round-trip capabilities, courtesy of the metadata model and various core services mentioned above</li>
</ul><p>This architecture didn&rsquo;t need a special build system, runtime component, IDE plugin or alike. It also met all of the design requirements mentioned earlier.</p>
<h2>Roo's Secret Sauce</h2><p>The &ldquo;new idea&rdquo; that made this possible was to automatically use ITDs as a code generation artifact. Using ITDs in this manner delivers considerable practical benefits, because it allows Roo to generate code that is in a separate <a href="http://hell.org.ua/Docs/oreilly/java/exp/ch05_06.htm">compilation unit</a> (ie physical file) from the code that the developer writes. Despite being in a separate file, the ITDs are combined into the same compiled .class file at compilation time. Because the resultant class is essentially the same as if the developer had written all the code themselves, all the benefits of traditional Java programming (like IDEs, debugger support, code assist, type introspection, type safety etc) work just as you&rsquo;d expect. Also, because the compiled class is just a class file, everything works perfectly at runtime. Specifically, you don&rsquo;t have to worry about issues like <a href="https://stackoverflow.com/questions/435553/java-reflection-performance">reflection performance</a>, memory usage, confusing and difficult to debug operation, extra libraries that may need approval and upgrading etc.</p><p>What&rsquo;s also exciting about using ITDs for code generation is the <a href="https://en.wikipedia.org/wiki/Separation_of_concerns">separation of concerns</a> it delivers. Separation of concerns benefits the application developer, as they can safely ignore the ITD files created by Roo (because the developer knows Roo will manage them). But the separation of concerns is also excellent for Roo add-ons as well. The development of add-ons is much easier as the add-on developer knows they control the entire ITD compilation unit contents. A more subtle benefit is the automatic upgrade support this delivers. We&rsquo;ve seen many examples during Roo&rsquo;s development where we&rsquo;ve improved an add-on and then users who subsequently load Roo receive an automatically upgraded ITD. Similarly users can remove add-ons from their environment and the relevant ITDs will automatically be removed by Roo. This is an extremely pragmatic and useful technique that we&rsquo;ve found invaluable.</p><p>The final major benefit of ITDs is lock-in avoidance. As we&rsquo;ll see later, ITDs are essentially normal Java source files. They just sit on your disk with all of the other source code, meaning developers can elect to never load Roo again and their project will still work. Those wanting a more complete removal can use features like <a href="https://www.eclipse.org/ajdt/">Eclipse AJDT</a>&rsquo;s &ldquo;<a href="https://contraptionsforprogramming.blogspot.com/2009/05/push-in-refactoring-for-ajdt.html">push in refactoring</a>&rdquo;. What this does is automatically move all source code from ITDs to the correct Java source file. This means if you don&rsquo;t want to use Roo anymore, just &ldquo;push in refactor&rdquo; your project and you have a perfectly normal Java project - just as if you&rsquo;d written it all by hand yourself. This is fantastic news:</p>
<ul>
<li>People just wanting to kick-start a project can do so with incredible ease and then remove Roo (as an aside they can also resume using Roo again at any time and it will work fine)</li>
<li>People wanting to use Roo for long term productivity gains can do so with complete confidence, knowing they can very easily remove it at any future time with just a couple of mouse clicks</li>
</ul><p>Roo uses ITDs as provided by AspectJ. <a href="http://www.springsource.com/">SpringSource</a> are big supporters and users of AspectJ, and here are just some of the reasons we feel it&rsquo;s a good fit for Roo-based projects:</p>
<ul>
<li>AspectJ is an active project with a large community</li>
<li>AspectJ is mature, reliable and robust, having origins back in 2001 at PARC</li>
<li>AspectJ is widely supported by mainstream technologies like Maven, Ant and IDEs</li>
<li>Using AspectJ delivers existing IDE support without us needing to write extra plugins</li>
<li>Our research showed around half of all Spring users were already using AspectJ anyway</li>
<li>AspectJ is not used at runtime (the AspectJ runtime JAR is needed, but this has been a Spring Framework dependency since Spring 2.0 and as such would already be approved by organizations using Spring 2.0 and above)</li>
<li>AspectJ operates at build time and therefore ensures Java's performance and <a href="http://blogs.sun.com/jonthecollector/entry/presenting_the_permanent_generation">perm gen space</a> is not compromised</li>
<li>Roo's ITD usage pattern is automatic, transparent and does not require users to have any AspectJ (or ITD) knowledge, skills or experience</li>
<li>Using AspectJ permits more advanced programming patterns to be employed such as <a href="https://en.wikipedia.org/wiki/Domain-driven_design">domain driven design</a> (DDD) and <a href="https://www.eclipse.org/aspectj/doc/next/progguide/starting-development.html">enforcement aspects</a>, should developers wish to employ them</li>
<li>SpringSource employs the current leads of AspectJ (Andy Clement) and AJDT (Andrew Eisenberg), plus highly regarded AspectJ experts (like Ramnivas Laddard and Adrian Colyer), so we knew we had considerable in-house skills to ensure AspectJ would work very well with Roo</li>
<li>Many other production-proven technologies from SpringSource are also built on or support AspectJ, including <a href="http://www.springsource.org/about">Spring Framework</a>, <a href="http://www.springsource.org/security">Spring Security</a>, <a href="http://www.springsource.com/products/ams">SpringSource Application Management Suite</a>, <a href="http://www.springsource.com/products/dmserver">SpringSource dm Server</a>, <a href="http://www.springsource.com/products/dmserver">SpringSource tc Server</a> and more</li>
</ul>
<h2>Roo Usage in More Detail</h2><p>Let&rsquo;s explore Roo&rsquo;s ITD usage and metadata model by creating a new project. Assuming you&rsquo;ve installed Roo 1.0.0.M2, let&rsquo;s create a new directory for our project and start Roo:</p>
<pre><code class="prettyprint code">$ mkdir architecture
$ cd architecture
$ roo
</code></pre><p>Once you receive the welcome screen, enter the following commands:</p>
<pre><code class="prettyprint code">roo&gt; project --topLevelPackage com.hello
roo&gt; persistence setup --provider HIBERNATE --database HYPERSONIC_IN_MEMORY
roo&gt; entity --name World 
roo&gt; field string name 
</code></pre><p>Graphically your screen will look something like this:</p><p><center><img src="http://blog.springsource.com/wp-content/uploads/2009/10/first-commands.png" alt="first-commands" title="first-commands" width="631" height="557" class="aligncenter size-full wp-image-2874" /></center><br /></p><p>Let&rsquo;s now open up a text editor and take a look inside the World.java file:</p>
<pre><code class="prettyprint java"><br />package com.hello; 

import javax.persistence.Entity; 
import org.springframework.roo.addon.javabean.RooJavaBean; 
import org.springframework.roo.addon.tostring.RooToString; 
import org.springframework.roo.addon.entity.RooEntity; 

@Entity 
@RooJavaBean 
@RooToString 
@RooEntity 
public class World { 
   private String name; 
} 
</code></pre><p>As shown, there are several @Roo* annotations. These annotations are included in Roo add-ons and instruct Roo to create an ITD if required. The @RooEntity annotation is indicating that you&rsquo;d like Roo to automatically provide typical JPA methods and fields (including an identifier and version property). The @RooJavaBean is requesting getters and setters to be created for each field. The @RooToString is requesting a toString() method to be created.</p><p>All ITDs created by Roo adopt a specific naming convention. The convention is SimpleTypeName + &ldquo;<em>Roo</em>&rdquo; + AddOnSpecificKeyword + &ldquo;.aj&rdquo;. Roo automatically ensures all files matching this format are properly managed by a relevant add-on. If there is no add-on installed for a particular keyword, Roo will delete the orphaned ITD file. This ensures you can change your add-on configuration at any time and not have to manually deal with cleaning up.</p><p>Let&rsquo;s have a look inside the World_Roo_ToString.aj ITD:</p>
<pre><code class="prettyprint java"><br />package com.hello; 

privileged aspect World_Roo_ToString { 

    public String World.toString() {    
        StringBuilder sb = new StringBuilder();        
        sb.append(&quot;id: &quot;).append(getId()).append(&quot;, &quot;);        
        sb.append(&quot;version: &quot;).append(getVersion()).append(&quot;, &quot;);        
        sb.append(&quot;name: &quot;).append(getName());        
        return sb.toString();        
    }    
    
} 
</code></pre><p>As you can see, an ITD looks just like a normal Java source file. There is only one difference: in the method signature there is a &ldquo;World.&rdquo; prefix before the &ldquo;toString()&rdquo; method name. This is directing AspectJ to introduce the toString() method into the World.class file during compilation. As you can see, ITDs are incredibly simple even if you&rsquo;ve never encountered them before. In particular, there are no pointcuts required.</p><p>Let&rsquo;s edit the World.java file and add another field to it:</p>
<pre><code class="prettyprint java"><br />private String comment;
</code></pre><p>If you&rsquo;ve left Roo running, as soon as you save World.java you will notice that it instantly modifies the World_Roo_JavaBean.aj and World_Roo_ToString.aj files. This is because Roo monitors the file system for any changes you make outside of the Roo shell, such as through your preferred IDE. You could have also used Roo&rsquo;s &ldquo;add field string&rdquo; command if you preferred.</p><p>If you didn&rsquo;t have Roo running, the next time that you load it an automatic startup-time scan will be performed. This includes automatically upgrading any existing ITDs if the relevant add-on has been upgraded (or even deleting the ITD if the add-on no longer exists). The point is all of this happens automatically and naturally, without you needing to worry about following special rules and constraints about when Roo must run or how you must change files etc.</p>
<h2>Customizing What Roo Generates</h2><p>All @Roo* annotations allow you to control the member name being used, and also provide the member yourself. Let&rsquo;s edit the World.java file and change the @RooToString annotation to:</p>
<pre><code class="prettyprint java"><br />@RooToString(toStringMethod=&quot;rooIsFun&quot;)
</code></pre><p>If you now have a look in the World_Roo_ToString.aj file, you&rsquo;ll see the method name has automatically changed:</p>
<pre><code class="prettyprint java"><br />package com.hello; 

privileged aspect World_Roo_ToString { 
    
    public String World.rooIsFun() {    
        StringBuilder sb = new StringBuilder();        
        sb.append(&quot;id: &quot;).append(getId()).append(&quot;, &quot;);        
        sb.append(&quot;version: &quot;).append(getVersion()).append(&quot;, &quot;);        
        sb.append(&quot;comment: &quot;).append(getComment()).append(&quot;, &quot;);        
        sb.append(&quot;name: &quot;).append(getName());        
        return sb.toString();        
    }    
    
} 
</code></pre><p>Let&rsquo;s say you don&rsquo;t like Roo&rsquo;s toString() method (which is now rooIsFun(), remember!). You have two ways of removing it. You can either delete or comment out the @RooToString annotation in the World.java file, or you can simply provide your own rooIsFun() method directly in World.java. Feel free to try both techniques. In both cases you&rsquo;ll see Roo automatically deletes the World_Roo_ToString.aj file, as it can see you don&rsquo;t need Roo to provide the method for you anymore. This reflects Roo&rsquo;s approach: you are always in total control and there aren&rsquo;t any surprises.</p>
<h2>Metadata Model</h2><p>While you certainly don&rsquo;t need to understand Roo&rsquo;s internals to simply use Roo, curious readers might be wondering how the World_Roo_ToString.aj file even knew there were getId(), getVersion(), getComment() and getName() methods available. This is particularly interesting given these methods aren&rsquo;t even in the World.java file. Let&rsquo;s explore this a little more.</p><p>In the Roo shell, enter the following command:</p>
<pre><code class="prettyprint code">roo&gt; metadata for type --type com.hello.World
</code></pre><p>The resultant screen should look similar to:</p><p><center><img src="http://blog.springsource.com/wp-content/uploads/2009/10/metadata.png" alt="metadata" title="metadata" width="825" height="596" class="aligncenter size-full wp-image-2875" /></center><br /></p><p>What this is summarizing is Roo&rsquo;s internal representation of the World.java type. This is built from an AST parse and bind of the World.java file. You may have noticed there are downstream dependencies listed. These represent other metadata items that wish to be notified should the World.java metadata ever change. Add-ons will generally listen for changes to other metadata items and then modify ITDs (or XML files or JSPs etc) accordingly.</p><p>You can watch the metadata event notifications take place by typing &ldquo;metadata trace 1&rdquo; and then changing the World.java file. The notification messages will appear similar to the following:</p><p><center><img src="http://blog.springsource.com/wp-content/uploads/2009/10/tracing.png" alt="tracing" title="tracing" width="826" height="495" class="aligncenter size-full wp-image-2876" /></center><br /></p><p>Before concluding this introduction to Roo&rsquo;s metadata model, I will note that Roo does not require metadata to be retained in memory. This ensures very large projects can still use Roo without running out of memory. Roo automatically tracks cache statistics and also the runtime profile of individual add-ons. Those systems with sufficient memory will enjoy an automatic <a href="https://en.wikipedia.org/wiki/Cache_algorithms#Least_Recently_Used">LRU</a> cache. If you&rsquo;re curious about the LRU cache statistics, these are available via the &ldquo;metadata status&rdquo; command (note the cache hit ratio is pleasingly high):</p>
<pre><code class="prettyprint code">roo&gt; metadata status 
2: org.springframework.roo.addon.configurable.ConfigurableMetadata
5: org.springframework.roo.addon.javabean.JavaBeanMetadata
8: org.springframework.roo.addon.finder.FinderMetadata
35: org.springframework.roo.addon.plural.PluralMetadata
53: org.springframework.roo.addon.beaninfo.BeanInfoMetadata
64: org.springframework.roo.addon.entity.EntityMetadata
124: org.springframework.roo.addon.tostring.ToStringMetadata
862: org.springframework.roo.process.manager.internal.DefaultFileManager
[<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3f7b5a595e4a534b725a4b5e5b5e4b5e6c5a4d49565c5a7f090f0c0f5906">[email&#160;protected]</a> providers = 14, validGets = 369, cachePuts = 17, cacheHits = 352, cacheMisses = 17, cacheEvictions = 0, cacheCurrentSize = 6, cacheMaximumSize = 1000]
</code></pre>
<h2>Conclusion</h2><p>I hope that you have found this discussion of how Roo works interesting. We&rsquo;ve seen that Roo uses ITDs to achieve sustainable productivity gains for Java developers. We&rsquo;ve looked at the benefits of Roo&rsquo;s ITD approach and seen how it actually works in depth, including how they are customized, how they operate at a metadata level and how their lifecycle is transparently and automatically linked to add-on upgrades. We&rsquo;ve also discussed how ITDs deliver mature and proven separation of concerns while concurrently avoiding lock-in, runtime implications and other subtle issues that are important in large, real-world projects. Finally, we reviewed Roo&rsquo;s metadata system and explored some of its event notifications, type introspection and scalability features.</p><p>We look forward to supporting the community in becoming involved in Roo and developing new add-ons. We invite you to <a href="http://www.springsource.com/download/community?project=Spring%20Roo">try out Roo</a> and we very much welcome your <a href="http://forum.springsource.org/forumdisplay.php?f=67">feedback</a>, <a href="http://jira.springsource.org/browse/ROO">bug reports</a>, <a href="http://jira.springsource.org/browse/ROO">feature ideas</a> and <a href="https://search.twitter.com/search?q=%23roo">comments</a>. I hope that you enjoy using <a href="http://www.springsource.org/roo">Roo</a>.</p></div>
</div>
<section id="disqus_thread"></section>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 245;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>