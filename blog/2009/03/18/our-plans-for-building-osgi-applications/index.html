<html dir="ltr" data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>我们构建OSGi应用程序的计划</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>System.config({baseURL: "/b92013b"});</script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>System.import('app/main.js')</script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Our plans for building OSGi applications">
<meta name="twitter:description" content="<p>In the recent days and weeks, we’ve seen an increasing amount of interest in the future of build solutions for applications made up of OSGi bundles. Due to our heavy involvement with OSGi, this is something that is near and dear to our hearts and we’ve spent a long time looking at customer requirements and solutions for those requirements. In this blog entry, I will outline the requirements that we have identified and present the solutions that we see to these requirements.</p>
<p>I’m very interested in hearing from anyone who has extra requirements, thinks the requirements we have are bogus or has better ideas for solutions.</p>
">

<meta property="og:title" content="Our plans for building OSGi applications">
<meta property="og:description" content="<p>In the recent days and weeks, we’ve seen an increasing amount of interest in the future of build solutions for applications made up of OSGi bundles. Due to our heavy involvement with OSGi, this is something that is near and dear to our hearts and we’ve spent a long time looking at customer requirements and solutions for those requirements. In this blog entry, I will outline the requirements that we have identified and present the solutions that we see to these requirements.</p>
<p>I’m very interested in hearing from anyone who has extra requirements, thinks the requirements we have are bogus or has better ideas for solutions.</p>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2009-03-18 16:59:00.0">
</head>
<body dir="ltr">

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">// Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }</script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">我们构建OSGi应用程序的计划</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="null?s=20&d=mm"> <span class="author">罗伯·哈罗普</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2009-03-18 16:59:00.0">2009年3月18日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2009/03/18/our-plans-for-building-osgi-applications#disqus_thread" data-disqus-identifier="213">
</a></div>
</div>
</header>
<div class="blog--post"><p>在最近几天和几周内，我们看到了对由OSGi捆绑软件组成的应用程序的构建解决方案的未来越来越感兴趣。由于我们与OSGi的密切合作，这是我们心中近乎而宝贵的事情，并且我们花了很长时间研究客户需求和满足这些需求的解决方案。在此博客文章中，我将概述我们已经确定的需求，并介绍针对这些需求的解决方案。</p><p>我非常想听听有其他要求的人，认为我们的要求是虚假的或有更好的解决方案的想法。</p>
<h2>OSGi Build的要求</h2>
<h4>不重复依赖元数据</h4><p>当前OSGi构建的一个真正问题是依赖元数据可以在许多地方重复。对于dm Server，我们具有ivy.xml，.classpath和MANIFEST.MF文件中描述的依赖项。对于OSGi构建的任何长期解决方案，仅需要一个位置即可存储依赖元数据。</p>
<h4>使用现有的构建解决方案</h4><p>考虑到OSGi应用程序的独特性，很容易尝试从头开始构建系统。我们花了一段时间来接受这个想法，但是很明显，这在技术上不可行，也不是我们用户的最佳解决方案。</p><p>我们的用户非常喜欢他们选择的构建解决方案，并且让他们迁移似乎并不实用。相反，用户想要一种可以很好地插入其Maven或Ant构建中的解决方案。</p>
<h4>自动生成清单文件</h4><p>迁移到OSGi的最简单方法可能是开始从可用于应用程序模块的关联元数据自动生成清单文件。理想情况下，这种方法将导致对应用程序代码或开发人员使用该代码的方式的更改最少。</p>
<h4>从OSGi清单派生构建依赖项</h4><p>尽管清单生成是一种有效的方法，但是许多用户有兴趣将其OSGi清单视为相关性元数据的规范描述。这些用户希望从清单中编写的元数据中驱动构建。为了支持轻松的清单创建，许多用户希望看到对清单模板的支持。清单模板允许自动生成样板清单内容，同时使用户可以完全控制重要信息，例如版本。</p><p>此方法将清单用作IDE和脱机构建中的中央依赖项描述符。开发人员可以手动或在工具的帮助下编写OSGi清单，并且清单清单由构建工具使用，类似于Maven使用pom.xml和Ivy使用ivy.xml的方式。</p><p>通过使用OSGi元数据进行解析，可以在构建过程中应用整套OSGi解析规则。这将使构建时依赖项分辨率与运行时将发生的分辨率更准确地匹配。</p><p>这种方法的潜在缺点是，开发人员将需要在清单中指定测试依赖项。Maven和Ivy都具有标记依赖关系的方法，仅在测试环境中使用，并且在使用清单进行依赖关系解析时需要类似的解决方案。</p>
<h2>情境</h2><p>从这些要求中，我们得出了四个主要方案。有趣的是，这些场景中的每一个都由我经常与dm Server进行交互的一个或多个用户代表。</p>
<h4>1。Maven和Eclipse-pom.xml驱动</h4><p>伴随着下一个场景，这是我们遇到的最频繁的场景，也是我们目前花费最多时间进行工作的场景。使用这种方法，开发人员可以像执行任何普通的Maven / Eclipse项目一样执行开发任务。</p><p>OSGi清单文件由Maven和Eclipse的插件生成。开发人员可以选择让Eclipse插件重新生成清单，作为增量构建或按需构建的一部分。</p><p>可以在Java代码（源/字节码）中找到生成OSGi清单所需的大多数元数据。但是，不可能从字节码中得出相关性的合理版本号。在这种情况下，可以从pom.xml文件或可自定义的清单模板中提取版本。</p><p>清单模板可以承载的信息不仅限于版本号，还允许开发人员添加OSGi属性和指令以及任何自定义标头。</p>
<h4>2。Ant，Ivy和Eclipse-ivy.xml驱动</h4><p>该方法类似于Maven Pom驱动的方法，除了依赖项元数据将从ivy.xml文件而不是pom.xml文件中提取。</p><p>开发人员将有权访问Ant任务以在构建的适当阶段执行清单生成。</p><p>这种方法的最大缺点是在Eclipse中缺乏引人注目的Ivy集成。对于Ivy 2，可悲的是缺少Eclipse插件支持。我们正在考虑的一种方法是根据生成的清单创建Eclipse类路径。我们已经支持此工具，并将在接下来的两种情况下进行扩展。开发人员将编写ivy.xml文件，使用Eclipse插件生成清单，并自动更新Eclipse类路径。</p>
<h4>3。Maven和Eclipse-MANIFEST.MF驱动</h4><p>在这种方法中，OSGi清单文件是项目依赖元数据的确定声明。开发人员可以选择手动编写整个清单，但是很可能他们将编写清单模板，然后让我们的插件完成其余工作。</p><p>dm Server工具已经带有由清单驱动的Eclipse类路径容器，并且将对其进行扩展以支持准确的传递依赖项解析。</p><p>为了在这种环境下支持测试，插件将允许编写MANIFEST.MF和TEST.MF文件，其中TEST.MF描述仅适用于测试的依赖关系，而MANIFEST.MF描述仅适用于测试和生产的依赖关系。</p><p>该场景剩下的最后一部分是如何插入Maven。我们目前正在研究两种方法：用Maven依赖解析器替换/集成或生成pom.xml文件。我很想听听您的意见，认为您认为哪种方法最有价值，对您最有利。</p>
<h4>4。Ant，Ivy和Eclipse-MANIFEST.MF驱动</h4><p>这种方法与以清单驱动的方式使用Maven非常相似。与方案2不同，该方案不会缺少适当的Ivy / Eclipse集成，因为我们将使用与方案3相同的清单驱动的Eclipse类路径容器。</p>
<h2>OSGi构建工具</h2><p>为了满足概述的要求，我们正在构建一套与Maven，Ant和Ivy一起使用的工具，以提供用于构建OSGi应用程序的集成解决方案。</p>
<h4>邦德勒</h4><p>Bundlor是我们内部使用了一段时间的工具，用于生成OSGi清单。我们主要使用它来创建您在<a href="http://www.springsource.com/repository">企业捆绑软件存储库中</a>看到的所有<a href="http://www.springsource.com/repository">捆绑软件</a> 。Bundlor可用于为所创建的遗留库生成清单，而这些遗留库无需过多考虑OSGi。Bundlor也可用于为要在考虑OSGi的情况下特定创建的捆绑包生成清单。Bundlor删除了创建高质量捆绑件清单所涉及的大部分驴工作。</p><p>Bundlor支持清单模板的概念，该模板允许您自定义生成的清单。使用该模板，您可以为包导入和导出添加版本和属性，从包中排除包，在无法自动检测的情况下添加导入，还可以添加额外的清单头。下面的代码段显示了我们的示例应用程序之一的清单。</p>
<pre><code class="prettyprint code">Manifest-Version: 1.0
Bundle-ManifestVersion: 2
Bundle-Name: GreenPages Service
Bundle-SymbolicName: greenpages
Bundle-Vendor: SpringSource Inc.
Bundle-Version: 1.0
Import-Template: org.springframework.*;version="[2.5.6.A,3.0)"
Excluded-Exports: greenpages.internal
</code></pre><p>在此示例中， <span style="font-family:monospace">Excluded-Exports</span>标头用于防止<span style="font-family:monospace">greenpages.internal</span>被暴露。<span style="font-family:monospace">Import-Template</span>标头用于为所有与<span style="font-family:monospace">org.springframework。*</span>模式匹配的软件包名称设置版本。扫描项目代码以确定可能的导入和导出的集合。然后，使用模板文件来控制该集合中的哪些导入/导出实际上将其放入清单以及它们具有的版本。重要的是，生成过程将为您正确生成<a href="http://blog.springsource.com/2008/10/20/understanding-the-osgi-uses-directive/">使用元数据</a> ，从而删除最繁琐的工作之一。</p><p>Bundlor实际上将支持创建两个清单文件：MANIFEST.MF和TEST.MF。 TEST.MF文件将用于描述仅在测试期间需要的依赖项。对于想要使用清单驱动的构建但又不想用测试依赖项污染生产清单的开发人员而言，这一点很重要。</p><p>在接下来的几周内，我们将发布Bundlor的第一个公开里程碑。在此发行版中，您将能够从Ant和Maven中为项目生成清单，还可以使用清单模板自定义那些清单。在此之后的下几个里程碑中，我们将添加对自动检测pom.xml和ivy.xml文件中依赖项版本的支持。</p><p>我们将及时将大多数示例从手写清单转换为Bundlor 1.0最终版使用Bundlor和清单模板。此外，我们还将dm Server也移至Bundlor，并丢弃了所有手写清单。</p>
<h4>BundlorEclipse</h4><p>BundlorEclipse是一个Eclipse插件，可直接在Eclipse IDE中使用Bundlor功能。使用此插件，您可以在常规Eclipse构建生命周期中执行完全增量的清单生成。如果像我一样，使用“保存”按钮有点过于自由和轻松，则可以将BundlorEclipse配置为仅按需生成清单。</p><p>将其与即将推出的dm Server容器内测试框架结合使用时，您将能够在Eclipse内部启动完整的dm Server测试环境，其中包含所有捆绑包的清单文件。</p>
<h4>离线依赖项解析器</h4><p>对于如何解决模块之间的依赖关系以及如何验证这些依赖关系并将其转变为一致的类空间，OSGi有其自己的规则。在OSGi之外，构建工具在平坦的类路径上工作，该路径列出了JAR和目录以搜索类。</p><p>为了支持清单驱动的构建，我们将创建一个脱机依赖解析器，该解析器在不启动Equinox或dm Server的情况下执行OSGi解析。我们将把它与一个将在OSGi分辨率图上展平的工具配对为一个简单的类路径，以进行编译和测试。用户可以完全配置该扁平化过程，这些用户将能够提供策略信息来控制如何将OSGi图形中的多个版本映射到类路径中的单个版本。</p>
<h4>清单类路径容器</h4><p>使用依赖解析器，我们将能够改进清单类路径容器，以为每个Eclipse项目创建完整的可传递类路径。</p>
<h4>Maven / Ivy依赖解析器/pom.xml/ivy.xml生成器</h4><p>依赖解析器还将构成依赖解析器/pom.xml/ivy.xml生成器工具的核心部分。这里的关键观察是，作为开发人员，您应该期望在Eclipse和构建工具中获得一致的结果。</p>
<h2>为什么选择邦德而不是邦德？</h2><p>如您所知，OSGi技术总监Peter Kriens提供了一个名为bnd的工具，该工具的作用与Bundlor类似。我们最初的立场是将bnd用于我们自己的项目，并将其用作工具的一部分。实际上，早在Bundlor出现之前，Spring Dynamic Modules就使用bnd来创建其捆绑包。那么，为什么我们决定创建Bundlor？</p><p>创建Bundlor的主要原因是我们必须支持bnd中不存在的一些其他功能，例如：</p>
<ul>
<li>基于JDT的源代码扫描</li>
<li>部分代码处理</li>
<li>增量清单创建</li>
</ul><p>这些功能用于支持BundlorEclipse。我们使用基于JDT的扫描代替Eclipse中的字节码扫描，以改善用户体验并更好地集成到Eclipse构建生命周期中。Eclipse可以很好地处理部分正确的代码，我们希望Bundlor能够以几乎相同的方式支持部分代码。</p><p>在BundlorEclipse中，可以将Bundlor配置为每次在IDE中保存更改时运行。为了提高性能，我们支持增量清单生成。对代码进行更改时，Bundlor可以跟踪对清单文件进行哪些更改，而不必重新创建所有清单。</p>
<h2>使用除Eclipse之外的其他IDE</h2><p>我们知道，尽管Eclipse是Java开发人员的主要IDE，但是仍然有大量运行IntelliJ和NetBeans等IDE的开发人员。</p><p>虽然我们不会自己承诺为这些IDE构建任何插件，但我们将使所描述的所有工具都可以作为开源使用，从而使其他人可以为自己喜欢的IDE创建插件。</p><p>我们构建工具的方法是尝试在通用库中尽可能多地封装功能。我们致力于与NetBeans和IntelliJ团队合作，以帮助他们将我们的工具库集成到其IDE中。</p><p>理想的最终结果是，无论使用哪种IDE，您都仍然可以访问相同的基础OSGi工具。</p>
<h2>进一步要求</h2><p>OSGi构建的需求不仅限于我概述的4种情况。还有许多功能和增强功能可以改善使用OSGi应用程序的开发人员的体验。</p>
<h4>散装束生成</h4><p>许多商店将积压大量不是OSGi捆绑包的JAR工件。我们计划扩展Bundlor以支持批量捆绑包生成。在这种模式下，您可以通过将Bundlor指向JAR目录，并让Bundlor为所有捆绑包创建捆绑包来节省时间。除此之外，Bundlor将能够使用这些工件之间的关系来确定依赖项的版本范围。这将减少您必须编写的模板代码量，同时仍会产生高质量的捆绑软件。</p>
<h4>存储库驱动的代码完成</h4><p>使用清单驱动的构建来构建dm Server应用程序时，必须手动编写初始清单导入。借助对存储库驱动的代码完成的支持，您将能够针对将生成Java导入和清单导入的dm Server存储库获得Eclipse代码完成。使用此功能，您将能够根据需要建立清单依赖关系，而不必切换到清单文件。</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">var disqus_shortname = 'spring-io';
      var disqus_identifier = 213;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));</script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });</script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>