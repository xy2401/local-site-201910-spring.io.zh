<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Bundlor Version Expansion and Property Substitution</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Bundlor Version Expansion and Property Substitution" />
<meta name="twitter:description" content="&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Recently the M3 milestone of Bundlor has been released (&lt;a href=&quot;http://forum.springsource.org/showthread.php?t=70950&quot;&gt;Forum Anouncement&lt;/a&gt;). This milestone adds support for Property Substitution and Version Expansion. This blog post explains how to work with these new features to improve the quality of generated Manifests.&lt;/p&gt;
&lt;h2&gt;Property Substitution&lt;/h2&gt;
&lt;p&gt;Bundlor can now be used to substitute any property value into your Manifest Template.&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;&lt;br&gt;Bundle-Name: ${name}&lt;br&gt;Bundle-Description: Test bundle using new version of Kernel at ${com.springsource.kernel}&lt;br&gt;Import-Template: com.springsource.kernel.*;version=“${com.springsource.kernel}”&lt;br&gt;&lt;/pre&gt;
" />
<meta name="twitter:creator" content="@cgfrost" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/30994352b9a990d525f9aed9718b012a?s=200" />

<meta property="og:title" content="Bundlor Version Expansion and Property Substitution" />
<meta property="og:image" content="https://gravatar.com/avatar/30994352b9a990d525f9aed9718b012a?s=200" />
<meta property="og:description" content="&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Recently the M3 milestone of Bundlor has been released (&lt;a href=&quot;http://forum.springsource.org/showthread.php?t=70950&quot;&gt;Forum Anouncement&lt;/a&gt;). This milestone adds support for Property Substitution and Version Expansion. This blog post explains how to work with these new features to improve the quality of generated Manifests.&lt;/p&gt;
&lt;h2&gt;Property Substitution&lt;/h2&gt;
&lt;p&gt;Bundlor can now be used to substitute any property value into your Manifest Template.&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;&lt;br&gt;Bundle-Name: ${name}&lt;br&gt;Bundle-Description: Test bundle using new version of Kernel at ${com.springsource.kernel}&lt;br&gt;Import-Template: com.springsource.kernel.*;version=“${com.springsource.kernel}”&lt;br&gt;&lt;/pre&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2009-05-12 14:58:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Bundlor Version Expansion and Property Substitution</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/30994352b9a990d525f9aed9718b012a?s=20&amp;d=mm" />
<span class="author">Christopher Frost</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2009-05-12 14:58:00.0">May 12, 2009</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="232" href="/blog/2009/05/12/bundlor-version-expansion-and-property-substitution#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><h2>Introduction</h2><p>Recently the M3 milestone of Bundlor has been released (<a href="http://forum.springsource.org/showthread.php?t=70950">Forum Anouncement</a>). This milestone adds support for Property Substitution and Version Expansion. This blog post explains how to work with these new features to improve the quality of generated Manifests.</p>
<h2>Property Substitution</h2><p>Bundlor can now be used to substitute any property value into your Manifest Template.<br /><pre><br />Bundle-Name: ${name}<br />Bundle-Description: Test bundle using new version of Kernel at ${com.springsource.kernel}<br />Import-Template: com.springsource.kernel.*;version=&ldquo;${com.springsource.kernel}&rdquo;<br /></pre></p><p>This syntax allows you to specify property placeholders for <code>${name}</code> and <code>${com.springsource.kernel}</code> and have them substituted at runtime with actual values. The way that these values are passed in is specific to which Bundlor front end is being used.</p>
<h3>Specifying Properties at the Command Line</h3><p>When Bundlor is run from the command line it will use all the properties available as system properties, this does not include any environment variables. The command line script will pass through any variables passed in via <code>-D</code> so the following will provide the <code>${com.springsource.kernel}</code> property with a value of &lsquo;2.0.0.RELEASE&rsquo; and the <code>${name}</code> property with a value of &lsquo;Kernel test bundle&rsquo;.</p>
<pre>bundlor.sh \
        transform \
        --bundle ./org.springframework.integration.jar \
        --manifest ./template.mf \
        --outputfile ./target/org.springframework.integration.jar \
        -Dcom.springsource.kernel=2.0.0.RELEASE \
        -Dname="Kernel test bundle"
</pre>
<h3>Specifying Properties with Maven</h3><p>To pass properties in to Bundlor from a Maven build you should define a new (or add to an existing) properties element under the project element in the Maven project file.</p>
<pre>&lt;properties&gt;
    &lt;name&gt;${project.name}&lt;/name&gt;
    &lt;com.springsource.kernel&gt;2.0.0.RELEASE&lt;/com.springsource.kernel&gt;
&lt;/properties&gt;
</pre><p>This would run Bundlor with a substitution value for <code>${com.springsource.kernel}</code> of &lsquo;2.0.0.RELEASE&rsquo; and a substitution value for <code>${name}</code> of the name of the Maven project.</p>
<h3>Specifying Properties with Ant</h3><p>When calling the Bundlor task from Ant an extra property can be provided on the task that passes in an Ant Property Set which will be passed on to Bundlor.</p>
<pre>&lt;bundlor:bundlor&gt;
    bundlePath="${basedir}/org.springframework.integration.jar"
    outputPath="${basedir}/target/org.springframework.integration.jar"
    bundleVersion="2.0.0.BUILD-${timestamp}"
    manifestTemplatePath="${basedir}/template.mf">
    &lt;propertyset&gt;
        &lt;property name="name" value="${ant.project.name}"/&gt;
        &lt;property name="com.springsource.kernel" value="2.0.0.RELEASE"/&gt;
    &lt;/propertyset&gt;
&lt;/bundlor:bundlor&gt;
</pre><p>This would run Bundlor and provide a substitution value for <code>${com.springsource.kernel}</code> of &lsquo;2.0.0.RELEASE&rsquo; and a substitution value for <code>${name}</code> of the name of the Ant project.</p>
<h2>Version Expansion</h2><p>Property substitution can take place anywhere in the values of a Manifest Template. It can even be used to substitute &lsquo;Import-Template&rsquo; versions. On their own, a single version in an import isn&rsquo;t very useful as it is rather restrictive, but automatically expanding a version into a version range is useful. A version expansion pattern can be given after a colon that will be applied to the version to generate a version range.</p>
<pre>Import-Template: com.springsource.kernel.*;version="${com.springsource.kernel:[=.=.=.=, +1.0.0)}",
 org.apache.commons.logging.*;version="${org.apache.commons.logging:[=.=.=.=, =.=.+1)}"
</pre><p>Version expansion works on a variable that holds a legal OSGi version number. Based on that version number, the expansion breaks into 4 parts, the major, minor, micro, and qualifier. If the supplied property is not a valid OSGi version then Bundlor will fail with an exception stating that the supplied property was not a valid version string.</p>
<table cellspacing="5">
<tr><td colspan="2">The first three segments of this version number can be substituted in the expansion as follows:</td></tr>
<tr><td>=</td><td>Equal to the value from the variable</td></tr>
<tr><td>[+/-]n</td><td>Adjust the value from the variable by this amount</td></tr>
<tr><td>n</td><td>Substitute this value for the one in the variable. This will typically only be used for putting in a 0</td></tr>
<tr><td colspan="2">The fourth segment (qualifier) can only take the following substitutions:</td></tr>
<tr><td>=</td><td>Equal to the value from the variable</td></tr>
<tr><td>Any legal qualifier value.</td><td>Substitute this value for the one in the variable</td></tr>
</table><p><br />So for the example above, the generated version range for <code>${com.springsource.kernel}</code> and a given version of 1.2.0 would be [1.2.0, 2.0.0). This means the highest version available from 1.2.0 to (but not including) 2.0.0 will be used. For <code>${org.apache.commons.logging}</code> and a given version of 1.4.0 the generated version range would be [1.4.0, 1.4.1), this is a lot more restrictive as it will only let changes to the qualifier of version 1.4.0 and will not let versions from 1.4.1.xxx and upwards be used.</p>
<h3>Naming</h3><p>If a pattern is going to be used for several imports then it can be specified with a name and used many times. A new header is used in the Template Manifest to specify the named version expansion patterns.</p>
<pre>Import-Template: 
 org.apache.commons.codec.*;version="${org.apache.commons.codec:apache}",
 org.apache.commons.logging.*;version="${org.apache.commons.logging:apache}",
 org.hibernate.*;version="${org.hibernate:hibernate}"
 org.myorg.*;version="${org.myorg:(=.=.=.=, =.+1.0.=]}"

Version-Patterns: 
 apache;pattern="[=.=.=.=, +1.0.0)",
 hibernate;pattern="[=.=.=.=, =.=.+1)"
</pre><p>This shows multiple patterns being defined and being used for multiple imports. The apache pattern will give a version range from the one provided up to but not including the next major version. The hibernate pattern will give a version range of the one provided up to but not including the next micro version. There is also an import defined with an in-line version expansion pattern which can be used along with named patterns just fine in the same template. The in-line pattern shows a more unusual usage. It will create a version range from, but not including, the provided version up to and including the next minor version with the same qualifier.</p>
<h2>Conclusion</h2><p>Using these techniques together, the generation of reliable manifests is possible. Proper use of Version Expansion will ensure that the generated manifests are restrictive enough to stop unwanted wiring but flexible enough to allow minor changes through. When writing the Template Manifest a pragmatic approach should be taken for each bundle concerned as not all bundles are versioned with the same approach.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 232;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>