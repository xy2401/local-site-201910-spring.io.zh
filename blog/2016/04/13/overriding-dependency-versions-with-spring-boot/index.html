<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>使用Spring Boot覆盖依赖版本</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Overriding Dependency Versions with Spring Boot">
<meta name="twitter:description" >
<meta name="twitter:creator" content="@david_syer">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=200">

<meta property="og:title" content="Overriding Dependency Versions with Spring Boot">
<meta property="og:image" content="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=200">
<meta property="og:description" >
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2016-04-13 09:42:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">使用Spring Boot覆盖依赖版本</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=20&d=mm"> <a class="author" rel="author" href="/team/dsyer">戴夫·瑟</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2016-04-13 09:42:00.0">2016年4月13日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2016/04/13/overriding-dependency-versions-with-spring-boot#disqus_thread" data-disqus-identifier="2467">
</a></div>
</div>
</header>
<div class="blog--post"><p>本文介绍了一些依赖管理技巧<br>可用于创建依赖于较新版本的库和应用<br>传递性依赖关系比平台之类的依赖关系<br><a href="https://projects.spring.io/spring-boot">Spring Boot</a>或<br><a href="https://platform.spring.io/platform/">Spring IO Platform</a> 。的<br>以下示例以<a href="https://projectreactor.io">Reactor</a>为例<br>之类的依赖项，因为它即将发布主要版本（2.5.0）<br>但是现有的依赖项管理平台（Spring Boot 1.3.xq）<br>声明对较旧版本（2.0.7）的依赖。如果你想写<br>一个通过可传递程序依赖于新版本Reactor的应用<br>对图书馆的依赖，这就是您将要面对的情况<br>用。</p>
<p>这样做是很合理的，但应该这样做<br>请谨慎，因为较新版本的传递依赖项可以<br>轻松打破依赖于Spring较早版本的功能<br>开机当您执行此操作并应用以下修复程序之一时，您就是<br>与Spring Boot的依赖管理脱离<br>说“嘿，我知道我在做什么，请相信我。”不幸，<br>有时您需要这样做以利用新功能<br>第三方库中的功能。如果您不需要新版本<br>（或其他任何外部传递依赖项）<br>需要），那么不要这样做，只是坚持快乐的道路，让Spring<br>引导管理依赖项。</p>
<p>与本文中的玩具代码平行的现实生活是<br>库显式更改了某些内容的版本<br>列于<code>spring-boot-dependencies</code> 。其他基于Boot的项目，<br>例如Spring Cloud的各个部分，定义自己的部分<code>*-dependencies</code><br>您可以用来管理外部依赖关系的物料清单<br>部分这些不需要新版本的传递依赖项<br>与Spring Boot的冲突。如果他们这样做了，这就是他们会做的<br>必须声明它们，这就是您可以选择加入它们的方式<br>版本的依赖性管理。提示此的示例<br>文章原为<br><a href="https://github.com/spring-cloud/spring-cloud-cloudfoundry-deployer"><code>spring-cloud-cloudfoundry-deployer</code></a><br>它需要通过对新版本的传递依赖来实现Reactor 2.5<br><a href="https://github.com/cloudfoundry/cf-java-client">Cloud Foundry Java客户端</a> 。它的<br>父母有（或应该有）一个<code>*-dependencies</code>可以使用的物料清单<br>在下面列出的修复程序中需要的任何地方。</p>
<blockquote>
<p>注意：以下所有代码示例均在<br><a href="https://github.com/dsyer/dependency-hell">github仓库</a>您<br>应该<code>mvn install</code>在顶层进行所有设置。的<br>Maven项目都是作为反应堆构建而布置的，但这仅仅是<br>为了方便。原则上所有项目都可以<br>独立构建和安装（如果它们的相对路径<br>父母是固定的）。</p>
</blockquote><h2><a href="#the-problem" class="anchor" name="the-problem"></a>问题</h2>
<p>我们有一个父pom，它具有Reactor的依赖项管理<br>（2.0.7）。它通过Maven属性来执行此操作，即在父pom中：</p>
<pre><code class="prettyprint xml">	&lt;properties&gt;
		&lt;reactor.version&gt;2.0.7.RELEASE&lt;/reactor.version&gt;
	&lt;/properties&gt;
	&lt;dependencyManagement&gt;
		&lt;dependencies&gt;
			&lt;dependency&gt;
				&lt;groupId&gt;io.projectreactor&lt;/groupId&gt;
				&lt;artifactId&gt;reactor-core&lt;/artifactId&gt;
				&lt;version&gt;${reactor.version}&lt;/version&gt;
			&lt;/dependency&gt;
		&lt;/dependencies&gt;
	&lt;/dependencyManagement&gt;
</code></pre>
<p>然后我们有一个与此父级的库，希望使用更新的库<br>版本的Reactor，因此执行以下操作：</p>
<pre><code class="prettyprint">	&lt;properties&gt;
		&lt;reactor.version&gt;2.5.0.BUILD-SNAPSHOT&lt;/reactor.version&gt;
	&lt;/properties&gt;
	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;io.projectreactor&lt;/groupId&gt;
			&lt;artifactId&gt;reactor-core&lt;/artifactId&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;
</code></pre>
<p>大家都开心。这是关于<br>工件：</p>
<pre><code class="prettyprint">parent (manages reactor:2.0.7)
\(child)- library
   \(depends on)- reactor:2.5.0
</code></pre>
<p>和实际的dependency：Maven（3.3）中的树：</p>
<pre><code class="prettyprint">[INFO] com.example:example-library:jar:0.0.1-SNAPSHOT
[INFO] \- io.projectreactor:reactor-core:jar:2.5.0.BUILD-SNAPSHOT:compile
[INFO]    \- org.reactivestreams:reactive-streams:jar:1.0.0:compile
</code></pre>
<p>然后，用户想要编写一个依赖于库的应用程序，并且<br>想重用父级，让我们说其他功能<br>没有包含在简单示例中。他做到了，发现了<br>（boo，hoo），Reactor版本搞砸了。的关系<br>该应用程序可以总结如下：</p>
<pre><code class="prettyprint">parent
\(child)- app
  \(depends on)- library
</code></pre>
<p>Maven（3.3）依赖性报告如下所示：</p>
<pre><code class="prettyprint">[INFO] com.example:example-app:jar:0.0.1-SNAPSHOT
[INFO] \- com.example:example-library:jar:0.0.1-SNAPSHOT:compile
[INFO]    \- io.projectreactor:reactor-core:jar:2.0.7.RELEASE:compile
[INFO]       +- org.reactivestreams:reactive-streams:jar:1.0.0:compile
[INFO]       \- org.slf4j:slf4j-api:jar:1.7.12:compile
</code></pre>
<p>（即它的Reactor版本错误）。这是因为父母<br>具有Reactor的依赖项管理，并且没有显式的<br>应用本身中的Reactor依赖关系或依赖关系管理。的<br>在这种情况下，父级始终会获胜，因此添加BOM并没有帮助<br>（至少使用Maven 3.3）和正确的Reactor版本-仅<br>显式版本的Reactor本身将对其进行修复。</p>
<p>该结构与生成的用户应用相同（少级）<br>从<a href="https://start.spring.io">initializr开始</a> ，并依赖于<br>使用Reactor 2.5.0的库。它具有所有相同的问题，并且<br>解决方法和修复程序的选项相同。</p><h2><a href="#workarounds-and-fixes" class="anchor" name="workarounds-and-fixes"></a>解决方法和修复</h2>
<p><strong>选项1：</strong>在应用中明确管理Reactor依赖项：</p>
<pre><code class="prettyprint">	&lt;dependencyManagement&gt;
		&lt;dependencies&gt;
			&lt;dependency&gt;
				&lt;groupId&gt;io.projectreactor&lt;/groupId&gt;
				&lt;artifactId&gt;reactor-core&lt;/artifactId&gt;
				&lt;version&gt;2.5.0.BUILD-SNAPSHOT&lt;/version&gt;
			&lt;/dependency&gt;
		&lt;/dependencies&gt;
	&lt;/dependencyManagement&gt;
</code></pre>
<p>这很丑陋，并且有很多行XML。请注意，这无助于<br>在Maven 3.3中使用包含此代码的BOM（但在<br>Maven 3.4，请参见下文）。</p>
<pre><code class="prettyprint">$ cd app-1
$ ../mvn dependency:tree
...
[INFO] com.example:example-app-1:jar:0.0.1-SNAPSHOT
[INFO] \- com.example:example-library:jar:0.0.1-SNAPSHOT:compile
[INFO]    \- io.projectreactor:reactor-core:jar:2.5.0.BUILD-SNAPSHOT:compile
[INFO]       \- org.reactivestreams:reactive-streams:jar:1.0.0:compile
...
</code></pre>
<blockquote>
<p>注意：可以使用相同数量的XML（或实际上少一些）<br>明确列出相同的依赖项<code><dependencies></code><br>POM部分。</p>
</blockquote>
<p><strong>选项2：</strong>通过，仅在应用中明确管理Reactor版本<br>属性：</p>
<pre><code class="prettyprint">	&lt;properties&gt;
		&lt;reactor.version&gt;2.5.0.BUILD-SNAPSHOT&lt;/reactor.version&gt;
	&lt;/properties&gt;
</code></pre>
<p>这似乎相当可口，并且遵循以下简单规则：如果您的<br>项目或您的依赖项之一需要覆盖版本<br>由父POM管理的传递依赖项，只需添加一个<br>该依赖项的version属性。为了使该规则起作用，父级<br>POM必须为其定义的所有依赖项定义版本属性<br>管理（ <code>spring-boot-starter-parent</code>做这个）。</p>
<pre><code class="prettyprint">$ cd app-2
$ ../mvnw dependency:tree
...
[INFO] com.example:example-app-2:jar:0.0.1-SNAPSHOT
[INFO] \- com.example:example-library:jar:0.0.1-SNAPSHOT:compile
[INFO]    \- io.projectreactor:reactor-core:jar:2.5.0.BUILD-SNAPSHOT:compile
[INFO]       \- org.reactivestreams:reactive-streams:jar:1.0.0:compile
...
</code></pre>
<p><strong>选项3：</strong>将BOM与新的Reactor版本和Maven 3.4一起使用。</p>
<p>即在应用程序中：</p>
<pre><code class="prettyprint">	&lt;dependencyManagement&gt;
		&lt;dependencies&gt;
			&lt;dependency&gt;
				&lt;groupId&gt;com.example&lt;/groupId&gt;
				&lt;artifactId&gt;example-bom&lt;/artifactId&gt;
				&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
				&lt;type&gt;pom&lt;/type&gt;
				&lt;scope&gt;import&lt;/scope&gt;
			&lt;/dependency&gt;
		&lt;/dependencies&gt;
	&lt;/dependencyManagement&gt;
</code></pre>
<p>Maven 3.4尚未发布，但您可以从中获取<br><a href="https://repository.apache.org/content/repositories/snapshots/org/apache/maven/apache-maven/3.4.0-SNAPSHOT/">回购</a><br>例如通过编辑<code>wrapper.properties</code>在应用程序中<br>项目。这个策略很好，因为它适合Maven依赖<br>管理模型很好，但仅适用于Maven版本<br>尚未发布。</p>
<pre><code class="prettyprint">$ cd app-3
$ ./mvnw dependency:tree # N.B. Maven 3.4
...
[INFO] com.example:example-app-3:jar:0.0.1-SNAPSHOT
[INFO] \- com.example:example-library:jar:0.0.1-SNAPSHOT:compile
[INFO]    \- io.projectreactor:reactor-core:jar:2.5.0.BUILD-SNAPSHOT:compile
[INFO]       \- org.reactivestreams:reactive-streams:jar:1.0.0:compile
...
</code></pre>
<blockquote>
<p>注意： <code>wrapper.properties</code>该项目已被设置为<br>在撰写本文时工作。您可能需要编辑版本<br>标签以使其与最新快照配合使用。</p>
</blockquote>
<p><strong>选项4：</strong>在新的Reactor中使用Gradle（而不是Maven）和BOM<br>版。没有父母，因为那是Maven的事情，并且<br>具有可用BOM的依赖关系管理可以使用<br>的<code>spring.io</code>插入。</p>
<pre><code class="prettyprint">$ cd app-4
$ ./gradlew dependencies
...
compile - Dependencies for source set &#39;main&#39;.
\--- com.example:example-library:0.0.1-SNAPSHOT
     \--- io.projectreactor:reactor-core:2.5.0.BUILD-SNAPSHOT
          \--- org.reactivestreams:reactive-streams:1.0.0
...
</code></pre>
<p><strong>选项5：</strong>不要使用该父母，而是采用<code>*-dependencies</code>模仿<br>Spring Cloud的用途。如果父母有一些插件和属性<br>您要重复使用的声明，将其复制到新的父项中，<br>并将其用作您的应用程序父POM。依赖<br>管理可以在独立的BOM中声明，然后可以使用<br>在里面<code><dependencyManagement></code>您的应用程序POM部分<br>如果先声明，它将优先于其他BOM<br>它明确声明的任何内容。</p>
<p>的<code>simple-parent</code>和<code>bom</code>示例代码中的示例<br>以这种方式拆分父母。然后<code>app-5</code>使用<br><code>simple-parent</code>作为父母， <code>bom</code>作为BOM。</p>
<pre><code class="prettyprint">$ cd app-5
$ ../mvnw dependency:tree
...
[INFO] com.example:example-app-5:jar:0.0.1-SNAPSHOT
[INFO] \- com.example:example-library:jar:0.0.1-SNAPSHOT:compile
[INFO]    \- io.projectreactor:reactor-core:jar:2.5.0.BUILD-SNAPSHOT:compile
[INFO]       \- org.reactivestreams:reactive-streams:jar:1.0.0:compile
...
</code></pre></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 2467;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>