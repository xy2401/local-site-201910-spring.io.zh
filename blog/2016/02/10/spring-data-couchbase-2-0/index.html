<html dir="ltr" data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>Spring Data Couchbase 2.0</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>System.config({baseURL: "/b92013b"});</script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>System.import('app/main.js')</script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Spring Data Couchbase 2.0">
<meta name="twitter:description" content="<blockquote> 
 <p>This is a cross-post blog from Simon BASLÃ‰ from <a href=" http:="" ="" www.couchbase.co="="></head><body dir="ltr">Couchbase. You can find him on twitter (<a href="https://twitter.com/simonbasle"><code>@simonbasle</code></a>) or <a href="">github</a>. Learn more about Couchbase and the Couchbase Java SDK on the <a href="http://developer.couchbase.com/documentation/server/4.1/sdks/java-2.2/java-intro.html">developer portal</a>. Thanks again, Simon and great job to you and your team! -Josh 

<p>Spring Data Couchbase 2.0 is a rewrite of the original Spring Data Couchbase 1.4.x connector. It is based on the Couchbase Java 2.2 SDK and makes heavy use of the new query language N1QL (which was introduced in Couchbase Server 4.0) to offer more features for Spring Data users.</p>
">
<meta name="twitter:creator" content="@starbuxman">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/fb22593caf24e4bb4c98d467cdd247e6?s=200">

<meta property="og:title" content="Spring Data Couchbase 2.0">
<meta property="og:image" content="https://gravatar.com/avatar/fb22593caf24e4bb4c98d467cdd247e6?s=200">
<meta property="og:description" content="<blockquote> 
 <p>This is a cross-post blog from Simon BASLÃ‰ from <a href=" http:="" ="" www.couchbase.co="=">Couchbase. You can find him on twitter (<a href="https://twitter.com/simonbasle"><code>@simonbasle</code></a>) or <a href="">github</a>. Learn more about Couchbase and the Couchbase Java SDK on the <a href="http://developer.couchbase.com/documentation/server/4.1/sdks/java-2.2/java-intro.html">developer portal</a>. Thanks again, Simon and great job to you and your team! -Josh 

<p>Spring Data Couchbase 2.0 is a rewrite of the original Spring Data Couchbase 1.4.x connector. It is based on the Couchbase Java 2.2 SDK and makes heavy use of the new query language N1QL (which was introduced in Couchbase Server 4.0) to offer more features for Spring Data users.</p>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2016-02-10 12:35:46.124">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">// Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }</script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">ä¸“æ¡ˆ</a>
</li>
<li class="navbar-link">
<a href="/guides">å¯¼æ¸¸</a>
</li>
<li class="navbar-link active">
<a href="/blog">åšå®¢</a>
</li>
<li class="navbar-link">
<a href="/services">åŸ¹è®­ä¸è®¤è¯</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="æœç´¢æ–‡æ¡£ï¼ŒæŒ‡å—å’Œå¸–å­..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="æœç´¢..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">å®¶<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">ä¸“æ¡ˆ<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">å¯¼æ¸¸<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">åšå®¢<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">åŸ¹è®­ä¸è®¤è¯<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>å·¥ç¨‹</div>
</div>
<div class="blog-category content--title">
<div>å‘å¸ƒ</div>
</div>
<div class="blog-category content--title">
<div>æ–°é—»ä¸æ´»åŠ¨</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Data Couchbase 2.0</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">å·¥ç¨‹</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/fb22593caf24e4bb4c98d467cdd247e6?s=20&d=mm"> <a class="author" rel="author" href="/team/jlong">ä¹”ä»€Â·æœ—ï¼ˆJosh Longï¼‰</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2016-02-10 12:35:46.124">2016å¹´2æœˆ10æ—¥</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2016/02/10/spring-data-couchbase-2-0#disqus_thread" data-disqus-identifier="2376">
</a></div>
</div>
</header>
<div class="blog--post"><blockquote>
<p>è¿™æ˜¯<a href="http://www.couchbase.com">Couchbaseçš„</a> SimonBASLÃ‰çš„è·¨å¸–å­åšå®¢ã€‚æ‚¨å¯ä»¥åœ¨twitterï¼ˆ <a href="https://twitter.com/simonbasle"><code>@simonbasle</code></a> ï¼‰æˆ–<a href="">github</a>ä¸Šæ‰¾åˆ°ä»–ã€‚åœ¨<a href="http://developer.couchbase.com/documentation/server/4.1/sdks/java-2.2/java-intro.html">å¼€å‘äººå‘˜é—¨æˆ·</a>ä¸Šäº†è§£æœ‰å…³Couchbaseå’ŒCouchbase Java SDKçš„æ›´å¤šä¿¡æ¯ã€‚å†æ¬¡æ„Ÿè°¢Simonï¼Œéå¸¸æ„Ÿè°¢æ‚¨å’Œæ‚¨çš„å›¢é˜Ÿï¼ -ä¹”ä»€</p>
</blockquote>
<p>Spring Data Couchbase 2.0æ˜¯å¯¹åŸå§‹Spring Data Couchbase 1.4.xè¿æ¥å™¨çš„é‡å†™ã€‚å®ƒåŸºäºCouchbase Java 2.2 SDKï¼Œå¹¶å¤§é‡ä½¿ç”¨äº†æ–°çš„æŸ¥è¯¢è¯­è¨€N1QLï¼ˆåœ¨Couchbase Server 4.0ä¸­å¼•å…¥ï¼‰ï¼Œä¸ºSpring Dataç”¨æˆ·æä¾›äº†æ›´å¤šåŠŸèƒ½ã€‚</p>
<p>ç¬¬<a href="http://blog.couchbase.com/2015/august/spring-data-couchbase-2.0-preview">ä¸€ä¸ªé‡Œç¨‹ç¢‘</a>å·²äºå»å¹´8æœˆå‘å¸ƒï¼Œç„¶åå‘å¸ƒäº†å€™é€‰ç‰ˆæœ¬ï¼Œæ­¤åå®æ–½äº†é™„åŠ åŠŸèƒ½ï¼ˆå’Œé”™è¯¯ä¿®æ­£ï¼‰ï¼Œç°åœ¨å¯ä»¥å‘å…¬ä¼—å‘å¸ƒGAç‰ˆæœ¬ã€‚</p>
<p>è®©æˆ‘ä»¬å¿«é€Ÿæµè§ˆä¸€ä¸‹å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ï¼ˆç”¨â­åˆ°â­â­â­ç¬¦å·è¡¨ç¤ºæˆ‘ä»¬è®¤ä¸ºæ¯ä¸ªåŠŸèƒ½çš„å‡ºè‰²ç¨‹åº¦å’Œé‡è¦æ€§ğŸ˜„ï¼‰ï¼š</p><h2><a href="#new-features-in-spring-data-couchbase-2-0" class="anchor" name="new-features-in-spring-data-couchbase-2-0"></a> Spring Data Couchbase 2.0çš„æ–°åŠŸèƒ½</h2>
<p>Spring Data Couchbaseçš„1.xç‰ˆæœ¬ä¸å…¶2.xç‰ˆæœ¬ä¹‹é—´çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼š</p>
<ul>
<li>é…ç½®å…ƒç´ æ›´æ¥è¿‘Couchbaseç°å®ï¼šç¯å¢ƒï¼Œç¾¤é›†ï¼Œå­˜å‚¨æ¡¶ï¼ˆå¯èƒ½å…è®¸æ‚¨åˆ›å»º<code>CouchbaseTemplate</code> ï¼Œæ¯ä¸ªéƒ½è¿æ¥åˆ°ä¸åŒçš„å­˜å‚¨æ¡¶ï¼Œç”šè‡³è¿æ¥åˆ°ä¸åŒçš„ç¾¤é›†ï¼ï¼‰</li>
<li>æ”¯æŒè‡ªå®šä¹‰å­˜å‚¨åº“æ–¹æ³•ä¸å†æ€»æ˜¯ä½¿ç”¨è§†å›¾æ¥å®Œæˆï¼Œï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ç°åœ¨é€šè¿‡N1QLå®Œæˆï¼Œè¿™æ›´åŠ çµæ´»å¹¶ä¸”éœ€è¦è¾ƒå°‘çš„æœåŠ¡å™¨ç«¯ç»´æŠ¤ã€‚</li>
<li>ä½¿ç”¨è§†å›¾çš„è‡ªå®šä¹‰æ–¹æ³•å·²è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œä»¥æ›´å¥½åœ°éµå¾ªSpring Dataå“²å­¦ã€‚è¿™ç¨å¾®é™ä½äº†çµæ´»æ€§ï¼Œä½†æ˜¯å®ç°æ˜¯ä»æ–¹æ³•åç§°ç”Ÿæˆçš„ï¼ˆé€šè¿‡â€œæŸ¥è¯¢æ´¾ç”Ÿâ€ï¼‰ã€‚</li>
<li>ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è§†å›¾å¯¹æ•°æ®è¿›è¡Œåœ°ç†ç©ºé—´æŸ¥è¯¢ï¼ˆå¦‚æœè¶…å‡º3ç»´ï¼Œåˆ™å¯ä»¥è¿›è¡Œå¤šç»´æŸ¥è¯¢ï¼‰ã€‚</li>
</ul>
<p>å½“ç„¶ï¼Œæ‚¨ä»ç„¶å¯ä»¥ä½¿ç”¨<code>CouchbaseTemplate</code>è€Œä¸æ˜¯<code>CouchbaseRepository</code>æ¥å£æ¥è®¿é—®è¾ƒä½çº§åˆ«çš„APIï¼Œç”šè‡³å¯ä»¥ä»SDKä¸­è®¿é—®åŸºç¡€<code>Bucket</code> ã€‚</p><h3><a href="#repository-methods-through-n1ql" class="anchor" name="repository-methods-through-n1ql"></a>é€šè¿‡N1QLçš„å­˜å‚¨åº“æ–¹æ³•</h3>
<p>â­â­â­</p>
<p>Couchbase 4.0ä¸­æœ€å¤§çš„æ–°åŠŸèƒ½æ˜¯<strong>N1QL</strong> ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯åœ¨JSONæ–‡æ¡£ä¸Šä½¿ç”¨çš„SQLæ‰©å±•ï¼ˆå› æ­¤å®ƒå‘SQLæ·»åŠ äº†ä¸JSONç›¸å…³çš„ç‰¹æ€§ï¼‰ã€‚</p>
<p>è¿™å¯¹äºSpring Dataä¸­çš„<code>Repository</code>æ¨¡å¼å’ŒæŸ¥è¯¢æ´¾ç”Ÿå°¤å…¶æœ‰ç”¨ï¼Œå› ä¸ºç»å¤§å¤šæ•°æŸ¥è¯¢æ´¾ç”Ÿå…³é”®å­—éƒ½å¯ä»¥è½»æ¾è½¬æ¢ä¸ºN1QLã€‚</p>
<p>N1QLç°åœ¨æ˜¯å­˜å‚¨åº“æ–¹æ³•çš„é»˜è®¤åå¤‡CouchbaseåŠŸèƒ½ã€‚å¦‚æœè¦åœ¨æ‰§è¡Œçš„æŸ¥è¯¢ä¸­æ˜¾å¼æ˜¾ç¤ºï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨@Queryæ¥å£ã€‚</p>
<pre><code class="prettyprint java">public interface UserRepository extends Repository<User, String> {

  User findByUsernameEquals(String username);

  List<User> findByUsernameContains(String contains);

  @Query //optional for N1QL query derivation but more explicit
  List<User> findByAgeBetween(int minAge, int maxAge);
}
</code></pre><h3><a href="#repository-methods-through-views" class="anchor" name="repository-methods-through-views"></a>é€šè¿‡è§†å›¾çš„å­˜å‚¨åº“æ–¹æ³•</h3>
<p>â­â­</p>
<p>æ­¤ç‰ˆæœ¬çš„ä¸€ä¸ªé‡å¤§å˜åŒ–æ˜¯ï¼Œç°åœ¨ï¼ŒåŸºäºè§†å›¾çš„å­˜å‚¨åº“æŸ¥è¯¢ï¼ˆåˆåè‡ªå®šä¹‰å­˜å‚¨åº“æ–¹æ³•ï¼‰æ›´ç¬¦åˆSpring Dataçš„å“²å­¦ã€‚è¿˜å¿…é¡»ä½¿ç”¨<code>@View(viewName="something")</code>æ˜¾å¼æ³¨é‡Šå®ƒä»¬ã€‚</p>
<p>è¿™æ„å‘³ç€Couchbaseç‰¹å®šçš„ä»»ä½•å†…å®¹éƒ½ä¸åº”æ³„æ¼åˆ°æ‚¨çš„å­˜å‚¨åº“ç•Œé¢ä¸­ã€‚ç›¸åï¼Œæ‚¨å¯ä»¥åšçš„æ˜¯å¯¹å¤§å¤šæ•°æŸ¥è¯¢ä½¿ç”¨æŸ¥è¯¢æ´¾ç”Ÿæœºåˆ¶ã€‚</p>
<p>æŸ¥è¯¢æ´¾ç”Ÿåœ¨å¾ˆå°çš„ç¨‹åº¦ä¸Šä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œåœ¨è§†å›¾æ”¯æŒçš„æ–¹æ³•ä¸­å¯ä»¥æ¥å—ä¸€äº›å…³é”®å­—ã€‚</p>
<pre><code class="prettyprint java">public interface UserRepository extends Repository<User, String> {

  @Override
  @View(designDocument = "user", viewName = "customFindAllView")
  Iterable<User> findAll();

  @View(viewName = "customFindByNameView")
  User findByUsernameIs(String lowKey);

  @View(viewName = "customFindByNameView")
  List<User> findByUsernameBetween(String lowKey, String highKey);
}
</code></pre><h3><a href="#using-reduce-function-from-views" class="anchor" name="using-reduce-function-from-views"></a>ä½¿ç”¨Viewçš„reduceå‡½æ•°</h3>
<p>â­</p>
<p>ä»¥å‰ä¸æ”¯æŒçš„å¦ä¸€é¡¹æ–°åŠŸèƒ½æ˜¯æ‰§è¡Œreduceå‡½æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚ç°åœ¨ï¼Œä¸ºäº†æ‰§è¡Œå®ƒï¼Œæ‚¨åªéœ€åœ¨<code>@View</code>annotationä¸­å°†<code>reduce</code>æ ‡å¿—è®¾ç½®ä¸ºtrueã€‚</p>
<p>å¦‚æœå¯¹æ‚¨æœ‰æ„ä¹‰ï¼Œæ‚¨ä¹Ÿå¯ä»¥åœ¨æ–¹æ³•çš„å‰é¢åŠ ä¸Šâ€œè®¡æ•°â€è€Œä¸æ˜¯â€œæŸ¥æ‰¾â€ï¼ˆå³æ‚¨å®é™…ä¸Šä½¿ç”¨äº†â€œè®¡æ•°â€å‡å°‘åŠŸèƒ½ï¼‰ã€‚</p>
<p>è¯·æ³¨æ„ï¼ŒCouchbaseä¸­çš„reduceå‡½æ•°å¯ä»¥æ˜¯é™¤é¢„å…ˆå­˜åœ¨çš„_countä¹‹å¤–çš„å…¶ä»–å‡½æ•°ï¼Œç”šè‡³å¯ä»¥è¿”å›é•¿äº<code>JsonObject</code> ï¼Œä¾‹å¦‚å†…ç½®<code>_stats</code> ã€‚</p>
<p>åŒæ ·ï¼Œåœ¨æ–¹æ³•åç§°ä¸­æ·»åŠ å˜ä½“â€œ topXâ€æˆ–â€œ firstXâ€å°†å¯¼è‡´åœ¨è¯·æ±‚ä¸Šè®¾ç½®å…¶ä»–é™åˆ¶ï¼ˆä¾‹å¦‚ï¼Œ <code>findFirst5ByLastName</code>å°†åˆ—è¡¨é™åˆ¶ä¸º5ä¸ªç»“æœï¼‰ã€‚</p><h3><a href="#configuring-consistency-read-your-own-writes" class="anchor" name="configuring-consistency-read-your-own-writes"></a>é…ç½®ä¸€è‡´æ€§ï¼Œè‡ªå·±æ’°å†™</h3>
<p>â­â­â­</p>
<p>ä½¿ç”¨å¼‚æ­¥å¡«å……çš„è¾…åŠ©ç´¢å¼•ï¼ˆä¾‹å¦‚è§†å›¾å’ŒGSIï¼‰ï¼ˆæ”¯æŒN1QLçš„æ–°çš„è¾…åŠ©ç´¢å¼•å¼•æ“ï¼‰æ—¶ï¼Œç»å¸¸å‡ºç°çš„ä¸€ä»¶äº‹æ˜¯éœ€è¦ç«‹å³è¯»å–å…ˆå‰å†™å…¥æ“ä½œä¸­çš„ä¿®æ”¹ã€‚</p>
<p>è¿™æ„å‘³ç€åªè¦æ•°æ®ä»åœ¨è¢«ç´¢å¼•è¿‡ç¨‹ä¸­ï¼Œview / N1QLå°±ä¸åº”å“åº”ï¼Œå› æ­¤è¿™ä¼šç‰ºç‰²ä¸€äº›æ€§èƒ½ä»¥åˆ©äºä¸€è‡´æ€§ã€‚</p>
<p>ç›¸åï¼ˆSpring Data Couchbaseçš„å½“å‰é»˜è®¤è®¾ç½®ï¼‰æ˜¯é€šè¿‡æ¥å—è¦è¿”å›çš„é™ˆæ—§æ•°æ®æ¥æé«˜æ€§èƒ½ã€‚</p>
<p>é€šè¿‡å›´ç»•ä¸€è‡´æ€§æ¦‚å¿µæä¾›ä¸€ä¸ªå°çš„æŠ½è±¡ï¼Œæˆ‘ä»¬æ·»åŠ äº†å…¨å±€è¯­ä¹‰ï¼Œç”¨äºé…ç½®æ¡†æ¶é€šè¿‡æŸ¥è¯¢æ´¾ç”Ÿæ„é€ çš„æ‰€æœ‰æŸ¥è¯¢ï¼ˆåŸºäºè§†å›¾æˆ–åŸºäºN1QLï¼‰ã€‚</p>
<p>è¿™æ˜¯é€šè¿‡é‡å†™<code>AbstractCouchbaseConfiguration</code>çš„<code>getDefaultConsistency()</code>æ–¹æ³•æ¥å®Œæˆçš„ã€‚<code>Consistency</code>æ˜¯ä¸€ä¸ªæšä¸¾ï¼Œè®©æ‚¨é€‰æ‹©<code>READ_YOUR_OWN_WRITES</code> ï¼Œ <code>STRONGLY_CONSISTENT</code> ï¼Œ <code>UPDATE_AFTER</code>å’Œ<code>EVENTUALLY_CONSISTENT</code> ã€‚è¯·å‚é˜…å®˜æ–¹æ–‡æ¡£ï¼Œä»¥è·å–æœ‰å…³å®ƒä»¬å¦‚ä½•æ­£å¸¸å·¥ä½œä»¥åŠåœ¨æŸ¥è¯¢æ—¶çš„å½±å“çš„æ›´å¤šä¿¡æ¯ã€‚</p>
<p>æ‚¨è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨<code><couchbase:template></code>æ ‡ç­¾ã€‚</p>
<p>ä»GAå¼€å§‹ï¼Œå­˜å‚¨åº“ä¸­çš„CRUDæ–¹æ³•ç°åœ¨ä¹Ÿè€ƒè™‘äº†é»˜è®¤é…ç½®çš„ä¸€è‡´æ€§ã€‚</p><h3><a href="#changing-the-type-information-field-in-stored-json" class="anchor" name="changing-the-type-information-field-in-stored-json"></a>æ›´æ”¹å­˜å‚¨çš„JSONä¸­çš„ç±»å‹ä¿¡æ¯å­—æ®µ</h3>
<p>â­</p>
<p>ä¸€äº›ç”¨æˆ·æŠ¥å‘Šäº†Spring Dataå’ŒCouchbase Mobileæ–¹é¢çš„é—®é¢˜ï¼Œè€ŒSync Gatewayæ‹’ç»äº†åŒ…å«å¸¦ä¸‹åˆ’çº¿å‰ç¼€çš„å­—æ®µçš„æ–‡æ¡£ã€‚</p>
<p>è¿™å¯¹äºSpring Dataæ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹å®ƒå°†ç±»å‹ä¿¡æ¯å­˜å‚¨åœ¨<code>_class</code>å­—æ®µä¸­ï¼š(</p>
<p>è§£å†³æ–¹æ¡ˆæ˜¯å…è®¸é€šè¿‡é…ç½®ä¿®æ”¹è¯¥ç±»å‹ä¿¡æ¯å­—æ®µçš„åç§°ã€‚æ‚¨å¯ä»¥é€šè¿‡é‡å†™è¿™æ ·åš<code>typeKey()</code>çš„æ–¹æ³•<code>AbstractCouchbaseConfiguration</code> ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¸¸é‡<code>MappingCouchbaseConverter.TYPEKEY_SYNCGATEWAY_COMPATIBLE</code> ï¼ˆå³â€œ <code>javaClass</code> â€ï¼‰ã€‚</p>
<p>æ­¤å­—æ®µæ˜¯ç”Ÿæˆçš„N1QLæŸ¥è¯¢ç”¨æ¥ä»…è¿‡æ»¤ä¸å­˜å‚¨åº“å®ä½“ç›¸å¯¹åº”çš„æ–‡æ¡£çš„å­—æ®µã€‚</p><h3><a href="#support-for-code-pageable-code-code-pagerequest-code-in-n1ql-derived-queries" class="anchor" name="support-for-code-pageable-code-code-pagerequest-code-in-n1ql-derived-queries"></a>åœ¨N1QLæ´¾ç”ŸæŸ¥è¯¢ä¸­æ”¯æŒ<code>Pageable</code> / <code>PageRequest</code></h3>
<p>â­â­</p>
<p>ä½¿ç”¨N1QLï¼Œå¯¹äºé€šè¿‡æŸ¥è¯¢æ´¾ç”Ÿç”Ÿæˆçš„æŸ¥è¯¢ï¼Œç°åœ¨æ”¯æŒ<code>Pageable</code>å’Œ<code>Sort</code>å‚æ•°ã€‚</p>
<ul>
<li>æ”¯æŒ<code>PagingAndSortingRepository</code>åŸºäºN1QLã€‚</li>
<li>æ·»åŠ ä¸¤ä¸ªä¾èµ–N1QLè¿›è¡Œåˆ†é¡µå’Œ/æˆ–æ’åºçš„<code>findAll</code>æ–¹æ³•ã€‚ä½¿ç”¨é»˜è®¤é…ç½®çš„ä¸€è‡´æ€§ã€‚</li>
</ul><h3><a href="#geospatial-and-multi-dimensional-querying-using-spatial-views" class="anchor" name="geospatial-and-multi-dimensional-querying-using-spatial-views"></a>ä½¿ç”¨ç©ºé—´è§†å›¾è¿›è¡Œåœ°ç†ç©ºé—´å’Œå¤šç»´æŸ¥è¯¢</h3>
<p>â­â­â­</p>
<p>ä½¿ç”¨åæ ‡æŸ¥è¯¢Couchbaseï¼å¦‚æœæ‚¨çš„å®ä½“å…·æœ‰<code>Point</code> ï¼ˆæˆ–<code>x</code>å’Œ<code>y</code> ï¼‰ä½ç½®ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ‰¾åˆ°å®ƒï¼š</p>
<ul>
<li>ä¸€ä¸ªè¾¹ç•Œæ¡†ï¼š <code>findByLocationWithin(Box area)</code></li>
<li>ä¸€ä¸ªåœ†ï¼š <code>findByLocationWithin(Circle area)</code> ï¼Œ <code>findByLocationWithin(Point center, Distance radius)</code> ã€‚</li>
<li>ä¸€ä¸ªå¤šè¾¹å½¢ï¼š <code>findByLocationWithin(Polygon area)</code> ï¼Œ <code>findByLocationWithin(Point[] polygon)</code> ã€‚</li>
<li>ä¸€ä¸ªè·ç¦»<code>findByLocationNear(Point near, Distance maxDistance)</code> ã€‚</li>
</ul>
<p>ä½œä¸ºæœåŠ¡å™¨ä¸Šçš„è¾¹ç•Œæ¡†è¿‘ä¼¼å€¼ï¼Œå¯ä»¥å¿«é€Ÿæ‰§è¡Œåœ†å½¢å’Œç±»ä¼¼å¤šè¾¹å½¢çš„æŸ¥è¯¢ï¼Œç„¶ååœ¨å‘ˆç°ç»“æœä¹‹å‰ï¼Œæ¡†æ¶ä¼šæ¶ˆé™¤è¯¯æŠ¥ã€‚</p>
<p>æ‚¨å¯ä»¥åˆ©ç”¨Couchbaseç©ºé—´è§†å›¾çš„å¤šç»´æ–¹é¢ä¸ºæŸ¥è¯¢æ·»åŠ é¢å¤–çš„ç»´åº¦ï¼ˆä¾‹å¦‚ï¼Œåœ¨åŸå¸‚ä¸­è¥ä¸šè‡³æ·±å¤œçš„å•†åº—â€¦ï¼‰ã€‚</p>
<pre><code class="prettyprint java">public interface DimensionalPartyRepository extends CrudRepository<Party, String> {

  @Dimensional(designDocument = "partyGeo", spatialViewName = "byLocation")
  List<Party> findByLocationNear(Point p, Distance d);

  @Dimensional(designDocument = "partyGeo", spatialViewName = "byLocation")
  List<Party> findByLocationWithin(Box boundingBox);

  @Dimensional(designDocument = "partyGeo", spatialViewName = "byLocation")
  List<Party> findByLocationWithin(Polygon zone);
  
  @Dimensional(designDocument = "partyGeo", spatialViewName = "byLocationAndAttendees", dimensions = 3)
  List<Party> findByLocationWithinAndAttendeesGreaterThan(Polygon zone, double minAttendees);
}
</code></pre>
<p>æ³¨æ„ï¼šå¦‚æœè¦é‡ç”¨æ³¨é‡Šï¼Œä¹Ÿå¯ä»¥è¿™æ ·åšï¼ˆä¹Ÿé€‚ç”¨äº<code>@View</code>å’Œ<code>@Query</code> ï¼‰ï¼š</p>
<pre><code class="prettyprint java">public interface DimensionalPartyRepository extends CrudRepository<Party, String> {

  //define your own meta-annotation
  @Dimensional(designDocument = "partyGeo", spatialViewName = "byLocation", dimensions = 2)
  @Retention(RetentionPolicy.RUNTIME)
  @interface IndexedByLocation { }
  
  //use it :)
  @IndexedByLocation
  List<Party> findByLocationNear(Point p, Distance d);

  @IndexedByLocation
  List<Party> findByLocationWithin(Box boundingBox);

  @IndexedByLocation
  List<Party> findByLocationWithin(Polygon zone);
  
  //here we use a variation with 3 dimensions, so we need to revert to @Dimensional
  @Dimensional(designDocument = "partyGeo", spatialViewName = "byLocationAndAttendees", dimensions = 3)
  List<Party> findByLocationWithinAndAttendeesGreaterThan(Polygon zone, double minAttendees);
}
</code></pre><h3><a href="#inline-code-n1ql-code-code-query-code-now-have-spel-support" class="anchor" name="inline-code-n1ql-code-code-query-code-now-have-spel-support"></a>å†…è”<code>N1QL</code> <code>@Query</code>ç°åœ¨å…·æœ‰SpELæ”¯æŒ</h3>
<p>â­â­â­</p>
<p>å†…è”æŸ¥è¯¢å¯ä»¥ä½¿ç”¨SpELè¡¨ç¤ºæ³•æ¥ï¼š</p>
<ol>
<li>ç¡®ä¿æ­£ç¡®çš„é€‰æ‹©å’Œè¿‡æ»¤åº”ç”¨äºè¯­å¥ä»¥æ„é€ å’Œè¿”å›å®ä½“ï¼šä½¿ç”¨<code>#{#n1ql.selectEntity}</code>ç”Ÿæˆ<code>SELECT ... FROM ...</code>å­å¥å’Œ<code>#{#n1ql.filter}</code>å°†åœ¨<code>WHERE</code>å­å¥é™åˆ¶æŸ¥è¯¢åˆ°æ­£ç¡®çš„å®ä½“ã€‚</li>
<li>è®¡ç®—å€¼æˆ–ä»Springä¸Šä¸‹æ–‡ä¸­é…ç½®çš„å¤–éƒ¨SpELå€¼æä¾›æ£€ç´¢æ•°æ®ã€‚</li>
</ol><h3><a href="#repository-ldquo-main-rdquo-indexes-creation-can-be-automatically-triggered" class="anchor" name="repository-ldquo-main-rdquo-indexes-creation-can-be-automatically-triggered"></a>å­˜å‚¨åº“â€œä¸»â€ç´¢å¼•åˆ›å»ºå¯ä»¥è‡ªåŠ¨è§¦å‘</h3>
<p>â­â­</p>
<p>âš ï¸ <strong><em>é‡è¦ï¼šåœ¨å¼€å‘/æµ‹è¯•è¿‡ç¨‹ä¸­è¢«è®¤ä¸ºæ˜¯ä¸€ç§å¸®åŠ©ï¼Œåœ¨ç”Ÿäº§ä¸­ä¸é¼“åŠ±ä½¿ç”¨</em></strong></p>
<p>ä¸ºäº†ç¡®ä¿åœ¨å¼€å‘ç¯å¢ƒæˆ–é¢„ç”Ÿäº§ç¯å¢ƒä¸­æ¿€æ´»ç»™å®šå­˜å‚¨åº“ä¸­å®ä½“çš„N1QLç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨<code>@N1qlPrimaryIndexed</code> ï¼ˆå¯ç”¨å­˜å‚¨æ¡¶èŒƒå›´çš„è‡ªç”±æ ¼å¼æŸ¥è¯¢ï¼‰å’Œ<code>@N1qlSecondaryIndexed</code> ï¼ˆä»…å¯¹ç´¢å¼•è¿›è¡Œæ³¨é‡Šï¼‰å¯¹å…¶è¿›è¡Œæ³¨é‡Šã€‚å¯¹åº”äºè¯¥å®ä½“çš„ç±»å‹ï¼Œé€šè¿‡ä½¿ç”¨SpELäº§ç”Ÿçš„WHEREå­å¥ç±»ä¼¼äºæ–‡ä»¶<code>#{#n1ql.filter}</code></p>
<p>æ­¤å¤–ï¼Œå¯¹äºCRUDæ“ä½œåç›¾è§†å›¾å¯ä»¥è‡ªåŠ¨é€šè¿‡æ³¨é‡Šä¸ä¿¡æ¯åº“ä¸­åˆ›å»º<code>@ViewIndexed</code> ï¼ˆä½ éœ€è¦æä¾›è®¾è®¡æ–‡ä»¶åç§°ï¼Œå…¶å¯¹åº”äºå®ä½“çš„ç®€å•ç±»åé¦–å­—æ¯å°å†™ï¼‰ã€‚</p>
<p>è¿˜å¿…é¡»é€šè¿‡åœ¨<code>AbstractCouchbaseConfiguration</code>é‡æ–°å®šä¹‰<code>indexManager</code> beanæ¥é€‰æ‹©å¯ç”¨æ­¤åŠŸèƒ½ã€‚</p><h3><a href="#simple-return-types-primitives-and-code-string-code-are-now-supported-when-using-a-single-row-projection" class="anchor" name="simple-return-types-primitives-and-code-string-code-are-now-supported-when-using-a-single-row-projection"></a>ä½¿ç”¨å•è¡ŒæŠ•å½±æ—¶ï¼Œç°åœ¨æ”¯æŒç®€å•çš„è¿”å›ç±»å‹ï¼ˆåŸºæœ¬ç±»å‹å’Œ<code>String</code> ï¼‰</h3>
<p>â­â­</p>
<p>è¿™ç‰¹åˆ«é’ˆå¯¹å…·æœ‰èšåˆå‡½æ•°ï¼ˆå¦‚<code>COUNT(*)</code> ï¼Œ <code>AVG(field)</code>ç­‰<code>COUNT(*)</code>å†…è”N1QLæŸ¥è¯¢ã€‚æŸ¥è¯¢å¿…é¡»è¿”å›å…·æœ‰å•ä¸ªæŠ•å½±çš„å•è¡Œã€‚</p><h3><a href="#support-named-parameters-in-n1ql-inline-queries" class="anchor" name="support-named-parameters-in-n1ql-inline-queries"></a>åœ¨N1QLå†…è”æŸ¥è¯¢ä¸­æ”¯æŒå‘½åå‚æ•°</h3>
<p>â­â­</p>
<p>ä½¿ç”¨å‘½åå‚æ•°æˆ–ä½ç½®å‚æ•°ï¼Œä½†ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚å‘½åå‚æ•°çš„è¯­æ³•ä¸º<code>$paramName</code> ï¼Œè¦æ±‚æ¯ä¸ªæ–¹æ³•å‚æ•°éƒ½ä½¿ç”¨<code>@Param("paramName")</code>è¿›è¡Œæ³¨é‡Šã€‚</p><h3><a href="#other-features" class="anchor" name="other-features"></a>å…¶å®ƒåŠŸèƒ½</h3>
<p>â­</p>
<p>å…¶ä»–åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>ä¿®å¤Beanå‘½åé—®é¢˜ï¼Œä»¥ä½¿Spring Data Couchbaseåˆ›å»ºçš„æ‰€æœ‰beanéƒ½ä»¥â€œ <code>couchbase</code> â€ä¸ºå‰ç¼€ï¼Œä»¥é¿å…ä¸å…¶ä»–å­˜å‚¨åŒºå‘ç”Ÿå†²çªã€‚</li>
<li>ç°åœ¨æ”¯æŒæ›´æ”¹æ‰€æœ‰å­˜å‚¨åº“çš„åŸºç±»ï¼ˆéµå¾ªé€šç”¨Spring Dataæ–‡æ¡£ä¸­è®°å½•çš„è¿‡ç¨‹ï¼‰</li>
<li>å¦‚æœç´¢å¼•è¿‡æœŸï¼Œåˆ™ä»<code>CouchbaseTemplate</code> findæ–¹æ³•ä¸­åˆ é™¤å·²åˆ é™¤çš„æ–‡æ¡£</li>
<li>åˆ°æœŸæ—¶é—´å¯ä»¥åœ¨<code>@Document</code>ä¸Šè®¾ç½®ä¸º<code>long</code> + <code>timeUnit</code></li>
</ul>
<p>RC1çš„ä¸€äº›é”™è¯¯ä¿®æ­£å’Œæ”¹è¿›ä¹Ÿå·²å®ç°ã€‚</p><h2><a href="#documentation" class="anchor" name="documentation"></a>æ–‡çŒ®èµ„æ–™</h2>
<p>â­â­â­</p>
<p><a href="https://docs.spring.io/spring-data/couchbase/docs/2.0.0.RELEASE/reference/html/">æ–‡æ¡£</a>ä¹Ÿå¾—åˆ°äº†æ”¹è¿›ï¼Œæ·»åŠ äº†é¢å‘Couchbaseçš„ç¤ºä¾‹ï¼Œè¿™äº›ç¤ºä¾‹æ¶‰åŠå¦‚ä½•å‘å­˜å‚¨åº“æ·»åŠ è‡ªå®šä¹‰æ–¹æ³•çš„å®ç°ï¼Œå¦‚ä½•æ›´æ”¹æ‰€æœ‰å­˜å‚¨åº“çš„åŸºç±»ï¼Œå¦‚ä½•åœ¨å†…è”æŸ¥è¯¢ä¸­å¤„ç†SpELï¼Œç­‰ç­‰ã€‚</p><h2><a href="#a-note-about-spring-cache" class="anchor" name="a-note-about-spring-cache"></a>å…³äºSpring Cacheçš„è¯´æ˜</h2>
<p>Spring Cacheæ”¯æŒå·²ä»Spring Dataå­˜å‚¨åº“ä¸­ç§»å‡ºã€‚å®ƒä»ç„¶å­˜åœ¨ï¼Œæˆ‘ä»¬è®¡åˆ’å¯¹å…¶è¿›è¡Œæ”¹è¿›ã€‚æ‚¨ç°åœ¨å¯ä»¥åœ¨githubä¸Šçš„Couchbase <a href="https://github.com/couchbaselabs/couchbase-spring-cache">å­˜å‚¨åº“ä¸­</a>æ‰¾åˆ°å®ƒï¼Œä½†æ˜¯å®ƒåº”è¯¥å¾ˆå¿«é‡æ–°é›†æˆSpringå®˜æ–¹é¡¹ç›®ç³»åˆ—ã€‚</p><h2><a href="#getting-spring-data-couchbase" class="anchor" name="getting-spring-data-couchbase"></a>è·å–Spring Data Couchbase</h2>
<p>æ‚¨å¯ä»¥åœ¨ä¸‹é¢æ·»åŠ åˆ°é¡¹ç›®çš„<code>pom.xml</code>å¾—åˆ°è¿™ä¸ªGAç‰ˆæœ¬ï¼ˆåœ¨<code>dependencies</code>éƒ¨åˆ†ï¼š</p>
<pre><code class="prettyprint xml"><!--<dependencies>-->
  <dependency>
    <groupId>org.springframework.data</groupId>
    <artifactId>spring-data-couchbase</artifactId>
    <version>2.0.0.RELEASE</version>
  </dependency>
<!--</dependencies>-->
</code></pre>
<p>æˆ‘ä»¬å¸Œæœ›æ‚¨å–œæ¬¢æ­¤ç‰ˆæœ¬åŠå…¶å¸¦æ¥çš„æ‰€æœ‰æ–°åŠŸèƒ½ã€‚ä¸‹ä¸€æ­¥å°†é‡æ–°è¿æ¥åˆ°<code>Hopper</code>é‡Šæ”¾åˆ—è½¦ç‰ˆæœ¬<code>2.1</code>å¤å¤©ä¹‹å‰çš„é¢„æœŸã€‚</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">var disqus_shortname = 'spring-io';
      var disqus_identifier = 2376;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));</script>
<noscript>è¯·å¯ç”¨JavaScriptä»¥æŸ¥çœ‹<a href="http://disqus.com/?ref_noscript">ç”±Disqusæä¾›</a>çš„<a href="http://disqus.com/?ref_noscript">è¯„è®ºã€‚</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">ç”±<span class="logo-disqus">Disqus</span>æä¾›åŠ¨åŠ›çš„è¯„è®º</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>èƒŒéƒ¨</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">æ‰€æœ‰å¸–å­</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">å·¥ç¨‹</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">å‘å¸ƒ</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">æ–°é—»ä¸æ´»åŠ¨</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>å°†The Spring Teamçš„æ›´æ–°å‘é€åˆ°æ‚¨çš„æ”¶ä»¶ç®±</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });</script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">çƒé˜Ÿ</a></li>
<li><a href="/tools">å·¥å…·ç±»</a></li>
<li><a href="https://store.pivotal.io/">å•†åº—</a></li>
<li><a href="/blog">é€šè®¯</a></li>
</ul>
</div>
</div>Â© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ï¼ŒInc.ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚
<a href="https://pivotal.io/terms-of-use">ä½¿ç”¨æ¡æ¬¾</a> â€¢ <a href="https://pivotal.io/privacy-policy">éšç§</a> â€¢ <a href="/trademarks">å•†æ ‡å‡†åˆ™</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>