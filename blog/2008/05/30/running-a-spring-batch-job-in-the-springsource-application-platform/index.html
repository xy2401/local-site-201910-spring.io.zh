<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Running a Spring Batch Job in The SpringSource Application Platform</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Running a Spring Batch Job in The SpringSource Application Platform" />
<meta name="twitter:description" content="&lt;p&gt;In this article I will show you how to run a Spring Batch job in the SpringSource Application Platform. I ran an early version of this up as a little demo for JavaOne, and then again at the London Spring User Group, and thought it might be a good thing to share. The sample code is &lt;a href=&quot;http://blog.springsource.com/main/wp-content/uploads/2008/06/batch-ap-blog-v2.zip&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;The Bundles&lt;/h2&gt;
&lt;p&gt;First we’ll do a quick tour of the bundles in the sample code. Start the server now, or at any point after you have installed some bundles.&lt;/p&gt;
&lt;h3&gt;Bundle: hsql-server&lt;/h3&gt;
&lt;p&gt;This one is useful to have around for development and testing. All it does is launch an instance of HSQLDB in server mode, so that you can connect to it and inspect the database using SQL statements. You can just drag and drop it into the Platform Server instance in the Servers View. Do this first, because the Platform remembers the order in which bundles were installed, and starts them in that order. This one has to be started first because other bundles will try to connect to the database server.&lt;/p&gt;
" />
<meta name="twitter:creator" content="@david_syer" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=200" />

<meta property="og:title" content="Running a Spring Batch Job in The SpringSource Application Platform" />
<meta property="og:image" content="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=200" />
<meta property="og:description" content="&lt;p&gt;In this article I will show you how to run a Spring Batch job in the SpringSource Application Platform. I ran an early version of this up as a little demo for JavaOne, and then again at the London Spring User Group, and thought it might be a good thing to share. The sample code is &lt;a href=&quot;http://blog.springsource.com/main/wp-content/uploads/2008/06/batch-ap-blog-v2.zip&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;The Bundles&lt;/h2&gt;
&lt;p&gt;First we’ll do a quick tour of the bundles in the sample code. Start the server now, or at any point after you have installed some bundles.&lt;/p&gt;
&lt;h3&gt;Bundle: hsql-server&lt;/h3&gt;
&lt;p&gt;This one is useful to have around for development and testing. All it does is launch an instance of HSQLDB in server mode, so that you can connect to it and inspect the database using SQL statements. You can just drag and drop it into the Platform Server instance in the Servers View. Do this first, because the Platform remembers the order in which bundles were installed, and starts them in that order. This one has to be started first because other bundles will try to connect to the database server.&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2008-05-30 16:26:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Running a Spring Batch Job in The SpringSource Application Platform</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/dsyer">Dave Syer</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2008-05-30 16:26:00.0">May 30, 2008</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="164" href="/blog/2008/05/30/running-a-spring-batch-job-in-the-springsource-application-platform#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>In this article I will show you how to run a Spring Batch job in the SpringSource Application Platform. I ran an early version of this up as a little demo for JavaOne, and then again at the London Spring User Group, and thought it might be a good thing to share. The sample code is <a href="http://blog.springsource.com/main/wp-content/uploads/2008/06/batch-ap-blog-v2.zip">here</a>.</p>
<h2>The Bundles</h2><p>First we&rsquo;ll do a quick tour of the bundles in the sample code. Start the server now, or at any point after you have installed some bundles.</p>
<h3>Bundle: hsql-server</h3><p>This one is useful to have around for development and testing. All it does is launch an instance of HSQLDB in server mode, so that you can connect to it and inspect the database using SQL statements. You can just drag and drop it into the Platform Server instance in the Servers View. Do this first, because the Platform remembers the order in which bundles were installed, and starts them in that order. This one has to be started first because other bundles will try to connect to the database server.</p><p>The bundle configuration is in <tt>META-INF/spring/module-context.xml</tt> (this is conventional for Platform bundles) - Spring DM picks up all XML files from <tt>META-INF/spring</tt>. This one just uses Spring to configure and launch an instance of the HSQL Server.</p><p>There is an integration test that can be used to check the configuration.</p><p>The Eclipse project also contains a launch configuration for an HSQL Swing client, so you can see the database contents in a GUI. Launch it and connect to the server instance with the properties provided in <tt>META-INF/batch-hsql.properties</tt> in the same project (url=jdbc:hsqldb:<a href="hsql://localhost:9005/samples)">hsql://localhost:9005/samples)</a>.</p>
<h3>Bundle: data-source</h3><p>This bundle is a configuration bundle which exposes a single OSGi service for a <tt>javx.sql.DataSource</tt>. Drop this into the Server next. There is a simple integration test that can be used to check the configuration - it just gets a connection from the datasource and asserts it is not null.</p>
<h3>Bundle: data-source-initializer</h3><p>This is another convenient bundle to have in a test environment. It&rsquo;s job is to tear down the database and re-install the tables needed for the rest of the bundles (the batch meta data, and some business tables for the jobs themselves). When you install this bundle into the server it will add the tables, which should then show up in the HSQL Swing GUI. Once it has been installed once, you can remove it (right click on the bundle in the Server View and select Remove).</p>
<h3>Bundle: job-launcher</h3><p>This is the first bundle that contains some Spring Batch dependencies. It is mainly a configuration bundle, exposing services (JobLauncher, JobRepository, TransactionManager) for other bundles that will actually run jobs. Once it is installed it can just sit there providing the services.</p><p>The bundle configuration is in <tt>META-INF/spring/module-context.xml</tt> as per usual. It is a stripped-down version of the <tt>simple-job-launcher-context.xml</tt> from the Spring Batch samples. It only has to define the beans that will be exported, i.e.</p>
<pre><code class="prettyprint xml">&lt;bean id=&quot;jobLauncher&quot;
    class=&quot;org.springframework.batch.core.launch.support.SimpleJobLauncher&quot;&gt;
  &lt;property name=&quot;jobRepository&quot; ref=&quot;jobRepository&quot; /&gt;
&lt;/bean&gt;

&lt;bean id=&quot;jobRepository&quot;
    class=&quot;org.springframework.batch.core.repository.support.JobRepositoryFactoryBean&quot;&gt;
  &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;
  &lt;property name=&quot;databaseType&quot; value=&quot;hsql&quot; /&gt;
&lt;/bean&gt;
	
&lt;bean id=&quot;transactionManager&quot; 
    class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
  &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
&lt;/bean&gt;
</code></pre><p>The only other configuration there is the transaction advice for the <tt>JobRepository</tt> (not needed in Spring Batch 1.1). The dataSource reference comes from an OSGi service exposed by the <tt>data-source</tt> bundle above. To see how that reference is imported and how the local services are exposed to the OSGi Service Registry, we can look at <tt>META-INF/spring/osgi-context.xml</tt>:</p>
<pre><code class="prettyprint xml">&lt;reference id=&quot;dataSource&quot; interface=&quot;javax.sql.DataSource&quot; /&gt;

&lt;service ref=&quot;jobLauncher&quot;
  interface=&quot;org.springframework.batch.core.launch.JobLauncher&quot; /&gt;
&lt;service ref=&quot;jobRepository&quot;
  interface=&quot;org.springframework.batch.core.repository.JobRepository&quot; /&gt;
&lt;service ref=&quot;transactionManager&quot;
  interface=&quot;org.springframework.transaction.PlatformTransactionManager&quot; /&gt;
</code></pre><p>This is pretty straightforward use of Spring DM. The important thing is that the module context is kept separate from the OSGi-specific context. This allows us to write an integration test for the module context, without having to deploy to the Platform. Thus we have:</p>
<pre><code class="prettyprint java">@ContextConfiguration
@RunWith(SpringJUnit4ClassRunner.class)
public class JobLauncherIntegrationTests {

  @Autowired
  private JobLauncher jobLauncher;

  @Test
  public void testLaunchJob() throws Exception {
    assertNotNull(jobLauncher);
  }

}
</code></pre><p>The test loads the context up, adding a local data source definition to replace the OSGi one (see <tt>JobLauncherIntegrationTests-context.xml</tt>), ad then asserts that a job launcher is available. You can run the test directly from Eclipse in the normal way.</p>
<h4>The <tt>SimpleJobLauncherBean</tt></h4><p>In addition to the configuration above exposing services in the OSGi container, this bundle also exports a package. Look in the <tt>MANIFEST.MF</tt>:</p>
<pre><code class="prettyprint plain">...
Export-Package: com.springsource.consulting.batch.support
...
</code></pre><p>If you look in this package you will find a convenience class that can be used by other bundles to launch a job (<tt>SimpleJobLauncherBean</tt>). The <tt>SimpleJobLauncherBean</tt> is an <tt>ApplicationListener</tt> which means that any Spring <tt>ApplicationContext</tt> that contains one of these will try to launch the job on startup (when the context is loaded). The way it does this is to listen for a <tt>ContextRefreshedEvent</tt> and then try to launch the job:</p>
<pre><code class="prettyprint java">try {
  jobLauncher.run(job, converter.getJobParameters(parameters));
} catch (JobExecutionAlreadyRunningException e) {
  logger.error(&quot;This job is already running&quot;, e);
} catch (JobInstanceAlreadyCompleteException e) {
  logger.info(&quot;This job is already complete.  &quot;
    + &quot;Maybe you need to change the input parameters?&quot;, e);
} catch (JobRestartException e) {
  logger.error(&quot;Unspecified restart exception&quot;, e);
}
</code></pre><p>The plan for launching jobs is to simply create a bundle for each job, and have it define one of these <tt>SimpleJobLauncherBean</tt> instances.</p>
<h3>Bundle: hello-world</h3><p>This is a very simple job bundle. It has all the features of a bigger job (input from a file and output to a database), but works with a very simple domain model and a very small dataset.</p><p>Drop the bundle into the running Server instance. It starts pretty quickly, and since the job is so small in scope you will immediately see the effect in the batch meta-data. In the HSQL Swing GUI you can execute some SQL, e.g.</p>
<pre><code class="prettyprint plain">SELECT * FROM BATCH_STEP_EXECUTION
</code></pre><p>And see the result, something like this:</p>
<table cellspacing="0" cellpadding="0" border="1"><tr><th>STEP_EXECUTION_ID</th><th>VERSION</th><th>STEP_NAME</th><th>...</th><th>STATUS</th><th>...</th></tr>
<tr><td>0</td><td>4</td><td>helloWorldStep</td><td>...</td><td>COMPLETED</td><td>...</td></tr>
</table><p>This shows that the job was executed (and completed successfully). The configuration for the step is in <tt>META-INF/spring/module-context.xml</tt>:</p>
<pre><code class="prettyprint xml">&lt;bean
	class=&quot;com.springsource.consulting.batch.support.SimpleJobLauncherBean&quot;&gt;
	&lt;constructor-arg ref=&quot;jobLauncher&quot; /&gt;
	&lt;constructor-arg ref=&quot;helloWorld&quot; /&gt;
	&lt;property name=&quot;parameters&quot; value=&quot;launch.timestamp=${launch.timestamp}&quot;/&gt;
&lt;/bean&gt;

&lt;bean id=&quot;helloWorld&quot; parent=&quot;simpleJob&quot;&gt;
	&lt;property name=&quot;steps&quot;&gt;
		&lt;bean parent=&quot;simpleStep&quot; id=&quot;helloWorldStep&quot;&gt;
			&lt;property name=&quot;commitInterval&quot; value=&quot;100&quot; /&gt;
			&lt;property name=&quot;itemReader&quot;&gt;
    ...
			&lt;/property&gt;
			&lt;property name=&quot;itemWriter&quot;&gt;
    ...
			&lt;/property&gt;
		&lt;/bean&gt;
	&lt;/property&gt;
&lt;/bean&gt;
</code></pre><p>From the above you can see that we have a regular Spring Batch job configuration (called &ldquo;helloWorld&rdquo;) with a single step. The step id (&ldquo;helloWorldStep&rdquo;) was seen already in the database query above, showing that the step had been executed (once). All the step does is read data from a flat file, transforming the lines to domain objects, and writing them to a stdout. You can see the result by inspecting the trace logs in the Platform home directory, e.g. if you <tt>tail -f serviceability/trace/trace.log | grep -i hello</tt> you should see:</p>
<pre><code class="prettyprint plain">[2008-05-30 15:57:04.140] platform-dm-11              
  com.springsource.consulting.batch.hello.MessageWriter.unknown 
  I Message: [Hello World]
[2008-05-30 15:57:04.140] platform-dm-11              
  com.springsource.consulting.batch.hello.MessageWriter.unknown 
  I Message: [Hello Small World]
</code></pre><p>If you like you can run the job again, just by editing one of the files in the bundle (e.g. the MANIFEST or one of the Spring config files) and saving it. The tools pick up the change and redeploy the bundle. The way this job is set up it starts every execution with a new set of parameters (using a timestamp) so it should always run successfully.</p>
<h4>The End of a Job</h4><p>Once the job has finished, either successfully or not, we want to leave the system in a state that signals what has happened. There are many possible approaches to this, but all we really need is one that is toolable, so that an operator can be notified, and take whatever action is necessary (like restart a failed job or re-parameterise a successful one for the next run). The operator might be a human, or a system function.</p><p>To signal the end of the job, the <tt>SimpleJobLauncherBean</tt> simply grabs the enclosing OSGi <tt>Bundle</tt> instance, and stops it. This is a pretty simple model, but has the benefit that the API is well defined and universally supported by the OSGi platform. It can in principle be extended very flexibly as long as the container (SpringSource Application Platform) can trap those bundle events. These are features we might see in the Batch Personality for the Platform version 2.0. If you have any ideas about what the behaviour should be and what features are required by operators, please help us by commenting on this article.</p><p>We can verify the state of the job bundle by logging into the Equinox console. If you go to a command line and type <tt>telnet localhost 2401</tt> you should see a command prompt from the platform:</p>
<pre><code class="prettyprint plain">osgi&gt;
</code></pre><p>Type &ldquo;ss&rdquo; and hit return, and you will see a list of installed bundles:</p>
<pre><code class="prettyprint plain">osgi&gt; ss

Framework is launched.

id      State       Bundle
...
86      RESOLVED    org.springframework.batch.infrastructure_1.0.0
87      RESOLVED    org.springframework.batch.core_1.0.0
88      RESOLVED    com.springsource.org.apache.commons.lang_2.4.0
97      ACTIVE      job.launcher_1.0.0
99      RESOLVED    hello.world_1.0.0

osgi&gt;
</code></pre><p>So the bundle with id=97 is the job launcher, and it is active. The bundle with id=99 is the hello world job (the ids might be different in your case), and it is resolved, but not active because it was stopped when the job finished executing.</p><p>You can restart the job again from the OSGi command line:</p>
<pre><code class="prettyprint plain">osgi&gt; start 99

osgi&gt; ss

Framework is launched.

id      State       Bundle
...
86      RESOLVED    org.springframework.batch.infrastructure_1.0.0
87      RESOLVED    org.springframework.batch.core_1.0.0
88      RESOLVED    com.springsource.org.apache.commons.lang_2.4.0
97      ACTIVE      job.launcher_1.0.0
99      RESOLVED    hello.world_1.0.0

osgi&gt;
</code></pre><p>The job bundle is back to the resolved state, but it has executed the job again, which you can verify from the HSQL GUI or from the trace logs as before.</p>
<table cellspacing="0" cellpadding="0" border="1"><tr><th>STEP_EXECUTION_ID</th><th>VERSION</th><th>STEP_NAME</th><th>...</th><th>STATUS</th><th>...</th></tr>
<tr><td>0</td><td>4</td><td>helloWorldStep</td><td>...</td><td>COMPLETED</td><td>...</td></tr>
<tr><td>1</td><td>4</td><td>helloWorldStep</td><td>...</td><td>COMPLETED</td><td>...</td></tr>
<tr><td>2</td><td>4</td><td>helloWorldStep</td><td>...</td><td>COMPLETED</td><td>...</td></tr>
</table>
<h4>Input files for Jobs</h4><p>Hello world has a fixed input file packaged inside the bundle. Sometimes that would not be appropriate, and it would be common in practice to find the input file sitting on the file system. On the other hand, with a deployment model based on hot-deployable bundles, maybe packaging the input file in with the job execution is not a bad idea - the footprint of the bundle can be very small, and it contains a perfect audit record of what precisely was executed. Comments would be interesting.</p>
<h3>Bundle: football-job</h3><p>There is another job bundle in the sample code, which is a more realistic business application (it&rsquo;s the football job sample from Spring Batch). You can launch it and re-launch it in the same way as the hello-world job.</p><p>If you just tried that, you probably found that on the second and subsequent launches, nothing changes in the database. That&rsquo;s expected because you have restarted a successfully completed job instance, so it won&rsquo;t process the data again. In fact an exception was thrown by the <tt>JobLauncher</tt>, caught and logged by the <tt>SimpleJobLauncherBean</tt> (so it shows up in the trace logs).</p>
<h2>Setting up a Workspace</h2>
<h3>The SpringSource Application Platform</h3><p>If you somehow managed to miss the release announcements, or haven&rsquo;t had time yet to try it out (maybe you thought it was all about web applications), here are a few links to get you started:</p>
<ul>
<li><a href="http://www.springsource.com/beta/applicationplatform/downloads.php">Platform Download Page</a> including links to User (or admin) and Programmer Guide</li>
<li>The <a href="http://www.springsource.com/repository/app/">SpringSource Enterprise Bundle Repository</a> - essential for downloading and locating dependencies</li>
<li>Rob's Blog on <a href="http://blog.springsource.com/main/2008/05/02/running-spring-applications-on-osgi-with-the-springsource-application-platform/">exploiting Spring features</a> in the Platform</li>
<li>Rob's <a href="http://blog.springsource.com/main/2008/04/30/introducing-the-springsource-application-platform/">Introductory Blog</a> on the Platform</li>
<li>Sam's blog on <a href="http://blog.springsource.com/main/2008/05/06/springsource-application-platform-deployment-options/">deployment options</a></li>
<li>Andy's blog on <a href="http://blog.springsource.com/main/2008/05/09/working-with-springsource-application-platforms-provisioning-repository/">provisioning bundles in the platform</a></li>
</ul>
<h3>Pre-Requisites</h3><p>To follow the examples and run the <a href="http://blog.springsource.com/main/wp-content/uploads/2008/06/batch-ap-blog-v2.zip">sample code</a> you will need some or all of the following. I used them all, and so the smoothest experience will probably come from using them all.</p>
<ul>
<li>The SpringSource <a href="http://www.springsource.com/web/guest/products/suite/sts">ToolSuite</a></li>
<li>The SpringSource <a href="http://www.springsource.com/beta/applicationplatform/downloads.php">Application Platform</a> including the Eclipse tooling (install using the update site on the download page)</li>
<li>The Q4E <a href="https://code.google.com/p/q4e/">Maven Integration for Eclipse</a></li>
</ul><p>After installing the SpringSource Eclipse tools, you need to create a server instance. Go to File-&gt;New-&gt;Other&hellip; and find Server-&gt;Server. Select SpringSource and the server type below that and use the browse dialogue to find the Platform installation.</p>
<h3>Downloading Dependencies</h3><p>We are all waiting expectantly for the SpringSource Eclipse tooling to provide automatic download and installation of dependencies. If that isn&rsquo;t available when you read this article, then you can do it the way I did, if you like. Here&rsquo;s what I did:</p>
<ul>
<li> (Optional) start with an empty local Maven repo (delete ~/.m2/repository, or point to a new location in settings.xml)</li>
<li>Before installing a bundle for the first time, open up the project's pom.xml and find the <profile /> element with id "shell".</li>
<li>Change the activeByDefault flag to true, and wait while Q4E downloads the dependencies.</li>
<li>Inspect the dependencies using the Q4E visualiser (right click on project and select Maven2->Analyse Dependencies (or Visualize Dependencies). You only need to do this to see what the transitive dependencies are. (You can also use <tt>$ mvn dependency:tree</tt> on the command line.)</li>
<li>At this point I always also right click on the project and select Maven2->Fetch Source JARs. This is optional, but makes development easier and debugging possible.</li>
<li>Copy the direct dependencies into the Platform <tt>bundles/usr</tt> directory. Strictly you only need to copy the ones that are not already in <tt>bundles/ext</tt>. On a command line (with a sensible OS) you can do
<pre>$ find ~/.m2/repository -name \*.jar -exec cp {} bundles/usr \;
</pre>
</li>
<li>You might need to make "fake edits" on some or all of the <tt>MANIFEST.MF</tt> files in the bundle projects to force the tooling to refresh.</li>
<li> Switch the activeByDefault flag back to false.</li>
</ul><p>No need to restart Eclipse or anything. The &ldquo;Bundle Dependencies&rdquo; classpath container should then contain the runtime dependencies you just downloaded. When all Eclipse errors in the Problems view (angry red margin markers) have disappeared, we are ready to go.</p><p>I would be delighted to hear from people who have a better way of doing this. Other people have evolved other methods already, but none seemed that convenient to me. Actually, a command-line Maven target would be quite easy to write, but I haven&rsquo;t seen that one yet.</p>
<h4>Update for Beta5</h4><p>With beta5 you don&rsquo;t need the &ldquo;find and copy&rdquo; step because the platform.config allows you to point to the local Maven repo as a source of dependencies instead of bundles/usr.</p><p>You also don&rsquo;t need the Maven local repo for runtime dependencies at all, in principle. You can open the Platform runtime (right click in the Servers view and Open), and browse for and download dependencies directly to <tt>bundles/usr</tt>. The only weakness currrently (the tools team is working on improving this) is that it doesn&rsquo;t provide any view of the transitive dependencies - you have to know explicitly which bundles are needed. In the case of the samples for this blog, that is easy because the MANIFESTs all have the dependencies completely specificied already. It&rsquo;s harder when you aren&rsquo;t sure what they are and have to create the MANIFEST from scracth. For that I&rsquo;m still using Q4E for now.</p>
<h2>Closing</h2><p>There is always more than one way to skin a cat, and the Platform is a very rich environment, so you can be sure that what I showed here is not the only way to achieve the goal of running a job in the Platform. Hopefully it&rsquo;s a good starting point.</p><p>A lot of the focus with the Application Platform 1.0 release is on the web tier, and while this is clearly essential (and very tricky to deliver), there are other fish to fry. The 2.0 release will have specific batch-related features (a Batch Personality), so anything we do now will be helpful to flesh out feature requirements for that release. So if you get a chance to try this out and have some constructive comments, especially about operational aspects, they will come in handy when we start to build the Batch Personality.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 164;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>