<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>使用SpringSource应用程序平台在OSGi上运行Spring应用程序</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Running Spring Applications on OSGi with the SpringSource Application Platform">
<meta name="twitter:description" content="<p>A lot of people have been asking what exactly the SpringSource Application Platform does for Spring applications to make them run well under OSGi, over and above what you can get out of the box with OSGi and Spring Dynamic Modules. Adrian’s post yesterday highlighted some of the general issues, now lets look at a few of the details.</p>
<p>The three most challenging aspects of running Spring applications on OSGi are:</p>
<ul> 
 <li>Load-time weaving</li> 
 <li>Classpath scanning</li> 
 <li>Thread context classloader management</li> 
</ul>
<p>The remaining, but less interesting, issues include: JSP support, TLD scanning, annotation matching and resource lookups. Overall, there was a decent-sized set of issues that needed to be solved to make applications deploy smoothly.</p>
">

<meta property="og:title" content="Running Spring Applications on OSGi with the SpringSource Application Platform">
<meta property="og:description" content="<p>A lot of people have been asking what exactly the SpringSource Application Platform does for Spring applications to make them run well under OSGi, over and above what you can get out of the box with OSGi and Spring Dynamic Modules. Adrian’s post yesterday highlighted some of the general issues, now lets look at a few of the details.</p>
<p>The three most challenging aspects of running Spring applications on OSGi are:</p>
<ul> 
 <li>Load-time weaving</li> 
 <li>Classpath scanning</li> 
 <li>Thread context classloader management</li> 
</ul>
<p>The remaining, but less interesting, issues include: JSP support, TLD scanning, annotation matching and resource lookups. Overall, there was a decent-sized set of issues that needed to be solved to make applications deploy smoothly.</p>
">
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2008-05-02 14:34:00.0">
</head>
<body >

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">使用SpringSource应用程序平台在OSGi上运行Spring应用程序</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="null?s=20&d=mm"> <span class="author">罗伯·哈罗普</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2008-05-02 14:34:00.0">2008年5月2日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2008/05/02/running-spring-applications-on-osgi-with-the-springsource-application-platform#disqus_thread" data-disqus-identifier="156">
</a></div>
</div>
</header>
<div class="blog--post"><p>除了使用OSGi和Spring动态模块可以立即使用的功能之外，很多人一直在问SpringSource Application Platform对Spring应用程序到底能做什么以使其在OSGi下很好地运行。阿德里安（Adrian）昨天的帖子重点介绍了一些一般性问题，现在让我们来看一些细节。</p>
<p>在OSGi上运行Spring应用程序的三个最具挑战性的方面是：</p>
<ul>
<li>加载时间编织</li>
<li>类路径扫描</li>
<li>线程上下文类加载器管理</li>
</ul>
<p>其余但不太有趣的问题包括：JSP支持，TLD扫描，注释匹配和资源查找。总体而言，为了使应用程序顺利部署，需要解决一系列相当大的问题。</p>
<h2 id="load_time_weaving">加载时间编织</h2>
<p>加载时编织是要以可靠的方式支持的最成问题的功能之一。在基本级别上，它需要连接到Equinox <span style="font-family:courier">ClassLoader，</span>以便可以在<span style="font-family:courier">defineClass</span>调用期间附加和使用标准<span style="font-family:courier">ClassFileTransformers</span> 。最重要的是，LTW的许多用途都需要访问一个废弃的<span style="font-family:courier">ClassLoader</span> ， <span style="font-family:courier">该类</span>可以用来检查类型以确定在编织过程中需要发生什么，而不会影响真正的<span style="font-family:courier">ClassLoader</span> 。</p>
<p>基本的支持水平实际上相当容易实现。当编织是由一个束中的类驱动，但是要编织另一束中的类时，就会遇到困难。这在企业应用程序中非常普遍，其中一个捆绑包包含域实体，另一个捆绑包包含使用JPA <span style="font-family:courier">EntityManager的</span>类型。平台通过确保可以使用适当的<span style="font-family:courier">ClassFileTransformers</span>编织应用程序中的所有捆绑包来解决这种复杂性。</p>
<p>当您开始将编织扩展到其他束时，您确实需要知道何时停止。如果仅将编织应用于所有捆绑，那么应用程序将相互干扰。平台通过显式确定编织范围来防止这种情况的发生，因此它仅适用于应用程序中的模块。</p>
<p>LTW的另一个问题是它使刷新变得复杂。刷新捆绑软件时，OSGi会刷新依赖于它的所有捆绑软件。这意味着，在我上面给出的示例中，刷新域捆绑包将导致<span style="font-family:courier">EntityManager</span>捆绑包被刷新。但是，刷新<span style="font-family:courier">EntityManager</span> <strong>不会</strong>刷新域绑定，这意味着编织可能不同步。平台通过将刷新传播到受编织影响的其他束来解决此问题。</p>
<h2 id="classpath_scanning">类路径扫描</h2>
<p>使用类路径扫描时，主要问题是Equinox不公开标准的<span style="font-family:courier">jar：</span>和<span style="font-family:courier">file：</span>资源。平台在中间放置了一个适配器，以便库可以看到它们期望的资源协议。使<strong>许多</strong>第三方库正常工作具有很好的副作用-不仅是对类路径扫描的修复。</p>
<h2 id="thread_context_classloader_management">线程上下文类加载器管理</h2>
<p>许多第三方库使用线程上下文<span style="font-family:courier">ClassLoader</span>访问应用程序类型和资源。OSGi中的每个捆绑软件都有其自己的<span style="font-family:courier">ClassLoader</span> ，因此，任何时候都只能将一个捆绑软件公开为线程上下文<span style="font-family:courier">ClassLoader</span> 。这意味着，如果第三方库需要查看分布在多个捆绑软件中的类型，则它将无法正常工作。</p>
<p>平台通过创建<span style="font-family:courier">ClassLoader</span>来解决此问题，该<span style="font-family:courier">ClassLoader</span>导入应用程序中每个模块的所有导出软件包。然后，此<span style="font-family:courier">ClassLoader</span>作为线程上下文<span style="font-family:courier">ClassLoader</span>公开，使第三方库可以查看应用程序中所有导出的类型。</p>
<p>这只是平台要解决的问题的一小部分，但希望它可以使您了解平台对Spring Framework用户的意义。</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 156;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>