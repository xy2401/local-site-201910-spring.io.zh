<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Working with SpringSource Application Platform&#39;s provisioning repository</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Working with SpringSource Application Platform&#39;s provisioning repository" />
<meta name="twitter:description" content="&lt;p&gt;One of the main advantages of the SpringSource Application Platform is its ability to provision dependencies on an as-needed basis. The benefits of this are two-fold: it ensures that the Platform’s memory footprint is as small as possible and it allows applications to be deployed without encapsulating all of their dependencies in a monolithic deployment unit, e.g. a WAR file. To take advantage of these capabilities you will require an understanding of the Platform’s provisioning repository and this blog intends to provide just that.&lt;br&gt;&lt;/p&gt;
" />
<meta name="twitter:creator" content="@ankinson" />
<meta name="twitter:image:src" content="https://gravatar.com/avatar/8d143bf6d465cb98f8196cf4311256d0?s=200" />

<meta property="og:title" content="Working with SpringSource Application Platform&#39;s provisioning repository" />
<meta property="og:image" content="https://gravatar.com/avatar/8d143bf6d465cb98f8196cf4311256d0?s=200" />
<meta property="og:description" content="&lt;p&gt;One of the main advantages of the SpringSource Application Platform is its ability to provision dependencies on an as-needed basis. The benefits of this are two-fold: it ensures that the Platform’s memory footprint is as small as possible and it allows applications to be deployed without encapsulating all of their dependencies in a monolithic deployment unit, e.g. a WAR file. To take advantage of these capabilities you will require an understanding of the Platform’s provisioning repository and this blog intends to provide just that.&lt;br&gt;&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2008-05-09 08:42:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
 <i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Working with SpringSource Application Platform&#39;s provisioning repository</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/8d143bf6d465cb98f8196cf4311256d0?s=20&amp;d=mm" />
<a class="author" rel="author" href="/team/awilkinson">Andy Wilkinson</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2008-05-09 08:42:00.0">May 09, 2008</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="159" href="/blog/2008/05/09/working-with-springsource-application-platform-s-provisioning-repository#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p>One of the main advantages of the SpringSource Application Platform is its ability to provision dependencies on an as-needed basis. The benefits of this are two-fold: it ensures that the Platform&rsquo;s memory footprint is as small as possible and it allows applications to be deployed without encapsulating all of their dependencies in a monolithic deployment unit, e.g. a WAR file. To take advantage of these capabilities you will require an understanding of the Platform&rsquo;s provisioning repository and this blog intends to provide just that.<br /><h2>Where is the provisioning repository and how does it work?</h2><br />By default the Platform&rsquo;s provisioning repository can be found in the <span style="font-family: courier">repository</span> directory at the root of the installation:</p><p><img alt="Directory structure of the provisioning repository" id="image335" src="http://blog.springsource.com/main/wp-content/uploads/2008/05/repository-directory-structure.png" /><br />As you can see, there are three main directories: <span style="font-family: courier">bundles</span>, <span style="font-family: courier">installed</span> and <span style="font-family: courier">libraries</span>. <span style="font-family: courier">installed </span>is for the Platform&rsquo;s internal use so we&rsquo;ll focus on the <span style="font-family: courier">bundles</span> and <span style="font-family: courier">libraries</span> directories here. Each contains a number of subdirectories to separate the different types of dependencies:<br /><ul><br /> <li><span style="font-family: courier">ext</span> contains external dependencies that are provided with the Platform but are not part of the Platform itself.</li><br /> <li><span style="font-family: courier">subsystems</span> contains all of the subsystems that comprise the Platform.</li><br /> <li><span style="font-family: courier">usr</span> is initially empty and is intended to contain user-added dependencies, i.e. anything upon which your applications depend that is not already provided by the Platform.</li><br /></ul><br />The Platform searches the <span style="font-family: courier">repository</span> directory structure for both bundles and libraries during its initial startup. I&rsquo;ll talk about how this searching can be configured later on in this entry. As bundles and libraries are found within the repository, details of their symbolic names, exported packages etc. are added to an in-memory index of the repository. Upon completing the scan the in-memory indexes are cached to disk. Minimising the Platform&rsquo;s startup time was a priority for us during development. This caching allows the Platform to save some time during startup: it can skip the scan unless it detects that the contents of the repository have changed.<br /><h2>Runtime provisioning</h2><br />In a plain OSGi environment a bundle&rsquo;s dependencies can only be satisfied by other bundles which have already been installed in the environment. For example, installing and starting a bundle that imports the <span style="font-family: courier">org.apache.commons.dbcp</span> package will fail if no bundle which exports that package has already been installed. This can be a real pain for users as they have to manually install all of a bundle&rsquo;s dependencies. Thankfully, the SpringSource Application Platform improves upon this significantly by dynamically installing dependencies on an as-needed basis.</p><p>When a deployed application is started by the Platform its bundles are installed into Equinox. The Platform then asks Equinox for a list of all of the bundles&rsquo; unsatisfied dependencies and tries to satisfy them. Let&rsquo;s analyse this process by walking through a simple example scenario:<br /><ol><br /> <li>A bundle which imports <span style="font-family: courier">org.apache.commons.dbcp</span> is installed by the Platform into Equinox.</li><br /> <li>The Platform asks Equinox for the bundle&rsquo;s unsatisfied dependencies and is told that the import of <span style="font-family: courier">org.apache.commons.dbcp</span> cannot be satisfied.</li><br /> <li>The Platform searches its index of the provisioning repository for a bundle which exports <span style="font-family: courier">org.apache.commons.dbcp</span></li><br /> <li>The Platform installs the bundle which exports <span style="font-family: courier">org.apache.commons.dbcp</span> into Equinox</li><br /> <li>Having satisfied the original bundle&rsquo;s dependencies the Platform successfully starts the original bundle.</li><br /></ol><br />We hope that this will make our users&rsquo; lives much easier: as long as your application&rsquo;s dependencies are available to the Platform you can simply deploy your application and go! There&rsquo;s no need to get your hands dirty with the time consuming process of manually installing all of your application&rsquo;s dependencies. One great thing about this process is that dependencies are only installed when they&rsquo;re needed. You can add as many bundles as you wish to the provisioning repository with almost no impact upon the Platform&rsquo;s memory footprint.</p><p>If the Platform&rsquo;s unable to satisfy a dependency from its repository a log message is generated that details the dependency that could not be satisfied. Armed with this information you can use the <a href="http://www.springsource.com/repository">SpringSource Enterprise Bundle Repository</a> to get hold of what you need. We&rsquo;d like the repository to provide as complete a set of bundles as possible: if there&rsquo;s a dependency that you need and it&rsquo;s not available then please <a href="http://www.springsource.com/repository/app/faq#q9">let us know</a>.<br /><h2>Adding items to the provisioning repository</h2><br />So you&rsquo;ve downloaded a dependency or two and now you want to add them to the Platform. All you need to do is copy them to the appropriate directory in the repository. For example, a new bundle would typically be added to the <span style="font-family: courier">repository/bundles/usr</span> directory and a new library descriptor would typically be added to the <span style="font-family: courier">repository/libraries/usr</span> directory.</p><p>As described above, the Platform uses an in-memory index of its provisioning repository that&rsquo;s populated during startup. In addition to this, the Platform will also check that its view of the repository is up-to-date whenever an application is deployed. When you want to install an application with new dependencies simply copy the dependencies to the appropriate locations in the repository and then deploy your application. During its deployment processing, the Platform will notice that the repository has been updated and will refresh its view of it. This means that you don&rsquo;t need to spend time restarting the Platform every time you want to install an application with new dependencies.<br /><h2>Sharing the provisioning repository between installations</h2><br />The locations where the Platform searches for items in the provisioning repository can be easily configured to suit your needs. For example, it&rsquo;s possible for multiple Platform instances to share some or all of a provisioning repository so you don&rsquo;t need to waste effort maintaining duplicate sets of bundles between Platform installations.</p><p>The locations which are scanned by the Platform when creating its provisioning repository can be configured in the <span style="font-family: courier">config/platform.config</span> file. The default configuration, which is used in the absence of any specific configuration, is:</p>
<pre><code class="prettyprint javascript"><br />&quot;provisioning&quot; : {
    &quot;searchPaths&quot;: [ 
        &quot;repository/bundles/subsystems/{name}/{bundle}.jar&quot;,
        &quot;repository/bundles/ext/{bundle}&quot;,
        &quot;repository/bundles/usr/{bundle}&quot;,
        &quot;repository/libraries/ext/{library}&quot;,
        &quot;repository/libraries/usr/{library}&quot;
    ]
}
</code></pre><p>Any relative paths are interpreted by the Platform as being relative to its installation root, with absolute paths being supported too. The entries in the search paths within curly braces are simply wildcards, e.g. the subsystems search path <span style="font-family: courier">repository/bundles/subsystems/{name}/{bundle}.jar</span> will find any file with a name ending in <span style="font-family: courier">.jar</span> in any of the <span style="font-family: courier">subsystems</span> directory&rsquo;s immediate sub-directories.</p><p>Hopefully you can see that it&rsquo;s a trivial change to share some or all of a provisioning repository between Platforms. For example, to make the Platform search a directory named <span style="font-family: courier">shared-bundles</span> in the root of the filesystem as well as in its own <span style="font-family: courier">subsystems</span> and <span style="font-family: courier">ext</span> directories, all you need to do is add the following snippet of <a href="https://www.json.org">JSON</a> (JavaScript Object Notation) to the <span style="font-family: courier">platform.config</span> file:</p>
<pre><code class="prettyprint javascript"><br />&quot;provisioning&quot; : {
    &quot;searchPaths&quot;: [
        &quot;repository/bundles/subsystems/{name}/{bundle}.jar&quot;,
        &quot;repository/bundles/ext/{bundle}&quot;,
        &quot;/shared-bundles/{bundle}&quot;,
        &quot;repository/libraries/ext/{library}&quot;,
        &quot;repository/libraries/usr/{library}&quot;
    ]
}
</code></pre><p>By configuring two or more Platform installations with this configuration they can be made to share the bundles in <span style="font-family: courier">/shared-bundles</span>. This can easily be taken one step further by configuring all of the search paths to point to shared locations so you wouldn&rsquo;t need to manage a per-Platform provisioning repository at all.<br /><h2>What&rsquo;s next?</h2><br />We&rsquo;re planning to make it simpler to run multiple instances of the Platform from the same set of binaries by providing some tooling or scripts. These will do most of the work for you, providing a sensible default configuration that you can then tweak to meet your specific needs.</p><p>We also intend to combine the power of the Platform&rsquo;s on-demand provisioning and the SpringSource Enterprise Bundle Repository by allowing the Platform to be configured to optionally search a remote repository when it&rsquo;s trying to satisfy a dependency. If a dependency is found in a remote repository the Platform will handle its download and installation automatically. Hopefully this&rsquo;ll make developers&rsquo; lives a lot easier, especially in the initial stages of an application&rsquo;s development as new dependencies are being added on a regular basis.</p><p>We&rsquo;d love to hear your suggestions as we work on the above-described enhancements and the Platform in general: please don&rsquo;t hesitate to comment on this blog entry, <a href="http://issuetracker.springsource.com/secure/CreateIssue!default.jspa">raise a JIRA</a>, or post on our <a href="http://www.springsource.com/beta/applicationplatform/">forums</a>.</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 159;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>