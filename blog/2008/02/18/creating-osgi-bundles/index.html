<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>创建OSGi捆绑包</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Creating OSGi bundles">
<meta name="twitter:description" >
<meta property="og:title" content="Creating OSGi bundles">
<meta property="og:description" >
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2008-02-18 09:46:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">创建OSGi捆绑包</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="null?s=20&d=mm"> <span class="author">Costin Leau</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2008-02-18 09:46:00.0">2008年2月18日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2008/02/18/creating-osgi-bundles#disqus_thread" data-disqus-identifier="136">
</a></div>
</div>
</header>
<div class="blog--post"><p></p><p>在接近OSGi时，必须学习的第一个概念是<em>bundle</em>的概念。在这篇文章中，我想仔细研究一下束实际上是什么以及如何将香草罐子转换成OSGi束。因此，事不宜迟，</p> <h2>什么是捆绑包？</h2> <p>OSGi规范将捆绑包描述为“模块化单元”，“由Java类和其他资源组成，它们可以一起为最终用户提供功能”。到目前为止一切顺利，但是捆绑包<em>到底</em>是什么？再次引用规格：</p> <blockquote> <p>捆绑软件是一个JAR文件，其中：</p> <ul> <li>包含[…]个资源</li> <li>包含清单文件，该文件描述JAR文件的内容并提供有关捆绑软件的信息</li> <li>可以在JAR文件的OSGI-OPT目录或其子目录之一中包含可选文档</li> </ul> </blockquote> <p>简而言之，包= jar + OSGI信息（在JAR清单文件<span style="font-family:courier">-META-INF / MANIFEST.MF中指定</span> ），不需要其他文件或预定义的文件夹布局。这意味着从jar中创建捆绑包所需要做的就是向JAR清单中添加一些条目。</p> <h2>OSGi元数据</h2> <p>OSGi元数据由清单条目表示，清单条目指示OSGi框架提供或提供和/或要求什么。该规范指示大约20个清单标头，但我们只看一下您最可能使用的标头。</p> <h5>出口包装</h5> <p>顾名思义，此标头指示导出了哪些软件包（捆绑软件中可用），以便其他捆绑软件可以导入它们。<em>仅</em>由标头指定的包将被导出，其余的将是私有的，并且在包含包中不会被看到。</p> <h5>进口包装</h5> <p>与<span style="font-family:courier">Export-Package</span>相似，此标头指示捆绑包导入的软件包。同样， <em>仅</em>此标头指定的包将被导入。默认情况下，导入的软件包是强制性的-如果导入的软件包不可用，则导入捆绑包将无法启动。</p>
<h5>Bundle-SymbolicName</h5><p>唯一需要的标头，此条目基于反向域名约定（也由java包使用）为捆绑包指定唯一标识符。</p>
<h5>捆绑名称</h5><p>定义此捆绑包的可读名称，不带空格。建议设置此标头，因为它可以提供比<span style="font-family:courier">Bundle-SymbolicName</span>更短，更有意义的有关包内容的信息。</p>
<h5>束激活剂</h5><p><span style="font-family:courier"><a href="http://www.osgi.org/javadoc/r4/org/osgi/framework/BundleActivator.html">BundleActivator</a></span>是OSGi特定的接口，当OSGi框架启动或停止分发包时，该接口允许通知Java代码。此标头的值应包含激活程序类的完全限定名称，该名称应该是公共的，并且包含不带任何参数的公共构造函数。</p>
<h5>捆绑类路径</h5><p>当jar通过扩展默认的bundle类路径（希望这些类直接在jar根目录下可用）在各种文件夹下包含嵌入式库或类包时，此头很方便。</p>
<h5>Bundle-ManifestVersion</h5><p>这个鲜为人知的标头指示用于读取此捆绑包的OSGi规范。 <span style="font-family:courier">1</span>表示OSGi版本3，而<span style="font-family:courier">2表示</span> OSGi版本4及更高版本。由于默认版本为<span style="font-family:courier">1</span> ，因此强烈建议指定此标头，因为OSGi版本4捆绑软件在OSGi版本3下无法按预期工作。</p><p>下面是一个示例，摘自Spring 2.5.x核心软件包清单，该清单使用了上面提到的一些标头：</p>
<pre><code class="prettyprint code"><br />Bundle-Name: spring-core 
Bundle-SymbolicName: org.springframework.bundle.spring.core 
Bundle-ManifestVersion: 2 
Export-Package:org.springframework.core.task;uses:=&quot;org.springframework.core,org.springframework.util&quot;;version=2.5.1 org.springframework.core.type;uses:=org.springframework.core.annotation;version=2.5.1[...] 
Import-Package:org.apache.commons.logging,edu.emory.mathcs.backport.java.util.concurrent;resolution:=optional[...] 
</code></pre><p></p><p>OSGi元数据上使用的大多数时间都可能花费在“导出/导入”软件包条目上，因为它们描述了包之间（即模块之间）的关系。当涉及到软件包时，没有什么隐含的-仅导入/导出提到的软件包，其余的则不是。这也适用于子包：出口<span style="font-family:courier">org.mypackage</span>将<strong>只是</strong>这个包，并没有别的（如<span style="font-family:courier">org.mypackage.util）</span>出口。导入也是如此-即使OSGi空间内部有可用的软件包，除非捆绑软件明确地将其导入，否则该软件包将不会被特定的捆绑包看到。</p> <p>总而言之，如果捆绑软件A出口软件包org.mypackage和捆绑软件B要使用它，那么捆绑软件A的<span style="font-family:courier">META-INF / MANIFEST.MF</span>应该在其<span style="font-family:courier">Export-Package</span>标头中指定该软件包，而捆绑软件B应该将其包含在其中。其<span style="font-family:courier">导入包</span>条目。</p> <h2>包装注意事项</h2> <p>尽管导出是相当简单的，但是导入则稍微复杂一些。通常，通过在环境中搜索某些库并仅使用可用的库，或者库中包含用户未使用的代码，应用程序的性能会下降。这样的示例包括日志记录（使用JDK 1.4或Log4j），正则表达式（ <a href="https://jakarta.apache.org/oro/">Jakarta ORO</a>或JDK 1.4+）或并发实用程序（JDK 5中的java.util或JDK 1.4的<a href="http://backport-jsr166.sourceforge.net/">backport-util-concurrent</a>库）。</p> <p>用OSGi术语来说，依赖于基于其可用性的程序包可以转换为<em>可选的</em>程序包导入。在前面的示例中，您已经看到了这样的软件包：</p><br><code>code Import-Package: [...]edu.emory.mathcs.backport.java.util.concurrent;resolution:=optional</code><p></p><p></p><p>由于在OSGi中可以存在同一类的多个版本，因此最佳做法是在导出和导入包时都指定类包的版本。这是通过在每个包声明之后添加的<span style="font-family:courier">version</span>属性来完成的。OSGi支持的版本格式为<major>。 <minor>。 <micro>。 <qualifier>其中<span style="font-family:courier">major</span> ， <span style="font-family:courier">minor</span>和<span style="font-family:courier">micro</span>是数字，而<span style="font-family:courier">限定词</span>是字母数字。</qualifier></micro></minor></major></p> <p>该<a href="https://en.wikipedia.org/wiki/Version_numbering">版本的意义</a>是完全由然而捆供应商，它是推荐使用流行的编号方案，如<a href="https://apr.apache.org/versioning.html">一个</a>来自Apache的APR项目，其中：</p> <ul> <li><major>-表示重大更新，不保证任何兼容性</major></li> <li><minor>-表示保留与较早的次要版本兼容的更新</minor></li> <li><micro>-从用户的角度来看是微不足道的更新，向前和向后完全兼容</micro></li> <li><qualifier>-是用户定义的字符串-未被广泛使用，并且可以为版本号提供附加标签，例如内部版本号或目标平台，而没有标准化的含义</qualifier></li> </ul> <p>默认版本（如果缺少属性）是“ 0.0.0”。</p> <p>虽然导出的软件包必须指示特定版本，但是进口商可以使用数学间隔符号来指示范围-例如</p> <p><span style="font-family:courier">[</span> 1.0.4，2.0 <span style="font-family:courier">）</span>将与版本1.0.42及更高版本匹配（不包括2.0）。请注意，仅指定一个版本而不是一个间隔将匹配所有大于或等于指定版本的软件包，即：</p> <p><span style="font-family:courier">导入包：com.mypackage; version =“ 1.2.3”</span></p> <p>相当于</p> <p><span style="font-family:courier">导入包：com.mypackage; version =“ [1.2.3，∞）”</span></p> <p>最后一点，请确保在指定版本时<em>始终</em>使用引号，无论它是否是范围。</p> <h2>使用OSGi元数据</h2> <p>现在我们已经有了关于捆绑包的一些信息，让我们看看我们可以使用什么工具对现有的jar进行osgi-fying：</p> <h3>用手</h3> <p>不建议您自己动手做这种方法，因为错别字和多余的空间很容易潜入并且使清单无效。即使在使用智能编辑器时，清单格式本身也会引起一些问题，因为它每行最多有72个空格，如果损坏，则可能导致一些神秘的问题。手动创建或更新jar并不是一个好主意，因为jar格式要求META-INF / MANIFEST.MF条目是存档中的第一个条目-如果不是，即使它存在于jar中，清单文件也会不被阅读。对于没有其他替代方法的情况，确实建议使用手动方法。</p> <p>但是，如果确实希望/需要直接使用清单，则应使用可以处理UNIX / DOS空间的编辑器以及适当的jar创建实用程序（例如JDK附带的jar工具）来应对。符合所有清单要求。</p> <h3>邦德</h3> <p><a href="http://www.aqute.biz/Code/Bnd">Bnd</a>代表BuNDle工具，是Peter Kriens（OSGi技术官）创建的一个不错的实用程序，“可[...]帮助创建和诊断OSGi R4软件包”。Bnd解析Java类以了解可用的包和导入的包，以便它可以创建等效的OSGi条目。Bnd提供了一系列指令和选项，可以自定义结果工件。关于bnd.jar本身的好处是可以从运行<a href="http://www.aqute.biz/Code/Bnd#cmd">命令行</a>通过专用，使用Ant <a href="http://www.aqute.biz/Code/Bnd#ant">任务</a>或集成到Eclipse的<a href="http://www.aqute.biz/Code/Bnd#eclipse">插件</a> 。</p> <p>Bnd可以使用classpath或Eclipse项目中可用的类创建jar，也可以通过添加所需的OSGi工件来对现有jar进行OSGI-FY。此外，它可以打印和验证有关给定jar的OSGi信息，从而使其成为功能强大且易于使用的工具。</p> <p>初次使用的用户可以使用Bnd查看将哪些OSGi清单添加到香草罐中。让我们选择一个像<a href="https://sourceforge.net/projects/c3p0">c3p0</a>这样的香草罐（这是一个出色的连接池库）并发出打印命令：</p> <p><br><code>code java -jar bnd.jar print c3p0-0.9.1.2.jar</code><br></p> <p>输出相当大，包含几个部分：</p> <ol> <li>通用清单信息：<p></p>
<pre><code class="prettyprint code">[MANIFEST c3p0-0.9.1.2.jar]
Ant-Version Apache Ant 1.7.0
Created-By 1.5.0_07-87 (&quot;Apple Computer, Inc.&quot;)
Extension-Name com.mchange.v2.c3p0
Implementation-Vendor Machinery For Change, Inc.
Implementation-Vendor-Id com.mchange
Implementation-Version 0.9.1.2
Manifest-Version 1.0
Specification-Vendor Machinery For Change, Inc.
Specification-Version 1.0
</code></pre><p></p></li><br><li>包装信息：<p></p>
<pre><code class="prettyprint java"><br />com.mchange.v2.c3p0.management   com.mchange.v1.lang com.mchange.v2.c3p0
                                                               com.mchange.v2.c3p0.impl com.mchange.v2.debug
                                                               com.mchange.v2.log com.mchange.v2.management
                                                               java.sql
                                                               javax.management
                                                               javax.sql
</code></pre><p>它指示指定在jar中发现的软件包（在左侧）及其导入（在右侧）。<br></p></li><br><li>可能的错误-通常这些错误指示在类路径中未找到但被其他类引用的软件包：<p></p>
<pre><code class="prettyprint code"> One error 1 : Unresolved references to 
[javax.management, javax.naming, javax.naming.spi, javax.sql, javax.xml.parsers, org.apache.log4j, org.w3c.dom] 
by class(es) on the Bundle-Classpath[Jar:c3p0-0.9.1.2.jar]: [...] 
</code></pre><p>。<br>本节很好地说明了给定jar导入的软件包。</p></li> </ol> <p>让我们通过使用OSGify工件</p> <p><br><code>code java -jar bnd.jar wrap c3p0-0.9.1.2.jar</code><br></p> <p>这将创建一个新存档，其内容与原始jar完全相同，但修改后的<span style="font-family:courier">MANIFEST.MF</span>将包含标记为可选的OSGi导入。当前的Bnd工具以<span style="font-family:courier">.jar $</span>扩展名保存存档，而以前的版本则使用<span style="font-family:courier">.bar</span> 。</p> <p>我们可能选择通过添加版本控制来调整jar，排除某些导出的软件包并将某些导入的软件包标记为强制性（在这种情况下，例如<span style="font-family:courier">javax.sql</span> ）。为此，我们将创建一个c3p0-0.9.1.2.bnd文件，如下所示：</p> <p></p>
<pre><code class="prettyprint code">version=0.9.1.2
Export-Package: com.mchange*;version=${version}
Import-Package: java.sql*,javax.sql*,*;resolution:=optional
Bundle-Version: ${version}
Bundle-Description: c3p0 connection pool
Bundle-Name: c3p0
</code></pre><p></p><p>注意，对于版本，我们使用了变量替换。要挂接属性文件，请使用以下命令行：</p> <p><br><code>code java -jar bnd.jar wrap -properties c3p0-0.9.1.2.bnd c3p0-0.9.1.2.jar</code><br></p> <p>我使用了.bnd扩展名，因为默认情况下，Bnd ant任务将在执行过程中查找该文件。</p> <p>要将Bnd工具与ant结合使用，您可以直接导入提供的任务并在jar创建过程中调用它们：</p> <p></p>
<pre><code class="prettyprint xml"><br />&lt;taskdef resource=&quot;aQute/bnd/ant/taskdef.properties&quot; classpath=&quot;${lib.dir}/bnd/bnd.jar&quot;/&gt;
...
&lt;bndwrap definitions=&quot;${basedir}/osgi/bnd&quot; output=&quot;${dist.dir}&quot;&gt;
   &lt;fileset dir=&quot;${dist.dir}&quot; includes=&quot;*.jar&quot;/&gt;    
&lt;/bndwrap&gt;
</code></pre><p></p> <p>请注意，通常会执行移动任务，将.jar $或.bar工件复制到原始jar上。</p> <h3>适用于Maven的捆绑插件</h3> <p>对于Maven， <a href="https://felix.apache.org/site/maven-bundle-plugin-bnd.html">Apache Felix Bundle插件</a>在Bnd和Maven 2之间提供了很好的集成。由于Maven POM包含有关项目的其他信息，因此Bnd插件可以使用项目属性自动填充清单的其他字段，例如Bundle-License或Bundle-Version。</p> <p>官方<a href="https://felix.apache.org/site/maven-bundle-plugin-bnd.html">文档</a>详细解释了用法，因此在此不再赘述。</p> <p>要转换我们的c3p0库，我将使用一个简单的Maven 2 pom，它将下载原始工件，然后将其打包为一个捆绑包：</p> <p></p>
<pre><code class="prettyprint xml"><br />&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project
        xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
        xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;

    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;my.company&lt;/groupId&gt;
    &lt;artifactId&gt;c3p0.osgi&lt;/artifactId&gt;
    &lt;packaging&gt;bundle&lt;/packaging&gt;
    &lt;version&gt;0.9.1.2-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;c3p0.osgi&lt;/name&gt;

    &lt;properties&gt;
        &lt;export.packages&gt;${export.package}*;version=${unpack.version}&lt;/export.packages&gt;
        &lt;import.packages&gt;*&lt;/import.packages&gt;
        &lt;private.packages&gt;!*&lt;/private.packages&gt;
        &lt;symbolic.name&gt;${pom.groupId}.${pom.artifactId}&lt;/symbolic.name&gt;
        &lt;embed-dep&gt;*;scope=provided;type=!pom;inline=true&lt;/embed-dep&gt;
        &lt;unpack-bundle&gt;false&lt;/unpack-bundle&gt;
    &lt;/properties&gt;

    &lt;build&gt;
    &lt;plugins&gt;
     &lt;plugin&gt;
        &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
        &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.2.0&lt;/version&gt;
        &lt;configuration&gt;
            &lt;unpackBundle&gt;${unpack.bundle}&lt;/unpackBundle&gt;
            &lt;instructions&gt;
                &lt;Bundle-Name&gt;${artifactId}&lt;/Bundle-Name&gt;
                &lt;Bundle-SymbolicName&gt;${symbolic.name}&lt;/Bundle-SymbolicName&gt;
                &lt;Bundle-Description&gt;${pom.name}&lt;/Bundle-Description&gt;
                &lt;Import-Package&gt;${import.packages}&lt;/Import-Package&gt;
                &lt;Private-Package&gt;${private.packages}&lt;/Private-Package&gt;
                &lt;Include-Resource&gt;${include.resources}&lt;/Include-Resource&gt;
                &lt;Embed-Dependency&gt;${embed-dep}&lt;/Embed-Dependency&gt;
                &lt;_exportcontents&gt;${export.packages}&lt;/_exportcontents&gt;
            &lt;/instructions&gt;
        &lt;/configuration&gt;
        &lt;extensions&gt;true&lt;/extensions&gt;
     &lt;/plugin&gt;
    &lt;/plugins&gt;
    &lt;/build&gt;

    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;c3p0&lt;/groupId&gt;
        &lt;artifactId&gt;c3p0&lt;/artifactId&gt;
        &lt;version&gt;0.9.1.2&lt;/version&gt;
        &lt;scope&gt;provided&lt;/scope&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre><p></p> <p>打包该项目将创建一个OSGi包，其内容与包含OSGi条目的MANIFEST.MF的原始期望相同。</p> <p>请注意属性用于外部化插件配置的用法。当在模块中使用多个项目时，这些属性允许将通用插件配置放置在顶级pom内，并且每个子模块可以通过指定不同的属性值来覆盖它。Spring-DM osgi存储库就是这种设置的生动<a href="https://springframework.svn.sourceforge.net/svnroot/springframework/osgi-repo/trunk">示例</a> 。</p> <p>重要的是要知道Bnd在创建捆绑包时会考虑classpath上所有可用的类。从命令行使用Bnd时，如上例所示，类路径仅由jar组成，因此除c3p0之外没有其他类。但是，当使用诸如Maven或Ant之类的构建工具时，类路径要大得多-在这种情况下，根据您的Export / Import包指令，Bnd可能会从生成的jar中添加或丢弃类。为避免这种情况，请确保使用仅与实际包含的软件包匹配的模式，即：com.mchange。*而非*。</p> <h3>定制的内部工具</h3> <p>尽管不太可能遇到，但另一种方法是通常基于字节码分析来创建自定义工具。可以针对某些环境高度定制此类实用程序，以提高速度或最小化内存打印，或支持其他启发式或配置文件。Spring Dynamic Modules在其测试框架中包含这样一个基于<a href="http://asm.objectweb.org/">ASM</a>的内部字节码解析器，以有效地创建动态MANIFEST.MF。</p> <p>但是对于一般用途，Bnd工具（无论是Vanilla还是通过其Maven集成）提供了更多选项，并且运行速度非常快。实际上，使用的范围越广，Bnd通过其高度可定制性来适应账单的可能性就越大。</p><h2>使用现有的OSGi存储库</h2> <p>这就是说，在将现有库包装为OSGi捆绑包之前，请检查是否有人已经为您完成了此工作。您可以通过检查现有的OSGi存储库之一来做到这一点：</p> <p><a href="http://www.osgi.org/Repository/HomePage">OSGi捆绑软件存储库（ORB）</a> -OSGi联盟捆绑软件存储库，提供“联合的捆绑软件集合”。</p> <p><a href="https://www.eclipse.org/orbit/">Eclipse Orbit-</a>包含可在Eclipse环境中使用的工件。由于Eclipse使用Equinox，因此工件可能包含特定于Equinox的清单条目</p> <p><a href="https://felix.apache.org/site/apache-felix-commons.html">Apache Felix</a> Commons-旨在“共享[…]捆绑的工件”</p> <p><a href="https://wiki.apache.org/commons/CommonsOsgi">Apache OSGified项目</a> -一个简单的页面，指示已经或将要在其正式发行版中包含OSGi清单条目的Apache Commons项目。</p> <p>希望在社区的帮助下，默认情况下，许多受欢迎的Java库将对OSGi友好，并且不需要使用单独的存储库或包装jar。在此之前，您可以通过为使用的项目提供补丁程序或仅要求此功能来提供帮助。</p> <p>在结束这篇文章之前，我想邀请所有对OSGi和Spring动态模块感兴趣的人参加下周（2月27 <sup>日</sup>星期三）的<a href="http://www.springsource.com/web/guest/webinars">网络研讨会</a> ，其中将涵盖OSGi的核心概念和Spring DM基础。</p><p></p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 136;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>