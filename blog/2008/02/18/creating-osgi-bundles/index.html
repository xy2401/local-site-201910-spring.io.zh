<!DOCTYPE html>
<html data-code-prettify="" data-mobile-support="" data-search="">
<head>
<title>Creating OSGi bundles</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no" id="Viewport" name="viewport" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png" />
<link href="https://fonts.googleapis.com/css?family=Varela+Round|Montserrat:400,700" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css" />
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M" name="google-site-verification" />

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css" />

<meta content="summary" name="twitter:card" />
<meta content="@springcentral" name="twitter:site" />
<meta name="twitter:title" content="Creating OSGi bundles" />
<meta name="twitter:description" content="&lt;p&gt;&lt;/p&gt;
&lt;p&gt;When approaching OSGi, one of the first concepts that have to be learned is the notion of a &lt;em&gt;bundle&lt;/em&gt;. In this entry, I’d like to take a closer look of what a bundle actually is and how a vanilla jar can be transformed into an OSGi bundle.&amp;nbsp; So, without further ado,&lt;/p&gt;
&lt;h2&gt;What is a bundle?&lt;/h2&gt;
&lt;p&gt;The OSGi spec describes the bundle as a &quot;unit of modularization&quot; that &quot;is comprised of Java classes and other resources which together can provide functions to end users.&quot;. So far so good, but what &lt;em&gt;exactly&lt;/em&gt; is a bundle? Quoting the spec again:&lt;/p&gt;
" />

<meta property="og:title" content="Creating OSGi bundles" />
<meta property="og:description" content="&lt;p&gt;&lt;/p&gt;
&lt;p&gt;When approaching OSGi, one of the first concepts that have to be learned is the notion of a &lt;em&gt;bundle&lt;/em&gt;. In this entry, I’d like to take a closer look of what a bundle actually is and how a vanilla jar can be transformed into an OSGi bundle.&amp;nbsp; So, without further ado,&lt;/p&gt;
&lt;h2&gt;What is a bundle?&lt;/h2&gt;
&lt;p&gt;The OSGi spec describes the bundle as a &quot;unit of modularization&quot; that &quot;is comprised of Java classes and other resources which together can provide functions to end users.&quot;. So far so good, but what &lt;em&gt;exactly&lt;/em&gt; is a bundle? Quoting the spec again:&lt;/p&gt;
" />
<meta content="article" property="og:type" />
<meta property="og:article:published_time" content="2008-02-18 09:46:00.0" />
</head>
<body>

<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" style="display:none;visibility:hidden" width="0"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">Projects</a>
</li>
<li class="navbar-link">
<a href="/guides">Guides</a>
</li>
<li class="navbar-link active">
<a href="/blog">Blog</a>
</li>
<li class="navbar-link">
<a href="/services">Training & Certification</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form action="/search" class="form-inline form-search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search for documentation, guides, and posts..." type="text" value="" />
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form action="/search" class="form-inline form-search" method="get">
<button class="search-form--submit" type="submit"><i class="icon-search"></i></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="Search..." type="text" value="" />
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">
Home
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">
Projects
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">
Guides
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">
Blog
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">
Training & Certification
<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>Engineering</div>
</div>
<div class="blog-category content--title">
<div>Releases</div>
</div>
<div class="blog-category content--title">
<div>News and Events</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Creating OSGi bundles</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">Engineering</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="null?s=20&amp;d=mm" />
<span class="author">Costin Leau</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2008-02-18 09:46:00.0">February 18, 2008</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" data-disqus-identifier="136" href="/blog/2008/02/18/creating-osgi-bundles#disqus_thread">
</a></div>
</div>
</header>
<div class="blog--post"><p><p>When approaching OSGi, one of the first concepts that have to be learned is the notion of a <em>bundle</em>. In this entry, I&rsquo;d like to take a closer look of what a bundle actually is and how a vanilla jar can be transformed into an OSGi bundle.&#160; So, without further ado,</p> <h2>What is a bundle?</h2> <p>The OSGi spec describes the bundle as a &quot;unit of modularization&quot; that &quot;is comprised of Java classes and other resources which together can provide functions to end users.&quot;. So far so good, but what <em>exactly</em> is a bundle? Quoting the spec again:</p> <blockquote> <p>a bundle is a JAR file that:</p> <ul> <li>Contains [&hellip;] resources </li> <li>Contains a manifest file describing the contents of the JAR file and providing information about the bundle </li> <li>Can contain optional documentation in the OSGI-OPT directory of the JAR file or one of its sub-directories </li> </ul> </blockquote> <p>In short, a bundle = jar + OSGI information (specified in the JAR manifest file - <span style="font-family: courier">META-INF/MANIFEST.MF</span>), no extra files or predefined folder layout are required. This means that all it takes to create a bundle from a jar, is to add some entries to the JAR manifest.</p> <h2>OSGi metadata</h2> <p>The OSGi metadata is represented by manifest entries that dictate to the OSGi framework what the bundle provides or/and requires. The specification indicates around 20 manifest headers but we will just take a look at the ones you are most likely to use.</p> <h5>Export-Package</h5> <p>As the name implies, this header indicates what packages (available in the bundle) are exported so they can be imported by other bundles. <em>Only</em> the packages specified by the header will be exported, the rest will be private and will not be seen outside the containing bundle.</p> <h5>Import-Package</h5> <p>Similar to <span style="font-family: courier">Export-Package</span>, this header indicates the packages that are imported by a bundle. As well, <em>only</em> the packages specified by this header will be imported. By default, imported packages are mandatory - the importing bundle will fail to start, if the imported package is not available.</p>
<h5>Bundle-SymbolicName</h5><p>The only required header, this entry specifies a unique identifier for a bundle, based on the reverse domain name convention (used also by the java packages).</p>
<h5>Bundle-Name</h5><p>Defines a human-readable name, without spaces, for this bundle. Setting this header is recommend since it can provide a shorter, more meaningful information about the bundle content then <span style="font-family: courier">Bundle-SymbolicName</span>.</p>
<h5>Bundle-Activator</h5><p>The <span style="font-family: courier"><a href="http://www.osgi.org/javadoc/r4/org/osgi/framework/BundleActivator.html">BundleActivator</a></span> is an OSGi specific interface that allows Java code to be notified when a bundle is started or stopped by the OSGi framework. The value of this header should contain a fully qualified name of the activator class which should be public and contain a public constructor without any arguments.</p>
<h5>Bundle-Classpath</h5><p>This header is handy when the jar contains embedded libraries or class packages under various folders, by extending the default bundle classpath (which expects the classes to be available directly under the jar root).</p>
<h5>Bundle-ManifestVersion</h5><p>This little known header indicates the OSGi specification to use for reading this bundle. <span style="font-family: courier">1</span> indicates OSGi release 3 while <span style="font-family: courier">2</span> OSGi release 4 and later. Since <span style="font-family: courier">1</span> is the default version, it is strongly recommended to specify this header since an OSGi release 4 bundle will not work as expected under OSGi release 3.</p><p>Below is an example, taken from Spring 2.5.x core bundle manifest that uses some of the headers mentioned above:</p>
<pre><code class="prettyprint code"><br />Bundle-Name: spring-core 
Bundle-SymbolicName: org.springframework.bundle.spring.core 
Bundle-ManifestVersion: 2 
Export-Package:org.springframework.core.task;uses:=&quot;org.springframework.core,org.springframework.util&quot;;version=2.5.1 org.springframework.core.type;uses:=org.springframework.core.annotation;version=2.5.1[...] 
Import-Package:org.apache.commons.logging,edu.emory.mathcs.backport.java.util.concurrent;resolution:=optional[...] 
</code></pre><p><p>Most of the time used on OSGi metadata is likely to be spent on Export/Import package entries as they describe the relationship between bundles (that is, between your modules). When it comes to packages, nothing is implicit - only packages that are mentioned are imported/exported, the rest aren&rsquo;t. This applies also to sub-packages: exporting <span style="font-family: courier">org.mypackage</span> will export <strong>just</strong> this package and nothing else (like <span style="font-family: courier">org.mypackage.util</span>). Same goes for importing - even if a package is available inside the OSGi space, it will not be seen by a certain bundle unless it is explicitly imported by it.</p> <p>To summarize, if a bundle A exports package org.mypackage and bundle B wants to consume it, then the <span style="font-family: courier">META-INF/MANIFEST.MF</span> for bundle A should specify the package inside its <span style="font-family: courier">Export-Package</span> header, while bundle B should include it in its <span style="font-family: courier">Import-Package</span> entry.</p> <h2>Package consideration</h2> <p>While exporting is fairly straight forward, importing is slightly more complex. It is common for applications to degrade nicely by searching the environment for certain libraries and using only what is available, or for libraries to include code that is not used by the user. Such examples include logging (using JDK 1.4 or Log4j), regular expressions (<a href="https://jakarta.apache.org/oro/">Jakarta ORO</a> or JDK 1.4+) or concurrent utilities (java.util in JDK 5 or <a href="http://backport-jsr166.sourceforge.net/">backport-util-concurrent</a> library for JDK 1.4).</p> <p>In OSGi terms, relying on a package based on its availability translates to an <em>optional</em> Package-Import. You have already seen such a package in the previous example:</p><br /><code>code
Import-Package: [...]edu.emory.mathcs.backport.java.util.concurrent;resolution:=optional
</code></p><p><p>Since in OSGi, multiple versions of the same class can exist, it is best practice to specify the version of the class package both when exporting and importing a package. This is done through the <span style="font-family: courier">version</span> attribute which is added after each package declaration. The version format supported by OSGi is &lt;major&gt;.&lt;minor&gt;.&lt;micro&gt;.&lt;qualifier&gt; where <span style="font-family: courier">major</span>, <span style="font-family: courier">minor</span> and <span style="font-family: courier">micro</span> are numbers and <span style="font-family: courier">qualifier</span> is alphanumeric.</p> <p>The <a href="https://en.wikipedia.org/wiki/Version_numbering">meaning of the version</a> is completely up to the bundle provider however, it is recommend to use a popular numbering scheme such as the <a href="https://apr.apache.org/versioning.html">one</a> from Apache APR project where:</p> <ul> <li>&lt;major&gt; - indicates a significant update which doesn&rsquo;t guarantee any compatibility </li> <li>&lt;minor&gt; - indicates an update which preserves compatibility with older minor versions</li> <li>&lt;micro&gt; - represents an insignificant update from the user point of view which is perfectly compatible both forwards and backwards</li> <li>&lt;qualifier&gt; - is a user defined string - it is not widely used and can provide an additional label to the version number, such as the build number or target platform without a standardized meaning </li> </ul> <p>The default version (if the attribute is missing) is &quot;0.0.0&quot;.</p> <p>While the exported packages have to indicate a specific version, the importers can indicate a range using the mathematical interval notation - for example</p> <p><span style="font-family: courier">[1.0.4, 2.0)</span> will match version 1.0.42 and upwards up to 2.0 (excluding). Note that an specifying only a version instead of an interval will match all packages that are at greater or equal then the specified version, that is :</p> <p><span style="font-family: courier">Import-Package: com.mypackage;version=&quot;1.2.3&quot;</span></p> <p>is equivalent to</p> <p><span style="font-family: courier">Import-Package: com.mypackage;version=&quot;[1.2.3, &#8734;)&quot;</span></p> <p>As a last tip, make sure to <em>always</em> use quotes when specifying an version, whether it is a range or not.</p> <h2>Working with OSGi metadata</h2> <p>Now that we have some information on what bundles are, let&rsquo;s see what tools we can use for osgi-fying an existing jar:</p> <h3>by hand</h3> <p>This do-it-yourself approach is discouraged as typos and extra spaces can easily sneak in and render the manifest useless. Even when working with a smart editor, the manifest format itself can cause some problems since it has a limit of 72 spaces per line which, if broken, can cause some cryptic problems. Manually creating or updating the jar is not a good idea since the jar format requires the META-INF/MANIFEST.MF entry to be the first one in the archive - if it&rsquo;s not, even though it&rsquo;s present in the jar, the manifest file will not be read. The manual approach is really recommended for cases where there are no other alternatives.</p> <p>However, if one really wants/needs to work directly with the manifest, then a editor that can deal with UNIX/DOS spaces should be used along with a proper jar creation utility (such as the jar tool that comes with the JDK) to cope with all the MANIFEST requirements.</p> <h3>Bnd</h3> <p><a href="http://www.aqute.biz/Code/Bnd">Bnd</a> stands for BuNDle tool and is a nice utility created by Peter Kriens (OSGi Technical Officer) that &quot;helps [&hellip;] create and diagnose OSGi R4 bundles&quot;. Bnd parses the java classes to understand the available and imported packages so it can create the equivalent OSGi entries. Bnd offers a series of directives and options which can customize the resulting artifact. The nice thing about bnd.jar itself is that is can be run from <a href="http://www.aqute.biz/Code/Bnd#cmd">command line</a>, by Ant through dedicated <a href="http://www.aqute.biz/Code/Bnd#ant">tasks</a> or integrated into Eclipse as a <a href="http://www.aqute.biz/Code/Bnd#eclipse">plug-in</a>.</p> <p>Bnd can create jars from the classes available on the classpath or inside Eclipse projects or can osgi-fy existing jars by adding the needed OSGi artifacts. Additionally, it can print and verify the OSGi information about the given jar making it quite a powerful, yet simple to use tool.</p> <p>First time users, can use Bnd to see what OSGi manifest will be added to a vanilla jar. Let&rsquo;s pick a vanilla jar such as <a href="https://sourceforge.net/projects/c3p0">c3p0</a> (which is an excellent connection pool library) and issue a print command:</p> <p><br /><code>code
java -jar bnd.jar print c3p0-0.9.1.2.jar
</code><br /></p> <p>The output is fairly big and contains of several sections:</p> <ol> <li>Generic manifest information: </p>
<pre><code class="prettyprint code">[MANIFEST c3p0-0.9.1.2.jar]
Ant-Version Apache Ant 1.7.0
Created-By 1.5.0_07-87 (&quot;Apple Computer, Inc.&quot;)
Extension-Name com.mchange.v2.c3p0
Implementation-Vendor Machinery For Change, Inc.
Implementation-Vendor-Id com.mchange
Implementation-Version 0.9.1.2
Manifest-Version 1.0
Specification-Vendor Machinery For Change, Inc.
Specification-Version 1.0
</code></pre><p></li><br /><li>Package Information:</p>
<pre><code class="prettyprint java"><br />com.mchange.v2.c3p0.management   com.mchange.v1.lang com.mchange.v2.c3p0
                                                               com.mchange.v2.c3p0.impl com.mchange.v2.debug
                                                               com.mchange.v2.log com.mchange.v2.management
                                                               java.sql
                                                               javax.management
                                                               javax.sql
</code></pre><p>which indicates specifies the packages discovered in the jar (on the left side) and its imports (on the right side).<br /></li><br /><li>Possible Errors - normally these indicate the packages that were not found in the classpath but were referenced by other classes: </p>
<pre><code class="prettyprint code"> One error 1 : Unresolved references to 
[javax.management, javax.naming, javax.naming.spi, javax.sql, javax.xml.parsers, org.apache.log4j, org.w3c.dom] 
by class(es) on the Bundle-Classpath[Jar:c3p0-0.9.1.2.jar]: [...] 
</code></pre><p>.<br />This section is a good indication on what packages the given jar imports.</li> </ol> <p>Let&rsquo;s OSGify the artifact by using</p> <p><br /><code>code
java -jar bnd.jar wrap c3p0-0.9.1.2.jar
</code><br /></p> <p>this will create a new archive with the exact content as the original jar but with a modified <span style="font-family: courier">MANIFEST.MF</span> that will contain the OSGi imports marked as optional. The current Bnd tool saves the archive with a <span style="font-family: courier">.jar$</span> extension while previous versions used <span style="font-family: courier">.bar</span> instead.</p> <p>We might chose to tweak the jar by adding versioning, excluding some exported packages and marking some imported packages as mandatory (such as <span style="font-family: courier">javax.sql</span> in this case). To do that, we&rsquo;ll create a c3p0-0.9.1.2.bnd file as follows:</p> <p></p>
<pre><code class="prettyprint code">version=0.9.1.2
Export-Package: com.mchange*;version=${version}
Import-Package: java.sql*,javax.sql*,*;resolution:=optional
Bundle-Version: ${version}
Bundle-Description: c3p0 connection pool
Bundle-Name: c3p0
</code></pre><p><p>Notice that for version we used variable substitution. To hook in the properties file, use the following command line:</p> <p><br /><code>code
java -jar bnd.jar wrap -properties c3p0-0.9.1.2.bnd c3p0-0.9.1.2.jar
</code><br /></p> <p>I&rsquo;ve used the .bnd extension since by default, the Bnd ant tasks will look for this file during execution.</p> <p>To use Bnd tool with ant, one can just import the tasks provided out-of-the-box and invoke them during jar creation:</p> <p></p>
<pre><code class="prettyprint xml"><br />&lt;taskdef resource=&quot;aQute/bnd/ant/taskdef.properties&quot; classpath=&quot;${lib.dir}/bnd/bnd.jar&quot;/&gt;
...
&lt;bndwrap definitions=&quot;${basedir}/osgi/bnd&quot; output=&quot;${dist.dir}&quot;&gt;
   &lt;fileset dir=&quot;${dist.dir}&quot; includes=&quot;*.jar&quot;/&gt;    
&lt;/bndwrap&gt;
</code></pre><p></p> <p>Note that usually, a move task follows to copy the .jar$ or .bar artifact over the original jar.</p> <h3>Bundle plug-in for Maven</h3> <p>For Maven, <a href="https://felix.apache.org/site/maven-bundle-plugin-bnd.html">Apache Felix Bundle Plug-in</a> provides nice integration between Bnd and Maven 2. Since the Maven POM contains additional information about the project, the Bnd plug-in can populate other fields of the manifest automatically, such as Bundle-License or Bundle-Version, using the the project properties.</p> <p>The official <a href="https://felix.apache.org/site/maven-bundle-plugin-bnd.html">documentation</a> explains the usage in detail so I will not replicate it here.</p> <p>To convert our c3p0 library, I will use a simple Maven 2 pom which will download the original artifact and then wrap it as a bundle:</p> <p></p>
<pre><code class="prettyprint xml"><br />&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project
        xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
        xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;

    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;my.company&lt;/groupId&gt;
    &lt;artifactId&gt;c3p0.osgi&lt;/artifactId&gt;
    &lt;packaging&gt;bundle&lt;/packaging&gt;
    &lt;version&gt;0.9.1.2-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;c3p0.osgi&lt;/name&gt;

    &lt;properties&gt;
        &lt;export.packages&gt;${export.package}*;version=${unpack.version}&lt;/export.packages&gt;
        &lt;import.packages&gt;*&lt;/import.packages&gt;
        &lt;private.packages&gt;!*&lt;/private.packages&gt;
        &lt;symbolic.name&gt;${pom.groupId}.${pom.artifactId}&lt;/symbolic.name&gt;
        &lt;embed-dep&gt;*;scope=provided;type=!pom;inline=true&lt;/embed-dep&gt;
        &lt;unpack-bundle&gt;false&lt;/unpack-bundle&gt;
    &lt;/properties&gt;

    &lt;build&gt;
    &lt;plugins&gt;
     &lt;plugin&gt;
        &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
        &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.2.0&lt;/version&gt;
        &lt;configuration&gt;
            &lt;unpackBundle&gt;${unpack.bundle}&lt;/unpackBundle&gt;
            &lt;instructions&gt;
                &lt;Bundle-Name&gt;${artifactId}&lt;/Bundle-Name&gt;
                &lt;Bundle-SymbolicName&gt;${symbolic.name}&lt;/Bundle-SymbolicName&gt;
                &lt;Bundle-Description&gt;${pom.name}&lt;/Bundle-Description&gt;
                &lt;Import-Package&gt;${import.packages}&lt;/Import-Package&gt;
                &lt;Private-Package&gt;${private.packages}&lt;/Private-Package&gt;
                &lt;Include-Resource&gt;${include.resources}&lt;/Include-Resource&gt;
                &lt;Embed-Dependency&gt;${embed-dep}&lt;/Embed-Dependency&gt;
                &lt;_exportcontents&gt;${export.packages}&lt;/_exportcontents&gt;
            &lt;/instructions&gt;
        &lt;/configuration&gt;
        &lt;extensions&gt;true&lt;/extensions&gt;
     &lt;/plugin&gt;
    &lt;/plugins&gt;
    &lt;/build&gt;

    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;c3p0&lt;/groupId&gt;
        &lt;artifactId&gt;c3p0&lt;/artifactId&gt;
        &lt;version&gt;0.9.1.2&lt;/version&gt;
        &lt;scope&gt;provided&lt;/scope&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre><p></p> <p>Packaging the project will create an OSGi bundle, identical in content with the original one expect for the MANIFEST.MF which will contain the OSGi entries. </p> <p>Notice the usage of properties for externalizing the plug-in configuration. When working with multiple project inside a module, the properties allow the generic plug-in configuration to be placed inside the top level pom and for each sub-module to override it by specifying different properties values. A live <a href="https://springframework.svn.sourceforge.net/svnroot/springframework/osgi-repo/trunk">example</a> of such a setup is the Spring-DM osgi repository.</p> <p>It is important to know that Bnd considers all the classes available on the classpath when creating a bundle. When using Bnd from the command line, as in the previous example, the classpath is formed only by a jar so no extra classes besides c3p0 exist. However, when using a building tool such as Maven or Ant, the classpath is considerably larger - in this case, based on your Export/Import package directives, Bnd might add or discard classes from the resulting jar. To prevent this, make sure to use patterns matching just the actual package included, i.e: com.mchange.* instead of *.</p> <h3>Custom, in-house tool</h3> <p>Another approach, though not likely to be encountered, is to create a customized tool, usually based on bytecode analysis. Such an utility can be highly customized for certain environments to gain speed or minimize the memory print or to support additional heuristics or configuration files. Spring Dynamic Modules contains such an internal, <a href="http://asm.objectweb.org/">ASM</a>-based byte-code parser for its test framework, to efficiently create on-the-fly MANIFEST.MFs.</p> <p>For generic use however, Bnd tool (either vanilla or through its Maven integration) provides much more options and works quite fast. In fact, the more general the usage becomes, the more likely Bnd will fit the bill through its high customizability.</p><h2>Using existing OSGi repository</h2> <p>These being said, before wrapping existing libraries as OSGi bundles, check whether somebody already did it for you. You can do that by checking one of the existing OSGi repositories:</p> <p><a href="http://www.osgi.org/Repository/HomePage">OSGi Bundle Repository (ORB)</a> - OSGi Alliance bundles repository which provides &quot;a federated collection of bundles&quot;.</p> <p><a href="https://www.eclipse.org/orbit/">Eclipse Orbit</a> - which contains artifacts usable inside Eclipse environment. Since Eclipse uses Equinox, the artifacts might contain Equinox specific Manifest entries</p> <p><a href="https://felix.apache.org/site/apache-felix-commons.html">Apache Felix Commons</a> - which aims at &quot;sharing [&hellip;] bundlized artifacts&quot;</p> <p><a href="https://wiki.apache.org/commons/CommonsOsgi">Apache OSGified projects</a> - a simple page that indicates the Apache Commons projects that have or are about to include the OSGi manifest entries into their official distribution.</p> <p>Hopefully, with the community help, many of the popular Java libraries out there will be OSGi-friendly by default and using a separate repository or wrapping the jar will not be necessary. Until then you can help out by providing patches to the projects you use or by simply asking for this feature.</p> <p>Before ending this post, I would like to invite all of you interested in OSGi and Spring Dynamic Modules to an upcoming <a href="http://www.springsource.com/web/guest/webinars">webinar</a> next week, on Wednesday Feb 27<sup>th</sup>, that will cover the core OSGi concepts and Spring DM fundamentals.</p></p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 136;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>
Back
</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">All Posts</a>
<a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">Engineering</a>
<a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">Releases</a>
<a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">News and Events</a>
<a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>Get updates from The Spring Team delivered to your inbox</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">Tools</a></li>
<li><a href="https://store.pivotal.io/">Store</a></li>
<li><a href="/blog">Newsletter</a></li>
</ul>
</div>
</div>
&copy; <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a>, Inc. All Rights Reserved.
<a href="https://pivotal.io/terms-of-use">Terms of Use</a> &bullet;
<a href="https://pivotal.io/privacy-policy">Privacy</a> &bullet;
<a href="/trademarks">Trademark Guidelines</a>
<div id="teconsent" style="display:inline-block;"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>