<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>Spring Batch最近的更改和即将发布的M4版本</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Spring Batch Recent Changes and Upcoming m4 Release">
<meta name="twitter:description" >
<meta name="twitter:creator" content="@david_syer">
<meta name="twitter:image:src" content="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=200">

<meta property="og:title" content="Spring Batch Recent Changes and Upcoming m4 Release">
<meta property="og:image" content="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=200">
<meta property="og:description" >
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2008-02-04 22:57:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">Spring Batch最近的更改和即将发布的M4版本</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="https://gravatar.com/avatar/ae671230e3a1c2a0eefa7604990084f1?s=20&d=mm"> <a class="author" rel="author" href="/team/dsyer">戴夫·瑟</a>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2008-02-04 22:57:00.0">2008年2月4日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2008/02/04/spring-batch-recent-changes-and-upcoming-m4-release#disqus_thread" data-disqus-identifier="135">
</a></div>
</div>
</header>
<div class="blog--post"><p>我们一直在非常努力地为Spring Batch做好准备，以准备<a href="http://www.springframework.org/projects">Spring Portfolio</a> 2.5发行版，我认为这是一个向所有人更新正在发生的事情的好时机。在本文中，我将对域建模进行一些扩展，并决定提高某些核心域对象的性能并增加其职责。我还将介绍在1.0之前的下几个发行版中将要发布的内容，因此人们可以根据需要发表评论。</p><p>道歉：自从我上次在博客上发布以来，Spring Batch的内部发生了相当大的变化，因此我感到自己一直在疏忽。在本文中，我认为我无法涵盖所有更改，但是我可以保证将来会尝试保持最新状态，并且随着1.0版本的到来，我一定会保持最新状态。（注意，Spring Portfolio 2.5发行版包含Spring Batch 1.0。）</p><p>因为自1.0.0-m3起我们已经修复了70个或更多的问题，所以我们认为是时候解决问题了。我们上周制定的计划是明天（2月5日）发布1.0.0-m4，范围比计划的要窄一些（例如，推迟XML名称空间的实现）。然后1.0.0-m5大约会在10-14天后到来，至少要有一个候选版本的时间才能在3月20日最终发布1.0.0。</p>
<h3>春季批处理核心</h3><p>Spring Batch Core是一个紧凑的API。实际上，如果我们一定希望批处理应用程序开发人员实现或扩展它，那么它实际上包含的内容并不多，因此实际上是一个内部API。尽管如此，它对Spring Batch用户产生了深远的影响，因为它影响了我们对批处理作业及其执行以及（对于用户而言更重要的是）其实现，配置和部署的思考方式。</p>
<h4>作业和步骤以及数据模型</h4><p>在1.0.0-m3以下，我们遇到了一个经典案例，即API与批处理通用语言之间不匹配。我们不得不继续说明，大多数人会认为<tt>JobConfiguration</tt>是一个“工作”（与<tt>StepConfiguration</tt>和“ Step”相同）。“作业”是您配置为每天运行的事物，但是每次运行时，它都有一个新的标识。这清楚地表明“作业”是域概念的名称，那么为什么我们将其称为“作业配置”？好问题。因此，现在（在1.0.0-m4中），用户配置的东西就是<tt>Job</tt> ，当它运行时，我们创建一个新的<tt>JobInstance</tt> 。<tt>Step</tt>和<tt>StepInstance也是如此</tt> 。因此，实体原型是由<tt>* Instance</tt>对象实现的-它们在数据库中具有一个ID和一个主键。例如，[[日末<tt>作业</tt> ]的[ <tt>JobInstance</tt>生效于2008年2月2日]。</p><p>其他实体成见<tt>JobExecution</tt>和<tt>StepExecution。</tt>自m3以来，这些都没有更改其名称或职责。当<tt>JobInstance</tt>执行我们创建一个<tt>JobExecution（</tt>确保实例是不是已经先执行）。此时[2月2日<tt>JobExecution</tt>在晚上10点]，在<tt>[JobInstance</tt>有效的2月2日2008]对[“结束日” <tt>工作</tt> ]中，推出。不过，如果失败，并且重新开始的第二天，那么我们就需要一个新的[在下午10点12分在2月3日<tt>JobExecution]</tt>为同一<tt>JobInstance（</tt>即[[[day-of-day] <tt>Job</tt> ]的<tt>JobInstance</tt>于2008年2月2日生效）。因此<tt>工作</tt>是1对多的与<tt>JobInstance，</tt>而这又是1对多的与<tt>JobExecution。</tt><tt>步骤*也是如此</tt> 。</p>
<h4>工作与步骤与执行</h4><p>我们还针对执行1.0.0-m4中的<tt>作业</tt>和<tt>步骤</tt>对API进行了更改。截至1.0.0-M3我们必须对每个执行单独的接口- <tt>个JobExecutor</tt>执行<tt>工作</tt> ，并<tt>StepExecutor</tt>执行<tt>步骤</tt> 。正如我们在设计时所想到的那样，它具有封装的好处-我们想象到了<tt>StepExecutor的</tt>多个实现都能够执行同一<tt>Step</tt> 。在实践中，随着我们更多地了解实现的轮廓，我们发现这是人为的区别。有趣的是，信号表明我们在<tt>StepExecutor</tt>实现中在Java中进行了太多的“ instanceof”检查-他们总是必须对不同的<tt>Step</tt>实现进行特殊处理。最后，很明显，每个<tt>步骤</tt>都必须知道如何执行自己。与所有这些见解一样，当您看到它时很明显，但是直到那时，它什么都没有。谢谢<a href="https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215">埃里克·埃文斯（Eric Evans）</a> 。</p><p>因此，例如， <tt>Step</tt>域的中央接口是</p>
<pre><code class="prettyprint java"><br />public interface Step {

    // ... properties that the Job needs to know here ...

    void execute(StepExecution stepExecution) 
         throws StepInterruptedException, BatchCriticalException;

}
</code></pre><p>不需要<tt>步骤</tt>从<tt>execute</tt>方法返回任何内容，因为传入的<tt>StepExecution</tt>在<tt>步骤</tt> <tt>执行</tt>过程中会更新。它由调用方传递，并且可以在需要时用于监视执行进度。它也可以用来停止执行，如果主叫方需要中断工作（因此<tt>StepInterruptedException），</tt>只是<tt>setTerminateOnly（）</tt>设置一个标志。这是几个人问我的事情，因此在这里可能值得一提：该<tt>步骤</tt>负责在任何可能的地方检查该标志的值，因此该框架中内置了一种机制，用于通知a的提前终止工作。设置标志的效果取决于<tt>Step</tt>的实现，但是我们提供了一个<tt>SimpleStep</tt> ，它将在处理完每个项目之后检查标志，并在必要时中止。它还接受一个<tt>StepInterruptPolicy</tt>策略，该策略可用于检查其他异常情况（例如<tt>Thread.isInterrupted（）</tt> ）。</p>
<h3>Spring Batch命名空间</h3><p>Spring Batch几乎是一个完美的示例，该示例展示了XML XML名称空间可以使应用程序开发人员更轻松地进行工作。我们尚未实现<tt>NamespaceHandler</tt> ，但已计划将其用于下一个里程碑1.0.0-m5，因此现在是您了解示例感觉的好时机。</p><p>座右铭是“使配置看起来像域模型”，并且本着这种精神，请看一下此示例，看看它是否有意义。它是新名称空间的草稿，它模仿了现有的固定长度导入示例作业，因此您熟悉的人将看到这些相似之处。如果您需要查找现有样本，只需转到Spring Batch主页以下载该版本（固定长度的样本配置也可以<a href="http://fisheye3.cenqua.com/browse/springframework/spring-batch/trunk/spring-batch-samples/src/main/resources/jobs/fixedLengthImportJob.xml">在此处</a>浏览）。</p>
<pre><code class="prettyprint xml"><br />&lt;batch&gt;

	&lt;job id=&quot;fixedLengthImportJob&quot; volatile=&quot;false&quot;&gt;
		&lt;simple-step id=&quot;step1&quot; chunk-size=&quot;50&quot; save-restart-data=&quot;false&quot;
			allow-start-if-complete=&quot;true&quot; reader-ref=&quot;fileInputTemplate&quot;&gt;
			&lt;processor&gt;
				&lt;beans:bean
					class=&quot;org.springframework.batch.sample.item.processor.TradeProcessor&quot;&gt;
					&lt;property name=&quot;writer&quot; ref=&quot;tradeDao&quot; /&gt;
				&lt;/beans:bean&gt;
			&lt;/processor&gt;
			&lt;simple-completion-policy skipLimit=&quot;5&quot; /&gt;
		&lt;/simple-step&gt;
		&lt;simple-step id=&quot;step2&quot; chunk-size=&quot;200&quot;&gt;
			&lt;jdbc-cursor-reader data-source-ref=&quot;dataSource&quot;&gt;
				&lt;query&gt;&lt;![CDATA[SELECT ID FROM T_TRADE ORDER BY ID WHERE PROCESSED=&#39;N&#39;]]&gt;&lt;/query&gt;
			&lt;/jdbc-cursor-reader&gt;
			&lt;processor&gt;
				&lt;beans:bean
					class=&quot;org.springframework.batch.sample.item.processor.TradeUpdater&quot;&gt;
					&lt;property name=&quot;dao&quot; ref=&quot;tradeDao&quot; /&gt;
				&lt;/beans:bean&gt;
			&lt;/processor&gt;
		&lt;/simple-step&gt;
		&lt;tasklet-step id=&quot;step3&quot; chunk-size=&quot;1&quot;&gt;
			&lt;tasklet&gt;
				&lt;beans:bean
					class=&quot;org.springframework.batch.sample.sproc.TradeSummarizer&quot;
					p:dataSource-ref=&quot;dataSource&quot; /&gt;
			&lt;/tasklet&gt;
		&lt;/tasklet-step&gt;
	&lt;/job&gt;

	&lt;!-- INFRASTRUCTURE SETUP --&gt;

	&lt;flat-file-reader id=&quot;fileInputTemplate&quot;
		resource=&quot;data/fixedLengthImportJob/input/20070122.teststream.ImportTradeDataStep.txt&quot;
		field-set-mapper-ref=&quot;fieldSetMapper&quot;
		validator-ref=&quot;fixedValidator&quot;&gt;
		&lt;fixed-length-tokenizer&gt;
			&lt;columns&gt;
				ISIN=1-12 Quantity=13-15 Price=16-20 Customer=21-29
			&lt;/columns&gt;
		&lt;/fixed-length-tokenizer&gt;
	&lt;/flat-file-reader&gt;

	&lt;beans:bean id=&quot;fixedValidator&quot;
		class=&quot;org.springframework.batch.item.validator.SpringValidator&quot;&gt;
		&lt;property name=&quot;validator&quot;&gt;
			&lt;bean id=&quot;tradeValidator&quot;
				class=&quot;org.springmodules.validation.valang.ValangValidator&quot;&gt;
				&lt;property name=&quot;valang&quot;&gt;
					&lt;value&gt;
						&lt;![CDATA[
						{ isin : length(?) &lt; 13 : &#39;ISIN too long&#39; : &#39;isin_length&#39; : 12}
					]]&gt;
					&lt;/value&gt;
				&lt;/property&gt;
			&lt;/bean&gt;
		&lt;/property&gt;
	&lt;/beans:bean&gt;

	&lt;beans:bean id=&quot;tradeDao&quot;
		class=&quot;org.springframework.batch.sample.dao.JdbcTradeWriter&quot;&gt;
		&lt;property name=&quot;jdbcTemplate&quot; ref=&quot;jdbcTemplate&quot; /&gt;
		&lt;property name=&quot;incrementer&quot;&gt;
			&lt;bean parent=&quot;incrementerParent&quot;&gt;
				&lt;property name=&quot;incrementerName&quot; value=&quot;TRADE_SEQ&quot; /&gt;
			&lt;/bean&gt;

		&lt;/property&gt;
	&lt;/beans:bean&gt;

	&lt;beans:bean id=&quot;fieldSetMapper&quot;
		class=&quot;org.springframework.batch.sample.mapping.TradeFieldSetMapper&quot; /&gt;

&lt;/batch&gt;
</code></pre><p>请注意，如何隐藏“ <tt>作业”</tt>和“ <tt>步骤</tt> ”的实施细节-两者之间有区别<tt><simple-step></simple-step></tt>和<tt><tasklet-step></tasklet-step></tt> ，但是唯一可见的差异是用户必须了解的差异。用户不需要知道支持此配置的<tt>Step</tt>接口有不同的实现，但是隐藏面向项目和面向任务的步骤这一事实并没有被隐藏。我们认为这对用户很重要。当我们起草这些XML示例时，我们从现有的Spring Batch示例中获取了几个示例，并对其进行了破解，直到包含相同的配置信息，但在大多数情况下，文件的整体大小减少了50％或更多。这必须意味着我们走在正确的轨道上。</p>
<h3>后记</h3><p>这是对Spring Batch和一些最新更改的快速快速但相当深入的了解。关于框架使用和实现方面的经验，我可以与您分享更多有趣的内容。我的<a href="http://java.sun.com/javaone/sf/index.jsp">JavaOne</a>演示文稿已被接受，这意味着您可以期待五月份在旧金山学习更多信息，并希望听到更多有关真实批处理的示例。此外，随着2.5版本的发布即将开始，请在此博客上查找更多信息（从用户的角度来看！）。</p><p>最后，我要向在Spring Batch开发过程中发挥作用的Lucas Ward和Ben Hale致敬。我也要欢迎Robert Kasanicky作为我们的最新提交者-Robert已为Spring Batch贡献了一些非常高质量的代码，我相信他会继续这样做，因为我们总结了1.0并开始着手下一个主要版本的开发。如果其他人有兴趣提供帮助，Robert会按照正常的过程在论坛和JIRA上闲逛，提供想法和（至关重要的）补丁。我提名了他，我们进行了投票，现在他是团队的正式成员。</p><p>如果您需要澄清文章中的任何内容，请在此处随意评论。有关Spring Batch的一般讨论，请使用<a href="http://forum.springframework.org/forumdisplay.php?f=41">论坛</a> 。Spring Batch的主页<a href="http://www.springframework.org/spring-batch">在这里</a> ，或者可以从<a href="http://www.springframework.org/">Spring主页上</a>轻松找到</p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 135;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">球队</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>