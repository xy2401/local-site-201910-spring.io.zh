<html  data-code-prettify="" data-mobile-support="" data-search=""><head>
<title>在SpringSource应用程序平台上使用EclipseLink</title>
<meta id="Viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1, user-scalable=no">
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon-ca31b78daf0dd9a106bbf3c6d87d4ec7.png">
<link href="asset?aid=0" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/main-bc256dba5f9d253d6425441ccfb82576.css">
<script src="/jspm_packages/system-eccc019329febb5a1b06bde008ca5614.js"></script>
<script>
    System.config({baseURL: "/b92013b"});
  </script>
<script src="/config-5a675c9cddea3a5f55b71416e67d47d6.js"></script>
<script>
      System.import('app/main.js')
  </script>
<meta name="google-site-verification" content="7qGntFPD9lWAVCtUu5U77v4l68PsTHf6xpzgjQv2j2M">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KZM7GF6');</script>

<link href="/css/blog-92993c3ec6808bded45b277c18d7d621.css" rel="stylesheet" type="text/css">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@springcentral">
<meta name="twitter:title" content="Using EclipseLink on the SpringSource Application Platform">
<meta name="twitter:description" >
<meta property="og:title" content="Using EclipseLink on the SpringSource Application Platform">
<meta property="og:description" >
<meta content="article" property="og:type">
<meta property="og:article:published_time" content="2008-07-17 09:31:00.0">



<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-KZM7GF6" width="0" style="display:none"></iframe></noscript>

<script type="text/javascript">
    // Work around Google font rendering issues in webkit browsers on Windows 7
    if (navigator.userAgent.indexOf("NT 6.1") != -1) {
      document.body.style.WebkitTextStroke = "0.5px";
    }
  </script>
<div class="viewport">
<header class="navbar header--navbar desktop-only">
<div class="navbar-inner">
<div class="container-fluid">
<div class="spring-logo--container">
<a class="spring-logo" href="/"><span></span></a>
</div>
<ul class="nav pull-right">
<li class="navbar-link">
<a href="/projects">专案</a>
</li>
<li class="navbar-link">
<a href="/guides">导游</a>
</li>
<li class="navbar-link active">
<a href="/blog">博客</a>
</li>
<li class="navbar-link">
<a href="/services">培训与认证</a>
</li>
<li class="navbar-link nav-search js-nav-search">
<a>
<i class="icon-search navbar-search--icon js-search-input-open"></i>
<span class="search-input-close js-search-input-close">
<i class="icon-remove"></i>
</span>
</a>
</li>
</ul>
</div>
</div>
<div class="search-dropdown--container js-search-dropdown">
<div class="container-fluid">
<div class="search-form--container">
<form class="form-inline form-search" action="/search" method="get">
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索文档，指南和帖子..." type="text" value="">
<button class="search-form--submit" type="submit"></button>
</form>
</div>
</div>
</div>
</header>
<div>
<div class="mobile-navigation--wrapper mobile-only">
<div class="navigation-drawer--container">
<div class="mobile-search--container">
<form class="form-inline form-search" action="/search" method="get">
<button class="search-form--submit" type="submit"></button>
<input class="search-query search-form--form js-search-input" name="q" placeholder="搜索..." type="text" value="">
</form>
</div>
<div class="navigation-item-list">
<div class="navbar-link">
<a href="/">家<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/projects">专案<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/guides">导游<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link active">
<a href="/blog">博客<i class="icon-chevron-right pull-right"></i>
</a>
</div>
<div class="navbar-link">
<a href="/services">培训与认证<i class="icon-chevron-right pull-right"></i>
</a>
</div>
</div>
</div>
<div class="mobile-nav">
<div class="nav-icon js-open-nav-drawer">
<i class="icon-reorder"></i>
</div>
<div class="header-center-icon">
<a href="/">
<div class="icon icon-spring-logo-mobile"></div>
</a>
</div>
</div>
</div>
</div>
<div class="header--container"></div>
<div class="container-fluid"></div>
<div></div>
<div class="container-fluid">
<div class="main-body--wrapper">
<div class="row-fluid blog--wrapper">
<article class="span8 mobile-left-pane" id="content">
<header class="desktop-only">
<div class="blog-category active content--title">
<div>工程</div>
</div>
<div class="blog-category content--title">
<div>发布</div>
</div>
<div class="blog-category content--title">
<div>新闻与活动</div>
</div>
</header>
<div class="blog--container">
<header>
<h1 class="blog--title">在SpringSource应用程序平台上使用EclipseLink</h1>
<div class="meta-data--container">
<div class="meta-data--item desktop-only">
<div class="meta-data--icon icon blog-icon engineering"></div>
<a class="category">工程</a>
</div>
<div class="meta-data--item">
<img class="meta-data--icon" src="null?s=20&d=mm"> <span class="author">罗伯·哈罗普</span>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon calendar"></div>
<time class="date" pubdate="" datetime="2008-07-17 09:31:00.0">2008年7月17日</time>
</div>
<div class="meta-data--item">
<div class="meta-data--icon icon blog-icon comments"></div>
<a class="comments" href="/blog/2008/07/17/using-eclipselink-on-the-springsource-application-platform#disqus_thread" data-disqus-identifier="167">
</a></div>
</div>
</header>
<div class="blog--post"><p><br><br> <br> <title></title><br> <br> <br> </p><p><br>本周EclipseLink团队<a href="https://eclipselink.blogspot.com/2008/07/eclipselink-10-released.html">宣布了EclipseLink 1.0的发布</a> 。我已经在S2AP上使用EclipseLink已有一段时间了。实际上，在开发JPA加载时编织支持时，我使用了EclipseLink。<br> </p><br> <p><br>我们还没有将内部使用升级到1.0-我们的beta9在声明之前被标记了-但是我想证明配对在OSGi环境中的有效性。<br> </p><br> <h2 id="eclipselink-in-petclinic"><br>Petclinic中的EclipseLink<br> </h2><br> <p><br>在S2AP Petclinic示例的<a href="http://dist.springsource.com/release/AP/petclinic-1.2.0.RELEASE.zip">1.2.0版本</a>中，我们发布了<span style="font-family:courier">Clinic</span>后端的EclipseLink实现。后端是先前唯一选择的JDBC后端的直接替代。<br> </p><br> <h2 id="building-petclinic-eclipselink"><br>构建Petclinic EclipseLink<br> </h2><br> <p><br>要构建Petclinic的EclipseLink版本，只需在Petclinic根目录中打开一个终端窗口并运行：<br> </p><p></p>
<pre><code class="prettyprint code">cd org.springframework.petclinic.eclipselink
ant collect-provided jar
</code></pre>
<pre><code class="prettyprint">    &lt;p&gt;
       This will create the Petclinic EclipseLink PAR file in  &lt;span style=&quot;font-family:courier&quot;&gt;org.springframework.petclinic.eclipselink/target/artifacts/org.springframework.petclinic.eclipselink.par&lt;/span&gt; and will put all the required bundles in  &lt;span style=&quot;font-family:courier&quot;&gt;org.springframework.petclinic.eclipselink/target/par-provided/bundles/&lt;/span&gt;.
    &lt;/p&gt;
    &lt;h2 id=&quot;running-petclinic-eclipselink&quot;&gt;
       Running Petclinic EclipseLink
    &lt;/h2&gt;
    &lt;p&gt;
       To run the Petclinic EclipseLink application, copy all the provided bundles to the S2AP repository directory:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint code">cp target/par-provided/bundles/*.jar $PLATFORM_HOME/repository/bundles/usr
</code></pre>
<pre><code class="prettyprint">    &lt;p&gt;
       And then copy the PAR file to the S2AP  &lt;span style=&quot;font-family:courier&quot;&gt;pickup&lt;/span&gt; directory:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint code">cp target/artifacts/org.springframework.petclinic.eclipselink.par $PLATFORM_HOME/pickup
</code></pre>
<pre><code class="prettyprint">    &lt;p&gt;
       Once that is done, you can start the HSQLDB database needed by the Petclinic application:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint code">cd $PETCLINIC_ROOT
cd db/hsqldb
chmod +x server.sh
./server.sh
</code></pre>
<pre><code class="prettyprint">    &lt;p&gt;
       Now start the S2AP instance:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint code">$PLATFORM_HOME/bin/startup.sh
</code></pre>
<pre><code class="prettyprint">    &lt;p&gt;
       When this is complete you should see log messages like this:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint code">[2008-07-11 10:03:24.560] fs-watcher               &lt;SPSC1000I&gt; Creating web application &#39;/petclinic&#39;.
[2008-07-11 10:03:27.419] async-delivery-thread-1  &lt;SPSC1001I&gt; Starting web application &#39;/petclinic&#39;.
[2008-07-11 10:03:27.904] fs-watcher               &lt;SPDE0010I&gt; Deployment of &#39;org.springframework.petclinic.eclipselink&#39; version &#39;1.2.0.BUILD-20080711085448&#39; completed.
</code></pre>
<pre><code class="prettyprint">    &lt;h2 id=&quot;testing-petclinic-eclipselink&quot;&gt;
       Testing Petclinic EclipseLink
    &lt;/h2&gt;
    &lt;p&gt;
       To try the application out, simply hit  &lt;span style=&quot;font-family:courier&quot;&gt;http://localhost:8080/petclinic&lt;/span&gt;:
    &lt;/p&gt;
    &lt;p&gt;
       &lt;img alt=&quot;Petclinic Home Page&quot; src=&quot;http://blog.springsource.com/main/wp-content/uploads/2008/07/petclinic.png&quot; /&gt;
    &lt;/p&gt;
    &lt;h2 id=&quot;modularity-in-petclinic-eclipselink&quot;&gt;
       Modularity in Petclinic EclipseLink
    &lt;/h2&gt;
    &lt;p&gt;
       The Petclinic EclipseLink application is made up of six bundles:
    &lt;/p&gt;
    &lt;p&gt;
       &lt;img src=&quot;http://blog.springsource.com/main/wp-content/uploads/2008/07/modules.png&quot; alt=&quot;Module Layout&quot; /&gt;
    &lt;/p&gt;
    &lt;p&gt;
       The  &lt;span style=&quot;font-family:courier&quot;&gt;domain&lt;/span&gt;,  &lt;span style=&quot;font-family:courier&quot;&gt;web&lt;/span&gt;,  &lt;span style=&quot;font-family:courier&quot;&gt;repository&lt;/span&gt; and  &lt;span style=&quot;font-family:courier&quot;&gt;infrastructure&lt;/span&gt; bundles are common across all versions of the application. These bundles have the following roles:
    &lt;/p&gt;
    &lt;ul&gt;
       &lt;li&gt;
          &lt;span style=&quot;font-family:courier&quot;&gt;domain&lt;/span&gt; - contains the persistent types such as  &lt;span style=&quot;font-family:courier&quot;&gt;Pet&lt;/span&gt; and  &lt;span style=&quot;font-family:courier&quot;&gt;Vet&lt;/span&gt;
       &lt;/li&gt;
       &lt;li&gt;
          &lt;span style=&quot;font-family:courier&quot;&gt;repository&lt;/span&gt; - contains the main repository interface  &lt;span style=&quot;font-family:courier&quot;&gt;Clinic&lt;/span&gt;
       &lt;/li&gt;
       &lt;li&gt;
          &lt;span style=&quot;font-family:courier&quot;&gt;web&lt;/span&gt; - contains all the web front-end classes and configuration
       &lt;/li&gt;
       &lt;li&gt;
          &lt;span style=&quot;font-family:courier&quot;&gt;infrastructure&lt;/span&gt; - defines the  &lt;span style=&quot;font-family:courier&quot;&gt;DataSource&lt;/span&gt; to connect to HSQLDB and exports this as a service
       &lt;/li&gt;
    &lt;/ul&gt;
    &lt;p&gt;
       Note that the  &lt;span style=&quot;font-family:courier&quot;&gt;web&lt;/span&gt; bundle only depends on the  &lt;span style=&quot;font-family:courier&quot;&gt;domain&lt;/span&gt; and  &lt;span style=&quot;font-family:courier&quot;&gt;repository&lt;/span&gt; bundles at the module level. This means that  &lt;span style=&quot;font-family:courier&quot;&gt;web&lt;/span&gt; only needs types from those two bundles. In the case of  &lt;span style=&quot;font-family:courier&quot;&gt;Clinic&lt;/span&gt; which is an interface, the  &lt;span style=&quot;font-family:courier&quot;&gt;web&lt;/span&gt; bundle gets its implementation from OSGi:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint xml"> &lt;reference id=&quot;clinic&quot; interface=&quot;org.springframework.petclinic.repository.Clinic&quot;/&gt;
</code></pre>
<pre><code class="prettyprint">    &lt;h3 id=&quot;basic-jpa-implementation-and-configuration&quot;&gt;
       Basic JPA Implementation and Configuration
    &lt;/h3&gt;
    &lt;p&gt;
       The implementation of the  &lt;span style=&quot;font-family:courier&quot;&gt;Clinic&lt;/span&gt; interface is provided by the  &lt;span style=&quot;font-family:courier&quot;&gt;repository.jpa&lt;/span&gt; bundle. It is worthwhile looking at the implementation and configuration of this bundle in some detail. The  &lt;span style=&quot;font-family:courier&quot;&gt;EntityManagerClinic&lt;/span&gt; class implements  &lt;span style=&quot;font-family:courier&quot;&gt;Clinic&lt;/span&gt; using JPA:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint java">@Repository
@Transactional
public class EntityManagerClinic implements Clinic {

    @PersistenceContext
    private EntityManager em;


    @Transactional(readOnly = true)
    @SuppressWarnings(&quot;unchecked&quot;)
    public Collection&lt;Vet&gt; getVets() {
        return this.em.createQuery(&quot;SELECT vet FROM Vet vet ORDER BY vet.lastName, vet.firstName&quot;).getResultList();
    }

    @Transactional(readOnly = true)
    @SuppressWarnings(&quot;unchecked&quot;)
    public Collection&lt;PetType&gt; getPetTypes() {
        return this.em.createQuery(&quot;SELECT ptype FROM PetType ptype ORDER BY ptype.name&quot;).getResultList();
    }

    @Transactional(readOnly = true)
    @SuppressWarnings(&quot;unchecked&quot;)
    public Collection&lt;Owner&gt; findOwners(String lastName) {
        Query query = this.em.createQuery(&quot;SELECT owner FROM Owner owner WHERE owner.lastName LIKE :lastName&quot;);
        query.setParameter(&quot;lastName&quot;, lastName + &quot;%&quot;);
        return query.getResultList();
    }

    @Transactional(readOnly = true)
    public Owner loadOwner(int id) {
        return this.em.find(Owner.class, id);
    }

    @Transactional(readOnly = true)
    public Pet loadPet(int id) {
        return this.em.find(Pet.class, id);
    }

    public void storeOwner(Owner owner) {
        // Consider returning the persistent object here, for exposing
        // a newly assigned id using any persistence provider...
        Owner merged = this.em.merge(owner);
        this.em.flush();
        owner.setId(merged.getId());
    }

    public void storePet(Pet pet) {
        // Consider returning the persistent object here, for exposing
        // a newly assigned id using any persistence provider...
        Pet merged = this.em.merge(pet);
        this.em.flush();
        pet.setId(merged.getId());
    }

    public void storeVisit(Visit visit) {
        // Consider returning the persistent object here, for exposing
        // a newly assigned id using any persistence provider...
        Visit merged = this.em.merge(visit);
        this.em.flush();
        visit.setId(merged.getId());
    }

}
</code></pre>
<pre><code class="prettyprint">    &lt;p&gt;
       This class depends on a standard JPA  &lt;span style=&quot;font-family:courier&quot;&gt;EntityManager&lt;/span&gt; which is annotated for injection using  &lt;span style=&quot;font-family:courier&quot;&gt;@PersistenceContext&lt;/span&gt;. The transaction configuration is defined using Spring&#39;s  &lt;span style=&quot;font-family:courier&quot;&gt;@Transactional&lt;/span&gt; annotation. The configuration for the  &lt;span style=&quot;font-family:courier&quot;&gt;EntityManagerClinic&lt;/span&gt; is contained in  &lt;span style=&quot;font-family:courier&quot;&gt;module-context.xml&lt;/span&gt;:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint xml">&lt;bean id=&quot;clinic&quot; class=&quot;org.springframework.petclinic.repository.jpa.EntityManagerClinic&quot;/&gt;
</code></pre>
<pre><code class="prettyprint">    &lt;p&gt;
       The  &lt;span style=&quot;font-family:courier&quot;&gt;EntityManagerClinic&lt;/span&gt; needs to be injected with an  &lt;span style=&quot;font-family:courier&quot;&gt;EntityManager&lt;/span&gt;. Spring&#39;s JPA support provides the  &lt;span style=&quot;font-family:courier&quot;&gt;LocalContainerEntityManagerFactoryBean&lt;/span&gt; which provides access to a shared  &lt;span style=&quot;font-family:courier&quot;&gt;EntityManager&lt;/span&gt;:
    &lt;/p&gt;
    &lt;p&gt;
       To enable Spring transaction management, the configuration defines a  &lt;span style=&quot;font-family:courier&quot;&gt;JpaTransactionManager&lt;/span&gt;:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint xml">&lt;!-- JPA EntityManagerFactory --&gt;
&lt;bean id=&quot;entityManagerFactory&quot; class=&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;
    p:dataSource-ref=&quot;dataSource&quot;&gt;
    &lt;property name=&quot;jpaVendorAdapter&quot; ref=&quot;jpaVendorAdapter&quot; /&gt;
&lt;/bean&gt;
</code></pre>
<pre><code class="prettyprint">    &lt;p&gt;
       The  &lt;span style=&quot;font-family:courier&quot;&gt;JpaVendorAdapter&lt;/span&gt; defines which provider you are using, along with the provider-specific configuration. Rather than define the  &lt;span style=&quot;font-family:courier&quot;&gt;JpaVendorAdapter&lt;/span&gt; in-line, Petclinic uses an OSGi service to get the  &lt;span style=&quot;font-family:courier&quot;&gt;JpaVendorAdapter&lt;/span&gt; from another bundle. This allows for different JPA providers to be added without having to change the core  &lt;span style=&quot;font-family:courier&quot;&gt;repository.jpa&lt;/span&gt; bundle.
    &lt;/p&gt;
    &lt;p&gt;
       Enabling Spring&#39;s annotation-driven configuration will allow for the configured  &lt;span style=&quot;font-family:courier&quot;&gt;EntityManager&lt;/span&gt; to be injected into the  &lt;span style=&quot;font-family:courier&quot;&gt;EntityManagerClinic&lt;/span&gt;:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint xml">&lt;context:annotation-config/&gt;
</code></pre>
<pre><code class="prettyprint">    &lt;p&gt;
       Transactions are enabled using the  &lt;span style=&quot;font-family:courier&quot;&gt;JpaTransactionManager&lt;/span&gt; and annotation-driven configuration:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint xml">&lt;!-- Transaction manager for a single JPA EntityManagerFactory (alternative to JTA) --&gt;
&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;
        p:entityManagerFactory-ref=&quot;entityManagerFactory&quot;/&gt;

&lt;tx:annotation-driven mode=&quot;aspectj&quot;/&gt;
</code></pre>
<pre><code class="prettyprint">    &lt;p&gt;
       Notice that the configuration defines the transaction mode as  &lt;span style=&quot;font-family:courier&quot;&gt;aspectj&lt;/span&gt;. In this mode, AspectJ load-time weaving is used to apply the transaction behaviour. This requires that Spring&#39;s load-time weaving support be enabled and configured for AspectJ weaving:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint xml">&lt;context:load-time-weaver aspectj-weaving=&quot;on&quot;/&gt;
</code></pre>
<pre><code class="prettyprint">    &lt;p&gt;
       The  &lt;span style=&quot;font-family:courier&quot;&gt;LoadTimeWeaver&lt;/span&gt; is also used to support the weaving needed by EclipseLink when it transforms the persistent types. No special configuration is needed to use the S2AP  &lt;span style=&quot;font-family:courier&quot;&gt;LoadTimeWeaver&lt;/span&gt;; this will be added when the application is deployed.
    &lt;/p&gt;
    &lt;p&gt;
       The  &lt;span style=&quot;font-family:courier&quot;&gt;osgi-context.xml&lt;/span&gt; configuration pulls in the necessary services and exports the  &lt;span style=&quot;font-family:courier&quot;&gt;EntityManagerClinic&lt;/span&gt;:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint xml">&lt;service id=&quot;osgiClinic&quot;
         ref=&quot;clinic&quot;
         interface=&quot;org.springframework.petclinic.repository.Clinic&quot; /&gt;

&lt;reference id=&quot;dataSource&quot; interface=&quot;javax.sql.DataSource&quot;/&gt;
&lt;reference id=&quot;jpaVendorAdapter&quot; interface=&quot;org.springframework.orm.jpa.JpaVendorAdapter&quot;/&gt;
</code></pre>
<pre><code class="prettyprint">    &lt;p&gt;
       Notice that the  &lt;span style=&quot;font-family:courier&quot;&gt;JpaVendorAdapter&lt;/span&gt; is being referenced as an OSGi service - this allows the  &lt;span style=&quot;font-family:courier&quot;&gt;repository.jpa.eclipselink&lt;/span&gt; bundle to provide the exact  &lt;span style=&quot;font-family:courier&quot;&gt;JpaVendorAdapter&lt;/span&gt; needed to run with EclipseLink.
    &lt;/p&gt;
    &lt;h3 id=&quot;eclipselink-specific-configuration&quot;&gt;
       EclipseLink-specific configuration
    &lt;/h3&gt;
    &lt;p&gt;
       The configuration for the  &lt;span style=&quot;font-family:courier&quot;&gt;JpaVendorAdapter&lt;/span&gt; is contained in the  &lt;span style=&quot;font-family:courier&quot;&gt;repository.jpa.eclipselink&lt;/span&gt; bundle:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint xml">&lt;context:property-placeholder location=&quot;classpath:META-INF/spring/jpa.properties,classpath:org/springframework/petclinic/infrastructure/db.properties&quot; /&gt;

&lt;bean id=&quot;jpaVendorAdapter&quot; class=&quot;org.springframework.orm.jpa.vendor.EclipseLinkJpaVendorAdapter&quot;
    p:databasePlatform=&quot;${jpa.eclipselink.databasePlatform}&quot; p:showSql=&quot;${jpa.showSql}&quot;/&gt;;
</code></pre>
<pre><code class="prettyprint">    &lt;p&gt;
       The  &lt;span style=&quot;font-family:courier&quot;&gt;jpaVendorAdapter&lt;/span&gt; bean is then exported as an OSGi service:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint xml">&lt;service ref=&quot;jpaVendorAdapter&quot; interface=&quot;org.springframework.orm.jpa.JpaVendorAdapter&quot; /&gt;;
</code></pre>
<pre><code class="prettyprint">    &lt;h2 id=&quot;import-scopes&quot;&gt;
       Import Scopes
    &lt;/h2&gt;
    &lt;p&gt;
       To enable the  &lt;span style=&quot;font-family:courier&quot;&gt;Clinic&lt;/span&gt; implementation to be switched without having to make changes to the four core bundles, it is important that any changes are contained within the implementation bundles only. Unfortunately, this is not possible in standard OSGi.
    &lt;/p&gt;
    &lt;p&gt;
       When EclipseLink weaves a type, it adds dependencies on its own types to that type. For instance, weaving  &lt;span style=&quot;font-family:courier&quot;&gt;Vet&lt;/span&gt; will cause  &lt;span style=&quot;font-family:courier&quot;&gt;Vet&lt;/span&gt; and thus the  &lt;span style=&quot;font-family:courier&quot;&gt;domain&lt;/span&gt; bundle to depend on EclipseLink. One way of solving this is simply to add the appropriate  &lt;span style=&quot;font-family:courier&quot;&gt;Import-Package&lt;/span&gt; or  &lt;span style=&quot;font-family:courier&quot;&gt;Import-Bundle&lt;/span&gt; statements to the  &lt;span style=&quot;font-family:courier&quot;&gt;domain&lt;/span&gt; bundle. This is undesirable because it breaks the modularity - the  &lt;span style=&quot;font-family:courier&quot;&gt;domain&lt;/span&gt; bundle shouldn&#39;t care about how it is persisted.
    &lt;/p&gt;
    &lt;p&gt;
       This problem exists wherever bytecode transformation is used, and to a lesser degree where runtime class generation is used. For example, when using Hibernate, CGLIB is used to generate subclasses of persistent types. For the most part this is fine, except when some other code starts to reflect on objects of this dynamically generated type. This is quite common in web code, where reflection is used for data binding - all of a sudden the web bundle finds it has a dependency on Hibernate!
    &lt;/p&gt;
    &lt;p&gt;
       To solve this, S2AP supports the notion of Import Scopes. When using  &lt;span style=&quot;font-family:courier&quot;&gt;Import-Bundle&lt;/span&gt; inside an application, you can define that the scope of the import is the application. This will cause the import to be added to all the other modules in the application dynamically. This allows you to get the dependencies you need to make your application run, but without having to make changes to your application that might limit its flexibility.
    &lt;/p&gt;
    &lt;h3 id=&quot;configuring-import-scope&quot;&gt;
       Configuring Import Scope
    &lt;/h3&gt;
    &lt;p&gt;
       The  &lt;span style=&quot;font-family:courier&quot;&gt;repository.jpa&lt;/span&gt; bundle has no dependency on EclipseLink:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint code">Manifest-Version: 1.0
Bundle-Version: 1.0.0
Bundle-ManifestVersion: 2
Bundle-SymbolicName: org.springframework.petclinic.repository.jpa
Bundle-Name: PetClinic JPA-based Repository Implementation
Bundle-Vendor: SpringSource Inc.
Import-Library: org.springframework.spring;version=&quot;[2.5,2.6)&quot;
Import-Bundle: com.springsource.javax.persistence;version=&quot;[1.0.0,1.0.0]&quot;,
 com.springsource.org.aspectj.runtime;version=&quot;1.6.0&quot;,
 com.springsource.org.aspectj.weaver;version=&quot;1.6.0&quot;
Import-Package: javax.sql,
 org.apache.commons.logging,
 org.springframework.petclinic.domain,
 org.springframework.petclinic.repository
Export-Package: org.springframework.petclinic.repository.jpa
</code></pre>
<pre><code class="prettyprint">    &lt;p&gt;
       The  &lt;span style=&quot;font-family:courier&quot;&gt;repository.jpa.eclipselink&lt;/span&gt; bundle introduces the EclipseLink dependency and defines that all the application modules should see EclipseLink:
    &lt;/p&gt;
</code></pre>
<pre><code class="prettyprint code">Manifest-Version: 1.0
Bundle-ManifestVersion: 2
Bundle-Version: 1.0.0
Bundle-SymbolicName: org.springframework.petclinic.repository.eclipselink
Bundle-Name: PetClinic EclipseLink-based Repository Implementation
Bundle-Vendor: SpringSource Inc.
Import-Library: org.springframework.spring;version=&quot;[2.5,2.6)&quot;
Import-Bundle: com.springsource.org.eclipse.persistence;version=&quot;1.0.0.m5&quot;;import-scope:=application
Import-Package: org.apache.commons.logging,
 org.springframework.petclinic.infrastructure
Export-Package: org.springframework.petclinic.repository.eclipselink
</code></pre>
<pre><code class="prettyprint">    &lt;h2 id=&quot;summary&quot;&gt;
       Summary
    &lt;/h2&gt;
    &lt;p&gt;
       Using EclipseLink and JPA in the SpringSource Application Platform requires very little extra effort on your part. The Import Scope feature allows you to keep your non-EclipseLink modules completely isolated from your usage of EclipseLink.
    &lt;/p&gt;
&lt;/body&gt;
</code></pre><p></p></div>
</div>
<section id="disqus_thread"></section>
<script type="text/javascript">
      var disqus_shortname = 'spring-io';
      var disqus_identifier = 167;

      (function(disqus_shortname, document) {
        injectScript('//' + disqus_shortname + '.disqus.com/embed.js');
        injectScript('//' + disqus_shortname + '.disqus.com/count.js');

        function injectScript(url) {
          var s = document.createElement('script');
          s.async = true;
          s.src = url;
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
        }

      }(disqus_shortname, document));
    </script>
<noscript>请启用JavaScript以查看<a href="http://disqus.com/?ref_noscript">由Disqus提供</a>的<a href="http://disqus.com/?ref_noscript">评论。</a></noscript>
<a class="dsq-brlink" href="https://disqus.com">由<span class="logo-disqus">Disqus</span>提供动力的评论</a>
<div class="mobile-only">
<p><a href="/blog">
<i class="icon-chevron-left"></i>背部</a></p>
</div>
</article>
<aside class="span4 mobile-right-pane" id="sidebar">
<div>
<ul class="right-pane-widget--container secondary-nav with-icon">
<li class="blog-category">
<div class="icon blog-icon all-posts"></div>
<a href="/blog">所有帖子</a> <a class="pull-right" href="/blog.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category active">
<div class="icon blog-icon engineering"></div>
<a href="/blog/category/engineering">工程</a> <a class="pull-right" href="/blog/category/engineering.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon releases"></div>
<a href="/blog/category/releases">发布</a> <a class="pull-right" href="/blog/category/releases.atom"><i class="icon-rss"></i></a>
</li>
<li class="blog-category">
<div class="icon blog-icon news-and-events"></div>
<a href="/blog/category/news">新闻与活动</a> <a class="pull-right" href="/blog/category/news.atom"><i class="icon-rss"></i></a>
</li>
</ul>
<ul class="social-btn--container">
<a class="social-btn twitter" href="https://twitter.com/springcentral"></a>

<a class="social-btn linkedin" href="https://www.linkedin.com/groups/46964"></a>
<a class="social-btn youtube" href="/videos"></a>
</ul>
<div id="blog-sidebar-newsletter">
<p>将The Spring Team的更新发送到您的收件箱</p>
<script src="https://app-sj05.marketo.com/js/forms2/js/forms2.min.js"></script>
<form id="mktoForm_4723"></form>
<script>
        MktoForms2.loadForm("https://app-sj05.marketo.com", "625-IUJ-009", 4723, function(form){
          form.onSuccess(function(values, followUpUrl) {
            form.getFormElem().html("<p>Thank you!</p>");
            return false;
          });
        });
      </script>
</div>
</div>
</aside>
</div>
</div>
</div>
<footer class="footer">
<div class="container-fluid">
<div class="row-fluid">
<div class="span12">
<div class="navbar">
<div class="container">
<ul class="nav">
<li><a href="/team">Team</a></li>
<li><a href="/tools">工具类</a></li>
<li><a href="https://store.pivotal.io/">商店</a></li>
<li><a href="/blog">通讯</a></li>
</ul>
</div>
</div>© <span>2019</span> <a href="https://www.pivotal.io/">Pivotal Software</a> ，Inc.保留所有权利。
<a href="https://pivotal.io/terms-of-use">使用条款</a> • <a href="https://pivotal.io/privacy-policy">隐私</a> • <a href="/trademarks">商标准则</a>
<div id="teconsent" style="display:inline-block"></div>
</div>
</div>
</div>
</footer>
<div id="scrim"></div>
</div>
</body></html>